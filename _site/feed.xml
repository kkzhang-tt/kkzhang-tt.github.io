<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.9.1">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2023-03-13T23:29:04+08:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">Find a needle in haystack</title><subtitle></subtitle><author><name>kkzhang</name></author><entry><title type="html">Lion: Multi-Region Data Synchronization</title><link href="http://localhost:4000/multi-region-data-synchronization.html" rel="alternate" type="text/html" title="Lion: Multi-Region Data Synchronization" /><published>2023-03-12T00:00:00+08:00</published><updated>2023-03-12T00:00:00+08:00</updated><id>http://localhost:4000/multi-region-data-synchronization</id><content type="html" xml:base="http://localhost:4000/multi-region-data-synchronization.html">&lt;h1 id=&quot;1æ–‡æ¡£æ¦‚è¿°&quot;&gt;1ã€æ–‡æ¡£æ¦‚è¿°&lt;/h1&gt;

&lt;h2 id=&quot;11é¡¹ç›®èƒŒæ™¯&quot;&gt;1.1Â é¡¹ç›®èƒŒæ™¯&lt;/h2&gt;

&lt;p&gt;Lion ç›®å‰éƒ¨ç½²åœ¨åŒ—äº¬ï¼Œä¸Šæµ·ä¸¤ä¾§æ•°æ®ä¸­å¿ƒï¼ŒåŒ—ä¸Šä¸¤åœ°åŒå‘åŒæ­¥ã€‚å¯¹äºæœªæ¥æ€€æ¥ï¼Œé¦™æ¸¯æˆ–è€…å…¶ä»–æ•°æ®ä¸­å¿ƒçš„è§„åˆ’ï¼ŒLion æš‚ä¸æ”¯æŒå…¶ä»–æ•°æ®ä¸­å¿ƒçš„æ•°æ®åŒæ­¥ã€‚&lt;/p&gt;

&lt;p&gt;çŸ­æœŸå†…å¯ä»¥é€šè¿‡ Region å†…æµé‡é—­ç¯ï¼Œæ•°æ®è®¿é—®ä»ä½¿ç”¨åŒ—ä¸Šä¸¤åœ°æ•°æ®ä¸­å¿ƒçš„æ–¹æ¡ˆä¸´æ—¶æ”¯æŒï¼Œé•¿æœŸéœ€è¦æ¢ç´¢æ”¯æŒå¤šæ•°æ®ä¸­å¿ƒåŒæ­¥åŠŸèƒ½ã€‚&lt;/p&gt;

&lt;h2 id=&quot;12é¡¹ç›®ç›®æ ‡&quot;&gt;1.2Â é¡¹ç›®ç›®æ ‡&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;æ”¯æŒå¤šæ•°æ®ä¸­å¿ƒé—´æ•°æ®åŒæ­¥ï¼ˆåŒæ­¥æ–¹å‘å¯è‡ªå®šä¹‰è®¾ç½®ï¼‰&lt;/li&gt;
  &lt;li&gt;åŒä¸€ Region å†…æ•°æ®å’Œæµé‡é—­ç¯&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;13åè¯è§£é‡Š&quot;&gt;1.3Â åè¯è§£é‡Š&lt;/h2&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;åè¯&lt;/th&gt;
      &lt;th&gt;è§£é‡Š&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;DTS&lt;/td&gt;
      &lt;td&gt;ç¾å›¢å†…éƒ¨ä¸€ç§é›†æ•°æ®è®¢é˜…ã€æ•°æ®åŒæ­¥ã€æ•°æ®è¿ç§»äºä¸€ä½“çš„æ•°æ®ä¼ è¾“æœåŠ¡&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;DRC&lt;/td&gt;
      &lt;td&gt;é¥¿äº†ä¹ˆæ•°æ®å¤åˆ¶ä¸­å¿ƒ&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;MGR&lt;/td&gt;
      &lt;td&gt;MySQL ç»„å¤åˆ¶&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Lion&lt;/td&gt;
      &lt;td&gt;ç¾å›¢å†…éƒ¨é…ç½®ç»Ÿä¸€ç®¡ç†å’Œå®æ—¶æ¨é€çš„å¹³å°&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Lion Consistency&lt;/td&gt;
      &lt;td&gt;Lion ç³»ç»Ÿå†…è´Ÿè´£æ•°æ®åŒæ­¥æ¨¡å—&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Lion Managerï¼ˆæ–°å¢ï¼‰&lt;/td&gt;
      &lt;td&gt;Lion ç³»ç»Ÿå†…è´Ÿè´£åŒæ­¥ä»»åŠ¡ç®¡ç†æ¨¡å—&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Lion Meta&lt;/td&gt;
      &lt;td&gt;Lion ç³»ç»Ÿå†…è´Ÿè´£æœåŠ¡æ³¨å†Œå‘ç°æ¨¡å—&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Lion API/Console&lt;/td&gt;
      &lt;td&gt;Lion ç³»ç»Ÿå†… Open API åŠç®¡ç†ç«¯æ¨¡å—&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h1 id=&quot;2æ•´ä½“æ¶æ„&quot;&gt;2ã€æ•´ä½“æ¶æ„&lt;/h1&gt;

&lt;h2 id=&quot;21-æŠ€æœ¯è°ƒç ”&quot;&gt;2.1 æŠ€æœ¯è°ƒç ”&lt;/h2&gt;

&lt;h3 id=&quot;211-æ‹“æ‰‘ç»“æ„è°ƒç ”&quot;&gt;2.1.1 æ‹“æ‰‘ç»“æ„è°ƒç ”&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;æ‹“æ‰‘æ¨¡å‹&lt;/th&gt;
      &lt;th&gt;æè¿°&lt;/th&gt;
      &lt;th&gt;æ¯”è¾ƒ&lt;/th&gt;
      &lt;th&gt;ç»“è®º&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;æ˜Ÿå‹æ‹“æ‰‘&lt;/td&gt;
      &lt;td&gt;ä¸€ä¸ªæŒ‡å®šçš„æ ¹èŠ‚ç‚¹å°†å†™å…¥è½¬å‘ç»™æ‰€æœ‰å…¶ä»–èŠ‚ç‚¹&lt;/td&gt;
      &lt;td&gt;ä¼˜ç‚¹ 1.åŒæ­¥é“¾è·¯ä¿æŒä¸€å®šçš„é¡ºåºï¼Œæ•°æ®ä¸€è‡´æ€§å¯ä»¥å¾—åˆ°æå‡; 2.è¿ç»´ç›¸å¯¹ç®€å•ã€‚ç¼ºç‚¹ï¼š1.ç”±äºæ•°æ®åŒæ­¥éœ€è¦é€šè¿‡ä¸­é—´èŠ‚ç‚¹è½¬å‘ï¼Œä¸­é—´èŠ‚ç‚¹å¯èƒ½ä¼šæˆä¸ºæ€§èƒ½ç“¶é¢ˆï¼Œå®¹æ˜“å‡ºç°å•ç‚¹æ•…éšœï¼Œç³»ç»Ÿå®¹é”™é™ä½;2.ç”±äºé¡ºåºåŒæ­¥ï¼Œä½¿å¾—æ•´ä½“æ•°æ®åŒæ­¥å»¶è¿Ÿä¼šå¢å¤§ï¼ˆèŠ‚ç‚¹æ•°è¶Šå¤šï¼Œå»¶è¿Ÿè¶Šå¤§ï¼‰&lt;/td&gt;
      &lt;td&gt;é‡‡ç”¨æ˜Ÿå‹æ‹“æ‰‘ç»“æ„:1.è¶…è¿‡2/3çš„é…ç½®å˜æ›´é›†ä¸­åœ¨åŒ—äº¬ï¼Œåç»­æ€€æ¥ï¼Œä¸Šæµ·å¯ä»¥ä»¥åŒ—äº¬ä¸ºä¸»è¿›è¡ŒåŒæ­¥;2.ä»¥åŒ—äº¬ä¸ºä¸»ï¼Œåœ¨æ•°æ®å†²çªï¼Œä¸€è‡´æ€§ä¿è¯æ–¹é¢å¤„ç†ç›¸å¯¹ç®€å•ï¼ŒåŒ…æ‹¬å¢é‡ä¸€è‡´æ€§æ£€æµ‹åŠŸèƒ½å®ç°&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Â &lt;/td&gt;
      &lt;td&gt;Â &lt;/td&gt;
      &lt;td&gt;Â &lt;/td&gt;
      &lt;td&gt;Â &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;å…¨éƒ¨è‡³å…¨éƒ¨å‹ï¼ˆç½‘çŠ¶å‹ï¼‰&lt;/td&gt;
      &lt;td&gt;æ¯ä¸ªä¸»èŠ‚ç‚¹å°†å…¶å†™å…¥åŒæ­¥åˆ°å…¶ä»–æ‰€æœ‰ä¸»èŠ‚ç‚¹&lt;/td&gt;
      &lt;td&gt;ä¼˜ç‚¹:1.æ•°æ®åŒæ­¥é“¾è·¯æ›´å¯†é›†ï¼Œæ•°æ®å¯ä»¥æ²¿ç€ä¸åŒè·¯å¾„ä¼ æ’­ï¼Œé¿å…äº†å•ç‚¹æ•…éšœï¼Œå®¹é”™æ€§æ›´é«˜;2.æ•°æ®å˜æ›´å…¨é“¾è·¯å¹¿æ’­ï¼Œæ•´ä½“åŒæ­¥å»¶è¿Ÿç›¸å¯¹æ›´ä½. ç¼ºç‚¹:1.åŒæ­¥é“¾è·¯é¡ºåºæ— æ³•å¾—åˆ°ä¿éšœï¼Œæ•°æ®å†²çªçš„æƒ…å†µæ›´å¤æ‚ï¼ˆå¯èƒ½æ‰€æœ‰èŠ‚ç‚¹éƒ½éœ€è¦å¤„ç†å†²çªï¼‰;2.è¿ç»´æ›´åŠ å¤æ‚&lt;/td&gt;
      &lt;td&gt;-&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;212-åŒæ­¥æ–¹æ¡ˆè°ƒç ”&quot;&gt;&lt;strong&gt;2.1.2 åŒæ­¥æ–¹æ¡ˆè°ƒç ”&lt;/strong&gt;&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;ä¸šç•Œæ–¹æ¡ˆ&lt;/th&gt;
      &lt;th&gt;éƒ¨ç½²æ¶æ„&lt;/th&gt;
      &lt;th&gt;æ•´ä½“ä»‹ç»&lt;/th&gt;
      &lt;th&gt;å¤‡æ³¨&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;ç¾å›¢ DTS&lt;/td&gt;
      &lt;td&gt;-&lt;/td&gt;
      &lt;td&gt;1.Reader æ¨¡å—ä¸æº DB åŒåœ°åŸŸéƒ¨ç½²ï¼Œä»æº DB dump Binlogï¼Œå¹¶å­˜å‚¨åœ¨æœ¬åœ°å†…å­˜ä¸ç£ç›˜ä¸­; 2.Writer æ¨¡å—ä¸ç›®æ ‡ DB åŒåœ°åŸŸéƒ¨ç½²ï¼Œä» Reader ä¸­æ¶ˆè´¹ Binlogï¼Œå¹¶å°†æ•°æ®å†™å…¥ç›®æ ‡ DB ä¸­; 3.Reader ä¸ Writer ä¹‹é—´é€šè¿‡ç§æœ‰åè®®å®ç°é«˜é€Ÿä¼ è¾“ï¼›ä»»åŠ¡è°ƒåº¦ä¾èµ– Lion é…ç½®ä¸‹å‘&lt;/td&gt;
      &lt;td&gt;&lt;a href=&quot;https://km.sankuai.com/collabpage/1479786749&quot;&gt;DTS&lt;/a&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;é¥¿äº†ä¹ˆ DRC&lt;/td&gt;
      &lt;td&gt;-&lt;/td&gt;
      &lt;td&gt;1.Replicator æ¨¡å—ï¼šç”¨äºè§£ææº DB çš„ Binlogï¼Œå¹¶ç¼“å­˜åˆ°ä¸€ä¸ªè¶…å¤§çš„ Event Buffer ä¸­ï¼›åŒæ—¶å°†è§£æç»“æœé€šè¿‡ TCP æ¨åŠ¨åˆ°ç›®æ ‡ Applier æ¨¡å—;2.Applier æ¨¡å—ï¼šæ¥æ”¶ä» Replicator æ¨é€çš„æ•°æ®ï¼Œå¹¶å†™å…¥åˆ°ç›®æ ‡ DB ä¸­;3.Console æ¨¡å—ï¼šç”¨äºæ§åˆ¶ç®¡ç†&lt;/td&gt;
      &lt;td&gt;&lt;a href=&quot;https://km.sankuai.com/collabpage/1479723243&quot;&gt;DRC&lt;/a&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;DTS ä¸ DRC åœ¨æ¶æ„éƒ¨ç½²ä¸Šæ¯”è¾ƒç±»ä¼¼ï¼Œæœ‰ä¸€äº›å…±é€šçš„åœ°æ–¹ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;è¯»å†™åˆ†ç¦»&lt;/strong&gt;ï¼šBinlog è®¢é˜…ä¸å›æ”¾é€»è¾‘æ‹†åˆ†ä¸ºä¸¤ä¸ªæ¨¡å—ï¼šReaderï¼ŒWriterï¼Œè¿›è¡Œè¯»å†™åˆ†ç¦»ï¼›ä¸¤ä¸ªæ¨¡å—å¯åˆ†åˆ«æŒ‰éœ€æ‰©å±•ï¼Œæé«˜ç³»ç»Ÿæ‰©å±•æ€§&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;åŒåœ°åŸŸéƒ¨ç½²&lt;/strong&gt;ï¼šReader æ¨¡å—ä¸æº DB åŒåœ°åŸŸéƒ¨ç½²ï¼ŒWriter æ¨¡å—ä¸ç›®æ ‡ DB åŒåœ°åŸŸéƒ¨ç½²ï¼›Reader ä¸ Writer ä¹‹é—´é€šè¿‡ç§æœ‰åè®®é«˜é€Ÿä¼ è¾“&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;ä¸­å¿ƒåŒ–ç®¡ç†&lt;/strong&gt;ï¼šReader/Writer æ¶‰åŠçš„è®¢é˜…ä¸å›æ”¾ä»»åŠ¡åˆ†é…éƒ½æ˜¯é€šè¿‡ä¸­å¿ƒæ¨¡å—ç»Ÿä¸€è°ƒåº¦ï¼Œè€Œä¸æ˜¯ç”± Reader/Writer æ¨¡å—åˆ†åˆ«ç®¡ç†&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Log æ‰“æ ‡&lt;/strong&gt;ï¼šä¸ºäº†é¿å…æ•°æ®å›ç¯ï¼Œå¯¹äº§ç”Ÿçš„ Log è¿›è¡Œæ‰“æ ‡ï¼Œæ ‡è¯†åœ°åŸŸä¿¡æ¯ï¼Œåœ¨å›æ”¾æ—¶è¿›è¡Œè¿‡æ»¤&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;å¯¹ä¸Šè¿°å‡ ç‚¹ Lion åœ¨è®¾è®¡è¿‡ç¨‹ä¸­åŸºæœ¬éƒ½å¯ä»¥å€Ÿé‰´ï¼Œä¸è¿‡ä¸ºäº†ç®€åŒ–è®¾è®¡ï¼ŒReader/Writer æ¨¡å—ä¸è¿›è¡Œæ‹†åˆ†ï¼Œåˆå¹¶éƒ¨ç½²ï¼ˆä¸è¿‡ä»ç„¶è¿›è¡Œé€»è¾‘ä¸Šè§’è‰²åŒºåˆ†ï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;ğŸ’¡ &lt;strong&gt;Qï¼šä¸ºä»€ä¹ˆ Lion ä¸è€ƒè™‘ç›´æ¥æ¥å…¥ DTS ï¼Ÿ&lt;/strong&gt;
Aï¼š1. DTS ç›®å‰æ‰€æœ‰è¿ç»´åŠ¨ä½œã€é«˜å¯ç”¨å¼ºä¾èµ– Lionï¼Œå»æ‰ Lion å¼ºä¾èµ–çš„æƒ…å†µä¸‹æ”¹é€ æˆæœ¬é«˜ï¼Œå¹¶ä¸” SLA æ— æ³•ä¿è¯
      2. DTS ç›®å‰åœ¨è¿ç»´ã€å®•æœºç­‰åœºæ™¯å­˜åœ¨æ•°æ®å›æº¯ï¼Œä¸æ»¡ è¶³Lion ä½å»¶è¿Ÿã€æ•°æ®ä¸å›é€€ï¼ˆé…ç½®ç‰ˆæœ¬å›é€€ï¼‰è¦æ±‚
      3. å¦‚æœå¤šä¸­å¿ƒä¹‹é—´ä¸¤ä¸¤äº’å¤‡ï¼ŒDTS é’ˆå¯¹è¿™ç§å¤æ‚é“¾è·¯ï¼Œæ•°æ®è¿ç§»æ‹†åˆ†çŸ­æœŸæ²¡æœ‰æ¯”è¾ƒå¥½çš„è§£å†³æ–¹&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Qï¼šDTS ä¸ DRC éƒ½æ˜¯é€šè¿‡ Binlog è®¢é˜…ä¼ è¾“å®ç°æ•°æ®å¤åˆ¶ï¼ŒLion æ˜¯å¦ä¹Ÿé‡‡å–è¯¥æ–¹æ¡ˆï¼Ÿ&lt;/strong&gt;
Aï¼šLion åŒæ­¥æ•°æ®æ¨¡å‹é‡‡ç”¨è‡ªå®šä¹‰ Log ç»“æ„ã€‚
      ç›®å‰ Lion åŒ—ä¸Šæ•°æ®ä¸­å¿ƒé—´åŒæ­¥ä½¿ç”¨çš„æ˜¯è‡ªå®šä¹‰ Log æ•°æ®ï¼Œè€ƒè™‘åˆ°å¼•å…¥ MGR Binlog è®¢é˜…è§£ææµç¨‹å¹¶ä¸ä¼šå¯¹åŒæ­¥æµç¨‹æœ‰æ˜¾è‘—çš„æå‡ï¼Œå¹¶ä¸”ä¼šæé«˜è¿ç»´å¤æ‚åº¦ã€‚
      åŒæ—¶ï¼ŒLion åŒ—ä¸Šå­˜é‡æ•°æ®ï¼ˆConfig, Releaseç­‰è¡¨ï¼‰å¹¶ä¸å®Œå…¨ä¸€è‡´ï¼Œæš‚æ—¶æ— æ³•ç›´æ¥é‡‡ç”¨ Binglog è¿›è¡ŒåŒæ­¥ã€‚æ¯”å¦‚ï¼Œç”±äºåŒä¸€æ¡é…ç½®åœ¨åŒ—ä¸Šæœ€æ–°ç‰ˆæœ¬å·å¹¶ä¸ç›¸åŒï¼Œå¦‚æœä»æ•°æ®åº“å±‚é¢å¼ºè¡Œä¿æŒä¸€è‡´ï¼Œä¼šè§¦å‘ä¸€ä¾§ä¸šåŠ¡é‡æ–°è¿›è¡Œå…¨é‡é…ç½®åŠ è½½ï¼Œæœ‰è¾ƒå¤§çš„é£é™©ã€‚
      å› æ­¤ï¼ŒLion ä»ä¿ä½¿ç”¨è‡ªå®šä¹‰ Log ç»“æ„ã€‚&lt;/p&gt;

&lt;h3 id=&quot;213-æ¨æ‹‰é€‰å‹&quot;&gt;2.1.3 æ¨æ‹‰é€‰å‹&lt;/h3&gt;

&lt;p&gt;è¿™é‡Œçš„æ¨æ‹‰æ¨¡å‹æŒ‡çš„æ˜¯ Reader ä¸ Writer ä¹‹é—´ä¼ è¾“ Log çš„æ–¹å¼ï¼š1. Reader ä¸»åŠ¨å°† Log æ¨é€åˆ° Writerï¼›2. Writer å®šæ—¶ä» Reader æŒ‰éœ€æ‹‰å– Logã€‚&lt;/p&gt;

&lt;h2 id=&quot;22-è®¾è®¡æ€»ä½“æ€è·¯&quot;&gt;2.2 è®¾è®¡æ€»ä½“æ€è·¯&lt;/h2&gt;

&lt;h3 id=&quot;221-éƒ¨ç½²æ¶æ„&quot;&gt;2.2.1 éƒ¨ç½²æ¶æ„&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;/images/lion_data_synchronization/1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä»¥åŒ—äº¬ï¼Œä¸Šæµ·ä¸¤ä¸ªæ•°æ®ä¸­å¿ƒä¸ºä¾‹ï¼Œæ¯ä¸ªæ•°æ®ä¸­å¿ƒéƒ¨ç½²äº†å…¨é‡çš„ Lion æœåŠ¡ï¼ˆéƒ¨åˆ†æœåŠ¡æœªåœ¨å›¾ä¸­å±•ç¤ºï¼‰ã€‚é€šè¿‡åŒæ­¥é…ç½®å˜æ›´åˆ°å…¶ä»–æ•°æ®ä¸­å¿ƒï¼Œä½¿å¾—æ¯ä¸ªæ•°æ®ä¸­å¿ƒæ‹¥æœ‰å…¨é‡æ•°æ®ï¼Œèƒ½å¤Ÿç‹¬ç«‹æä¾›å®Œæ•´çš„ Lion åŠŸèƒ½ã€‚&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;MGR (DB)&lt;/strong&gt;ï¼šæŒä¹…åŒ–ä¸šåŠ¡é…ç½®æ•°æ®ï¼ŒåŒæ­¥æ—¥å¿—ï¼ŒåŒæ­¥ä»»åŠ¡å…ƒæ•°æ®ç­‰ä¿¡æ¯ã€‚MGR æœ‰ä¸¤ç§éƒ¨ç½²æ¨¡å¼ï¼š
    &lt;ol&gt;
      &lt;li&gt;&lt;strong&gt;&lt;em&gt;æ¯ä¸­å¿ƒå•ç‹¬éƒ¨ç½²&lt;/em&gt;&lt;/strong&gt;ï¼šå­˜å‚¨ä¸­å¿ƒå†…ä¸šåŠ¡æ•°æ®ï¼ˆå¦‚åŒæ­¥ä»»åŠ¡ç®¡ç†ç›¸å…³å…ƒæ•°æ®ï¼‰ï¼Œæ”¯æŒä¸­å¿ƒå†…æµé‡ä¸æ•°æ®é—­ç¯ã€‚ä¸åŒæ•°æ®ä¸­å¿ƒçš„ MGR æ•°æ®å®æ—¶åŒæ­¥ï¼Œæœ€ç»ˆæ¯ä¸ªæ•°æ®ä¸­å¿ƒæ‹¥æœ‰å…¨é‡ä¸šåŠ¡æ•°æ®ã€‚&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;&lt;em&gt;ç‰¹å®šä¸­å¿ƒéƒ¨ç½²&lt;/em&gt;&lt;/strong&gt;ï¼šå­˜å‚¨å…¬å…±æ•°æ®ï¼Œä¾¿äºç»Ÿä¸€ç®¡ç†ï¼ˆå¦‚åŒæ­¥æ¨¡å—èŠ‚ç‚¹æœ€æ–°åˆ—è¡¨ï¼‰ï¼Œæ”¯æŒä¸åŒæ•°æ®ä¸­å¿ƒçš„æœåŠ¡è¿›è¡Œè·¨åœ°åŸŸè®¿é—®ã€‚åªéƒ¨ç½²åœ¨æŒ‡å®šæ•°æ®ä¸­å¿ƒï¼ˆä¸Šæµ·ï¼‰ï¼Œä¾›æ‰€æœ‰æ•°æ®ä¸­å¿ƒè¿›è¡Œè®¿é—®ã€‚&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Consistency&lt;/strong&gt;ï¼šæ‰§è¡Œæ•°æ®åŒæ­¥ä»»åŠ¡ï¼›æ¯ä¸­å¿ƒå•ç‹¬éƒ¨ç½²
    &lt;ul&gt;
      &lt;li&gt;æ— çŠ¶æ€æœåŠ¡ï¼›é€»è¾‘ä¸Šåˆ’åˆ†ä¸º Readerï¼ŒWriter ä¸¤ç§è§’è‰²&lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;&lt;strong&gt;&lt;em&gt;Reader&lt;/em&gt;&lt;/strong&gt;ï¼šå¯¹å¤–æš´éœ² HTTP API æ¥å£ï¼Œæä¾›åŒæ­¥æ—¥å¿—æŸ¥è¯¢åŠŸèƒ½&lt;/p&gt;

        &lt;blockquote&gt;
          &lt;p&gt;åŠŸèƒ½å¾ˆè½»é‡ï¼šæä¾› API æ¥å£ä¾› Writer è®¿é—®&lt;/p&gt;

        &lt;/blockquote&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;&lt;em&gt;Writer&lt;/em&gt;&lt;/strong&gt;ï¼šè°ƒç”¨ Reader æ¥å£ï¼Œå®ç°åŒæ­¥æ—¥å¿—åœ¨æ•°æ®ä¸­å¿ƒé—´ä¼ è¾“é€»è¾‘ï¼›åŒæ—¶å®Œæˆæ—¥å¿—å­˜å‚¨ï¼Œå›æ”¾ç­‰åŠŸèƒ½ã€‚
        &lt;ul&gt;
          &lt;li&gt;åœ¨è®¿é—®å…¶ä»–æ•°æ®ä¸­å¿ƒçš„ Reader ä¹‹å‰ï¼Œä¼šä» Meta æŸ¥è¯¢å¼‚åœ°æ•°æ®ä¸­å¿ƒå†… Reader å¯ç”¨èŠ‚ç‚¹åˆ—è¡¨ï¼ˆç¼“å­˜åœ¨æœ¬åœ°ï¼Œå®šæ—¶æ›´æ–°ï¼‰&lt;/li&gt;
          &lt;li&gt;æ¯ä¸ª Writer ä»»åŠ¡åŒæ­¥ç‰¹å®šåˆ†åŒºçš„æ—¥å¿—ï¼Œå¹¶å°†æœ€æ–°åŒæ­¥åç§»é‡ä¸ŠæŠ¥åˆ° Manager&lt;/li&gt;
          &lt;li&gt;Writer ç”Ÿå‘½å‘¨æœŸç”± Manager è¿›è¡Œç®¡ç†ï¼Œä¼šå‘¨æœŸæ€§ä¸ŠæŠ¥è‡ªèº«çŠ¶æ€&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;

    &lt;blockquote&gt;
      &lt;p&gt;ä¸ºäº†æé«˜åŒæ­¥æ‰©å±•æ€§ï¼Œå°†åŒæ­¥æ—¥å¿—è¿›è¡Œåˆ‡ç‰‡ï¼Œæ¯ä¸ª Writer ä»»åŠ¡åªä¼šåŒæ­¥æŒ‡å®šåˆ‡ç‰‡çš„æ—¥å¿—ã€‚&lt;/p&gt;

    &lt;/blockquote&gt;

    &lt;blockquote&gt;
      &lt;p&gt;åŒæ­¥èŠ‚ç‚¹ : åŒæ­¥ä»»åŠ¡ = 1 : N (æ¯ä¸ªåŒæ­¥èŠ‚ç‚¹ä¸Šå¯èƒ½ä¼šè¿è¡Œå¤šä¸ªåŒæ­¥ä»»åŠ¡)&lt;/p&gt;

    &lt;/blockquote&gt;

    &lt;blockquote&gt;
      &lt;p&gt;åŒæ­¥ä»»åŠ¡ : åŒæ­¥åˆ†åŒº = 1 : 1 (æ¯ä¸ªåŒæ­¥ä»»åŠ¡åªä¼šåŒæ­¥ä¸€ä¸ªåˆ†åŒºå†…çš„æ—¥å¿—)&lt;/p&gt;

    &lt;/blockquote&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Manager (æ–°å¢)&lt;/strong&gt;ï¼šç”¨äºåŒæ­¥å…ƒæ•°æ®ç®¡ç†ï¼ŒåŒæ­¥ä»»åŠ¡è°ƒåº¦ï¼›æ¯ä¸­å¿ƒå•ç‹¬éƒ¨ç½²
    &lt;ul&gt;
      &lt;li&gt;&lt;strong&gt;&lt;em&gt;ç®¡ç†åŒæ­¥å…ƒæ•°æ®&lt;/em&gt;&lt;/strong&gt;ï¼š1. åŒæ­¥èŠ‚ç‚¹ï¼ˆConsistencyï¼‰ä¸åŒæ­¥åˆ†åŒºï¼ˆPartitionï¼‰ç´¢å¼•çš„æ˜ å°„å…³ç³»ï¼›2. åŒæ­¥åˆ†åŒºæœ€æ–°åŒæ­¥åç§»é‡ï¼ˆOffsetï¼‰&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;&lt;em&gt;åŒæ­¥ä»»åŠ¡è°ƒåº¦&lt;/em&gt;&lt;/strong&gt;ï¼š1. åœ¨åŒæ­¥èŠ‚ç‚¹ä¸Šï¼Œæ ¹æ®åˆ†åŒºç´¢å¼•åˆ›å»ºå¯¹åº”åŒæ­¥ä»»åŠ¡ï¼›2. åˆ†åŒºç´¢å¼•è¿ç§»æ—¶ï¼Œå®ŒæˆåŒæ­¥ä»»åŠ¡è¿ç§»ï¼›3. ä¸åŒæ­¥ä»»åŠ¡ä¹‹é—´ç»´æŒå¿ƒè·³ï¼Œç¡®ä¿åŒæ­¥ä»»åŠ¡å¤„äºè¿è¡ŒçŠ¶æ€&lt;/li&gt;
      &lt;li&gt;æ¯ä¸ªæ•°æ®ä¸­å¿ƒå†…éƒ¨ç½²å¤šä¸ª Manager èŠ‚ç‚¹ï¼Œä½œä¸ºåŒæ­¥ä»»åŠ¡è°ƒåº¦çš„ä¸­å¿ƒæ¨¡å—ï¼š
        &lt;ol&gt;
          &lt;li&gt;ä¸ä¸­å¿ƒå†…åŒæ­¥èŠ‚ç‚¹ï¼ˆConsistencyï¼‰å‘¨æœŸäº¤äº’ï¼š1. ä¸‹å‘åŒæ­¥ä»»åŠ¡åˆ›å»º/é”€æ¯çš„å‘½ä»¤ï¼›2. äº†è§£åŒæ­¥ä»»åŠ¡çš„è¿è¡ŒçŠ¶æ€ï¼›3. ç¡®å®šåŒæ­¥ä»»åŠ¡æœ€æ–°åç§»é‡&lt;/li&gt;
          &lt;li&gt;å®šæ—¶è½®è¯¢ Meta èŠ‚ç‚¹ï¼šæŸ¥è¯¢ä¸­å¿ƒå†… Consistency æœ€æ–°å¯ç”¨èŠ‚ç‚¹åˆ—è¡¨ï¼Œåœ¨èŠ‚ç‚¹çŠ¶æ€å˜æ›´æ—¶è¿›è¡ŒåŒæ­¥åˆ†åŒº Rehash åŠåŒæ­¥ä»»åŠ¡è¿ç§»&lt;/li&gt;
          &lt;li&gt;ä»ä¸­å¿ƒå†… MGR åŠ è½½åŒæ­¥ä»»åŠ¡å…ƒæ•°æ®ï¼›å°†æœ€æ–°å…ƒæ•°æ®æŒä¹…åŒ–åˆ° MGR&lt;/li&gt;
        &lt;/ol&gt;
      &lt;/li&gt;
    &lt;/ul&gt;

    &lt;p&gt;æ¯ä¸ª Manager èŠ‚ç‚¹éƒ½å¯ä»¥è¿›è¡Œä»»åŠ¡ç®¡ç†ï¼ˆå¹¶ä¸æ˜¯ä¸»ä»æ¶æ„ï¼‰ï¼Œä¸ºäº†å‡å°‘å¤šä¸ª Manager ç®¡ç†å†²çªï¼Œå¼•å…¥ç®€å•çš„åˆ†å¸ƒå¼é”ï¼ˆLion å†…éƒ¨å·²è¿è¡ŒéªŒè¯ï¼‰&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Meta&lt;/strong&gt;ï¼šæä¾› Lion ä¾§éƒ¨åˆ†æœåŠ¡æ³¨å†Œå‘ç°åŠŸèƒ½ï¼›æ¯ä¸­å¿ƒå•ç‹¬éƒ¨ç½²
    &lt;ul&gt;
      &lt;li&gt;åŒæ­¥èŠ‚ç‚¹ï¼ˆConsistencyï¼‰ä¸Šä¸‹çº¿æ—¶ï¼Œä¼šç”±æ•°æ®ä¸­å¿ƒå†…çš„ Meta èŠ‚ç‚¹ç»´æŠ¤å…¶å¯ç”¨çŠ¶æ€ï¼Œå¹¶&lt;strong&gt;&lt;em&gt;å°†ä¸­å¿ƒå†…æœ€æ–°å¯ç”¨èŠ‚ç‚¹åˆ—è¡¨å­˜å‚¨åœ¨å…¬å…± DB ä¸­&lt;/em&gt;&lt;/strong&gt;&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;&lt;em&gt;ä¸åŒæ•°æ®ä¸­å¿ƒçš„ Meta èŠ‚ç‚¹éƒ½å¯ä»¥æŸ¥çœ‹æ‰€æœ‰æ•°æ®ä¸­å¿ƒçš„åŒæ­¥èŠ‚ç‚¹ï¼ˆConsistencyï¼‰åˆ—è¡¨è§†å›¾&lt;/em&gt;&lt;/strong&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;API/Console&lt;/strong&gt;ï¼šLion ç®¡ç†ç«¯ / API æ¨¡å—ï¼Œä¸ºç”¨æˆ·æä¾›é…ç½®å˜æ›´/æŸ¥è¯¢ç­‰åŠŸèƒ½ï¼›æ¯ä¸­å¿ƒå•ç‹¬éƒ¨ç½²
    &lt;ul&gt;
      &lt;li&gt;æ¯æ¬¡é…ç½®å˜æ›´éƒ½ä¼šäº§ç”Ÿå¯¹åº”çš„åŒæ­¥æ—¥å¿—ï¼ˆLogï¼‰ï¼Œç”¨äºæ•°æ®ä¸­å¿ƒé—´é…ç½®åŒæ­¥&lt;/li&gt;
      &lt;li&gt;API/Console è¯·æ±‚çš„æµé‡ + è®¿é—®çš„æ•°æ®ä¼šåœ¨ä¸­å¿ƒå†…å®ç°é—­ç¯&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;222-æ•°æ®æ¨¡å‹&quot;&gt;2.2.2 æ•°æ®æ¨¡å‹&lt;/h3&gt;

&lt;h3 id=&quot;2221-åŒæ­¥æ—¥å¿—&quot;&gt;2.2.2.1 åŒæ­¥æ—¥å¿—&lt;/h3&gt;

&lt;p&gt;Lion åŒæ­¥æ—¥å¿—é‡‡ç”¨è‡ªå®šä¹‰ Logï¼Œè€Œé Binlogã€‚æ ¹æ®åŒæ­¥é˜¶æ®µçš„ä¸åŒï¼Œæˆ‘ä»¬å°† Log æ‹†åˆ†ä¸ºä¸¤ç§å½¢å¼ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;æºåŒæ­¥æ—¥å¿—ï¼ˆsource sync logï¼‰&lt;/strong&gt;ï¼šåŒ…å«å˜æ›´é…ç½®çš„è¯¦ç»†ä¿¡æ¯ã€‚é…ç½®å˜æ›´æ—¶ï¼Œåœ¨æœ¬åœ°æ•°æ®ä¸­å¿ƒäº§ç”Ÿä¸€æ¡æ—¥å¿—ï¼Œè¯¥æ—¥å¿—ä¼šè¢«å…¶ä»–æ•°æ®ä¸­å¿ƒåŠ è½½ï¼ŒåŒæ­¥ã€‚&lt;/p&gt;

    &lt;p&gt;å…·ä½“è®¾è®¡&lt;/p&gt;

    &lt;table&gt;
      &lt;thead&gt;
        &lt;tr&gt;
          &lt;th&gt;id&lt;/th&gt;
          &lt;th&gt;release_key&lt;/th&gt;
          &lt;th&gt;timestamp&lt;/th&gt;
          &lt;th&gt;key&lt;/th&gt;
          &lt;th&gt;appkey&lt;/th&gt;
          &lt;th&gt;set/swimlane/env&lt;/th&gt;
          &lt;th&gt;old_value&lt;/th&gt;
          &lt;th&gt;new_value&lt;/th&gt;
        &lt;/tr&gt;
      &lt;/thead&gt;
      &lt;tbody&gt;
        &lt;tr&gt;
          &lt;td&gt;ä¸»é”®&lt;/td&gt;
          &lt;td&gt;å˜æ›´å”¯ä¸€æ ‡è¯†&lt;/td&gt;
          &lt;td&gt;å˜æ›´æ—¶é—´æˆ³&lt;/td&gt;
          &lt;td&gt;é…ç½® key&lt;/td&gt;
          &lt;td&gt;é…ç½® appkey&lt;/td&gt;
          &lt;td&gt;é…ç½®å…¶ä»–æ ‡è¯†&lt;/td&gt;
          &lt;td&gt;æ—§å€¼&lt;/td&gt;
          &lt;td&gt;æ–°å€¼&lt;/td&gt;
        &lt;/tr&gt;
      &lt;/tbody&gt;
    &lt;/table&gt;

    &lt;p&gt;åŒæ­¥æ–¹å‘ä¸º&lt;strong&gt;ä¸Šæµ· -&amp;gt; åŒ—äº¬&lt;/strong&gt;æ—¶ï¼ŒåŒ—äº¬ä¾§çš„ Consistency(Writer) èŠ‚ç‚¹ä¸Šçš„åŒæ­¥ä»»åŠ¡ä¼šä¸æ–­ä»ä¸Šæµ·ä¾§æ‰¹é‡æ‹‰å–&lt;strong&gt;&lt;em&gt;æœªåŒæ­¥&lt;/em&gt;&lt;/strong&gt;çš„ SourceSyncLogã€‚&lt;/p&gt;

    &lt;blockquote&gt;
      &lt;p&gt;é€šè¿‡ Offset æ¥æ ‡è¯†å·²åŒæ­¥çš„ SourceSyncLogï¼ˆid &amp;gt; offset : æœªåŒæ­¥ï¼›id &amp;lt;= offset : å·²åŒæ­¥ï¼‰&lt;/p&gt;

    &lt;/blockquote&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;ç›®æ ‡åŒæ­¥æ—¥å¿—ï¼ˆtarget sync logï¼‰&lt;/strong&gt;ï¼šé€šè¿‡å›æ”¾è¯¥æ—¥å¿—ï¼Œå°†å…¶ä»–æ•°æ®ä¸­å¿ƒçš„æœ€æ–°é…ç½®æ›´æ–°åˆ°æœ¬åœ°æ•°æ®ä¸­å¿ƒï¼ˆç›®æ ‡åŒæ­¥æ—¥å¿—æ˜¯ç”±æºåŒæ­¥æ—¥å¿—è½¬åŒ–è€Œæ¥çš„ï¼‰ã€‚&lt;/p&gt;

    &lt;p&gt;å…·ä½“è®¾è®¡&lt;/p&gt;

    &lt;table&gt;
      &lt;thead&gt;
        &lt;tr&gt;
          &lt;th&gt;id&lt;/th&gt;
          &lt;th&gt;source_idc&lt;/th&gt;
          &lt;th&gt;source_idc_log_id&lt;/th&gt;
          &lt;th&gt;status&lt;/th&gt;
          &lt;th&gt;release_key&lt;/th&gt;
          &lt;th&gt;timestamp&lt;/th&gt;
          &lt;th&gt;key&lt;/th&gt;
          &lt;th&gt;appkey&lt;/th&gt;
          &lt;th&gt;set/swimlane/env&lt;/th&gt;
          &lt;th&gt;old_value&lt;/th&gt;
          &lt;th&gt;new_value&lt;/th&gt;
        &lt;/tr&gt;
      &lt;/thead&gt;
      &lt;tbody&gt;
        &lt;tr&gt;
          &lt;td&gt;ä¸»é”®&lt;/td&gt;
          &lt;td&gt;æºæ•°æ®ä¸­å¿ƒæ ‡è¯†&lt;/td&gt;
          &lt;td&gt;æºæ•°æ®ä¸­å¿ƒçš„ SourceSyncLog Id&lt;/td&gt;
          &lt;td&gt;åŒæ­¥çŠ¶æ€&lt;/td&gt;
          &lt;td&gt;å˜æ›´å”¯ä¸€æ ‡è¯†&lt;/td&gt;
          &lt;td&gt;å˜æ›´æ—¶é—´æˆ³&lt;/td&gt;
          &lt;td&gt;é…ç½® key&lt;/td&gt;
          &lt;td&gt;é…ç½® appkey&lt;/td&gt;
          &lt;td&gt;é…ç½®å…¶ä»–æ ‡è¯†&lt;/td&gt;
          &lt;td&gt;æ—§å€¼&lt;/td&gt;
          &lt;td&gt;æ–°å€¼&lt;/td&gt;
        &lt;/tr&gt;
      &lt;/tbody&gt;
    &lt;/table&gt;

    &lt;p&gt;åŒæ­¥æ–¹å‘ä¸º&lt;strong&gt;ä¸Šæµ· -&amp;gt; åŒ—äº¬&lt;/strong&gt;æ—¶ï¼ŒåŒ—äº¬ä¾§çš„åŒæ­¥ä»»åŠ¡å°†ä»ä¸Šæµ·ä¾§æ‹‰å–åˆ°çš„ SourceSyncLog è½¬åŒ–æˆ TargetSyncLogï¼Œå¹¶æ’å…¥æœ¬åœ° DBï¼›ä¹‹åä¼šæ ¹æ® TargetSyncLog å°†ä¸Šæµ·ä¾§çš„å˜æ›´å›æ”¾åˆ°æœ¬åœ°ã€‚&lt;/p&gt;

    &lt;p&gt;ğŸ’¡ TargetSyncLog æ¯” SourceSyncLog å¤šäº† source_idc, source_idc_log_id, status å­—æ®µï¼Œä¸»è¦æ˜¯ä¸ºäº†é¿å…æ•°æ®å›ç¯ï¼Œæ ‡è¯†å·²åŒæ­¥ä½ç½®ç­‰&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;2222-åŒæ­¥ä»»åŠ¡å…ƒæ•°æ®&quot;&gt;2.2.2.2 åŒæ­¥ä»»åŠ¡å…ƒæ•°æ®&lt;/h3&gt;

&lt;p&gt;æ•°æ®ä¸­å¿ƒé—´ Log ä¼ è¾“ç®€å•æ¥çœ‹å°±æ˜¯å°†å…¶ä»–æ•°æ®ä¸­å¿ƒçš„ Log å¤åˆ¶åˆ°æœ¬ä¾§æ•°æ®ä¸­å¿ƒï¼Œå¤åˆ¶è¿‡ç¨‹æœ‰å‡ ç‚¹éœ€è¦è€ƒè™‘ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;åŒæ­¥é“¾è·¯æ§åˆ¶&lt;/strong&gt;ï¼šåº”è¯¥æ˜ç¡®å“ªäº›æ•°æ®ä¸­å¿ƒé—´å¯ä»¥è¿›è¡ŒåŒæ­¥ï¼Œæ•°æ®æ˜¯å•å‘åŒæ­¥è¿˜æ˜¯åŒå‘åŒæ­¥&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;åŒæ­¥ä»»åŠ¡æ‰©å±•æ€§åŠæ€§èƒ½&lt;/strong&gt;ï¼šå¦‚æœé›†ç¾¤ä¸­çš„å•ä¸ªåŒæ­¥èŠ‚ç‚¹éƒ½åŒæ­¥å…¨é‡ Logï¼Œå¯èƒ½ä¼šä½¿å¾—åŒæ­¥æ€§èƒ½è¾ƒä½ï¼Œå»¶è¿Ÿè¾ƒå¤§ï¼›åŒæ—¶ï¼Œé›†ç¾¤æ— æ³•æ°´å¹³æ‰©å®¹ï¼Œæ‰©å±•æ€§ä½ã€‚æˆ‘ä»¬åº”è¯¥å°†åŒæ­¥ Log ä»¥åˆ‡ç‰‡çš„å½¢å¼åˆ†é…ç»™å„ä¸ªé›†ç¾¤èŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹åŒæ­¥éƒ¨åˆ† Logï¼Œä»è€Œæé«˜é›†ç¾¤çš„æ‰©å±•æ€§åŠåŒæ­¥æ€§èƒ½&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;åŒæ­¥ç¨³å®šæ€§&lt;/strong&gt;ï¼šèŠ‚ç‚¹çŠ¶æ€ç»å¸¸å˜åŒ–ï¼ˆå®•æœº/é‡å¯/æ‰©å®¹/ä¸‹çº¿ï¼‰ï¼ŒåŒæ­¥ä»»åŠ¡ä¹Ÿéšä¹‹ä¸å¤ªç¨³å®šï¼›æˆ‘ä»¬åº”è¯¥ä¿è¯åœ¨åŒæ­¥ä»»åŠ¡é‡å¯/è¿ç§»/é”€æ¯æ—¶ï¼ŒLog åŒæ­¥å°½é‡ä¸é—æ¼ï¼Œä¸é‡å¤&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;é’ˆå¯¹ä¸Šé¢ä¸‰ç‚¹é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡ç›¸åº”çš„é…ç½®è¿›è¡Œç®¡ç†ï¼š&lt;/p&gt;

&lt;h3 id=&quot;22221-åŒæ­¥è·¯ç”±é…ç½®idc-routers&quot;&gt;&lt;strong&gt;2.2.2.2.1 åŒæ­¥è·¯ç”±é…ç½®ï¼ˆIDC Routersï¼‰&lt;/strong&gt;&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;ç”¨äºæ§åˆ¶ä¸åŒæ•°æ®ä¸­å¿ƒé—´çš„åŒæ­¥æ–¹å‘&lt;/strong&gt;&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;id&lt;/th&gt;
      &lt;th&gt;target_idc&lt;/th&gt;
      &lt;th&gt;source_idc&lt;/th&gt;
      &lt;th&gt;status&lt;/th&gt;
      &lt;th&gt;å¤‡æ³¨&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;ä¸»é”®&lt;/td&gt;
      &lt;td&gt;ç›®æ ‡æ•°æ®ä¸­å¿ƒ&lt;/td&gt;
      &lt;td&gt;Â &lt;/td&gt;
      &lt;td&gt;Â &lt;/td&gt;
      &lt;td&gt;Â &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;ï¼ˆå½“å‰æ•°æ®ä¸­å¿ƒï¼‰&lt;/td&gt;
      &lt;td&gt;æºæ•°æ®ä¸­å¿ƒ&lt;/td&gt;
      &lt;td&gt;åŒæ­¥æ˜¯å¦å¼€å¯&lt;/td&gt;
      &lt;td&gt;æ•°æ®åŒæ­¥æ–¹å‘ï¼š&lt;/td&gt;
      &lt;td&gt;Â &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;source -&amp;gt; target&lt;/td&gt;
      &lt;td&gt;Â &lt;/td&gt;
      &lt;td&gt;Â &lt;/td&gt;
      &lt;td&gt;Â &lt;/td&gt;
      &lt;td&gt;Â &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;ç¤ºä¾‹ï¼šåŒ—äº¬ -&amp;gt; ä¸Šæµ·&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;id&lt;/th&gt;
      &lt;th&gt;target_idc&lt;/th&gt;
      &lt;th&gt;source_idc&lt;/th&gt;
      &lt;th&gt;status&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;sh&lt;/td&gt;
      &lt;td&gt;bj&lt;/td&gt;
      &lt;td&gt;true&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;22222-åŒæ­¥åˆ†åŒºé…ç½®partitions&quot;&gt;2.2.2.2.2 åŒæ­¥åˆ†åŒºé…ç½®ï¼ˆPartitionsï¼‰&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;åŒæ­¥èŠ‚ç‚¹ä¸åŒæ­¥åˆ†åŒºçš„æ˜ å°„å…³ç³»&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;åŒæ­¥åˆ†åŒºè®¾è®¡å‚è€ƒ Redis Cluster Slot å®ç°ï¼Œäººä¸ºæå‰è®¾å®šåˆ†åŒºæ€»æ•°ï¼Œå¦‚åˆ†åŒºæ€»æ•° 30ï¼Œåˆ†åŒºç´¢å¼•ä¸º [0, 1, 2, 3, 4 â€¦ 29]ã€‚&lt;/p&gt;

    &lt;p&gt;æ¯ä¸ªåŒæ­¥èŠ‚ç‚¹è´Ÿè´£ä¸€éƒ¨åˆ†åˆ†åŒºç´¢å¼•é›†åˆï¼Œå¦‚ node_1:[0, 2, 4, 6]ï¼Œnode_2:[1, 3, 5]ã€‚&lt;/p&gt;

    &lt;p&gt;åœ¨è¿›è¡Œ Log åŒæ­¥æ—¶ï¼Œå…ˆå¯¹ Log Key è¿›è¡Œ Hash å–æ¨¡ï¼Œè®¡ç®— Log å¯¹åº”çš„åˆ†åŒºç´¢å¼•ï¼Œå¦‚æœè¯¥ç´¢å¼•å€¼è½åœ¨åŒæ­¥èŠ‚ç‚¹ç»´æŠ¤çš„èŒƒå›´å†…ï¼Œåˆ™ç”±è¯¥èŠ‚ç‚¹è¿›è¡ŒåŒæ­¥ï¼Œå¦åˆ™å¿½ç•¥ã€‚&lt;/p&gt;

    &lt;blockquote&gt;
      &lt;p&gt;é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥ä¿è¯åŒä¸€ä¸ª key çš„å˜æ›´ä¼šç”±ç›¸åŒçš„åŒæ­¥èŠ‚ç‚¹è¿›è¡ŒåŒæ­¥ï¼Œä¿è¯åŒæ­¥é¡ºåº&lt;/p&gt;

    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;id&lt;/th&gt;
      &lt;th&gt;node&lt;/th&gt;
      &lt;th&gt;source_idc&lt;/th&gt;
      &lt;th&gt;partition_indexes&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;ä¸»é”®&lt;/td&gt;
      &lt;td&gt;åŒæ­¥èŠ‚ç‚¹ï¼šConsistency(Writer)&lt;/td&gt;
      &lt;td&gt;æºæ•°æ®ä¸­å¿ƒ&lt;/td&gt;
      &lt;td&gt;åŒæ­¥åˆ†åŒºç´¢å¼•åˆ—è¡¨&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;ç¤ºä¾‹ï¼šä¸Šæµ·ä¾§åŒæ­¥åˆ†åŒºé…ç½®&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;id&lt;/th&gt;
      &lt;th&gt;node&lt;/th&gt;
      &lt;th&gt;source_idc&lt;/th&gt;
      &lt;th&gt;partition_indexes&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;sh_node_1&lt;/td&gt;
      &lt;td&gt;bj&lt;/td&gt;
      &lt;td&gt;[1, 2, 3, 4, 5]&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2&lt;/td&gt;
      &lt;td&gt;sh_node_2&lt;/td&gt;
      &lt;td&gt;bj&lt;/td&gt;
      &lt;td&gt;[6, 7, 8, 9, 10]&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;ğŸ’¡ è¯¥é…ç½®è¡¨ç¤ºçš„æ˜¯&lt;em&gt;æœ¬åœ°æ•°æ®&lt;/em&gt;ä¸­å¿ƒåŒæ­¥ä»»åŠ¡çš„é…ç½®ã€‚é€šå¸¸ï¼Œ&lt;strong&gt;ä¸€ä¸ªåŒæ­¥èŠ‚ç‚¹å¯èƒ½è¿è¡Œå¤šä¸ªåŒæ­¥ä»»åŠ¡ï¼Œæ¯ä¸ªåŒæ­¥ä»»åŠ¡è´Ÿè´£åŒæ­¥ç‰¹å®šçš„åˆ†åŒºç´¢å¼• Logã€‚
åˆ†åŒºæ€»æ•°æå‰é…ç½®å¥½ï¼Œä¸”æ­£å¸¸æƒ…å†µä¸‹ä¿æŒä¸å˜ï¼›å°½é‡ä¿è¯åˆ†åŒºç´¢å¼•åœ¨åŒæ­¥èŠ‚ç‚¹ä¸­å‡åŒ€åˆ†é…ã€‚&lt;/strong&gt;
åŒæ­¥èŠ‚ç‚¹ : åŒæ­¥ä»»åŠ¡ = 1 : N (æ¯ä¸ªåŒæ­¥èŠ‚ç‚¹ä¸Šå¯èƒ½ä¼šè¿è¡Œå¤šä¸ªåŒæ­¥ä»»åŠ¡)
åŒæ­¥ä»»åŠ¡ : åŒæ­¥åˆ†åŒº = 1 : 1 (æ¯ä¸ªåŒæ­¥ä»»åŠ¡åªä¼šåŒæ­¥ä¸€ä¸ªåˆ†åŒº)&lt;/p&gt;

&lt;h3 id=&quot;22223-æ—¥å¿—åˆ†åŒºåç§»é‡é…ç½®offsets&quot;&gt;&lt;strong&gt;2.2.2.2.3 æ—¥å¿—åˆ†åŒºåç§»é‡é…ç½®ï¼ˆOffsetsï¼‰&lt;/strong&gt;&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;è®°å½•æ¯ä¸ªåˆ†åŒºæœ€æ–°åŒæ­¥ä½ç½®&lt;/strong&gt;&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;id&lt;/th&gt;
      &lt;th&gt;source_idc&lt;/th&gt;
      &lt;th&gt;partition_index&lt;/th&gt;
      &lt;th&gt;offset&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;ä¸»é”®&lt;/td&gt;
      &lt;td&gt;æºæ•°æ®ä¸­å¿ƒ&lt;/td&gt;
      &lt;td&gt;åŒæ­¥åˆ†åŒºç´¢å¼•&lt;/td&gt;
      &lt;td&gt;åŒæ­¥æ—¥å¿—åç§»é‡&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;ç¤ºä¾‹ï¼šåŒ—äº¬åˆ†åŒºåç§»é‡é…ç½®&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;id&lt;/th&gt;
      &lt;th&gt;source_idc&lt;/th&gt;
      &lt;th&gt;partition_index&lt;/th&gt;
      &lt;th&gt;offset&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;bj&lt;/td&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;10&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2&lt;/td&gt;
      &lt;td&gt;bj&lt;/td&gt;
      &lt;td&gt;2&lt;/td&gt;
      &lt;td&gt;4&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;3&lt;/td&gt;
      &lt;td&gt;bj&lt;/td&gt;
      &lt;td&gt;3&lt;/td&gt;
      &lt;td&gt;5&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;4&lt;/td&gt;
      &lt;td&gt;bj&lt;/td&gt;
      &lt;td&gt;4&lt;/td&gt;
      &lt;td&gt;9&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;ğŸ’¡ åŒæ­¥ä»»åŠ¡å¢é‡åŒæ­¥æŒ‡å®šåˆ†åŒºçš„éƒ¨åˆ† Log ä¹‹åï¼Œæ›´æ–°è¯¥åˆ†åŒºçš„åç§»é‡ï¼ˆoffsetï¼‰ï¼Œä»¥ä¾¿&lt;strong&gt;å½“åŒæ­¥ä»»åŠ¡é‡å¯/è¿ç§»åèƒ½å¤Ÿä»ä¸Šæ¬¡åŒæ­¥çš„ä½ç½®ç»§ç»­åŒæ­¥&lt;/strong&gt;ã€‚
æ¯ä¸ªæºæ•°æ®ä¸­å¿ƒä¸‹çš„æ¯ä¸ªåˆ†åŒºéƒ½éœ€è¦ç»´æŠ¤è‡ªèº«çš„ Offsetã€‚&lt;/p&gt;

&lt;h3 id=&quot;223-manager--åŒæ­¥ä»»åŠ¡è°ƒåº¦&quot;&gt;2.2.3 Manager : åŒæ­¥ä»»åŠ¡è°ƒåº¦&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;/images/lion_data_synchronization/2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å‰é¢æåˆ°ï¼Œä¸ºäº†æé«˜åŒæ­¥ä»»åŠ¡çš„æ‰©å±•æ€§ï¼Œå¯¹åŒæ­¥æ—¥å¿—è¿›è¡Œäº†åˆ‡ç‰‡å¤„ç†ï¼Œ&lt;strong&gt;æ¯ä¸ªåŒæ­¥ä»»åŠ¡åªè´Ÿè´£ä¸€ä¸ªåˆ‡ç‰‡ï¼Œæ¯ä¸ªåŒæ­¥èŠ‚ç‚¹ä¸Šå¯è¿è¡Œå¤šä¸ªåŒæ­¥ä»»åŠ¡&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;Manager ä½œä¸ºåŒæ­¥ä»»åŠ¡ç®¡ç†çš„æ ¸å¿ƒæ¨¡å—ï¼Œä¸»è¦ä¸åŒæ•°æ®ä¸­å¿ƒå†…çš„åŒæ­¥èŠ‚ç‚¹ï¼ˆConsistencyï¼‰èŠ‚ç‚¹è¿›è¡Œäº¤äº’ï¼Œæ¶‰åŠåŠŸèƒ½æœ‰ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;åˆå§‹åŒ–åŒæ­¥ä»»åŠ¡&lt;/strong&gt;ï¼šåœ¨æ–°å¢æ•°æ®ä¸­å¿ƒï¼Œæ–°å¢åŒæ­¥/é›†ç¾¤èŠ‚ç‚¹ï¼ŒåŒæ­¥æœåŠ¡å¯åŠ¨æ—¶ï¼Œåœ¨åŒæ­¥èŠ‚ç‚¹ï¼ˆConsistencyï¼‰ä¸Šåˆå§‹åŒ–åŒæ­¥ä»»åŠ¡&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;åŒæ­¥ä»»åŠ¡ç»´æŠ¤&lt;/strong&gt;ï¼šä¸»åŠ¨æ£€æµ‹åŒæ­¥èŠ‚ç‚¹ä¸Šå„ä¸ªä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€ï¼›åœ¨åŒæ­¥ä»»åŠ¡ä¸å¯ç”¨æ—¶ï¼ŒåŠæ—¶é”€æ¯æ—§ä»»åŠ¡ï¼Œåˆ›å»ºæ–°ä»»åŠ¡ï¼›å½“åŒæ­¥åˆ†åŒºè¿ç§»æ—¶ï¼Œä¸»åŠ¨åœ¨åŒæ­¥èŠ‚ç‚¹é—´è¿ç§»åŒæ­¥ä»»åŠ¡&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;æ—¥å¿—åˆ†åŒºåˆ†é…&lt;/strong&gt;ï¼šå½“åŒæ­¥èŠ‚ç‚¹å˜æ›´æ—¶ï¼Œéœ€è¦å¯¹åˆ†åŒºè¿›è¡Œåˆ†é…ï¼Œä¿è¯ä¸åŒèŠ‚ç‚¹é—´åŒæ­¥è´Ÿè½½å°½å¯èƒ½å‡è¡¡ï¼ˆ&lt;em&gt;åŒæ­¥åˆ†åŒºçš„å˜æ›´ä¼šè§¦å‘åŒæ­¥ä»»åŠ¡çš„è¿ç§»&lt;/em&gt;ï¼‰&lt;/p&gt;

    &lt;blockquote&gt;
      &lt;p&gt;ç³»ç»Ÿåˆå§‹åŒ–æ—¶ï¼Œç”±äººå·¥æ‰‹åŠ¨è¿›è¡Œåˆ†åŒºé…ç½®&lt;/p&gt;

    &lt;/blockquote&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;åŒæ­¥èŠ‚ç‚¹ç›‘å¬&lt;/strong&gt;ï¼šManager ä¼šå®šæ—¶ä» Meta æŸ¥è¯¢æœ€æ–°çš„åŒæ­¥èŠ‚ç‚¹åˆ—è¡¨ï¼Œå½“å‘ç”ŸèŠ‚ç‚¹å˜æ›´æ—¶ï¼Œè§¦å‘åˆ†åŒºé‡æ–°åˆ†é…&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;åˆ†åŒºåç§»é‡ç»´æŠ¤&lt;/strong&gt;ï¼šåŒæ­¥ä»»åŠ¡åœ¨å®Œæˆå¢é‡æ—¥å¿—åŒæ­¥æ—¶ï¼Œä¼šä¸ŠæŠ¥å½“å‰åˆ†åŒºæœ€æ–°åç§»é‡å¹¶æŒä¹…åŒ–ï¼Œä»¥ä¾¿åç»­åŒæ­¥ä»»åŠ¡é‡å¯æ—¶èƒ½å¤Ÿä»æœ€æ–° Offset å¤„é‡æ–°åŒæ­¥&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;img src=&quot;/images/lion_data_synchronization/3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Manager ç®¡ç†æµç¨‹ç»†èŠ‚å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Manager ä» DB ä¸­åŠ è½½ IDC Routersï¼ŒPartitions åŸæ•°æ®ï¼Œç”¨äºæ˜ç¡®æ•°æ®åŒæ­¥æ–¹å‘ï¼ˆsource-&amp;gt;targetï¼‰ï¼ŒåŒæ­¥èŠ‚ç‚¹ç»´æŠ¤çš„åˆ†åŒºåˆ—è¡¨&lt;/li&gt;
  &lt;li&gt;Manager &lt;strong&gt;å®šæ—¶ä¸åŒæ­¥èŠ‚ç‚¹é€šä¿¡&lt;/strong&gt;ï¼Œè·å–èŠ‚ç‚¹ä¸Šåˆ†åŒºåŒæ­¥ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€ï¼š{partition_index: task_status}
    &lt;ol&gt;
      &lt;li&gt;å¦‚æœåŒæ­¥èŠ‚ç‚¹ç»´æŠ¤çš„åˆ†åŒºåˆ—è¡¨æ²¡æœ‰å¯¹åº”çš„åŒæ­¥ä»»åŠ¡æ‰§è¡Œï¼Œåˆ™åœ¨è¯¥åŒæ­¥èŠ‚ç‚¹ä¸Š&lt;strong&gt;åˆå§‹åŒ–å¯¹åº”åˆ†åŒºåŒæ­¥ä»»åŠ¡&lt;/strong&gt;&lt;/li&gt;
      &lt;li&gt;å¦‚æœåŒæ­¥èŠ‚ç‚¹ç»´æŠ¤çš„éƒ¨åˆ†åˆ†åŒºä»»åŠ¡æ‰§è¡ŒçŠ¶æ€å¼‚å¸¸ï¼Œåˆ™åœ¨è¯¥åŒæ­¥èŠ‚ç‚¹ä¸Š&lt;strong&gt;æ–°å»ºå¯¹åº”åˆ†åŒºåŒæ­¥ä»»åŠ¡ï¼Œå¹¶é”€æ¯æ—§åŒæ­¥ä»»åŠ¡&lt;/strong&gt;&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
  &lt;li&gt;åœ¨åŒæ­¥ä»»åŠ¡æ­£å¸¸æ‰§è¡ŒæœŸé—´ï¼Œä¼šä¸ŠæŠ¥æœ€æ–°å·²åŒæ­¥åˆ†åŒºæ—¥å¿—åç§»é‡è‡³ Managerï¼Œå¹¶æŒä¹…åŒ–åˆ° Offsets è¡¨ä¸­&lt;/li&gt;
  &lt;li&gt;Manager å®šæ—¶ä» Meta æŸ¥è¯¢åŒæ­¥æ¨¡å—æœ€æ–°å¯ç”¨èŠ‚ç‚¹åˆ—è¡¨
    &lt;ol&gt;
      &lt;li&gt;å¦‚æœæ–°å¢/æ‘˜é™¤åŒæ­¥èŠ‚ç‚¹ï¼Œåˆ™ &lt;strong&gt;Manager ä¼šå¯¹åŒæ­¥åˆ†åŒºè¿›è¡Œé‡æ–°åˆ†é…&lt;/strong&gt;ï¼Œå°½é‡ä¿è¯åˆ†åŒºå‡åŒ€åˆ†é…&lt;/li&gt;
      &lt;li&gt;åˆ†åŒºé‡æ–°åˆ†é…ä¹‹åï¼Œéœ€è¦å¯¹åŒæ­¥ä»»åŠ¡è¿›è¡Œè¿ç§»ï¼Œç¡®ä¿&lt;strong&gt;åŒæ­¥èŠ‚ç‚¹ç»´æŠ¤çš„åˆ†åŒºåˆ—è¡¨ä¸åŒæ­¥ä»»åŠ¡ä¸€ä¸€å¯¹åº”&lt;/strong&gt;&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;ä»ä¸Šé¢æµç¨‹æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Offset åªä¼šç”±åŒæ­¥ä»»åŠ¡ä¸ŠæŠ¥å¹¶æ›´æ–°&lt;/strong&gt;ï¼› Offset ä¸ Partition ç»‘å®š&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Partition é…ç½®åªåœ¨åŒæ­¥èŠ‚ç‚¹å‘ç”Ÿå˜æ›´çš„æ—¶å€™æ‰ä¼šå˜æ›´&lt;/strong&gt;ï¼›Partition ä¸åŒæ­¥èŠ‚ç‚¹ç»‘å®š&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ğŸ’¡ Qï¼šæ•°æ®ä¸­å¿ƒåˆå§‹åŒ–é˜¶æ®µï¼ŒåŒæ­¥åˆ†åŒºå¦‚ä½•åˆ†é…çš„ï¼Ÿ
Aï¼šåˆå§‹é˜¶æ®µç”±äººå·¥æ‰‹åŠ¨ä¸ºåŒæ­¥èŠ‚ç‚¹è¿›è¡Œåˆ†åŒºåˆ†é…ï¼Œå¹¶ä¸”åˆ†åŒºæ€»æ•°éœ€è¦å¤§äºèŠ‚ç‚¹æ•°ã€‚å¦‚åŒæ­¥èŠ‚ç‚¹æ•°ä¸º 5ï¼Œåˆ†åŒºæ€»æ•°ä¸º 30.&lt;/p&gt;

&lt;p&gt;Qï¼šå¤šä¸ª Manager ä¼šåŒæ—¶è¿›è¡Œä»»åŠ¡ç®¡ç†å—ï¼Ÿ
Aï¼šä¼šçš„ï¼ŒåŒä¸€æ•°æ®ä¸­å¿ƒå†…ä¼šæœ‰å¤šä¸ª Manager èŠ‚ç‚¹è¿›è¡Œç®¡ç†ï¼Œä¸ºäº†å‡å°‘å†²çªï¼Œå¯ä»¥æ›´æ–°å‰ä½¿ç”¨ç®€å•çš„åˆ†å¸ƒå¼é”ï¼ˆå·²åœ¨ Lion å½“å‰å®ç°ä¸­å¾—åˆ°éªŒè¯ï¼‰.&lt;/p&gt;

&lt;h3 id=&quot;224-consistency--å®æ—¶åŒæ­¥æ•°æ®&quot;&gt;2.2.4 Consistency : å®æ—¶åŒæ­¥æ•°æ®&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;/images/lion_data_synchronization/4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Manager åœ¨åŒæ­¥èŠ‚ç‚¹ï¼ˆConsistencyï¼‰ä¸Šåˆ›å»ºçš„åŒæ­¥ä»»åŠ¡ç”¨äºå®ç°ä¸åŒæ•°æ®ä¸­å¿ƒé—´æ•°æ®åŒæ­¥åŠŸèƒ½&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;ç”¨æˆ·åœ¨åŒ—äº¬ä¾§å˜æ›´é…ç½®ï¼ŒåŒ—äº¬ä¾§ DB ä¼šæ’å…¥ä¸€æ¡ SourceSyncLogï¼Œè¯¥ Log åŒ…å«äº†é…ç½®å˜æ›´çš„è¯¦ç»†ä¿¡æ¯&lt;/li&gt;
  &lt;li&gt;ä¸Šæµ·ä¾§åŒæ­¥ä»»åŠ¡ï¼ˆWriterï¼‰åœ¨è¿è¡Œæ—¶ï¼Œä¼šä» Manager &lt;strong&gt;åŠ è½½å¯¹åº”åˆ†åŒºçš„åç§»é‡&lt;/strong&gt;ï¼ŒåŒæ—¶ä» Meta è·å–&lt;strong&gt;åŒ—äº¬ä¾§ Consistency æœ€æ–°å¯ç”¨èŠ‚ç‚¹åˆ—è¡¨&lt;/strong&gt;ï¼Œç”¨äºåç»­æ—¥å¿—æ‹‰å–&lt;/li&gt;
  &lt;li&gt;åŒæ­¥ä»»åŠ¡ï¼ˆWriterï¼‰&lt;strong&gt;éšæœºè®¿é—®&lt;/strong&gt;åŒ—äº¬ä¾§ Consistencyï¼ˆReaderï¼‰èŠ‚ç‚¹ï¼Œæ ¹æ® Offset æ‰¹é‡åŠ è½½ SourceSyncLog
    &lt;ol&gt;
      &lt;li&gt;å¯¹åŒ—äº¬ä¾§è¿”å›çš„æ—¥å¿—è¿›è¡Œè¿‡æ»¤ï¼Œ&lt;strong&gt;è¿‡æ»¤å‡ºå±äºå½“å‰åˆ†åŒºç´¢å¼•çš„éƒ¨åˆ†æ—¥å¿—&lt;/strong&gt;ï¼ˆå¯¹é…ç½® key å– hashï¼‰&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
  &lt;li&gt;è¿‡æ»¤å®Œæˆåï¼ŒåŒæ­¥ä»»åŠ¡é¦–å…ˆå°†&lt;strong&gt;è¿‡æ»¤ç»“æœæ—¥å¿—æ‰¹é‡ä¿å­˜åœ¨æœ¬åœ° DB&lt;/strong&gt;ï¼ˆTargetSyncLogï¼‰ä¸­
    &lt;ol&gt;
      &lt;li&gt;æ­¤æ—¶ï¼Œä¿å­˜åœ¨æœ¬åœ°çš„ TargetSyncLog çš„ Status å­—æ®µé»˜è®¤ä¸º&lt;em&gt;æœªåŒæ­¥çŠ¶æ€&lt;/em&gt;&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
  &lt;li&gt;éšåï¼ŒåŒæ­¥ä»»åŠ¡ï¼ˆWriterï¼‰å°†æ—¥å¿—ä¾æ¬¡å›æ”¾ï¼Œå°†åŒ—äº¬ä¾§çš„æœ€æ–°é…ç½®åŒæ­¥æœ¬åœ°
    &lt;ol&gt;
      &lt;li&gt;åŒæ­¥æˆåŠŸä¹‹åï¼Œå°† TargetSyncLog çš„ Status å­—æ®µç½®ä¸º&lt;em&gt;åŒæ­¥æˆåŠŸçŠ¶æ€&lt;/em&gt;&lt;/li&gt;
      &lt;li&gt;å¦‚æœåŒæ­¥å¤±è´¥ï¼Œåˆ™åº”å°† Status å­—æ®µç½®ä¸º&lt;em&gt;åŒæ­¥å¤±è´¥çŠ¶æ€&lt;/em&gt;&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
  &lt;li&gt;å°†å›æ”¾å®Œæˆçš„æ—¥å¿— &lt;strong&gt;LogId ä½œä¸ºæœ€æ–°åˆ†åŒº Offset&lt;/strong&gt; ä¸ŠæŠ¥ç»™ Manager
    &lt;ol&gt;
      &lt;li&gt;ä¸ç®¡å›æ”¾æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½éœ€è¦ä¸ŠæŠ¥ Offsetï¼Œä¼˜å…ˆä¿è¯ä¸é˜»å¡åç»­æ—¥å¿—åŒæ­¥ =&amp;gt; å¯¹äºå¤±è´¥çš„æ—¥å¿—ï¼Œç”±åç»­è¡¥æ‰«ä»»åŠ¡ç»§ç»­åŒæ­¥&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
  &lt;li&gt;æœ¬æ‰¹æ¬¡åŒæ­¥å®Œæˆä¹‹åï¼Œå°†ä»¥æœ€æ–°çš„ Offset è¿›è¡Œä¸‹ä¸€æ¬¡åŒæ­¥æµç¨‹&lt;/li&gt;
&lt;/ol&gt;

&lt;blockquote&gt;
  &lt;p&gt;æ¯ä¸ªåŒæ­¥ä»»åŠ¡åªä¼šåŒæ­¥å±äºè‡ªèº«åˆ†åŒºçš„æ—¥å¿—ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸åŒèŠ‚ç‚¹ä¸Šçš„ä¸åŒåŒæ­¥ä»»åŠ¡ä¸ä¼šé‡å¤åŒæ­¥åŒä¸€æ¡æ—¥å¿—ï¼ˆå³ä½¿æœ‰å°‘é‡é‡å¤åŒæ­¥ä¹Ÿæ²¡å½±å“ï¼‰&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;ğŸ’¡ Qï¼šæ—¥å¿—åŒæ­¥æµç¨‹æ˜¯å¦å¯ä»¥å°† Log æŒä¹…åŒ–åˆ° DB æ­¥éª¤ç§»é™¤ï¼Ÿ
Aï¼šæ—¥å¿—å›æ”¾è¿‡ç¨‹å¯èƒ½ä¼šå¤±è´¥ï¼Œé€šè¿‡å°† Log æŒä¹…åŒ–ï¼Œå¹¶æ ‡è¯†çŠ¶æ€ï¼Œå¯ä»¥æ–¹ä¾¿åç»­é‡æ–°åŒæ­¥ï¼Œä¿è¯ä¸é—æ¼&lt;/p&gt;

&lt;p&gt;Qï¼šæ•´ä¸ªæµç¨‹åŸºæœ¬ä¸ºåŒæ­¥æ‰§è¡Œï¼Œæ˜¯å¦ä¼šå­˜åœ¨æ€§èƒ½é—®é¢˜ï¼Ÿ
Aï¼šé€šè¿‡è®¾ç½®é€‚å½“å¤§å°çš„åˆ†åŒºï¼ˆå¦‚ 256ï¼‰ï¼Œå¹¶è€ƒè™‘ä»£ç å±‚é¢ä¼˜åŒ–ï¼ˆå¦‚çƒ­ç‚¹ key èšåˆï¼Œåˆ†åŒºå†…éƒ¨å† hashï¼‰ï¼ŒåŸºæœ¬èƒ½å¤Ÿæ»¡è¶³ Lion éœ€æ±‚&lt;/p&gt;

&lt;h3 id=&quot;225-åŒæ­¥é›†ç¾¤èŠ‚ç‚¹å˜æ›´ä¸ä»»åŠ¡è¿ç§»&quot;&gt;2.2.5 åŒæ­¥é›†ç¾¤èŠ‚ç‚¹å˜æ›´ä¸ä»»åŠ¡è¿ç§»&lt;/h3&gt;

&lt;p&gt;åœ¨æ—¥å¸¸è¿ç»´ä¸­ï¼Œé›†ç¾¤èŠ‚ç‚¹å˜æ›´æ˜¯ç»å¸¸å‘ç”Ÿçš„ï¼Œå¦‚æœåŠ¡å‘å¸ƒï¼Œå®¿ä¸»æœºå®•æœºï¼Œæ–°å¢æœºå™¨ç­‰ã€‚æˆ‘ä»¬éœ€è¦ä¿è¯é›†ç¾¤èŠ‚ç‚¹å˜åŒ–æ—¶ï¼Œæ•°æ®åŒæ­¥åŠŸèƒ½ä»ç¨³å®šæ‰§è¡Œã€‚é’ˆå¯¹è¿™ç±»é—®é¢˜ï¼Œè¿›ä¸€æ­¥è¿›è¡Œè®¨è®ºã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/lion_data_synchronization/5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ¯ä¸ªèŠ‚ç‚¹ç»´æŠ¤ä¸€éƒ¨åˆ†åˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºå¯¹åº”ä¸€ä¸ªåŒæ­¥ä»»åŠ¡ã€‚å½“å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹ä¸å¯ç”¨æ—¶ï¼Œè¯¥èŠ‚ç‚¹ç»´æŠ¤çš„åˆ†åŒºé›†åˆå°±ä¼šè¢«è¿ç§»åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šï¼ŒåŒæ—¶åœ¨å…¶ä»–èŠ‚ç‚¹ä¸Šåˆ›å»ºå¯¹åº”çš„åˆ†åŒºåŒæ­¥ä»»åŠ¡ã€‚&lt;/p&gt;

&lt;p&gt;é‚£ä¹ˆï¼Œåœ¨åŒæ­¥ä»»åŠ¡è¿ç§»ï¼ˆåˆ†åŒºè¿ç§»ï¼‰è¿‡ç¨‹ä¸­ï¼Œèƒ½å¦ä¿è¯åŒæ­¥æµç¨‹ç¨³å®šæ‰§è¡Œï¼Ÿ&lt;/p&gt;

&lt;p&gt;å›çœ‹ä¸‹åŒæ­¥ä»»åŠ¡çš„æ‰§è¡Œæ­¥éª¤ï¼Œè¿›ä¸€æ­¥åˆ†æï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/lion_data_synchronization/6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;åœ¨æ—¥å¿—ä»å¼‚åœ°åŠ è½½è¿‡æ»¤ä¹‹åï¼Œå°†ä¼šæŒä¹…åŒ–åˆ° DBã€‚ä¹‹åä¼šé€æ¡é¡ºåºå›æ”¾æ—¥å¿—ï¼Œå›æ”¾å®Œæˆåä¸ŠæŠ¥æœ€æ–° Offset&lt;/p&gt;

&lt;/blockquote&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;ä»»åŠ¡è¿ç§»æ—¶æœº&lt;/th&gt;
      &lt;th&gt;ç›´æ¥å½±å“&lt;/th&gt;
      &lt;th&gt;åŒæ­¥ç¨³å®šæ€§å½±å“&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Step 1: æ—¥å¿—åŠ è½½&lt;/td&gt;
      &lt;td&gt;å½“å‰æ‰¹æ¬¡æ‹‰å–å¤±è´¥&lt;/td&gt;
      &lt;td&gt;æ— å½±å“ï¼šç”±äº Offset æœªå˜åŒ–ï¼Œè¿ç§»åçš„æ–°ä»»åŠ¡ä¼šé‡æ–°ä»å½“å‰ä½ç½®æ‹‰å–&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Step 2: æ—¥å¿—è¿‡æ»¤ï¼Œä¿å­˜&lt;/td&gt;
      &lt;td&gt;æ‹‰å–çš„æ—¥å¿—ä¿å­˜å¤±è´¥&lt;/td&gt;
      &lt;td&gt;æ— å½±å“ï¼šç”±äº Offset æœªå˜åŒ–ï¼Œè¿ç§»åçš„æ–°ä»»åŠ¡ä¼šé‡æ–°ä»å½“å‰ä½ç½®æ‹‰å–ï¼Œè¿‡æ»¤ï¼Œä¿å­˜&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Step 3: é€æ¡å›æ”¾æ—¥å¿—&lt;/td&gt;
      &lt;td&gt;è¯¥æ‰¹æ¬¡ logId &amp;gt; offset çš„æ—¥å¿—å›æ”¾å¤±è´¥&lt;/td&gt;
      &lt;td&gt;å°‘é‡æ—¥å¿—é‡å¤åŒæ­¥ï¼šè¯¥æ‰¹æ¬¡ logId &amp;gt; offset çš„æ—¥å¿—ä¼šè¢«æ–°ä»»åŠ¡é‡æ–°åŒæ­¥&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Step 4: ä¸ŠæŠ¥ Offset&lt;/td&gt;
      &lt;td&gt;è¯¥æ¡å›æ”¾å®Œæˆçš„æ—¥å¿— logId æœªä¸ŠæŠ¥&lt;/td&gt;
      &lt;td&gt;å°‘é‡æ—¥å¿—é‡å¤åŒæ­¥ï¼šè¯¥æ‰¹æ¬¡ logId &amp;gt; offset çš„æ—¥å¿—ä¼šè¢«æ–°ä»»åŠ¡é‡æ–°åŒæ­¥&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;å¯ä»¥çœ‹å‡ºï¼Œåœ¨åŒæ­¥ä»»åŠ¡æ‰§è¡Œé˜¶æ®µçš„ä»»ä½•æ—¶æœºè¿ç§»ï¼Œ&lt;strong&gt;æœ€åçš„æƒ…å†µæ˜¯è¯¥æ‰¹æ¬¡æ—¥å¿—è¢«é‡å¤åŒæ­¥&lt;/strong&gt;ã€‚è€Œæˆ‘ä»¬çš„åŒæ­¥æµç¨‹æ”¯æŒå¹‚ç­‰ï¼Œä¸”æ—¥å¿—æ‰¹æ¬¡å¤§å°å¯æ§ï¼Œå› æ­¤ï¼Œå¯¹åŒæ­¥æµç¨‹çš„ç¨³å®šæ€§åŸºæœ¬æ²¡æœ‰å½±å“ã€‚&lt;/p&gt;

&lt;h3 id=&quot;226-è¡¥æ‰«ä»»åŠ¡é‡æ–°åŒæ­¥&quot;&gt;2.2.6 è¡¥æ‰«ä»»åŠ¡ï¼šé‡æ–°åŒæ­¥&lt;/h3&gt;

&lt;p&gt;åœ¨ Log å¤åˆ¶å¹¶åŒæ­¥åˆ°æœ¬åœ°æµç¨‹ä¸­ï¼Œå¯èƒ½ä¼šå› ä¸º DB å¼‚å¸¸/ä»£ç é€»è¾‘ Bug ç­‰åŸå› å¯¼è‡´åŒæ­¥å¤±è´¥ï¼Œä¸ºäº†ä¸é˜»å¡åç»­å˜æ›´åŒæ­¥ï¼Œåœ¨é‡è¯•ä¸€å®šæ¬¡æ•°ä¹‹åï¼Œåº”è¯¥æ”¾å¼ƒã€‚&lt;/p&gt;

&lt;p&gt;ä½†æ˜¯ï¼Œä¸ºäº†ä¿è¯é…ç½®æœ€ç»ˆåŒæ­¥æˆåŠŸï¼Œåº”è¯¥å¯¹åŒæ­¥å¤±è´¥çš„ Log è¿›è¡Œé‡æ–°åŒæ­¥ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/lion_data_synchronization/7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;è¡¥æ‰«ä»»åŠ¡å®šæ—¶ä» TargetSyncLog ä¸­åŠ è½½æœªåŒæ­¥æˆåŠŸï¼ˆå¯èƒ½æ˜¯åŒæ­¥å¤±è´¥ï¼Œä¹Ÿå¯èƒ½æ˜¯æœªåŒæ­¥ï¼‰çš„æ—¥å¿—ï¼ŒåŒæ ·æŒ‰ç…§åˆ†åŒºè¿›è¡Œè¿‡æ»¤&lt;/p&gt;

    &lt;blockquote&gt;
      &lt;p&gt;ä¸ºäº†é¿å…æ‰«æåˆ°åˆšå¤åˆ¶è¿‡æ¥ï¼Œä½†è¿˜æœªåŒæ­¥å®Œæˆä¸­çš„æ—¥å¿—ï¼Œè¡¥æ‰«ä»»åŠ¡éœ€è¦æ‰«æä¸€å®šæ—¶é—´èŒƒå›´å†…çš„æ—¥å¿—ï¼Œå¦‚ 1 åˆ†é’ŸèŒƒå›´å¤–&lt;/p&gt;

    &lt;/blockquote&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;å¯¹æ‰«æåˆ°çš„æ—¥å¿—è¿›è¡Œé‡æ–°åŒæ­¥ï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™æ›´æ–° Status å­—æ®µä¸ºåŒæ­¥æˆåŠŸçŠ¶æ€ï¼›å¦åˆ™ä»æ”¾å¼ƒï¼Œç­‰å¾…ä¸‹æ¬¡è¡¥æ‰«ä»»åŠ¡åŒæ­¥&lt;/p&gt;

    &lt;blockquote&gt;
      &lt;p&gt;å¤šæ¬¡è¡¥æ‰«åŒæ­¥ä»å¯èƒ½å¤±è´¥ï¼Œå› æ­¤éœ€è¦è®¾ç½®ä¸€ä¸ªåŒæ­¥é˜ˆå€¼ï¼Œè¶…è¿‡è¯¥é˜ˆå€¼ä»æœªæˆåŠŸï¼Œåˆ™è§¦å‘å‘Šè­¦ï¼Œäººå·¥ä»‹å…¥æ’æŸ¥åŸå› &lt;/p&gt;

    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;è¡¥æ‰«ä»»åŠ¡ä¸åŒæ­¥èŠ‚ç‚¹æ˜¯ 1 : 1 çš„å…³ç³»ï¼Œå³&lt;strong&gt;ä¸€ä¸ªåŒæ­¥èŠ‚ç‚¹ä¸Šåªæœ‰ä¸€ä¸ªè¡¥æ‰«ä»»åŠ¡ï¼Œå¹¶ä¸”è¯¥è¡¥æ‰«ä»»åŠ¡è´Ÿè´£å¤šä¸ªæ—¥å¿—åˆ†åŒº&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;å‡å¦‚åŒæ­¥èŠ‚ç‚¹è´Ÿè´£çš„åˆ†åŒºç´¢å¼•ä¸º [1, 2, 3]ï¼Œé‚£ä¹ˆä¼šæœ‰ä¸‰ä¸ªå®æ—¶åŒæ­¥ä»»åŠ¡ï¼Œæ¯ä¸ªå®æ—¶åŒæ­¥ä»»åŠ¡åˆ†åˆ«è´Ÿè´£ä¸€ä¸ªåˆ†åŒºï¼›ä½†æ˜¯åªæœ‰ä¸€ä¸ªè¡¥æ‰«ä»»åŠ¡ï¼ŒåŒæ—¶è´Ÿè´£ [1, 2, 3] åˆ†åŒº&lt;/p&gt;

&lt;/blockquote&gt;

&lt;h3 id=&quot;227-ä¸€è‡´æ€§æ£€æµ‹&quot;&gt;2.2.7 ä¸€è‡´æ€§æ£€æµ‹&lt;/h3&gt;

&lt;p&gt;å®æ—¶åŒæ­¥ä¸è¡¥æ‰«åŒæ­¥æµç¨‹èƒ½å¤Ÿä¿è¯å¤§éƒ¨åˆ†æƒ…å†µä¸‹é…ç½®ä¸€è‡´æ€§ï¼ˆ&amp;gt;99.99%ï¼‰ï¼Œä»æœ‰å°æ¦‚ç‡ä¼šå‡ºç°é…ç½®ä¸ä¸€è‡´çš„æƒ…å†µã€‚&lt;/p&gt;

&lt;p&gt;å› æ­¤é™¤äº†å®æ—¶åŒæ­¥ï¼Œè¡¥æ‰«åŒæ­¥ï¼Œè¿˜éœ€è¦å¢åŠ å¢é‡ä¸€è‡´æ€§æ£€æµ‹ä»»åŠ¡ï¼Œå¯¹äºä¸ä¸€è‡´çš„é…ç½®è¿›è¡Œå†æ¬¡æ£€æµ‹ä¸ä¿®å¤ã€‚&lt;/p&gt;

&lt;p&gt;ç†æƒ³æƒ…å†µä¸‹ï¼Œå¢é‡ä¸€è‡´æ€§æ£€æµ‹ä»»åŠ¡æ‰§è¡Œæ­¥éª¤å¦‚ä¸‹ï¼š1. æ¯ä¸ªæ•°æ®ä¸­å¿ƒçš„åŒæ­¥èŠ‚ç‚¹æŒ‰ç…§ IDC Router é…ç½®ï¼Œä»ç›®æ ‡ IDC ä¸­æŸ¥è¯¢æŒ‡å®šé…ç½®çš„æœ€æ–°å€¼ï¼›2. å°†ç›®æ ‡ IDC è¿”å›çš„æœ€æ–°å€¼è¿›è¡Œæ¯”è¾ƒï¼ˆtimestamp æ¯”è¾ƒï¼‰ï¼Œå¦‚æœå¤šä¸ªæ•°æ®ä¸­å¿ƒçš„é…ç½®å€¼ä¸åŒï¼Œåˆ™é€‰æ‹©æœ€æ–°çš„é…ç½®å€¼ä½œä¸ºç›®æ ‡å€¼ï¼Œå¹¶æ›´æ–°æœ¬åœ°ã€‚&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;ä¸¾ä¾‹ï¼ŒåŒ—äº¬ä¾§æœ‰ä¸ªé…ç½® key = lion-test.demoï¼ŒåŒ—äº¬ä¾§åŒæ­¥èŠ‚ç‚¹æŸ¥è¯¢ lion-test.demo åœ¨ä¸Šæµ·/æ€€æ¥/é¦™æ¸¯ä¾§çš„æœ€æ–°å€¼ï¼Œå¦‚æœè¿™å‡ ä¸ªæ•°æ®ä¸­å¿ƒçš„å€¼éƒ½ä¸åŒï¼Œåˆ™ä»¥æœ€æ–°å€¼ä¸ºä¸»ï¼Œå°†å…¶æ›´æ–°æœ¬åœ°&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;è€ƒè™‘åˆ°å·²çŸ¥éœ€è¦æ”¯æ’‘çš„æ•°æ®ä¸­å¿ƒæœ‰åŒ—äº¬/ä¸Šæµ·/æ€€æ¥/é¦™æ¸¯ï¼Œå¦‚æœæŒ‰ç…§ä¸Šé¢æ‰§è¡Œæ­¥éª¤ï¼Œé‚£ä¹ˆæ£€æµ‹é“¾è·¯ä¸º 4*3ï¼Œæ¯ä¸¤ä¸ªæ•°æ®ä¸­å¿ƒé—´éƒ½éœ€è¦è¿›è¡Œä¸€æ¬¡æ¯”è¾ƒï¼Œå¯¹äºä¸ä¸€è‡´å†²çªæƒ…å†µå¤„ç†æ¯”è¾ƒå¤æ‚ã€‚åç»­å¦‚æœéœ€è¦å†æ–°å¢æ•°æ®ä¸­å¿ƒï¼Œå†²çªå¤„ç†æƒ…å†µå°†ä¼šæ›´åŠ å¤æ‚ï¼Œä¸åˆ©äºç»´æŠ¤ã€‚&lt;/p&gt;

&lt;p&gt;ç°åœ¨ Lion å·²ç»æœ‰åŒ—äº¬/ä¸Šæµ·ä¸¤ä¸ªæ•°æ®ä¸­å¿ƒï¼Œä¸Šæµ·ä¾§çš„å˜æ›´è¯·æ±‚åªæœ‰åŒ—äº¬ä¾§çš„ä¸€åŠï¼Œå¤§éƒ¨åˆ†å˜æ›´è§¦å‘æºéƒ½åœ¨åŒ—äº¬ï¼Œå³å¤§éƒ¨åˆ†æ•°æ®åŒæ­¥æ–¹å‘ä¸ºï¼šåŒ—äº¬ -&amp;gt; ä¸Šæµ·ã€‚&lt;/p&gt;

&lt;p&gt;å› æ­¤ï¼Œä¸ºäº†ç®€åŒ–ä¸ä¸€è‡´å†²çªå¤„ç†ï¼Œæˆ‘ä»¬äººä¸º&lt;strong&gt;ç»™æ•°æ®ä¸­å¿ƒè®¾ç½®ä¼˜å…ˆçº§ï¼šåŒ—äº¬ &amp;gt; æ€€æ¥ &amp;gt; ä¸Šæµ· &amp;gt; é¦™æ¸¯&lt;/strong&gt;ã€‚&lt;strong&gt;åŒ—äº¬æ•°æ®ä¸­å¿ƒä½œä¸ºä¸»æ•°æ®ä¸­å¿ƒ&lt;/strong&gt;ï¼Œå…¶ä»–æ•°æ®ä¸­å¿ƒä»¥åŒ—äº¬ä¾§ä¸ºä¸»è¿›è¡Œå¢é‡ä¸€è‡´æ€§æ£€æµ‹ã€‚&lt;/p&gt;

&lt;p&gt;ä½†æ˜¯ï¼Œå¦‚æœå…¶ä»–æ•°æ®ä¸­å¿ƒçš„æ•°æ®æ¯”åŒ—äº¬è¦æ–°ï¼Œåˆ™éœ€è¦åå“ºåŒ—äº¬ï¼Œæ›´æ–°åŒ—äº¬ä¾§æ•°æ®ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/lion_data_synchronization/8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä»¥ä¸Šæµ·æ•°æ®ä¸­å¿ƒå¢é‡æ£€æµ‹ä¸ºä¾‹ï¼ŒåŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;ä¸Šæµ·ä¾§ Consistency å¢é‡ä¸€è‡´æ€§æ£€æµ‹ä»»åŠ¡æŸ¥è¯¢æœ¬åœ°æŒ‡å®šæ—¶é—´èŒƒå›´å†…é…ç½®å˜æ›´åˆ—è¡¨&lt;/li&gt;
  &lt;li&gt;é€šè¿‡ HTTP è¯·æ±‚æŸ¥è¯¢åŒ—äº¬ä¾§å¯¹åº”é…ç½®çš„æœ€æ–°å€¼ï¼Œå¹¶è¿›è¡Œæ¯”è¾ƒæ—¶é—´æˆ³
    &lt;ol&gt;
      &lt;li&gt;åå“ºï¼šå¦‚æœä¸Šæµ· Timestamp &amp;gt; åŒ—äº¬ Timestampï¼Œåˆ™å›è°ƒåŒ—äº¬ï¼Œåœ¨åŒ—äº¬ä¾§æ’å…¥ä¸€æ¡ TargetSyncLogï¼Œç­‰å¾…åç»­è¡¥æ‰«ä»»åŠ¡é‡æ–°åŒæ­¥&lt;/li&gt;
      &lt;li&gt;ä¿®å¤ï¼šå¦‚æœä¸Šæµ· Timestamp &amp;lt;= åŒ—äº¬ Timestampï¼Œåˆ™åœ¨ä¸Šæµ·ä¾§æ’å…¥ä¸€æ¡ TargetSyncLogï¼Œç­‰å¾…åç»­è¡¥æ‰«ä»»åŠ¡é‡æ–°åŒæ­¥ï¼Œå®Œæˆä¿®å¤&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;ğŸ’¡ Qï¼šä¸ºä»€ä¹ˆæ—¥å¿—åŒæ­¥æ—¶æœªå¯¹æ•°æ®ä¸­å¿ƒè¿›è¡Œä¼˜å…ˆçº§åˆ’åˆ†ï¼Œç®€åŒ–åŒæ­¥æµç¨‹å‘¢ï¼Ÿ
Aï¼šå¦‚æœæ—¥å¿—åŒæ­¥ä¹ŸæŒ‰ç…§è¿™ç§æ–¹å¼å¤„ç†ï¼Œé‚£ä¹ˆä¼˜å…ˆçº§ä½çš„æ•°æ®ä¸­å¿ƒçš„å˜æ›´å°±ä¸ä¼šåŒæ­¥åˆ°å…¶ä»–æ•°æ®ä¸­å¿ƒï¼Œä¸èƒ½æ»¡è¶³å¤šæ•°æ®ä¸­å¿ƒä¸€è‡´æ€§çš„ç›®æ ‡ã€‚
      ä» Lion ç°çŠ¶æ¥çœ‹ï¼Œç»è¿‡å®æ—¶åŒæ­¥ï¼Œè¡¥æ‰«åŒæ­¥ä¹‹åï¼ŒåŒ—ä¸Šæ•°æ®ä¸€è‡´æ€§çš„æ¯”ä¾‹ &amp;gt; 99.99%ã€‚è€Œå¢é‡ä¸€è‡´æ€§æ£€æµ‹æ˜¯å¯¹å®æ—¶åŒæ­¥ï¼Œè¡¥æ‰«åŒæ­¥çš„å…œåº•å¤„ç†ï¼Œå¯¹ä¸€äº›æå°‘æ•°é…ç½®ä¸ä¸€è‡´çš„æƒ…å†µè¿›è¡Œæ£€æµ‹ä¿®å¤ã€‚&lt;/p&gt;

&lt;p&gt;Qï¼šä¸ºä»€ä¹ˆåªè€ƒè™‘å¢é‡ä¸€è‡´æ€§æ£€æµ‹ï¼Œä¸è€ƒè™‘å…¨é‡æ£€æµ‹ï¼Ÿ
Aï¼šå…¨é‡ä¸€è‡´æ€§æ£€æµ‹æˆæœ¬å¤ªé«˜ï¼Œä¸”ä» Lion ç°çŠ¶æ¥çœ‹ï¼Œå®æ—¶åŒæ­¥ &amp;amp; è¡¥æ‰«åŒæ­¥ &amp;amp; å¢é‡ä¸€è‡´æ€§æ£€æµ‹èƒ½å¤Ÿæ»¡è¶³ Lion å¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚ã€‚&lt;/p&gt;

&lt;h3 id=&quot;228-æ•°æ®åŒæ­¥å¯ç”¨æ€§ä¿éšœ&quot;&gt;2.2.8 æ•°æ®åŒæ­¥å¯ç”¨æ€§ä¿éšœ&lt;/h3&gt;

&lt;h3 id=&quot;2281-å†²çªè§£å†³&quot;&gt;2.2.8.1 å†²çªè§£å†³&lt;/h3&gt;

&lt;p&gt;æ¯æ¬¡é…ç½®å˜æ›´éƒ½ä¼šè®°å½•å˜æ›´æ—¶é—´æˆ³ï¼ˆtimestampï¼‰ï¼Œé»˜è®¤å†²çªè§£å†³ä¸ºæ¯”è¾ƒæ—¶é—´æˆ³è¿›è¡Œè¦†ç›–ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœæ—¶é—´æˆ³ç›¸åŒï¼Œåˆ™æ ¹æ® IDC ä¼˜å…ˆçº§è¿›è¡Œè¦†ç›–ï¼šBJ &amp;gt; HL &amp;gt; SH &amp;gt; HKã€‚&lt;/p&gt;

&lt;h3 id=&quot;2282-ä¸€è‡´æ€§ä¿è¯&quot;&gt;2.2.8.2 ä¸€è‡´æ€§ä¿è¯&lt;/h3&gt;

&lt;ol&gt;
  &lt;li&gt;åŒæ­¥æ—¥å¿—æŒä¹…åŒ–åˆ°æœ¬åœ° DBï¼ŒåŒæ­¥å¤±è´¥åä¼šè¿›è¡Œå¤šæ¬¡é‡è¯•ï¼ˆå®æ—¶åŒæ­¥ä¸è¡¥æ‰«åŒæ­¥å‡ä¼šé‡è¯•ï¼‰&lt;/li&gt;
  &lt;li&gt;æ¯æ‰¹æ¬¡ä»å…¶ä»–æ•°æ®ä¸­å¿ƒæˆåŠŸå¤åˆ¶æ—¥å¿—ä¹‹åï¼Œä¼šæŒä¹…åŒ–æœ€æ–°åˆ†åŒº Log åç§»é‡ã€‚å³ä½¿èŠ‚ç‚¹é‡å¯ï¼Œæˆ–è€…åˆ†åŒºè¿ç§»ï¼Œéƒ½èƒ½ä¿è¯ä»ä¸Šæ¬¡åŒæ­¥ä½ç½®é‡æ–°åŒæ­¥&lt;/li&gt;
  &lt;li&gt;æ ¹æ®åŒæ­¥æ—¥å¿—åŒæ­¥å˜æ›´çš„é…ç½®æµç¨‹æ˜¯å¹‚ç­‰çš„ï¼Œæ”¯æŒé‡å¤åŒæ­¥&lt;/li&gt;
  &lt;li&gt;å¢é‡ä¸€è‡´æ€§æ£€æµ‹ä»»åŠ¡è¿›è¡Œå…œåº•æ£€æµ‹&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;2283-æ•°æ®å›ç¯è§£å†³&quot;&gt;2.2.8.3 æ•°æ®å›ç¯è§£å†³&lt;/h3&gt;

&lt;p&gt;åŒæ­¥æ—¥å¿—åœ¨å¤åˆ¶ä¼ è¾“æ—¶ï¼Œåªä¼šä»ç›®æ ‡ IDC çš„ SourceSyncLog è¡¨ä¸­æŸ¥è¯¢ï¼Œå¹¶ä¿å­˜åœ¨æœ¬åœ°çš„ TargetSyncLog è¡¨ä¸­ï¼Œè€Œæ ¹æ® TargetSyncLog æ‰§è¡Œæ•°æ®åŒæ­¥çš„è¿‡ç¨‹ä¸ä¼šäº§ç”Ÿæ–°çš„ SourceSyncLogï¼Œé¿å…äº†æ•°æ®å›ç¯çš„æ¡ä»¶ã€‚å³ &lt;strong&gt;&lt;em&gt;å¼‚åœ°é…ç½®å˜æ›´ -&amp;gt; SourceSyncLog -&amp;gt; TargetSyncLog -&amp;gt; æœ¬åœ°é…ç½®&lt;/em&gt;&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;h1 id=&quot;23-ä¸Šçº¿æ–¹æ¡ˆ&quot;&gt;2.3 ä¸Šçº¿æ–¹æ¡ˆ&lt;/h1&gt;

&lt;h3 id=&quot;231-å‰æœŸå‡†å¤‡&quot;&gt;2.3.1 å‰æœŸå‡†å¤‡&lt;/h3&gt;

&lt;ol&gt;
  &lt;li&gt;BJï¼ŒSH ä¾§åˆ›å»ºåŒæ­¥å…ƒæ•°æ®è¡¨ï¼šIDC Router, Partitions, Offsetsï¼›åŒæ­¥æ—¥å¿—è¡¨ï¼šSourceSyncLog, TargetSyncLog&lt;/li&gt;
  &lt;li&gt;BJï¼ŒSH ä¾§é…ç½®åŒæ­¥ç›¸å…³å…ƒæ•°æ®&lt;/li&gt;
  &lt;li&gt;BJï¼ŒSH ä¾§æ·»åŠ åŒæ­¥å¼€å…³é…ç½®ï¼Œç”¨äºæ–°æ—§ç‰ˆæœ¬æ•°æ®åŒæ­¥æ–¹æ¡ˆåˆ‡æ¢ï¼ˆé»˜è®¤å…³é—­ï¼Œä½¿ç”¨æ—§æ–¹å¼è¿›è¡ŒåŒæ­¥ï¼‰&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;232-ä¸Šçº¿æ­¥éª¤&quot;&gt;2.3.2 ä¸Šçº¿æ­¥éª¤&lt;/h3&gt;

&lt;ol&gt;
  &lt;li&gt;BJï¼ŒSH æœåŠ¡å‘å¸ƒï¼šManager, Consistency, Metaï¼›æ­¤æ—¶é…ç½®å˜æ›´ä¼šæ’å…¥ Log è‡³ SourceSyncLogï¼Œä½†ä¸é€šè¿‡è¯¥æ—¥å¿—è¿›è¡ŒåŒæ­¥&lt;/li&gt;
  &lt;li&gt;å¼€å¯ SH ä¾§åŒæ­¥å¼€å…³ï¼šæ­¤æ—¶ BJ -&amp;gt; SH é‡‡å–æ–°æ–¹æ¡ˆåŒæ­¥ï¼ŒSH -&amp;gt; BJ ä»é‡‡ç”¨æ—§æ–¹æ¡ˆåŒæ­¥
    &lt;ol&gt;
      &lt;li&gt;&lt;em&gt;è®°å½•ä¸‹æ—¶é—´æˆ³ T1ï¼Œç”¨äºå¼‚å¸¸ä¿®å¤&lt;/em&gt;&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
  &lt;li&gt;è§‚å¯Ÿç›‘æ§ï¼š
    &lt;ol&gt;
      &lt;li&gt;åŒæ­¥æµç¨‹æ­£ç¡®æ€§ï¼ŒåŒæ­¥æ—¥å¿—å †ç§¯æƒ…å†µï¼ŒåŒæ­¥å»¶è¿Ÿï¼ŒåŒ—ä¸Šæ•°æ®ä¸€è‡´æ€§ï¼Œå¢é‡ä¸€è‡´æ€§æ£€æµ‹ä»»åŠ¡æ˜¯å¦æ­£å¸¸æ‰§è¡Œç­‰&lt;/li&gt;
      &lt;li&gt;é€šè¿‡å…¨é“¾è·¯ç›‘æ§æŸ¥çœ‹é…ç½®å˜æ›´æ¨é€æ˜¯å¦æ­£å¸¸&lt;/li&gt;
      &lt;li&gt;åŒæ—¶ï¼Œè§‚å¯Ÿ SH ä¾§ Offsets æ˜¯å¦æŒç»­å¢é•¿&lt;/li&gt;
      &lt;li&gt;æ‰‹åŠ¨è°ƒæ•´ SH ä¾§ Consistency èŠ‚ç‚¹çŠ¶æ€ï¼Œè§‚å¯Ÿ Partitions æ˜¯å¦æ­£å¸¸è°ƒæ•´ï¼ŒåŒæ­¥ä»»åŠ¡æ˜¯å¦æ­£å¸¸è¿ç§»ï¼ŒåŒæ­¥å»¶è¿Ÿ/å †ç§¯æ˜¯å¦ç¬¦åˆé¢„æœŸ&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
  &lt;li&gt;å¼€å¯ BJ ä¾§åŒæ­¥å¼€å…³ï¼šæ­¤æ—¶ BJ &amp;lt;-&amp;gt; SH åŒå‘åŒæ­¥å‡é‡‡ç”¨æ–°æ–¹æ¡ˆ
    &lt;ol&gt;
      &lt;li&gt;&lt;em&gt;è®°å½•ä¸‹å½“å‰æ—¶é—´æˆ³ T2ï¼Œç”¨äºå¼‚å¸¸ä¿®å¤&lt;/em&gt;&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
  &lt;li&gt;æŒç»­è§‚å¯Ÿ SHï¼ŒBJ ä¾§åŒæ­¥ç›‘æ§&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;233-å›æ»šæ­¥éª¤&quot;&gt;2.3.3 å›æ»šæ­¥éª¤&lt;/h3&gt;

&lt;ol&gt;
  &lt;li&gt;å…³é—­ SHï¼ŒBJ ä¾§åŒæ­¥å¼€å…³ï¼šåˆ‡å›æ—§åŒæ­¥æ–¹æ¡ˆ&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;è°ƒæ•´ SH ä¾§å¢é‡ä¸€è‡´æ€§æ£€æµ‹æ—¶é—´æˆ³ä¸º T1ï¼ŒBJ ä¾§æ—¶é—´æˆ³è°ƒæ•´ä¸º T2&lt;/p&gt;

    &lt;blockquote&gt;
      &lt;p&gt;prefix = lion.instance.last.check.timestamp&lt;/p&gt;

    &lt;/blockquote&gt;
  &lt;/li&gt;
  &lt;li&gt;æŒç»­è§‚å¯Ÿç›‘æ§ï¼šåŒ—ä¸Šæ•°æ®ä¸€è‡´æ€§ï¼Œå˜æ›´æ¨é€å»¶è¿Ÿç­‰&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;24-éåŠŸèƒ½æ€§è®¾è®¡&quot;&gt;2.4 éåŠŸèƒ½æ€§è®¾è®¡&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;åŒæ­¥ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€ç›‘æ§&lt;/li&gt;
  &lt;li&gt;åŒæ­¥åˆ†åŒºå˜æ›´å‘¨çŸ¥&lt;/li&gt;
  &lt;li&gt;æ•°æ®ä¸ä¸€è‡´å‘Šè­¦&lt;/li&gt;
  &lt;li&gt;åŒæ­¥å»¶è¿Ÿç›‘æ§ï¼Œå‘Šè­¦&lt;/li&gt;
  &lt;li&gt;åŒæ­¥å †ç§¯å‘Šè­¦&lt;/li&gt;
  &lt;li&gt;å¤šæ¬¡åŒæ­¥å¤±è´¥å‘Šè­¦&lt;/li&gt;
&lt;/ol&gt;

&lt;h1 id=&quot;3é¡¹ç›®é£é™©ç‚¹&quot;&gt;3ã€é¡¹ç›®é£é™©ç‚¹&lt;/h1&gt;

&lt;ol&gt;
  &lt;li&gt;åŒæ­¥ä»»åŠ¡çš„ç®¡ç†
    &lt;ol&gt;
      &lt;li&gt;èƒ½å¦å‡†ç¡®åˆ¤æ–­åŒæ­¥ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€&lt;/li&gt;
      &lt;li&gt;Manager èƒ½å¦å‡†ç¡®å®ŒæˆåŒæ­¥ä»»åŠ¡çš„è¿ç§»ï¼Œèƒ½å¦åŠæ—¶ Kill ä¸å¯ç”¨ä»»åŠ¡å¹¶æ–°å»ºä»»åŠ¡&lt;/li&gt;
      &lt;li&gt;åœ¨ Manager ç®¡ç†ä¸ç¬¦åˆé¢„æœŸçš„æƒ…å†µä¸‹ï¼Œéœ€è¦äººä¸ºä»‹å…¥ï¼Œæ‰‹åŠ¨æ‰§è¡Œä»»åŠ¡çš„åˆ é™¤ä¸åˆ›å»º&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
  &lt;li&gt;Offset ä¸ŠæŠ¥æ—¶æœº
    &lt;ol&gt;
      &lt;li&gt;æ¯å›æ”¾ä¸€æ¡ Log å°±ä¸ŠæŠ¥ Offset å¯ä»¥ä¿è¯å¯é æ€§ï¼Œä½†æ˜¯æ€§èƒ½ä¼šæœ‰æ‰€æŸè€—&lt;/li&gt;
      &lt;li&gt;æ˜¯å¦å¯ä»¥è°ƒæ•´ Offset ä¸ŠæŠ¥æ—¶æœºï¼Œå¦‚å‘¨æœŸä¸ŠæŠ¥ï¼Œè¿™æ ·å¯ä»¥æé«˜éƒ¨åˆ†æ€§èƒ½ï¼Œä½†æ˜¯åœ¨ä»»åŠ¡è¿ç§»æ—¶å¯èƒ½ä¼šæœ‰ Log é‡å¤åŒæ­¥ï¼Œéœ€è¦è¿›è¡Œæƒè¡¡&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
  &lt;li&gt;åŒæ­¥ä¸€è‡´æ€§ä¿è¯
    &lt;ol&gt;
      &lt;li&gt;åœ¨æ–°æ–¹æ¡ˆä¸Šçº¿æœŸé—´ï¼Œå¦‚æœæ•°æ®ä¸ä¸€è‡´æ¦‚ç‡è¾ƒé«˜ï¼Œéœ€è¦åŠæ—¶åˆ‡æ¢æ—§æ–¹æ¡ˆ&lt;/li&gt;
      &lt;li&gt;æ–°æ–¹æ¡ˆåœ¨åŒ—ä¸Šæ•°æ®ä¸­å¿ƒå¾—åˆ°éªŒè¯ï¼Œå¹¶ä¸”é•¿æ—¶é—´è¿è¡Œä¸€æ®µæ—¶é—´åï¼Œæ‰èƒ½æ¨å¹¿åˆ°å¤šæ•°æ®ä¸­å¿ƒ&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h1 id=&quot;4faq&quot;&gt;4ã€FAQ&lt;/h1&gt;

&lt;p&gt;Qï¼šWriter ä»»åŠ¡è°ƒåº¦ç®¡ç†æ¯”è¾ƒå¤æ‚ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ª Writer ä»»åŠ¡åŒæ­¥å…¨é‡æ•°æ®ï¼Œæ˜¯å¦å¯è¡Œï¼Ÿ&lt;/p&gt;

&lt;p&gt;Aï¼šå¦‚æœåªæœ‰ä¸€ä¸ª Writer ä»»åŠ¡è¿›è¡ŒåŒæ­¥ï¼Œé‚£ä¹ˆ Writer åŒæ­¥æ€§èƒ½éœ€è¦å°½å¯èƒ½é«˜ï¼Œæœ€ä½è¦æ”¯æŒ 2000QPSã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;æŒ‰ç…§å½“å‰çš„åŒæ­¥é€»è¾‘ï¼Œå•ä¸ªåŒæ­¥ä»»åŠ¡è‚¯å®šæ— æ³•æ”¯æ’‘ï¼šå•æ¡æ—¥å¿—é¡ºåºåŒæ­¥è€—æ—¶ TP999 48.4ms&lt;/li&gt;
  &lt;li&gt;ä¼˜åŒ–å•æ¡æ—¥å¿—é¡ºåºåŒæ­¥ -&amp;gt; æ‰¹é‡åŒæ­¥ï¼šç®€å•æµ‹è¯•äº†ä¸‹ï¼Œæ€§èƒ½å¤§æ¦‚æå‡ 20% å·¦å³ï¼Œä¸å¤ªèƒ½æ»¡è¶³è¦æ±‚ï¼ˆå¯èƒ½ä»å­˜åœ¨ä¼˜åŒ–ç©ºé—´ï¼›å•æ‰¹æ¬¡æ—¥å¿—æ•°é‡ä¸èƒ½è¿‡å¤šï¼Œå¯èƒ½ä¼šå¼•å‘å¤§äº‹åŠ¡ï¼‰&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æˆ‘ä»¬å°†åŒæ­¥ä»»åŠ¡è¿›è¡Œåˆ‡ç‰‡å¤„ç†ï¼Œ&lt;strong&gt;é™¤äº†æ€§èƒ½å› ç´ ï¼Œè¿˜æœ‰æœåŠ¡æ‰©å±•æ€§è€ƒè™‘&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;éšç€ä¸šåŠ¡é…ç½®å¢åŠ ï¼Œæ•°æ®ä¸­å¿ƒé€æ­¥å»ºè®¾ï¼ŒåŒæ­¥ä»»åŠ¡è¦æ”¯æŒæ°´å¹³æ‰©å±•ä»¥ä¿è¯ SLA&lt;/li&gt;
  &lt;li&gt;åŒæ­¥ä»»åŠ¡è°ƒåº¦ç®¡ç†è™½ç„¶æ¯”è¾ƒå¤æ‚ï¼Œä½†æ˜¯éƒ¨åˆ†é€»è¾‘ï¼ˆå¦‚åˆ†åŒºè¿ç§»ï¼‰å·²ç»ç»è¿‡çº¿ä¸ŠéªŒè¯ï¼Œå…¶ç¨³å®šæ€§åŠæ‰©å±•æ€§èƒ½å¤Ÿå¾—åˆ°ä¿éšœ&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å› æ­¤ï¼Œæˆ‘ä»¬ä»å€¾å‘ç»§ç»­é‡‡ç”¨ä»»åŠ¡åˆ‡ç‰‡çš„å½¢å¼ã€‚&lt;/p&gt;

&lt;p&gt;Qï¼šèƒ½å¦çµæ´»è°ƒæ•´æ•°æ®ä¸­å¿ƒåŒæ­¥æ–¹å‘ï¼Ÿå¦‚å°†é¦™æ¸¯ -&amp;gt; åŒ—äº¬çš„åŒæ­¥é“¾è·¯åˆ‡æ–­ï¼Œæˆ–è€…é¦™æ¸¯ä¾§æ•°æ®ä¸­å¿ƒä¸ä¸å…¶ä»–æ•°æ®ä¸­å¿ƒåŒæ­¥&lt;/p&gt;

&lt;p&gt;Aï¼šé€šè¿‡æ›´æ–° IDC Router é…ç½®å³å¯è°ƒæ•´æ•°æ®ä¸­å¿ƒé—´çš„åŒæ­¥æ–¹å‘ï¼ˆsource_idc -&amp;gt; target_idcï¼‰&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;æ›´æ–° IDC Router çš„ status å­—æ®µå¯ä»¥è°ƒæ•´åŒæ­¥æ–¹å‘å¼€å¯ä¸å¦&lt;/li&gt;
  &lt;li&gt;æ–°å¢ IDC Router è®°å½•å¯ä»¥æ–°å¢åŒæ­¥é“¾è·¯&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Qï¼šèƒ½å¦æ”¯æŒ Appkey ç²’åº¦åŒæ­¥æ–¹å‘æ§åˆ¶ï¼Ÿå¦‚ lion-demo é¡¹ç›®åªå¯ä»¥ä»åŒ—äº¬åŒæ­¥åˆ°ä¸Šæµ·&lt;/p&gt;

&lt;p&gt;Aï¼šå¯ä»¥æ”¯æŒã€‚ä¸è¿‡åªæŒ‰ç…§å‰é¢çš„æè¿°è¿˜ä¸èƒ½æ»¡è¶³ï¼Œéœ€è¦é¢å¤–çš„é…ç½®ï¼Œå¦‚æ¯ä¸ªæ•°æ®ä¸­å¿ƒæ–°å¢ä¸€ä¸ªè¡¨ IDCFilterï¼Œåœ¨è¯¥è¡¨ä¸­é…ç½®å“ªäº› IDC ä¸­çš„ Appkey, Key ä¸éœ€è¦è¿›è¡ŒåŒæ­¥ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨åŒæ­¥ä»»åŠ¡è¿›è¡Œæ—¥å¿—è¿‡æ»¤æ—¶ç›´æ¥å¿½ç•¥å¯¹åº”çš„ IDC, Appkey, Key å³å¯å®ç°ã€‚&lt;/p&gt;

&lt;p&gt;Qï¼šèƒ½å¤Ÿæ”¯æŒéƒ¨åˆ†ä¸šåŠ¡åŒæ­¥æµç¨‹éš”ç¦»ï¼Ÿå¦‚æ•°æ®åº“ç›¸å…³é…ç½®ä¸æ™®é€šä¸šåŠ¡é…ç½®åŒæ­¥éš”ç¦»&lt;/p&gt;

&lt;p&gt;Aï¼šå¯ä»¥æ”¯æŒï¼›å°†ç‰¹å®šèŒƒå›´çš„åˆ†åŒºï¼ˆå¦‚ 1000 ï½ 1024ï¼‰å•ç‹¬åˆ’åˆ†å‡ºæ¥ç»™æŒ‡å®šä¸šåŠ¡ä½¿ç”¨ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨åˆ†åŒºç´¢å¼•è®¡ç®—æ—¶è¿›è¡Œè®¾è®¡ï¼Œä¿è¯æŒ‡å®šçš„ Appkey åˆ—è¡¨åªä¼šè·¯ç”±åˆ°ç‰¹å®šçš„åˆ†åŒºï¼Œè€Œå…¶ä»–ä¸šåŠ¡ Appkey è·¯ç”±åˆ°å…¶ä»–åˆ†åŒºã€‚&lt;/p&gt;

&lt;p&gt;Qï¼šLion çŸ­æœŸå†…ä»ä¸èƒ½å®Œå…¨ä¸‹æ‰ Redisï¼Œå¯¹ Redis åŒæ­¥å¦‚ä½•å¤„ç†ï¼Ÿ&lt;/p&gt;

&lt;p&gt;Aï¼šåŒæ­¥ä»»åŠ¡åœ¨å›æ”¾æ—¥å¿—æ—¶ï¼Œå…ˆåŒæ­¥ DBï¼Œä¹‹åå†åŒæ­¥ Redisã€‚ç°æœ‰ç›‘æ§æ¥çœ‹ï¼ŒRedis æ•°æ®åŒæ­¥è€—æ—¶ TP999 71.3msï¼Œå¹³å‡ 4.2msï¼Œå¯¹åŒæ­¥å»¶è¿Ÿå½±å“æœ‰é™ï¼Œå¯ä»¥ç›´æ¥åŒæ­¥ã€‚&lt;/p&gt;

&lt;p&gt;ç­‰ Redis å®Œå…¨ä¸‹æ‰ä¹‹åï¼Œåœ¨é€šè¿‡å¼€å…³ç§»é™¤ Redis åŒæ­¥æµç¨‹ã€‚&lt;/p&gt;

&lt;p&gt;Qï¼šç›®å‰é’ˆå¯¹åŒ—ä¸Šä¸¤ä¸ªæ•°æ®ä¸­å¿ƒï¼ŒLion æ–‡ä»¶é…ç½®åœ¨æ›´æ–°æ—¶ä¼šå°†æ–‡ä»¶å†…å®¹åŒæ—¶æ›´æ–°åˆ°åŒ—ä¸Šä¸¤ä¸ª S3 é›†ç¾¤ï¼Œåœ¨åŒæ­¥æ—¶åªåŒæ­¥æ–‡ä»¶ SHA Keyã€‚å¦‚æœæ‰©å±•åˆ°å¤šä¸ªé›†ç¾¤ï¼Œé’ˆå¯¹æ–‡ä»¶é…ç½®å¦‚ä½•å¤„ç†ï¼Ÿ&lt;/p&gt;

&lt;p&gt;Aï¼šå¯¹äºæ–‡ä»¶é…ç½®ï¼Œåœ¨åŒæ­¥ SHA Key åï¼Œé€šè¿‡å•ç‹¬çš„çº¿ç¨‹ï¼Œä»æºæ•°æ®ä¸­å¿ƒ S3 é›†ç¾¤è¿›è¡Œæ–‡ä»¶åŠ è½½ï¼ŒåŒæ­¥åˆ°æœ¬åœ° S3 é›†ç¾¤ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœä»æºæ•°æ®ä¸­å¿ƒçš„ S3 é›†ç¾¤åŠ è½½å¤±è´¥ï¼Œåˆ™æŒ‰ç…§é¡ºåºï¼ˆBJ &amp;gt; HL &amp;gt; SH &amp;gt; HKï¼‰é™çº§è¿›è¡Œé‡æ–°æ‹‰å–ã€‚&lt;/p&gt;

&lt;h1 id=&quot;5å…¶ä»–è¡¥å……&quot;&gt;5ã€å…¶ä»–è¡¥å……&lt;/h1&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;https://km.sankuai.com/page/28131829#id-%E6%9E%B6%E6%9E%84%E4%BB%8B%E7%BB%8D&quot;&gt;https://km.sankuai.com/page/28131829#id-%E6%9E%B6%E6%9E%84%E4%BB%8B%E7%BB%8D&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://km.sankuai.com/page/600429548&quot;&gt;https://km.sankuai.com/page/600429548&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://dbaplus.cn/news-11-1399-1.html&quot;&gt;https://dbaplus.cn/news-11-1399-1.html&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://km.sankuai.com/collabpage/1407987923&quot;&gt;https://km.sankuai.com/collabpage/1407987923&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://km.sankuai.com/page/1476581664&quot;&gt;https://km.sankuai.com/page/1476581664&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://km.sankuai.com/page/617657890&quot;&gt;https://km.sankuai.com/page/617657890&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://km.sankuai.com/collabpage/1532367225&quot;&gt;https://km.sankuai.com/collabpage/1532367225&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content><author><name>kkzhang</name></author><category term="system-design" /><summary type="html">1ã€æ–‡æ¡£æ¦‚è¿°</summary></entry><entry><title type="html">Google Dapper</title><link href="http://localhost:4000/dapper.html" rel="alternate" type="text/html" title="Google Dapper" /><published>2023-01-17T00:00:00+08:00</published><updated>2023-01-17T00:00:00+08:00</updated><id>http://localhost:4000/dapper</id><content type="html" xml:base="http://localhost:4000/dapper.html">&lt;h1 id=&quot;1-abstract&quot;&gt;1-Abstract&lt;/h1&gt;

&lt;p&gt;ç°ä»£äº’è”ç½‘æœåŠ¡é€šå¸¸æ˜¯ç”¨&lt;strong&gt;å¤æ‚çš„ï¼Œå¤§è§„æ¨¡çš„åˆ†å¸ƒå¼é›†ç¾¤&lt;/strong&gt;æ¥å®ç°çš„ã€‚è¿™äº›æœåŠ¡é€šå¸¸ç”±ä¸åŒçš„è½¯ä»¶æ¨¡å—ç»„æˆï¼Œè€Œè¿™äº›æ¨¡å—å¯èƒ½ç”±ä¸åŒçš„å›¢é˜Ÿå¼€å‘ï¼Œä½¿ç”¨ä¸åŒçš„ç¼–ç¨‹è¯­è¨€ï¼Œä¹Ÿæœ‰å¯èƒ½åˆ†å¸ƒåœ¨æ•°åƒå°æœºå™¨ä¸Šï¼Œæ¨ªè·¨å¤šä¸ªæ•°æ®ä¸­å¿ƒã€‚å› æ­¤ï¼Œéœ€è¦ä¸€äº›å¯ä»¥å¸®åŠ©&lt;strong&gt;ç†è§£ç³»ç»Ÿè¡Œä¸ºï¼Œç”¨äºåˆ†ææ€§èƒ½é—®é¢˜&lt;/strong&gt;çš„å·¥å…·ã€‚&lt;/p&gt;

&lt;p&gt;Dapper æ˜¯ Google ç”Ÿäº§ç¯å¢ƒä¸‹åˆ†å¸ƒå¼è·Ÿè¸ªç³»ç»Ÿï¼Œæ»¡è¶³äº†&lt;strong&gt;ä½æ¶ˆè€—&lt;/strong&gt;ï¼ˆlow overheadï¼‰ï¼Œ&lt;strong&gt;åº”ç”¨å±‚é€æ˜&lt;/strong&gt;ï¼ˆapplication-level transparencyï¼‰ï¼Œ&lt;strong&gt;å¤§èŒƒå›´éƒ¨ç½²&lt;/strong&gt;ï¼ˆubiquitous deployment on a very large scale systemï¼‰ä¸‰ä¸ªéœ€æ±‚ã€‚&lt;/p&gt;

&lt;h1 id=&quot;2-introduction&quot;&gt;2-Introduction&lt;/h1&gt;

&lt;p&gt;æ„å»º Dapper çš„ç›®çš„æ˜¯ä¸ºäº†ç»™å¼€å‘è€…æä¾›æ›´å¤š&lt;em&gt;å…³äºå¤æ‚åˆ†å¸ƒå¼ç³»ç»Ÿçš„è¡Œä¸ºä¿¡æ¯&lt;/em&gt;ã€‚è¿™ç±»ç³»ç»Ÿç‰¹åˆ«å—å…³æ³¨ï¼Œå› ä¸ºé‚£äº›å¤§è§„æ¨¡çš„ä½ç«¯æœåŠ¡å™¨ï¼Œä½œä¸ºäº’è”ç½‘æœåŠ¡çš„è½½ä½“ï¼Œæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç»æµåˆ’ç®—çš„å¹³å°ã€‚ä¸ºäº†åœ¨ä¸Šä¸‹æ–‡ä¸­ç†è§£åˆ†å¸ƒå¼ç³»ç»Ÿçš„è¡Œä¸ºï¼Œå°±éœ€è¦ç›‘æ§é‚£äº›æ¨ªè·¨äº†ä¸åŒçš„åº”ç”¨ã€ä¸åŒæœåŠ¡å™¨ä¹‹é—´çš„æ“ä½œã€‚&lt;/p&gt;

&lt;p&gt;ç½‘ç»œæœç´¢çš„ä¾‹å­å°†ä¼šè¯´æ˜æ­¤ç±»ç›‘æ§ç³»ç»Ÿéœ€è¦è§£å†³çš„ä¸€äº›æŒ‘æˆ˜ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ä¸€ä¸ªå‰ç«¯æœåŠ¡å¯èƒ½ä¼šå°†ä¸€æ¬¡ç½‘ç»œæŸ¥è¯¢åˆ†å‘ç»™æ•°ç™¾ä¸ªæŸ¥è¯¢æœåŠ¡å™¨ï¼Œæ¯ä¸€ä¸ªæŸ¥è¯¢éƒ½æœ‰è‡ªå·±çš„ Indexã€‚æŸ¥è¯¢è¯·æ±‚ä¹Ÿå¯èƒ½è¢«å‘é€åˆ°å¤šä¸ªå­ç³»ç»Ÿä¸­ï¼Œè¿™äº›å­ç³»ç»Ÿä¹Ÿè®¸ç”¨æ¥å¤„ç†å¹¿å‘Šï¼Œæ‹¼å†™æ£€æŸ¥ï¼Œæˆ–è€…æŸ¥è¯¢å›¾ç‰‡ï¼Œè§†é¢‘ï¼Œæ–°é—»ç­‰ç‰¹æ®Šç»“æœã€‚å¯¹è¿™äº›æœåŠ¡çš„è¿”å›ç»“æœé€‰æ‹©æ€§åœ°ç»„åˆåˆ°ç»“æœé¡µé¢ï¼›è¿™ç§æœç´¢æ¨¡å‹è¢«ç§°ä¸º&lt;strong&gt;å…¨å±€æœç´¢&lt;/strong&gt;ï¼ˆuniversal searchï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ€»çš„æ¥è¯´ï¼Œä¸€æ¬¡å…¨å±€æœç´¢æŸ¥è¯¢å¯èƒ½éœ€è¦æ•°åƒå°æœºå™¨ï¼Œå¤šä¸ªä¸åŒçš„æœåŠ¡å‚ä¸å¤„ç†ã€‚åŒæ—¶ï¼Œç”¨æˆ·å¯¹æœç´¢å»¶è¿Ÿæ˜¯æ¯”è¾ƒæ•æ„Ÿçš„ï¼Œä»»ä½•å­ç³»ç»Ÿçš„ä½æ€§èƒ½éƒ½å¯èƒ½ä¼šå¯¼è‡´å»¶è¿Ÿå¢å¤§ã€‚&lt;/p&gt;

&lt;p&gt;åªçœ‹æ•´ä½“çš„å»¶è¿Ÿï¼Œå·¥ç¨‹å¸ˆå¯èƒ½ä¼šçŸ¥é“å…¨å±€æœç´¢æµç¨‹å­˜åœ¨é—®é¢˜ï¼Œä½†æ˜¯å¯èƒ½&lt;em&gt;æ— æ³•åˆ¤æ–­å“ªä¸ªæœåŠ¡å­˜åœ¨é—®é¢˜ï¼Œæˆ–è€…ä¸ºä»€ä¹ˆæ€§èƒ½è¾ƒå·®&lt;/em&gt;ã€‚åŸå› å¯èƒ½æœ‰ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;æ— æ³•å‡†ç¡®çŸ¥é“æ­¤æ¬¡å…¨å±€æœç´¢æ¶‰åŠå“ªäº›æœåŠ¡&lt;/li&gt;
  &lt;li&gt;å·¥ç¨‹å¸ˆå¯¹æ¶‰åŠçš„æœåŠ¡å¹¶ä¸æ€»æ˜¯å¾ˆäº†è§£&lt;/li&gt;
  &lt;li&gt;æ¶‰åŠçš„æœåŠ¡æˆ–è€…æœºå™¨å¯èƒ½åŒæ—¶è¢«å…¶ä»–å®¢æˆ·ç«¯è®¿é—®ï¼Œæ‰€ä»¥æ€§èƒ½é—®é¢˜å¯èƒ½æ˜¯ç”±äºå…¶ä»–åº”ç”¨çš„å½±å“&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¸Šè¿°æè¿°çš„æ¡ˆä¾‹ç»™å‡ºäº† Dapper çš„ä¸¤ä¸ªåŸºæœ¬è¦æ±‚ï¼š&lt;strong&gt;1. æ— å¤„ä¸åœ¨çš„éƒ¨ç½²ï¼›2. æŒç»­çš„ç›‘æ§&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;æ— å¤„ä¸åœ¨çš„ç‰¹æ€§æ˜¯å¾ˆé‡è¦çš„ï¼Œå› ä¸ºå¦‚æœæŸä¸ªç³»ç»Ÿçš„å¾ˆå°ä¸€éƒ¨åˆ†æ²¡æœ‰è¢«ç›‘æ§åˆ°ï¼Œé‚£ä¹ˆè¿½è¸ªç³»ç»Ÿçš„å¯ç”¨æ€§å°±ä¼šè¢«ä¸¥é‡å½±å“&lt;/li&gt;
  &lt;li&gt;å¦å¤–ï¼Œç›‘æ§éœ€è¦ä¸€ç›´å¼€å¯ï¼Œå› ä¸ºç»å¸¸ä¼šé‡åˆ°å¾ˆéš¾æˆ–ä¸å¯èƒ½é‡ç°å¼‚å¸¸æˆ–å€¼å¾—æ³¨æ„çš„ç³»ç»Ÿè¡Œä¸º&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è¿™äº›è¦æ±‚äº§ç”Ÿäº†ä¸‰ä¸ªå…·ä½“çš„è®¾è®¡ç›®æ ‡ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;ä½æ¶ˆè€—&lt;/strong&gt;ï¼ˆlow overheadï¼‰ï¼šè¿½è¸ªç³»ç»Ÿåº”è¯¥å¯¹æ­£åœ¨è¿è¡Œçš„æœåŠ¡äº§ç”Ÿå¯ä»¥å¿½ç•¥ä¸è®¡çš„æ€§èƒ½å½±å“ã€‚å¯¹äºæŸäº›é«˜åº¦ä¼˜åŒ–åçš„æœåŠ¡æ¥è¯´ï¼Œå³ä½¿å¾ˆå°çš„ç›‘æ§è´Ÿè½½ä¹Ÿèƒ½è¢«å¯Ÿè§‰åˆ°ï¼Œæœ‰å¯èƒ½ä¼šè¿«ä½¿ä¸šåŠ¡å›¢é˜Ÿå°†ç›‘æ§ç³»ç»Ÿå…³é—­ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;åº”ç”¨å±‚é€æ˜&lt;/strong&gt;ï¼ˆapplication-level transparencyï¼‰ï¼šå¼€å‘äººå‘˜ä¸éœ€è¦æ„ŸçŸ¥åˆ°è¿½è¸ªç³»ç»Ÿçš„å­˜åœ¨ï¼›ä¸€ä¸ªä¾èµ–åº”ç”¨å±‚å¼€å‘äººå‘˜ç§¯æåˆä½œæ‰èƒ½æœ‰åºè¿è¡Œçš„è¿½è¸ªç³»ç»Ÿä¼šå˜å¾—å¾ˆè„†å¼±ï¼ˆä¸å¯é ï¼‰ï¼Œå¯èƒ½ä¼šç”±äºæœºå™¨çš„é—®é¢˜æˆ–è€…ä»£ç çš„ç–å¿½å¯¼è‡´æ•´ä¸ªç³»ç»Ÿä¸­æ–­ï¼Œä»è€Œè¿åæ™®éå­˜åœ¨çš„è¦æ±‚ã€‚åœ¨åƒæˆ‘ä»¬è¿™æ ·çš„å¿«èŠ‚å¥å¼€å‘ç¯å¢ƒä¸­ï¼Œè¿™ä¸€ç‚¹å°¤å…¶é‡è¦ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;å¯æ‰©å±•æ€§&lt;/strong&gt;ï¼ˆscalabilityï¼‰ï¼šè¯¥ç³»ç»Ÿå¿…é¡»èƒ½å¤Ÿå¤„ç† Google æ¥ä¸‹æ¥å‡ å¹´çš„æœåŠ¡å’Œé›†ç¾¤çš„è§„æ¨¡ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;ä¸€ä¸ªé¢å¤–çš„è®¾è®¡ç›®æ ‡æ˜¯ï¼Œ&lt;strong&gt;å¯¹äºç”¨äºåˆ†æçš„æ•°æ®ï¼Œåœ¨å…¶ç”Ÿæˆä¹‹åéœ€è¦å°½å¯èƒ½å¿«åœ°å¯ä»¥å¾—åˆ°&lt;/strong&gt;ï¼Œç†æƒ³çš„æ—¶é—´æ˜¯ä¸€åˆ†é’Ÿå†…ã€‚&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;å°½ç®¡åŸºäºæ•°å°æ—¶æ•°æ®çš„è¿½è¸ªåˆ†æç³»ç»Ÿä¹Ÿæ˜¯æœ‰ä¸€å®šçš„ä»·å€¼ï¼Œä½†æ˜¯æœ€æ–°æ•°æ®çš„å¯ç”¨æ€§èƒ½å¤Ÿä½¿å¾—å¯¹äº§ç”Ÿçš„å¼‚å¸¸æœ‰æ›´å¿«çš„ååº”ã€‚&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;çœŸæ­£çš„åº”ç”¨çº§é€æ˜è®¾è®¡ç›®æ ‡ä¹Ÿè®¸æ˜¯æœ€å¤§çš„æŒ‘æˆ˜ï¼šé€šè¿‡æŠŠ&lt;em&gt;æ ¸å¿ƒè·Ÿè¸ªä»£ç åšçš„å¾ˆè½»å·§ï¼Œç„¶åæŠŠå®ƒæ¤å…¥åˆ°é‚£äº›æ— æ‰€ä¸åœ¨çš„å…¬å…±ç»„ä»¶ä¸­&lt;/em&gt;ï¼Œæ¯”å¦‚çº¿ç¨‹è°ƒç”¨ã€æ§åˆ¶æµä»¥åŠ RPC åº“æ¥å®ç°è¯¥ç›®æ ‡ã€‚é€šè¿‡ä½¿ç”¨&lt;strong&gt;&lt;em&gt;è‡ªé€‚åº”é‡‡æ ·&lt;/em&gt;&lt;/strong&gt;æ¥ä½¿ç³»ç»Ÿæ›´å…·å¯æ‰©å±•æ€§ï¼ŒåŒæ—¶é™ä½æ€§èƒ½å¼€é”€ã€‚ç»“æœå±•ç¤ºçš„ç›¸å…³ç³»ç»Ÿä¹ŸåŒ…å«ä¸€äº›ç”¨æ¥æ”¶é›†è·Ÿè¸ªæ•°æ®çš„ä»£ç ï¼Œç”¨æ¥å›¾å½¢åŒ–çš„å·¥å…·ï¼Œä»¥åŠç”¨æ¥åˆ†æå¤§è§„æ¨¡è·Ÿè¸ªæ•°æ®çš„åº“å’Œ APIã€‚&lt;/p&gt;

&lt;h1 id=&quot;3-distributed-tracing-in-dapper&quot;&gt;3-Distributed Tracing in Dapper&lt;/h1&gt;

&lt;p&gt;åˆ†å¸ƒå¼æœåŠ¡çš„è¿½è¸ªç³»ç»Ÿéœ€è¦è®°å½•ä¸€æ¬¡ç‰¹å®šè¯·æ±‚åç³»ç»Ÿä¸­æ‰€æœ‰å®Œæˆçš„å·¥ä½œä¿¡æ¯ã€‚&lt;/p&gt;

&lt;p&gt;ä¸‹å›¾ç»™å‡ºäº†ä¸€ä¸ªç¤ºä¾‹ï¼Œä¸€ä¸ªä¸äº”å°æœåŠ¡å™¨ç›¸å…³çš„æœåŠ¡ï¼ŒåŒ…æ‹¬ä¸€ä¸ªå‰ç«¯ï¼ˆAï¼‰ï¼Œä¸¤ä¸ªä¸­é—´å±‚ï¼ˆBï¼ŒCï¼‰ï¼Œä¸¤ä¸ªåç«¯ï¼ˆDï¼ŒEï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/dapper/dapper_1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å½“ä¸€ä¸ªç”¨æˆ·è¯·æ±‚åˆ°è¾¾å‰ç«¯æ—¶ï¼Œå‘é€ä¸¤ä¸ª RPC è¯·æ±‚åˆ° Bï¼ŒCã€‚B å¯ä»¥ç«‹å³å“åº”ï¼Œä½†æ˜¯ C éœ€è¦ä¸åç«¯çš„ Dï¼ŒE äº¤äº’ä¹‹åå†å“åº” Aï¼Œæœ€åç”± A æ¥ç›¸åº”æœ€åˆçš„è¯·æ±‚ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å¯¹è¿™æ ·çš„è¯·æ±‚ï¼Œä¸€ä¸ªç®€å•å®ç”¨çš„åˆ†å¸ƒå¼è¿½è¸ªç³»ç»Ÿçš„å®ç°ï¼Œå°±æ˜¯ä¸ºæœåŠ¡å™¨ä¸Š&lt;em&gt;æ¯ä¸€æ¬¡å‘é€å’Œæ¥æ”¶åŠ¨ä½œ&lt;/em&gt;æ”¶é›†&lt;strong&gt;ä¿¡æ¯æ ‡è¯†ç¬¦&lt;/strong&gt;ï¼ˆmessage identifierï¼‰å’Œ&lt;strong&gt;äº‹ä»¶æ—¶é—´æˆ³&lt;/strong&gt;ï¼ˆtimestamped eventï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;ä¸ºäº†&lt;em&gt;å°†æ‰€æœ‰è®°å½•æ¡ç›®ä¸ç‰¹å®šçš„è¯·æ±‚å‘èµ·è€…å…³è”èµ·æ¥å¹¶è®°å½•æ‰€æœ‰ä¿¡æ¯&lt;/em&gt;ï¼Œæœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;é»‘ç›’&lt;/strong&gt;ï¼ˆblack-boxï¼‰æ¨¡å‹
    &lt;ul&gt;
      &lt;li&gt;å‡è®¾é™¤äº†ä¸Šè¿°æ¶ˆæ¯è®°å½•å¤–æ²¡æœ‰å…¶ä»–é¢å¤–ä¿¡æ¯ï¼Œä½¿ç”¨ç»Ÿè®¡å›å½’æŠ€æœ¯æ¨æ–­ä¸¤è€…ä¹‹é—´çš„å…³ç³»&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;&lt;em&gt;ç¼ºç‚¹&lt;/em&gt;&lt;/strong&gt;ï¼šç”±äºä¾èµ–ç»Ÿè®¡æ¨æ–­ï¼Œä¸ºäº†è·å¾—æ›´é«˜çš„å‡†ç¡®æ€§ï¼Œå°±éœ€è¦æ›´å¤šçš„æ•°æ®&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;&lt;em&gt;ä¼˜ç‚¹&lt;/em&gt;&lt;/strong&gt;ï¼šæ¯”åŸºäºæ ‡æ³¨çš„æ¨¡å‹æ›´åŠ è½»ä¾¿&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;åŸºäºæ ‡æ³¨&lt;/strong&gt;ï¼ˆannotation-basedï¼‰çš„æ¨¡å‹
    &lt;ul&gt;
      &lt;li&gt;ä¾èµ–åº”ç”¨æˆ–è€…ä¸­é—´ä»¶æ˜ç¡®æ ‡è®°ä¸€ä¸ªå…¨å±€ IDï¼Œä»è€Œå°†æ¯æ¡æ¶ˆæ¯è®°å½•ä¸åŸå§‹è¯·æ±‚è¿æ¥èµ·æ¥&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;&lt;em&gt;ç¼ºç‚¹&lt;/em&gt;&lt;/strong&gt;ï¼šéœ€è¦ä»£ç æ¤å…¥&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;åœ¨ Google çš„å¼€å‘ç¯å¢ƒä¸­ï¼Œæ‰€æœ‰çš„åº”ç”¨ç¨‹åºéƒ½æ˜¯ç”¨åŒä¸€ç§çº¿ç¨‹æ¨¡å‹ï¼Œæ§åˆ¶æµä¸ RPC ç³»ç»Ÿï¼Œå› æ­¤å¯ä»¥&lt;strong&gt;&lt;em&gt;æŠŠä»£ç æ¤å…¥é™åˆ¶åœ¨ä¸€ä¸ªå¾ˆå°çš„é€šç”¨ç»„ä»¶åº“ä¸­ï¼Œå®ç°ä¸€å¥—å¯¹å¼€å‘äººå‘˜æœ‰æ•ˆé€æ˜çš„ç›‘æ§ç³»ç»Ÿ&lt;/em&gt;&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬å€¾å‘äºå°† Dapper è¿½è¸ªç³»ç»Ÿçœ‹ä½œç±»ä¼¼åµŒå¥—åœ¨ RPC è°ƒç”¨çš„æ ‘å½¢ç»“æ„ã€‚ ç„¶è€Œï¼Œæˆ‘ä»¬çš„æ ¸å¿ƒæ•°æ®æ¨¡å‹å¹¶ä¸å±€é™äºç‰¹å®šçš„ RPC æ¡†æ¶ï¼Œè¿˜éœ€è¦è¿½è¸ªå…¶ä»–æ´»åŠ¨ï¼Œå¦‚ Gmail ä¸­çš„ SMTP ä¼šè¯ã€æ¥è‡ªå¤–éƒ¨çš„ HTTP è¯·æ±‚ä»¥åŠ SQL æŸ¥è¯¢ã€‚ &lt;strong&gt;å½¢å¼ä¸Šï¼Œæˆ‘ä»¬ä½¿ç”¨ Trees, Spans &amp;amp; Annotations å¯¹ Dapper è¿½è¸ªç³»ç»Ÿè¿›è¡Œå»ºæ¨¡&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;h2 id=&quot;3-1-trace-trees-and-spans&quot;&gt;3-1 Trace trees and spans&lt;/h2&gt;

&lt;p&gt;åœ¨ Dapper è¿½è¸ªæ ‘ä¸­ï¼Œæ ‘èŠ‚ç‚¹æ˜¯ Span çš„åŸºæœ¬å·¥ä½œå•å…ƒã€‚&lt;strong&gt;èŠ‚ç‚¹ä¹‹é—´çš„è¿çº¿è¡¨ç¤ºä¸€ä¸ª Span ä¸å…¶çˆ¶ Span ä¹‹é—´çš„å› æœå…³ç³»&lt;/strong&gt;ã€‚ä¸è¿‡ï¼ŒSpan åœ¨æ›´å¤§çš„æ ‘å½¢ç»“æ„ä¸­æ˜¯ç›¸å¯¹ç‹¬ç«‹çš„ï¼Œ&lt;strong&gt;ä¸€ä¸ª Span å°±æ˜¯ç®€å•çš„æ—¶é—´æˆ³æ—¥å¿—ï¼Œè®°å½•äº† Span çš„å¼€å§‹æ—¶é—´ä¸ç»“æŸæ—¶é—´&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ä¸‹å›¾è¯´æ˜äº†å¤šä¸ª Span å¦‚ä½•ç»„æˆæ›´å¤§çš„è¿½è¸ªæ ‘ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/dapper/dapper_2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Dapper è®°å½•äº†æ¯ä¸ª Span çš„ &lt;em&gt;Nameï¼ŒIDï¼ŒParent ID&lt;/em&gt;ï¼Œä»¥ä¾¿åœ¨å•ä¸ªåˆ†å¸ƒå¼è¿½è¸ªé“¾è·¯ä¸­é‡å»ºå„ä¸ª Span çš„å› æœå…³ç³»ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;em&gt;æ²¡æœ‰ Parent ID çš„ Span è¢«ç§°ä¸º Root Span&lt;/em&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;ä¸€ä¸ªè¿½è¸ªé“¾è·¯ä¸Šçš„æ‰€æœ‰ Span å…±äº«ä¸€ä¸ªå…¬å…± Trace ID&lt;/strong&gt;ï¼ˆå…¨å±€å”¯ä¸€çš„ 64 ä½æ•´æ•°ï¼›å›¾ä¸­å¹¶æœªå±•ç¤ºï¼‰&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;åœ¨ä¸€ä¸ªå…¸å‹çš„ Dapper è¿½è¸ªé“¾è·¯ä¸­ï¼ŒæœŸæœ›å°†æ¯ä¸€ä¸ª RPC è°ƒç”¨å¯¹åº”ä¸€ä¸ªå•ä¸€çš„ Spanï¼Œæ¯ä¸€ä¸ªé¢å¤–çš„ç»„ä»¶å±‚éƒ½å¯¹åº”ä¸€ä¸ªé¢å¤–çš„æ ‘å½¢ç»“æ„çš„å±‚çº§ã€‚&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;è¡¥å……ï¼Œå³æ¯ä¸ª Span çœ‹ä½œä¸€æ¬¡ RPC è°ƒç”¨ï¼›æ¯ä¸€å±‚çœ‹ä½œä¸€ä¸ªé¢å¤–çš„ç»„ä»¶&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;ä¸‹å›¾ç»™å‡ºäº†å…¸å‹ Dapper Trace Span ä¸­è®°å½•äº‹ä»¶ï¼ˆlog eventï¼‰æ›´è¯¦ç»†çš„è§†å›¾ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/dapper/dapper_3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;è¯¥å›¾æè¿°äº†å›¾ 2 ä¸­ä¸¤ä¸ª RPCï¼ˆHelper.Callï¼‰è°ƒç”¨ä¸­è·¨åº¦è¾ƒé•¿ Span&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;Span çš„å¼€å§‹æ—¶é—´ï¼ˆstart timeï¼‰ï¼Œç»“æŸæ—¶é—´ï¼ˆend timeï¼‰ä»¥åŠä»»ä½• RPC è°ƒç”¨ä¸­çš„è®¡æ—¶ä¿¡æ¯ï¼ˆtiming informationï¼‰éƒ½æ˜¯ç”± Dapper çš„ RPC ç»„ä»¶åº“è®°å½•çš„ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœåº”ç”¨ç¨‹åºå¼€å‘è€…æƒ³è¦åœ¨ Trace ä¸­æ·»åŠ è‡ªå®šä¹‰çš„æ³¨é‡Šï¼ˆannotation, å¦‚å›¾ä¸­çš„ â€œfooâ€ï¼‰ä»¥è®°å½•ä¸šåŠ¡ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ä¹Ÿä¼šå’Œå…¶ä»– Span æ•°æ®ä¸€æ ·è¢«è®°å½•ä¸‹æ¥ã€‚&lt;/p&gt;

&lt;p&gt;å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ&lt;strong&gt;&lt;em&gt;ä¸€ä¸ª Span å¯ä»¥åŒ…å«æ¥è‡ªå¤šä¸ªä¸»æœºï¼ˆhostï¼‰çš„ä¿¡æ¯&lt;/em&gt;&lt;/strong&gt;ã€‚äº‹å®ä¸Šï¼Œæ¯ä¸ª RPC Span éƒ½åŒ…å«æ¥è‡ªå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯è¿›ç¨‹çš„ä¿¡æ¯ï¼Œè¿™ä½¿å¾—é“¾æ¥ä¸¤ä¸ªä¸»æœºï¼ˆtwo-hostï¼‰çš„ Span æˆä¸ºæœ€å¸¸è§çš„ç±»å‹ã€‚&lt;/p&gt;

&lt;p&gt;ç”±äºå®¢æˆ·ç«¯è¿›ç¨‹ä¸æœåŠ¡ç«¯è¿›ç¨‹çš„æ—¶é—´æˆ³ï¼ˆtimestampï¼‰æ¥è‡ªä¸åŒçš„ä¸»æœºï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»è¦æ³¨æ„&lt;strong&gt;æ—¶é’Ÿæ¼‚ç§»&lt;/strong&gt;ï¼ˆclock skewï¼‰ã€‚åœ¨æˆ‘ä»¬çš„åˆ†æå·¥å…·ä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨äº†è¿™æ ·ä¸€ä¸ªäº‹å®ï¼Œå³ &lt;em&gt;RPC å®¢æˆ·ç«¯æ€»æ˜¯åœ¨æœåŠ¡ç«¯æ¥æ”¶è¯·æ±‚ä¹‹å‰å‘é€è¯·æ±‚&lt;/em&gt;ï¼Œåè¿‡æ¥å¯¹æœåŠ¡ç«¯å“åº”æµç¨‹ä¹Ÿæ˜¯ä¸€æ ·ã€‚ è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡º &lt;strong&gt;RPC æœåŠ¡å™¨ç«¯ Span æ—¶é—´æˆ³çš„ä¸‹é™å’Œä¸Šé™&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;h2 id=&quot;3-2-instrumentation-points&quot;&gt;3-2 &lt;strong&gt;Instrumentation points&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;Dapper å¯ä»¥é€šè¿‡&lt;strong&gt;å‡ ä¹é›¶ä¾µå…¥æˆæœ¬&lt;/strong&gt;æ¥å®ç°å¯¹åˆ†å¸ƒå¼è·¯å¾„çš„è¿½è¸ªï¼ˆåŸºæœ¬å®Œå…¨ä¾èµ–äºå°‘é‡ç»„ä»¶åº“çš„æ”¹é€ ï¼‰å¸¸è§çš„æ¤å…¥ç‚¹æœ‰ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å½“ä¸€ä¸ªçº¿ç¨‹å¤„ç†ä¸€ä¸ªè¢«è¿½è¸ªçš„è·¯å¾„æ—¶ï¼ŒDapper ä¼šå°†&lt;em&gt;è¿½è¸ªä¸Šä¸‹æ–‡&lt;/em&gt;ï¼ˆcontextï¼‰é™„åŠ åˆ°çº¿ç¨‹æœ¬åœ°ï¼ˆthread localï¼‰å­˜å‚¨ã€‚è¿½è¸ªä¸Šä¸‹æ–‡æ˜¯ä¸€ä¸ªè½»é‡ä¸”æ˜“äºå¤åˆ¶çš„ Span å±æ€§å®¹å™¨ï¼Œè¿™äº›å±æ€§åŒ…æ‹¬ Span ID, Trace ID&lt;/li&gt;
  &lt;li&gt;å½“è®¡ç®—è¿‡ç¨‹æ˜¯å»¶è¿Ÿè°ƒç”¨æˆ–æ˜¯å¼‚æ­¥çš„ï¼Œå¤§å¤šæ•° Google å¼€å‘è€…é€šè¿‡çº¿ç¨‹æ± æˆ–å…¶ä»–æ‰§è¡Œå™¨ï¼Œä½¿ç”¨ä¸€ä¸ªé€šç”¨çš„æ§åˆ¶æµåº“æ¥å›è°ƒã€‚Dapper ç¡®ä¿æ‰€æœ‰è¿™æ ·çš„å›è°ƒå¯ä»¥å­˜å‚¨è¿™æ¬¡è·Ÿè¸ªçš„ä¸Šä¸‹æ–‡ï¼Œè€Œå½“å›è°ƒå‡½æ•°è¢«è§¦å‘æ—¶ï¼Œè¿™æ¬¡è·Ÿè¸ªçš„ä¸Šä¸‹æ–‡ä¼šä¸é€‚å½“çš„çº¿ç¨‹å…³è”ä¸Šã€‚åœ¨è¿™ç§æ–¹å¼ä¸‹ï¼ŒDapper å¯ä»¥ä½¿ç”¨ Trace ID å’Œ Span ID æ¥è¾…åŠ©æ„å»ºå¼‚æ­¥è°ƒç”¨çš„è·¯å¾„&lt;/li&gt;
  &lt;li&gt;å‡ ä¹æ‰€æœ‰çš„ Google è¿›ç¨‹é—´é€šä¿¡éƒ½æ˜¯å»ºç«‹åœ¨ä¸€ä¸ª RPC è°ƒç”¨æ¡†æ¶ä¸Šï¼Œæ”¯æŒ C++ ä¸ Javaã€‚æˆ‘ä»¬å·²ç»ä½¿ç”¨è¯¥æ¡†æ¶æ¥å®šä¹‰æ‰€æœ‰ RPC Spanã€‚å¯¹äºè¢«è¿½è¸ªçš„ RPCï¼ŒSpan ID ä¸ Trace ID ä¼šä»å®¢æˆ·ç«¯å‘é€åˆ°æœåŠ¡ç«¯ã€‚åƒè¿™æ ·åœ¨ Google å†…éƒ¨è¢«å¹¿æ³›ä½¿ç”¨çš„ï¼Œä»¥ RPC é€šä¿¡ä¸ºåŸºç¡€çš„ç³»ç»Ÿï¼Œè¿™æ˜¯ä¸€ä¸ªé‡è¦çš„æ¤å…¥ç‚¹ã€‚æˆ‘ä»¬è®¡åˆ’åœ¨é RPC é€šä¿¡æ¡†æ¶ä¸­æ‰¾åˆ°ç”¨æˆ·ç¾¤å¹¶å¯¹å…¶è¿›è¡Œæ¤å…¥&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Dapper çš„è¿½è¸ªæ•°æ®æ˜¯&lt;strong&gt;è¯­è¨€æ— å…³çš„&lt;/strong&gt;ï¼ˆlanguage-independentï¼‰ï¼Œè®¸å¤šè¿½è¸ªæ•°æ®åŒæ—¶åŒ…å«äº†æ¥è‡ª C++ ä¸ Java ç¼–å†™çš„è¿›ç¨‹ã€‚&lt;/p&gt;

&lt;h2 id=&quot;3-3--annotations&quot;&gt;3-3  &lt;strong&gt;Annotations&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;ä¸Šè¿°æ¤å…¥ç‚¹è¶³ä»¥æ¨å¯¼å‡ºå¤æ‚åˆ†å¸ƒå¼ç³»ç»Ÿçš„è¿½è¸ªç»†èŠ‚ï¼Œä½¿å¾— Dapper æ ¸å¿ƒåŠŸèƒ½å¯ä»¥åº”ç”¨äºæœªç»æ”¹é€ çš„ Google åº”ç”¨ã€‚ç„¶è€Œï¼Œ&lt;strong&gt;Dapper è¿˜å…è®¸ç”¨æˆ·æ·»åŠ é¢å¤–çš„ä¿¡æ¯æ¥ä¸°å¯Œ Dapper è¿½è¸ªæ•°æ®&lt;/strong&gt;ï¼Œè¿™äº›è¢«æ·»åŠ çš„ä¿¡æ¯å¯ä»¥ç”¨æ¥ç›‘æ§æ›´é«˜çº§åˆ«çš„ç³»ç»Ÿè¡Œä¸ºæˆ–è€…ç”¨äºé—®é¢˜è°ƒè¯•ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬å…è®¸ç”¨æˆ·é€šè¿‡ç®€å•çš„ API å®šä¹‰&lt;strong&gt;å¸¦æ—¶é—´æˆ³çš„ Annotation&lt;/strong&gt;ï¼ˆtimestamped annotationsï¼‰ï¼Œæ ¸å¿ƒç”¨æ³•å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/dapper/dapper_4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Annotation ä¸­å¯ä»¥åŒ…å«ä»»æ„å†…å®¹&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;ä¸ºäº†é¿å…ç”¨æˆ·è¿‡åº¦æ·»åŠ  Annotation è®°å½•ï¼Œ&lt;em&gt;æ¯ä¸ª Dapper Span éƒ½æœ‰ä¸€ä¸ªå¯é…ç½®çš„ Annotation æ€»é‡ä¸Šé™&lt;/em&gt;ã€‚&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;éœ€è¦æ³¨æ„ï¼Œä¸ç®¡åº”ç”¨ç¨‹åºè¡Œä¸ºå¦‚ä½•ï¼Œåº”ç”¨å±‚é¢çš„ Annotation éƒ½ä¸èƒ½ä»£æ›¿ç”¨äºè¡¨ç¤º Span ç»“æ„çš„ä¿¡æ¯æˆ–è€… RPC ä¿¡æ¯&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;é™¤äº†ç®€å•çš„æ–‡æœ¬ Annotationï¼ŒDapper è¿˜æ”¯æŒ &lt;strong&gt;Key-Value å‹ Annotation&lt;/strong&gt;ï¼Œå¯ä»¥ä¸ºç”¨æˆ·æä¾›æ›´å¤šçš„è¿½è¸ªèƒ½åŠ›ï¼Œå¦‚ç»´æŠ¤è®¡æ•°å™¨ï¼Œè®°å½•äºŒè¿›åˆ¶ä¿¡æ¯ï¼Œåœ¨è¿›ç¨‹å†…ä¼ è¾“ä»»æ„ç”¨æˆ·å®šä¹‰æ•°æ®ä»¥åŠè·Ÿè¸ªè¯·æ±‚ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Key-Value å‹ Annotation ç”¨æ¥åœ¨åˆ†å¸ƒå¼è¿½è¸ªçš„ä¸Šä¸‹æ–‡ä¸­&lt;strong&gt;&lt;em&gt;å®šä¹‰æŸä¸ªç‰¹å®šåº”ç”¨ç¨‹åºçš„ç›¸å…³ç±»å‹&lt;/em&gt;&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;3-4-sampling&quot;&gt;3-4 &lt;strong&gt;Sampling&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;ä½è´Ÿè½½ï¼ˆlow overheadï¼‰æ˜¯ Dapper çš„ä¸€ä¸ªå…³é”®è®¾è®¡ç›®æ ‡ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å¦‚æœå¯¹æœåŠ¡æ€§èƒ½æœ‰é‡å¤§å½±å“ï¼Œé‚£ä¹ˆç”¨æˆ·æ˜¯ä¸æ„¿æ„éƒ¨ç½²ä½¿ç”¨çš„ã€‚&lt;/li&gt;
  &lt;li&gt;æˆ‘ä»¬å¸Œæœ›å…è®¸ç”¨æˆ·ä½¿ç”¨ Annotation API è€Œä¸ç”¨æ‹…å¿ƒé¢å¤–çš„æ€§èƒ½å¼€é”€ã€‚&lt;/li&gt;
  &lt;li&gt;æˆ‘ä»¬ä¹Ÿå‘ç°æœ‰äº› Web æœåŠ¡ç¡®å®å¯¹æ¤å…¥å¸¦æ¥çš„æ€§èƒ½å¼€é”€æ¯”è¾ƒæ•æ„Ÿã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å› æ­¤ï¼Œé™¤äº†ä½¿ Dapper æ”¶é›†çš„åŸºæœ¬æ¤å…¥æ€§èƒ½å¼€é”€å°½å¯èƒ½å°ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜é€šè¿‡&lt;strong&gt;ä»…è®°å½•æ‰€æœ‰è¿½è¸ªçš„ä¸€å°éƒ¨åˆ†æ¥è¿›ä¸€æ­¥æ§åˆ¶æ€§èƒ½å¼€é”€&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;h2 id=&quot;3-5-trace-collection&quot;&gt;3-5 &lt;strong&gt;Trace Collection&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;Dapper è¿½è¸ªè®°å½•å’Œæ”¶é›†æ˜¯ä¸‰é˜¶æ®µï¼ˆthree-stageï¼‰å¤„ç†æµç¨‹ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/dapper/dapper_5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;Span æ•°æ®è¢«å†™å…¥æœ¬åœ°æ—¥å¿—æ–‡ä»¶&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Dapper å®ˆæŠ¤è¿›ç¨‹åŠæ”¶é›†ç»„ä»¶æŠŠè¿™äº›æ•°æ®ä»æ‰€æœ‰ä¸»æœºä¸­æ‹‰å–å‡ºæ¥&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;æ”¶é›†åˆ°çš„æ•°æ®è¢«å†™å…¥ BigTable ä»“åº“ä¸­&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;ä¸€æ¬¡ Trace è¢«è®¾è®¡æˆ Bigtable ä¸­çš„ä¸€è¡Œï¼Œæ¯ä¸€åˆ—ç›¸å½“äºä¸€ä¸ª Spanã€‚Bigtable æ”¯æŒç¨€ç–è¡¨æ ¼çš„å¸ƒå±€æ­£é€‚åˆè¿™ç§æƒ…å†µï¼Œå› ä¸ºæ¯ä¸€æ¬¡è·Ÿè¸ªå¯ä»¥æœ‰ä»»æ„å¤šä¸ª Spanã€‚&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Trace æ•°æ®æ”¶é›†ï¼ˆå³ä»åº”ç”¨ä¸­çš„äºŒè¿›åˆ¶æ•°æ®ä¼ è¾“åˆ°ä¸­å¤®ä»“åº“æ‰€èŠ±è´¹çš„æ—¶é—´ï¼‰çš„å»¶è¿Ÿä¸­ä½æ•°å°‘äº 15 ç§’ã€‚TP98 å»¶è¿Ÿå¾€å¾€éšç€æ—¶é—´çš„æ¨ç§»å‘ˆç°åŒå³°å‹ï¼›å¤§çº¦ 75% çš„æ—¶é—´ï¼ŒTP98 å»¶è¿Ÿæ—¶é—´å°äº 2 åˆ†é’Ÿï¼Œä½†æ˜¯å¦å¤–å¤§çº¦ 25% çš„æ—¶é—´ï¼Œå¯ä»¥å¢æ¶¨åˆ°å‡ ä¸ªå°æ—¶ã€‚&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;Dapper è¿˜æä¾›äº†ä¸€ä¸ª API æ¥ç®€åŒ–è®¿é—® BigTable ä»“åº“ä¸­çš„ Trace æ•°æ®ã€‚ ç”¨æˆ·é€šè¿‡è¯¥ APIï¼Œå¯ä»¥æ„å»ºé€šç”¨å’Œç‰¹å®šåº”ç”¨ç¨‹åºçš„åˆ†æå·¥å…·ã€‚&lt;/p&gt;

&lt;h3 id=&quot;3-5-1-out-of-band-trace-collection&quot;&gt;3-5-1 &lt;strong&gt;Out-of-band trace collection&lt;/strong&gt;&lt;/h3&gt;

&lt;p&gt;Dapper é€šè¿‡è¯·æ±‚æ ‘å®ç° Trace æ•°æ®ï¼ˆin-bandï¼‰åŠå¸¦å¤–æ•°æ®ï¼ˆout-of-bandï¼‰æ”¶é›†ã€‚è¿™ä¹ˆåšæ˜¯å‡ºäºä¸¤ä¸ªä¸ç›¸å…³çš„åŸå› ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;å¸¦å†…æ•°æ®ï¼ˆin-bandï¼‰æ”¶é›†æ–¹æ¡ˆä¼šå½±å“åº”ç”¨ç¨‹åºçš„ç½‘ç»œåŠ¨æ€ï¼šTrace æ•°æ®ä¼šåœ¨ RPC å“åº”å¤´ä¸­æºå¸¦ã€‚åœ¨ Google çš„è®¸å¤šå¤§å‹ç³»ç»Ÿä¸­ï¼Œä¸€æ¬¡ Trace ä¸­åŒ…å«æ•°åƒä¸ª Span æ˜¯å¾ˆå¸¸è§çš„ã€‚ç„¶è€Œï¼ŒRPC å“åº”ä»å¯èƒ½ç›¸å¯¹æ¯”è¾ƒå°ï¼Œç»å¸¸å°äº 10KBã€‚è¿™æ ·ï¼Œ Dapper å¸¦å†…çš„ Trace æ•°æ®ä¼šè®©åº”ç”¨ç¨‹åºæ•°æ®å’Œå€¾å‘äºä½¿ç”¨åç»­åˆ†æç»“æœçš„æ•°æ®é‡ç›¸å½¢è§ç»Œï¼Œå¹¶ä½¿åç»­åˆ†æçš„ç»“æœäº§ç”Ÿåå·®ã€‚&lt;/li&gt;
  &lt;li&gt;å¸¦å†…æ•°æ®æ”¶é›†æ–¹æ¡ˆå‡è®¾æ‰€æœ‰ RPC è°ƒç”¨éƒ½æ˜¯å®Œç¾åµŒå¥—çš„ã€‚æˆ‘ä»¬å‘ç°ï¼Œåœ¨æ‰€æœ‰åç«¯ç³»ç»Ÿè¿”å›æœ€ç»ˆç»“æœä¹‹å‰ï¼Œæœ‰è®¸å¤šä¸­é—´ä»¶ä¼šæŠŠç»“æœè¿”å›ç»™ä»–ä»¬çš„è°ƒç”¨è€…ã€‚&lt;em&gt;å¸¦å†…æ”¶é›†ç³»ç»Ÿæ˜¯æ— æ³•è§£é‡Šè¿™ç§éåµŒå¥—çš„åˆ†å¸ƒå¼æ‰§è¡Œæ¨¡å¼çš„&lt;/em&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;blockquote&gt;
  &lt;p&gt;å¸¦å¤–æ•°æ®ï¼šä¼ è¾“å±‚åè®®ä½¿ç”¨å¸¦å¤–æ•°æ®(out-of-bandï¼ŒOOB)æ¥å‘é€ä¸€äº›é‡è¦çš„æ•°æ®,å¦‚æœé€šä¿¡ä¸€æ–¹æœ‰é‡è¦çš„æ•°æ®éœ€è¦é€šçŸ¥å¯¹æ–¹æ—¶,åè®®èƒ½å¤Ÿå°†è¿™äº›æ•°æ®å¿«é€Ÿåœ°å‘é€åˆ°å¯¹æ–¹ã€‚ä¸ºäº†å‘é€è¿™äº›æ•°æ®ï¼Œåè®®ä¸€èˆ¬ä¸ä½¿ç”¨ä¸æ™®é€šæ•°æ®ç›¸åŒçš„é€šé“,è€Œæ˜¯ä½¿ç”¨å¦å¤–çš„é€šé“ã€‚&lt;/p&gt;

&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;è¿™é‡ŒæŒ‡çš„ in-band ç­–ç•¥æ˜¯æŠŠè·Ÿè¸ªæ•°æ®éšç€è°ƒç”¨é“¾è¿›è¡Œä¼ é€ï¼Œout-of-band æ˜¯é€šè¿‡å…¶ä»–çš„é“¾è·¯è¿›è¡Œè·Ÿè¸ªæ•°æ®çš„æ”¶é›†ï¼ŒDapper çš„å†™æ—¥å¿—ç„¶åè¿›è¡Œæ—¥å¿—é‡‡é›†çš„æ–¹å¼å°±å±äº out-of-band ç­–ç•¥&lt;/p&gt;

&lt;/blockquote&gt;

&lt;h1 id=&quot;4-managing-tracing-overhead&quot;&gt;4-&lt;strong&gt;Managing Tracing Overhead&lt;/strong&gt;&lt;/h1&gt;

&lt;p&gt;è¿½è¸ªç³»ç»Ÿçš„æˆæœ¬è¢«è®¤ä¸ºåŒ…å«ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;em&gt;ç”±äºè¿½è¸ªæ•°æ®ç”Ÿæˆå’Œæ”¶é›†å¼€é”€è€Œå¯¼è‡´çš„è¢«ç›‘è§†ç³»ç»Ÿçš„æ€§èƒ½ä¸‹é™&lt;/em&gt;&lt;/li&gt;
  &lt;li&gt;&lt;em&gt;å­˜å‚¨å’Œåˆ†æè·Ÿè¸ªæ•°æ®æ‰€éœ€çš„èµ„æºé‡&lt;/em&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;blockquote&gt;
  &lt;p&gt;å°½ç®¡æœ‰äººä¼šè¯´æœ‰ä»·å€¼çš„è¿½è¸ªç³»ç»Ÿå€¼å¾—æ€§èƒ½æŸè€—ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç›¸ä¿¡å¦‚æœåŸºçº¿å¼€é”€å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œé‚£ä¹ˆå°†ä¼šæå¤§çš„ä¿ƒè¿›ä¸šåŠ¡ä½¿ç”¨ç‡&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;æ¥ä¸‹æ¥å°†ä¸»è¦ä»‹ç» &lt;strong&gt;Dapper æ¤å…¥æ“ä½œçš„å¼€é”€&lt;/strong&gt;ï¼Œ&lt;strong&gt;Trace æ•°æ®æ”¶é›†çš„å¼€é”€&lt;/strong&gt;ï¼Œä»¥åŠ Dapper å¯¹ä¸šåŠ¡è´Ÿè½½çš„å½±å“ã€‚åŒæ—¶ï¼Œè¿˜ä¼šä»‹ç» Dapper è‡ªé€‚åº”é‡‡æ ·æœºåˆ¶å¦‚ä½•å¹³è¡¡ä½æ€§èƒ½æŸè€—çš„éœ€æ±‚ä¸å¯¹ä»£è¡¨æ€§ Trace è¿½è¸ªçš„éœ€æ±‚ã€‚&lt;/p&gt;

&lt;h2 id=&quot;4-1-trace-generation-overhead&quot;&gt;4-1 &lt;strong&gt;Trace generation overhead&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;Trace ç”Ÿæˆå¼€é”€æ˜¯ Dapper æ€§èƒ½æŸè€—ä¸­æœ€å…³é”®çš„éƒ¨ä»½ï¼Œå› ä¸º Trace æ•°æ®æ”¶é›†åŠåˆ†æå¯ä»¥åœ¨ç´§æ€¥æƒ…å†µä¸‹è¢«å…³æ‰ã€‚&lt;/p&gt;

&lt;p&gt;Trace ç”Ÿæˆå¼€é”€ä¸»è¦æ¥æºæœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Span çš„åˆ›å»ºåŠé”€æ¯&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;å°† Span ä¿¡æ¯è®°å½•åˆ°æœ¬åœ°ç£ç›˜ï¼Œä»¥ä¾¿åç»­æ”¶é›†&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;Root Span åˆ›å»ºåŠé”€æ¯å¹³å‡éœ€è¦ 204 nsï¼Œé Root Span åˆ›å»ºåŠé”€æ¯éœ€è¦ 176 nsï¼›å·®åˆ«çš„åŸå› æ˜¯ éœ€è¦ç»™ Root Span åˆ†é…ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ Trace ID&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;å¦‚æœä¸å¯¹ Span è¿›è¡Œè¿½è¸ªé‡‡æ ·ï¼Œé‚£ä¹ˆé¢å¤–çš„ Span Annotation æˆæœ¬å‡ ä¹å¯ä»¥å¿½ç•¥ä¸è®¡ï¼ŒåŒ…æ‹¬ Dapper è¿è¡Œæ—¶çº¿ç¨‹æœ¬åœ°æŸ¥æ‰¾ï¼ˆå¹³å‡è€—æ—¶ 9nsï¼‰ã€‚å¦‚æœå¯¹ Span è¿›è¡Œè¿½è¸ªé‡‡æ ·ï¼Œé‚£ä¹ˆä¼šç”¨å­—ç¬¦ä¸²æ–‡æœ¬è¿›è¡Œæ³¨é‡Šè¿½è¸ª ???ã€‚&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;If it is sampled, annotating the trace with a string literal&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;å°† Span æ•°æ®å†™å…¥æœ¬åœ°ç£ç›˜æ—¶ Dapper è¿è¡Œæ—¶åº“æœ€æ˜‚è´µçš„æ“ä½œï¼Œä½†æ˜¯è¿™éƒ¨åˆ†æŸè€—è¢«å¤§å¤§å‡å°‘ï¼Œå› ä¸ºæ—¥å¿—å†™å…¥æ“ä½œç›¸å¯¹äºè¢«è¿½è¸ªçš„åº”ç”¨ç¨‹åºæ—¶å¼‚æ­¥æ‰§è¡Œçš„ã€‚ç„¶è€Œï¼Œæ—¥å¿—å†™å…¥æ“ä½œä¼šå¯¹é«˜ååé‡åº”ç”¨ç¨‹åºæ€§èƒ½äº§ç”Ÿæ˜æ˜¾å½±å“ï¼Œå°¤å…¶æ˜¯åœ¨æ‰€æœ‰è¯·æ±‚éƒ½è¢«è¿½è¸ªçš„æƒ…å†µä¸‹ã€‚&lt;/p&gt;

&lt;h2 id=&quot;4-2-trace-collection-overhead&quot;&gt;4-2 &lt;strong&gt;Trace collection overhead&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;è¯»å–æœ¬åœ° Trace æ•°æ®ä¹Ÿä¼šå¯¹è¢«è¿½è¸ªçš„å‰å°åº”ç”¨è´Ÿè½½æœ‰å½±å“ã€‚ä¸‹è¡¨å±•ç¤ºäº†å‹åŠ›æµ‹è¯•æƒ…å†µä¸‹ Dapper å®ˆæŠ¤è¿›ç¨‹çš„ CPU ä½¿ç”¨ç‡ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/dapper/dapper_6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Dapper å®ˆæŠ¤è¿›ç¨‹åœ¨æ•°æ®æ”¶é›†æœŸé—´ CPU ä½¿ç”¨ç‡ä¸è¶…è¿‡ 0.3%ï¼Œå¹¶ä¸”å†…å­˜å ç”¨éå¸¸å°ã€‚åŒæ—¶æˆ‘ä»¬ä¹Ÿä¼šå°† Dapper å®ˆæŠ¤è¿›ç¨‹çš„å†…æ ¸è°ƒåº¦ä¼˜å…ˆçº§è®¾ç½®çš„å°½å¯èƒ½ä½ï¼Œä»¥é˜²æ­¢åœ¨é«˜è´Ÿè½½çš„ä¸»æœºä¸­å‡ºç° CPU äº‰ç”¨çš„æƒ…å†µ&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;Dapper ä¹Ÿæ˜¯ä¸€ä¸ªè½»é‡çº§çš„å¸¦å®½èµ„æºæ¶ˆè´¹è€…ï¼Œæ¯ä¸ª Span å¹³å‡ä¸º 426 Byteï¼›Dapper æ•°æ®æ”¶é›†æµé‡ä»…å  Google ç”Ÿäº§ç¯å¢ƒç½‘ç»œæµé‡çš„ä¸åˆ° 0.01%ã€‚&lt;/p&gt;

&lt;h2 id=&quot;4-3-effect-on-production-workloads&quot;&gt;4-3 &lt;strong&gt;Effect on production workloads&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;æœ‰äº›è¯·æ±‚éƒ½ä¼šæ¶‰åŠåˆ°å¤§é‡é«˜ååé‡çš„çº¿ä¸ŠæœåŠ¡ï¼Œè¿™æ˜¯å¯¹æœ‰æ•ˆè¿½è¸ªæœ€ä¸»è¦çš„éœ€æ±‚ä¹‹ä¸€ï¼›è¿™äº›è¯·æ±‚å¾€å¾€ä¼šç”Ÿæˆå¤§é‡çš„è¿½è¸ªæ•°æ®ï¼ŒåŒæ—¶å®ƒä»¬å¯¹æ€§èƒ½å¹²æ‰°ä¹Ÿæœ€æ•æ„Ÿã€‚åœ¨ä¸‹è¡¨ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ç½‘ç»œæœç´¢é›†ç¾¤ä½œä¸ºè¿™ç±»æœåŠ¡çš„ä¸€ä¸ªç¤ºä¾‹ï¼Œå½“æˆ‘ä»¬æ”¹å˜ Trace é‡‡æ ·ç‡æ—¶ï¼Œè¯„ä¼° Dapper å¯¹å¹³å‡å»¶è¿Ÿä¸ååé‡çš„å½±å“ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/dapper/dapper_7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶å¯¹ååé‡çš„å½±å“ä¸æ˜¯å¾ˆæ˜æ˜¾ï¼Œä½†æ˜¯ä¸ºäº†é¿å…æ˜æ˜¾çš„å»¶è¿Ÿå¢åŠ ï¼ŒTrace é‡‡æ ·ç¡®å®å¾ˆæœ‰å¿…è¦ã€‚åœ¨å®è·µä¸­æˆ‘ä»¬å‘ç°ï¼Œå³ä½¿ä½¿ç”¨ 1/1024 çš„é‡‡æ ·ç‡ï¼Œå¯¹äºè¯·æ±‚é‡å¤§çš„æœåŠ¡ä»ç„¶èƒ½å¤Ÿäº§ç”Ÿè¶³å¤Ÿçš„ Trace æ•°æ®ã€‚&lt;/p&gt;

&lt;p&gt;å°† Dapper çš„åŸºçº¿å¼€é”€é™ä½å¾ˆé‡è¦ï¼Œå› ä¸ºç”¨æˆ·å¯ä»¥ä½¿ç”¨å…¨éƒ¨èŒƒå›´çš„ Annotation APIï¼Œè€Œä¸å¿…æ‹…å¿ƒæ€§èƒ½æŸè€—ã€‚ä½¿ç”¨ä½é‡‡æ ·ç‡è¿˜æœ‰ä¸€ä¸ªé¢å¤–çš„å¥½å¤„ï¼ŒTrace æ•°æ®å¯ä»¥åœ¨ä¸»æœºè¢«å›æ”¶ä¹‹å‰åœ¨ç£ç›˜ä¸Šä¿å­˜æ›´é•¿çš„æ—¶é—´ï¼Œè¿™ä¸ºæ•°æ® Trace æ•°æ®æ”¶é›†è®¾æ–½æä¾›äº†æ›´å¤§çš„çµæ´»æ€§ã€‚&lt;/p&gt;

&lt;h2 id=&quot;4-4-adaptive-sampling&quot;&gt;4-4 &lt;strong&gt;Adaptive sampling&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;Dapper è¿›ç¨‹å¼€é”€ä¸å•ä½æ—¶é—´å¤„ç† Trace æ•°æ®é‡æˆæ­£æ¯”ã€‚Dapper ç¬¬ä¸€ç‰ˆå¯¹ Google å†…æ‰€æœ‰è¿›ç¨‹ä½¿ç”¨ç»Ÿä¸€çš„é‡‡æ ·ç‡ (1/1024)ï¼Œè¿™ä¸ªç®€å•çš„æ–¹æ¡ˆå¯¹é«˜ååé‡çš„åœ¨çº¿æœåŠ¡å¾ˆæœ‰æ•ˆï¼Œå› ä¸ºç»å¤§å¤šæ•°æˆ‘ä»¬æ„Ÿå…´è¶£çš„äº‹ä»¶å¯èƒ½ç»å¸¸ä¼šå‡ºç°ï¼Œè¶³ä»¥è¢«æ•è·ã€‚&lt;/p&gt;

&lt;p&gt;ç„¶è€Œï¼Œæœ‰äº›ä½ååé‡ï¼ˆä½è´Ÿè½½ï¼‰çš„æœåŠ¡å¯èƒ½ä¼šåœ¨ä½é‡‡æ ·ç‡çš„æƒ…å†µä¸‹é”™è¿‡ä¸€äº›é‡è¦çš„äº‹ä»¶ï¼›åŒæ—¶ï¼Œè¿™ç±»æœåŠ¡å¯ä»¥å®¹å¿é«˜é‡‡æ ·ç‡å¸¦æ¥çš„æ€§èƒ½æŸè€—ã€‚å¯¹äºè¿™ç±»ç³»ç»Ÿï¼Œè§£å†³æ–¹æ¡ˆæ˜¯è¦†ç›–é»˜è®¤çš„é‡‡æ ·ç‡ï¼›å¯¹äºè¿™ç§éœ€è¦æ‰‹åŠ¨å¹²é¢„çš„æƒ…å†µæ˜¯æˆ‘ä»¬åœ¨ Dapper ä¸­åŠ›æ±‚é¿å…çš„ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬æ­£åœ¨éƒ¨ç½²ä¸€ç§è‡ªé€‚åº”é‡‡æ ·æ¨¡å‹ï¼Œè¯¥æ–¹æ¡ˆä¸æ˜¯é‡‡ç”¨ç»Ÿä¸€çš„é‡‡æ ·ç‡å‚æ•°ï¼Œè€Œæ˜¯ä½¿ç”¨ä¸€ä¸ªé‡‡æ ·æœŸæœ›ç‡æ¥æ ‡è¯†å•ä½æ—¶é—´å†…çš„é‡‡æ ·ã€‚è¿™æ ·ï¼Œ&lt;strong&gt;ä½æµé‡çš„æœåŠ¡ä¼šè‡ªåŠ¨æé«˜é‡‡æ ·ç‡ï¼Œè€Œé«˜æµé‡çš„æœåŠ¡ä¼šè‡ªåŠ¨é™ä½é‡‡æ ·ç‡ï¼Œä»è€Œä½¿é‡‡æ ·å¼€é”€ä¿æŒåœ¨å¯æ§çš„èŒƒå›´å†…&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;h2 id=&quot;4-5-coping-with-aggressive-sampling&quot;&gt;4-5 &lt;strong&gt;Coping with aggressive sampling&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;æ–°çš„ Dapper ç”¨æˆ·ç»å¸¸æƒ³çŸ¥é“ä½é‡‡æ ·ç‡æ˜¯å¦ä¼šå¹²æ‰°ä»–ä»¬çš„åˆ†æï¼ˆåœ¨é«˜ååé‡çš„æœåŠ¡ä¸‹ç»å¸¸ä½è‡³ 0.01ï¼…ï¼‰ã€‚Google çš„ç»éªŒè®©æˆ‘ä»¬ç›¸ä¿¡ï¼Œæ¿€è¿›çš„é‡‡æ ·ï¼ˆaggressive samplingï¼‰å¹¶ä¸ä¼šå¦¨ç¢é‡è¦çš„åˆ†æï¼šå¦‚æœä¸€ä¸ªå€¼å¾—æ³¨æ„çš„æ—¶é—´åœ¨ä¸€ä¸ªç³»ç»Ÿä¸­å‡ºç°ä¸€æ¬¡ï¼Œé‚£ä¹ˆå®ƒå°†ä¼šå‡ºç°å¾ˆå¤šæ¬¡ã€‚å¯¹äºæµé‡æ¯”è¾ƒå°çš„æœåŠ¡ï¼ˆæ¯ç§’å¤„ç†å‡ åä¸ªè¯·æ±‚ï¼Œè€Œä¸æ˜¯å‡ ä¸‡ä¸ªè¯·æ±‚ï¼‰ï¼Œå¯ä»¥æ¥å—å¯¹æ¯ä¸ªè¯·æ±‚è¿›è¡Œç›‘æ§ã€‚è¿™å°±æ˜¯æˆ‘ä»¬å†³å®šé‡‡ç”¨è‡ªé€‚åº”é‡‡æ ·ç‡çš„åŸå› ã€‚&lt;/p&gt;

&lt;h1 id=&quot;5-experiences&quot;&gt;5-&lt;strong&gt;Experiences&lt;/strong&gt;&lt;/h1&gt;

&lt;p&gt;Dapper åœ¨ Google å†…éƒ¨è¢«å¹¿æ³›åº”ç”¨ï¼Œä¸€éƒ¨åˆ†ç›´æ¥é€šè¿‡ Dapper çš„ç”¨æˆ·ç•Œé¢ï¼Œå¦ä¸€éƒ¨åˆ†é—´æ¥åœ°é€šè¿‡å¯¹ Dapper API çš„äºŒæ¬¡å¼€å‘æˆ–è€…å»ºç«‹åœ¨åŸºäº API çš„åº”ç”¨ä¸Šã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å¹¶ä¸æ‰“ç®—ç½—åˆ—å‡ºæ¯ä¸€ç§å·²çŸ¥çš„ Dapper ä½¿ç”¨æ–¹å¼ï¼Œè€Œæ˜¯è¯•å›¾è¦†ç›– Dapper ä½¿ç”¨æ–¹å¼çš„â€œåŸºæœ¬å‘é‡â€ï¼Œå¹¶åŠªåŠ›æ¥è¯´æ˜ä»€ä¹ˆæ ·çš„åº”ç”¨æ˜¯æœ€æˆåŠŸçš„ã€‚&lt;/p&gt;

&lt;h2 id=&quot;5-1-using-dapper-during-development&quot;&gt;5-1 &lt;strong&gt;Using Dapper during development&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;Google AdWords ç³»ç»Ÿæ˜¯å›´ç»•ä¸€ä¸ªå…³é”®è¯å®šä½å‡†åˆ™å’Œç›¸å…³æ–‡å­—å¹¿å‘Šçš„å¤§å‹æ•°æ®åº“æ­å»ºçš„ã€‚å½“æ–°çš„å…³é”®å­—æˆ–å¹¿å‘Šè¢«æ’å…¥æˆ–ä¿®æ”¹æ—¶ï¼Œå®ƒä»¬å¿…é¡»é€šè¿‡æœåŠ¡ç­–ç•¥æœ¯è¯­çš„æ£€æŸ¥ï¼ˆå¦‚æ£€æŸ¥ä¸æ°å½“çš„è¯­è¨€ï¼‰ï¼›è¿™ä¸ªè¿‡ç¨‹å¦‚æœä½¿ç”¨è‡ªåŠ¨å¤æŸ¥ç³»ç»Ÿæ¥åšçš„è¯ä¼šæ›´åŠ æœ‰æ•ˆã€‚&lt;/p&gt;

&lt;p&gt;å½“è®¾è®¡ä¸€ä¸ª Ads Review æœåŠ¡æ—¶ï¼Œè¿™ä¸ªå›¢é˜Ÿè¿­ä»£çš„ä»ç¬¬ä¸€ä¸ªç³»ç»ŸåŸå‹å¼€å§‹ä½¿ç”¨ Dapperï¼Œå¹¶ä¸”æœ€ç»ˆç”¨ Dapper ä¸€ç›´ç»´æŠ¤ç€ä»–ä»¬çš„ç³»ç»Ÿã€‚Dapper å¸®åŠ©ä»–ä»¬ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ”¹è¿›äº†ä»–ä»¬çš„æœåŠ¡ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;æ€§èƒ½ï¼ˆperformanceï¼‰&lt;/strong&gt;ï¼šå¼€å‘äººå‘˜é’ˆå¯¹è¯·æ±‚å»¶è¿Ÿçš„ç›®æ ‡è¿›è¡Œè·Ÿè¸ªï¼Œå¹¶å¯¹å®¹æ˜“ä¼˜åŒ–çš„åœ°æ–¹è¿›è¡Œå®šä½ã€‚Dapper ä¹Ÿè¢«ç”¨æ¥ç¡®å®šåœ¨å…³é”®è·¯å¾„ä¸Šä¸å¿…è¦çš„ä¸²è¡Œè¯·æ±‚ï¼ˆé€šå¸¸æ¥æºäºä¸æ˜¯å¼€å‘è€…è‡ªå·±å¼€å‘çš„å­ç³»ç»Ÿï¼‰å¹¶ä¿ƒä½¿ç›¸å…³å›¢é˜ŸæŒç»­ä¿®å¤ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;æ­£ç¡®æ€§ï¼ˆcorrectnessï¼‰&lt;/strong&gt;ï¼šAds Review æœåŠ¡å›´ç»•å¤§å‹æ•°æ®åº“ç³»ç»Ÿæ­å»ºã€‚ç³»ç»ŸåŒæ—¶å…·æœ‰åªè¯»å‰¯æœ¬ï¼ˆè®¿é—®æˆæœ¬ä½ï¼‰å’Œè¯»å†™ä¸»èŠ‚ç‚¹ï¼ˆè®¿é—®æˆæœ¬é«˜ï¼‰ä¸¤ç§æ–¹å¼ã€‚Dapper ç”¨äºè¯†åˆ«ä¸€äº›ä¸å¿…è¦åœ°å‘ä¸»èŠ‚ç‚¹è€Œä¸æ˜¯å‰¯æœ¬å‘å‡ºæŸ¥è¯¢çš„æƒ…å†µã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;ç†è§£æ€§ï¼ˆunderstandingï¼‰&lt;/strong&gt;ï¼šAds Review æŸ¥è¯¢è·¨è¶Šäº†å„ç§ç±»å‹çš„ç³»ç»Ÿï¼ŒåŒ…æ‹¬ BigTableï¼Œä»¥åŠå…¶ä»–å„ç§ C++ï¼ŒJava åç«¯æœåŠ¡ã€‚Dapper æ•°æ®è¿½è¸ªå¯ä»¥ç”¨æ¥è¯„ä¼°æ€»æŸ¥è¯¢æˆæœ¬ï¼Œä¿ƒè¿›é‡æ–°å¯¹ä¸šåŠ¡çš„è®¾è®¡ï¼Œä»è€Œå‡å°‘ç³»ç»Ÿä¾èµ–æ€§è´Ÿè½½ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;æµ‹è¯•ï¼ˆtestingï¼‰&lt;/strong&gt;ï¼šæ–°ä»£ç å‘å¸ƒé€šè¿‡ Dapper è·Ÿè¸ª QA æµç¨‹ï¼ŒéªŒè¯ç³»ç»Ÿè¡Œä¸ºçš„æ­£ç¡®æ€§å’Œæ€§èƒ½ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å‘ç°äº†è®¸å¤šé—®é¢˜ï¼ŒåŒ…æ‹¬ Ads Review æœåŠ¡ä»£ç æœ¬èº«å’Œä¾èµ–åº“ä¸­çš„é—®é¢˜ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;5-2-addressing-long-tail-latency&quot;&gt;5-2 &lt;strong&gt;Addressing long tail latency&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;ç”±äºç§»åŠ¨éƒ¨ä»¶ï¼ˆmoving partsï¼‰çš„æ•°é‡ï¼Œä»£ç åº“çš„å¤§å°ï¼Œéƒ¨ç½²çš„èŒƒå›´ï¼Œä½¿å¾—è°ƒè¯•ç±»ä¼¼é€šç”¨æœç´¢è¿™æ ·çš„æœåŠ¡å…·æœ‰éå¸¸å¤§çš„æŒ‘æˆ˜æ€§ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æè¿°ä¸ºäº†é™ä½é€šç”¨æœç´¢å»¶è¿Ÿåˆ†å¸ƒçš„é•¿å°¾æ•ˆåº”æ‰€åšå‡ºçš„åŠªåŠ›ã€‚&lt;/p&gt;

&lt;p&gt;Dapper èƒ½å¤ŸéªŒè¯å…³äºç«¯åˆ°ç«¯å»¶è¿Ÿçš„å‡è®¾ï¼Œæ›´å…·ä½“æ¥è¯´ï¼Œèƒ½å¤ŸéªŒè¯é€šç”¨æœç´¢è¯·æ±‚çš„å…³é”®è·¯å¾„ã€‚å½“ç³»ç»Ÿä¸ä»…æ¶‰åŠæ•°åä¸ªå­ç³»ç»Ÿï¼Œè€Œä¸”æ¶‰åŠæ•°åä¸ªå¼€å‘å›¢é˜Ÿæ—¶ï¼Œå³ä½¿æœ€ä¼˜ç§€ï¼Œæœ€æœ‰ç»éªŒçš„å·¥ç¨‹å¸ˆä¹Ÿä¸èƒ½å‡†ç¡®åˆ¤æ–­å¯¼è‡´ç«¯åˆ°ç«¯æ€§èƒ½è¾ƒå·®çš„æ ¹æœ¬åŸå› ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒDapper å¯ä»¥æä¾›æ€¥éœ€çš„æ•°æ®ï¼Œå¹¶ä¸”èƒ½å¤Ÿå¯¹è®¸å¤šé‡è¦çš„æ€§èƒ½é—®é¢˜çš„å‡ºç»“è®ºã€‚&lt;/p&gt;

&lt;h2 id=&quot;5-3-inferring-service-dependencies&quot;&gt;5-3 &lt;strong&gt;Inferring service dependencies&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;åœ¨ä»»ä½•ç»™å®šçš„æ—¶é—´å†…ï¼ŒGoogle å†…éƒ¨çš„ä¸€ä¸ªå…¸å‹çš„è®¡ç®—é›†ç¾¤æ˜¯ä¸€ä¸ªæ±‡é›†äº†æˆåƒä¸Šä¸‡ä¸ªé€»è¾‘â€œä»»åŠ¡â€çš„ä¸»æœºï¼Œä¸€å¥—çš„å¤„ç†å™¨åœ¨æ‰§è¡Œä¸€ä¸ªé€šç”¨çš„æ–¹æ³•ã€‚Google ç»´æŠ¤ç€è®¸å¤šè¿™æ ·çš„é›†ç¾¤ï¼Œäº‹å®ä¸Šï¼Œæˆ‘ä»¬å‘ç°åœ¨ä¸€ä¸ªé›†ç¾¤ä¸Šè®¡ç®—ç€çš„è¿™äº›ä»»åŠ¡é€šå¸¸ä¾èµ–äºå…¶ä»–çš„é›†ç¾¤ä¸Šçš„ä»»åŠ¡ã€‚ç”±äºä»»åŠ¡ä¹‹é—´çš„ä¾èµ–æ˜¯åŠ¨æ€æ”¹å˜çš„ï¼Œæ‰€ä»¥ä¸å¯èƒ½ä»…ä»é…ç½®ä¿¡æ¯ä¸Šæ¨æ–­å‡ºæ‰€æœ‰è¿™äº›æœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚åŒæ—¶ï¼Œåœ¨å…¬å¸å†…éƒ¨çš„å„ä¸ªæµç¨‹éœ€è¦å‡†ç¡®çš„æœåŠ¡ä¾èµ–å…³ç³»ä¿¡æ¯ï¼Œä»¥ç¡®å®šç“¶é¢ˆæ‰€åœ¨ï¼Œä»¥åŠè®¡åˆ’æœåŠ¡çš„è¿ç§»ã€‚&lt;/p&gt;

&lt;p&gt;Google å†…éƒ¨è¢«ç§°ä¸º â€œService Dependenciesâ€ çš„é¡¹ç›®æ˜¯é€šè¿‡ä½¿ç”¨ Trace Annotation å’Œ Dapper API MapReduce æ¥å£æ¥å®ç°è‡ªåŠ¨åŒ–ç¡®å®šæœåŠ¡ä¾èµ–ã€‚&lt;/p&gt;

&lt;p&gt;Dapper æ ¸å¿ƒç»„ä»¶ä¸ Dapper  Trace Annotation ä¸€èµ·ä½¿ç”¨çš„æƒ…å†µä¸‹ï¼Œâ€œService Dependenciesâ€ é¡¹ç›®èƒ½å¤Ÿæ¨ç®—å‡ºä»»åŠ¡å„è‡ªä¹‹é—´çš„ä¾èµ–ï¼Œä»¥åŠä»»åŠ¡å’Œå…¶ä»–ç»„ä»¶ä¹‹é—´çš„ä¾èµ–ã€‚&lt;/p&gt;

&lt;h2 id=&quot;5-4-layered-and-shared-storage-systems&quot;&gt;5-4 &lt;strong&gt;Layered and Shared Storage Systems&lt;/strong&gt;&lt;/h2&gt;

&lt;p&gt;Google çš„è®¸å¤šå­˜å‚¨ç³»ç»Ÿæ˜¯ç”±å¤šé‡ç‹¬ç«‹å¤æ‚å±‚çº§çš„åˆ†å¸ƒå¼åŸºç¡€è®¾å¤‡ç»„æˆçš„ã€‚ä¾‹å¦‚ï¼ŒGoogle çš„ App Engine å°±æ˜¯æ­å»ºåœ¨ä¸€ä¸ªå¯æ‰©å±•çš„å®ä½“å­˜å‚¨ç³»ç»Ÿä¸Šçš„ã€‚è¯¥å®ä½“å­˜å‚¨ç³»ç»ŸåŸºäº BigTable ä¸Šå…¬å¼€æŸäº›RDBMS åŠŸèƒ½ã€‚BigTable åŒæ—¶ä½¿ç”¨Chubby åŠ GFSã€‚è€Œä¸”ï¼Œåƒ BigTable è¿™æ ·çš„ç³»ç»Ÿç®€åŒ–äº†éƒ¨ç½²ï¼Œå¹¶æ›´å¥½çš„åˆ©ç”¨äº†è®¡ç®—èµ„æºã€‚&lt;/p&gt;

&lt;p&gt;åœ¨è¿™ç§åˆ†å±‚çš„ç³»ç»Ÿï¼Œå¹¶ä¸æ€»æ˜¯å¾ˆå®¹æ˜“ç¡®å®šæœ€ç»ˆç”¨æˆ·èµ„æºçš„æ¶ˆè´¹æ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œæ¥è‡ªç»™å®š BigTable å•å…ƒçš„å¤§é‡ GFS æµé‡å¯èƒ½ä¸»è¦æ¥è‡ªä¸€ä¸ªç”¨æˆ·æˆ–å¤šä¸ªç”¨æˆ·ï¼Œè€Œåœ¨ GFS å±‚é¢ï¼Œè¿™ä¸¤ç§ä¸åŒä½¿ç”¨æ¨¡å¼ä¹‹é—´çš„å·®å¼‚æ˜¯æ¨¡ç³Šçš„ã€‚è€Œä¸”ï¼Œå¦‚æœç¼ºä¹åƒ Dapper è¿™æ ·çš„å·¥å…·ï¼Œå¯¹æ­¤ç±»å…±äº«æœåŠ¡çš„ç«äº‰å¯èƒ½ä¼šåŒæ ·éš¾ä»¥è°ƒè¯•ã€‚&lt;/p&gt;

&lt;p&gt;Dapper çš„ç”¨æˆ·ç•Œé¢å¯ä»¥èšåˆé‚£äº›è°ƒç”¨ä»»æ„å…¬å…±æœåŠ¡çš„å¤šä¸ªå®¢æˆ·ç«¯çš„è·Ÿè¸ªçš„æ€§èƒ½ä¿¡æ¯ï¼Œè¿™å°±å¾ˆå®¹æ˜“è®©æä¾›è¿™äº›æœåŠ¡çš„æºä»å¤šä¸ªç»´åº¦ç»™ä»–ä»¬çš„ç”¨æˆ·æ’åï¼ˆä¾‹å¦‚ï¼Œå…¥ç«™çš„ç½‘ç»œè´Ÿè½½ï¼Œå‡ºç«™çš„ç½‘ç»œè´Ÿè½½ï¼Œæˆ–æœåŠ¡è¯·æ±‚çš„æ€»æ—¶é—´ï¼‰ã€‚&lt;/p&gt;

&lt;h1 id=&quot;6-conclusions&quot;&gt;6-&lt;strong&gt;Conclusions&lt;/strong&gt;&lt;/h1&gt;

&lt;p&gt;åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ä»‹ç» Dapper è¿™ä¸ª Google ç”Ÿäº§ç¯å¢ƒä¸‹çš„åˆ†å¸ƒå¼ç³»ç»Ÿè·Ÿè¸ªå¹³å°ï¼Œå¹¶æ±‡æŠ¥äº†æˆ‘ä»¬å¼€å‘å’Œä½¿ç”¨å®ƒçš„ç›¸å…³ç»éªŒã€‚&lt;/p&gt;

&lt;p&gt;Dapper å‡ ä¹åœ¨éƒ¨ç½²åœ¨ Google æ‰€æœ‰ç³»ç»Ÿä¸Šï¼Œå¹¶å¯ä»¥åœ¨&lt;strong&gt;ä¸éœ€è¦åº”ç”¨çº§ä¿®æ”¹çš„æƒ…å†µä¸‹è¿›è¡Œè·Ÿè¸ªï¼Œè€Œä¸”æ²¡æœ‰æ˜æ˜¾çš„æ€§èƒ½å½±å“&lt;/strong&gt;ã€‚Dapper å¯¹äºå¼€å‘äººå‘˜å’Œè¿ç»´å›¢é˜Ÿå¸¦æ¥çš„å¥½å¤„ï¼Œå¯ä»¥ä»æˆ‘ä»¬ä¸»è¦çš„è·Ÿè¸ªç”¨æˆ·ç•Œé¢çš„å¹¿æ³›ä½¿ç”¨ä¸Šçœ‹å‡ºæ¥ï¼Œå¦å¤–æˆ‘ä»¬è¿˜åˆ—ä¸¾äº†ä¸€äº› Dapper ä½¿ç”¨ç”¨ä¾‹æ¥è¯´æ˜ Dapper çš„ä½œç”¨ï¼Œè¿™äº›ç”¨ä¾‹æœ‰äº›ç”šè‡³éƒ½æ²¡æœ‰ Dapper å¼€å‘å›¢é˜Ÿå‚ä¸ï¼Œè€Œæ˜¯è¢«åº”ç”¨çš„å¼€å‘è€…å¼€å‘å‡ºæ¥çš„ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬ç›¸ä¿¡ï¼Œ&lt;strong&gt;Dapper æ¯”ä»¥å‰åŸºäº Annotation çš„åˆ†å¸ƒå¼è·Ÿè¸ªè¾¾åˆ°æ›´é«˜çš„åº”ç”¨é€æ˜åº¦&lt;/strong&gt;ï¼Œè¿™ä¸€ç‚¹å·²ç»é€šè¿‡åªéœ€è¦å°‘é‡äººå·¥å¹²é¢„çš„å·¥ä½œé‡å¾—ä»¥è¯æ˜ã€‚è™½ç„¶ä¸€å®šç¨‹åº¦ä¸Šå¾—ç›Šäºæˆ‘ä»¬çš„ç³»ç»Ÿçš„åŒè´¨æ€§ï¼Œä½†å®ƒæœ¬èº«ä»ç„¶æ˜¯ä¸€ä¸ªé‡å¤§çš„æŒ‘æˆ˜ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬çš„è®¾è®¡æå‡ºäº†ä¸€äº›å®ç°åº”ç”¨çº§é€æ˜æ€§çš„å……åˆ†æ¡ä»¶ï¼Œå¯¹æ­¤æˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿå¯¹æ›´é”™æ‚ç¯å¢ƒä¸‹çš„è§£å†³æ–¹æ¡ˆçš„å¼€å‘æœ‰æ‰€å¸®åŠ©ã€‚&lt;/p&gt;

&lt;p&gt;æœ€åï¼Œé€šè¿‡å¼€æ”¾ Dapper ä»“åº“ç»™å†…éƒ¨å¼€å‘è€…ï¼Œä¿ƒä½¿äº†æ›´å¤šåŸºäº Dapper çš„åˆ†æå·¥å…·çš„äº§ç”Ÿã€‚&lt;/p&gt;</content><author><name>kkzhang</name></author><category term="system-design" /><summary type="html">1-Abstract</summary></entry><entry><title type="html">2022 Summary</title><link href="http://localhost:4000/summary-2022.html" rel="alternate" type="text/html" title="2022 Summary" /><published>2023-01-15T00:00:00+08:00</published><updated>2023-01-15T00:00:00+08:00</updated><id>http://localhost:4000/summary_2022</id><content type="html" xml:base="http://localhost:4000/summary-2022.html">&lt;blockquote&gt;
  &lt;p&gt;æ¥ä¸Šæµ·ä¸‰å¹´å¤šï¼Œç¬¬ä¸€æ¬¡ï¼ˆ2023-01-15ï¼‰è§åˆ°é‚£ä¹ˆå¤§çš„é›ª&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;å¦‚æœç”¨ä¸€ä¸ªè¯è¡¨è¾¾ä»Šå¹´çš„çŠ¶æ€ï¼Œé‚£å°±æ˜¯â€&lt;strong&gt;ç„¦è™‘&lt;/strong&gt;â€œã€‚&lt;/p&gt;

&lt;p&gt;æ¯ä¸ªæ—¶é—´æ®µç„¦è™‘çš„åŸå› ä¸åŒï¼ŒæŒç»­çš„æ—¶é—´ä¹Ÿä¸ä¸€æ ·ï¼›ä½†æ˜¯æ¥è¿ä¸æ–­çš„ç„¦è™‘æ„Ÿè®©è‡ªå·±æ„Ÿè§‰å‹åŠ›ä¸å°ã€‚å¥½åœ¨æ‰€æœ‰çš„äº‹æƒ…æœ€ç»ˆéƒ½æœ‰ä¸€ä¸ªæ¯”è¾ƒæ»¡æ„çš„ç»“æœï¼Œä¹Ÿç®—è‹¦å°½ç”˜æ¥ã€‚&lt;/p&gt;

&lt;p&gt;ä»Šå¹´æ¯”è¾ƒè·Œå®•ï¼Œä½†æ”¶è·ä¹Ÿå¾ˆå¤šï¼Œä¸ªåˆ«æ¯”è¾ƒé‡è¦çš„äº‹æƒ…ä¹Ÿéƒ½æŒ‰ç…§è‡ªå·±çš„é¢„æœŸæœ‰æ‰€è¿›å±•ï¼Œæ•´ä½“è¿˜æ˜¯æ¯”è¾ƒçŸ¥è¶³çš„ã€‚&lt;/p&gt;

&lt;h2 id=&quot;æ™‹å‡&quot;&gt;æ™‹å‡&lt;/h2&gt;

&lt;p&gt;æ™‹å‡å¸¦ç»™è‡ªå·±çš„ç„¦è™‘ç®—æ˜¯æœ€å¤§çš„äº†ï¼Œæ¯•ç«Ÿç›´æ¥å½±å“è‡ªå·±æ¥ä¸‹æ¥çš„èŒä¸šè§„åˆ’ã€‚ä»æ™‹å‡å‡†å¤‡åˆ°æ™‹å‡ç­”è¾©ï¼Œæ•´ä¸ªè¿‡ç¨‹å†—é•¿ç¹çï¼Œä»¤äººç–²æƒ«ï¼Œä¸­é€”ç”šè‡³æƒ³æ”¾å¼ƒï¼Œè¿˜å¥½æœ€ç»ˆæ™‹å‡æˆåŠŸï¼Œè€Œä¸”ç­”è¾©æ’ååœ¨æ‰€æœ‰å€™é€‰äººä¸­å¤„äºå‰åˆ—ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ç¾å›¢ä¸¤å¹´å¤šï¼ŒèŒçº§ä½“ç³»ï¼Œæ™‹å‡æ”¿ç­–ä¸€ç›´åœ¨å˜åŒ–ï¼Œå¯¼è‡´è‡ªå·±ä»Šå¹´æ‰æœ‰æ™‹å‡æœºä¼šã€‚&lt;/p&gt;

&lt;p&gt;æŒ‰ç…§å»å¹´çš„æ”¿ç­–ï¼Œä»Šå¹´æ™‹å‡åº”è¯¥å®‰æ’åœ¨ 5ï¼Œ6 æœˆä»½ï¼ˆ2022 å¹´ä¸ŠåŠå¹´ç»©æ•ˆè¯„ä¼°å‰ï¼‰ï¼Œé‚£ä¹ˆè‡ªå·±ä¸ŠåŠå¹´ç†è®ºä¸Šéœ€è¦æŠ•å…¥æ›´å¤šçš„ç²¾åŠ›åœ¨å‡†å¤‡æ™‹å‡ææ–™ï¼Œç­”è¾©ç­‰ï¼›å¯¹ä¸ŠåŠå¹´ç»©æ•ˆç»“æœå¯ä»¥ä¸é‚£ä¹ˆåœ¨æ„ï¼Œå·¥ä½œæ–¹é¢å°±å¯ä»¥æŠ•å…¥è¾ƒå°‘çš„ç²¾åŠ›ï¼›ä½†æ˜¯å†ä¸€æ¬¡å‡ºç°äº†æ™‹å‡æ”¿ç­–è°ƒæ•´ï¼šæ™‹å‡æ—¶é—´è°ƒæ•´åˆ°ä¸‹åŠå¹´ï¼ˆ7ï¼Œ8ï¼Œ9æœˆä»½ï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;å¯¹è‡ªå·±æ¥è¯´ï¼Œä¹‹å‰çš„è§„åˆ’å°±å‡ºç°åå·®ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;2021 å¹´ç»©æ•ˆæ•´ä½“è¿˜è¡Œï¼Œå¦‚æœåªçœ‹ 2021 å¹´ä¸¤æ¬¡ç»©æ•ˆç»“æœï¼Œå¯¹æ™‹å‡æ¦‚ç‡è¿˜æ˜¯æœ‰ä¸€å®šæŠŠæ¡ã€‚&lt;/li&gt;
  &lt;li&gt;è°ƒæ•´ä¸º 2022 å¹´ä¸‹åŠå¹´æ™‹å‡ï¼Œé‚£å°±ä¼šå°† 2022 H1 çš„ç»©æ•ˆçº³å…¥è¯„ä¼°èŒƒå›´ã€‚å¦‚æœ 2022 H1 çš„ç»©æ•ˆä¸€èˆ¬ï¼Œé‚£ä¹ˆè‡ªå·±çš„ç«äº‰åŠ›ä¼šæœ‰æ‰€ä¸‹é™ï¼›å› æ­¤ï¼Œä¹‹å‰åˆ¶å®šçš„åˆ’æ°´ç­–ç•¥è¡Œä¸é€šäº†ï¼Œéœ€è¦åœ¨ 2022 H1 æ‹¿åˆ°ä¸€ä¸ªä¸é”™çš„ç»©æ•ˆæ‰è¡Œã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;äºæ˜¯ï¼Œåœ¨ 202204 è·Ÿ Leader çš„ä¸€æ¬¡ 1 on 1 ä¸­è§„åˆ’äº†ä¸‹æ¥ä¸‹æ¥çš„å·¥ä½œé‡ç‚¹ï¼Œä¸ºäº†åœ¨ 2022H1 æ‹¿åˆ°ä¸€ä¸ªæ»¡æ„çš„ç»©æ•ˆç»“æœï¼Œè‡ªå·±éœ€è¦æ‰¿æ‹…ä¸€é¡¹é‡è¦ç´§æ€¥ä¸”å›°éš¾çš„æ¨åŠ¨å·¥ä½œï¼Œå¦‚æœè¯¥å·¥ä½œäº¤ä»˜ç»“æœè¾¾æˆé¢„æœŸï¼Œé‚£ä¹ˆè‡ªå·±çš„ç»©æ•ˆä¹Ÿä¼šè¾¾åˆ°è‡ªå·±çš„ç›®æ ‡ï¼›åä¹‹åªèƒ½æ‹¿åˆ°ä¸€ä¸ªä¸€èˆ¬çš„ç»©æ•ˆã€‚æ‰€ä»¥ï¼Œåœ¨æ²Ÿé€šä¹‹åï¼Œè‡ªå·±å‡†å¤‡æ”¾æ‰‹ä¸€æäº†ã€‚ç»è¿‡ä¸¤ä¸ªå¤šæœˆçš„æ¨åŠ¨ï¼ŒåŸºæœ¬æŠ•å…¥äº† 100% çš„äººåŠ›ï¼Œå…‹æœå„ç§æœªçŸ¥å›°éš¾ï¼Œæœ€ç»ˆå·¥ä½œè¿›å±•è¶…å‡ºé¢„æœŸï¼Œç»©æ•ˆä¹Ÿè¶…å‡ºäº†é¢„æœŸã€‚&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;æ²¡æƒ³åˆ°è¿™ä¸ªå·¥ä½œåœ¨ä¸‹åŠå¹´è¿˜åœ¨æ¨åŠ¨ï¼Œåªæ˜¯æ–¹å‘æœ‰æ‰€è°ƒæ•´&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;è‡³æ­¤ï¼Œç»©æ•ˆæ–¹é¢å¯ä»¥æˆä¸ºæ¯”è¾ƒå¼ºæœ‰åŠ›çš„æ™‹å‡æ”¯æ’‘ï¼Œæ™‹å‡æˆåŠŸçœ‹èµ·æ¥ä¹Ÿè®¸æ˜¯æ°´åˆ°æ¸ æˆäº†ã€‚ä¸è¿‡ï¼Œæ™‹å‡æ”¿ç­–å†æ¬¡å‡ºç°è°ƒæ•´ï¼Œæ™‹å‡æµç¨‹ï¼Œæ¯”ä¾‹ï¼Œç­”è¾©ç­–ç•¥ç­‰éƒ½å‘ç”Ÿäº†å˜åŒ–ï¼Œæ¯ä¸ªæ­¥éª¤éƒ½éœ€è¦ä¸¥æ ¼å¡æ§æ¯”ä¾‹ã€‚åœ¨è§è¯†åˆ°ä¸€ä¸ªç»©æ•ˆä¼˜ç§€çš„åŒäº‹æå‰è¢«å¡æ‰ä¹‹åï¼Œè‡ªå·±å¯¹æ™‹å‡ç»“æœä¹Ÿä¿æŒäº†æ‚²è§‚æ€åº¦ï¼Œå¼€å§‹ç§¯æå¯»æ±‚å…¶ä»–æœºä¼šäº†ã€‚æ”¿ç­–çš„å¤šæ¬¡è°ƒæ•´ï¼Œè®©è‡ªå·±å¯¹æ•´ä¸ªæ™‹å‡ä½“ç³»æ„Ÿåˆ°å¤±æœ›ï¼Œå¯¹æ¥ä¸‹æ¥çš„å·¥ä½œä¹Ÿè¡¨ç°å‡ºæ¯”è¾ƒæ¶ˆæçš„æ€åº¦ã€‚åœ¨ç¾å›¢ä¸¤å¹´å¤šï¼Œä¸» R äº†å¤šä¸ªé‡ç‚¹å·¥ä½œï¼Œä¹Ÿéƒ½æ‹¿åˆ°äº†è¶…å‡ºé¢„æœŸçš„ç»“æœä¸ç»©æ•ˆï¼Œå¦‚æœæœ€ç»ˆæ™‹å‡å¤±è´¥ï¼Œæˆ‘å¤§æ¦‚ç‡ä¸ä¼šåæ€è‡ªå·±èƒ½åŠ›ä¸å¤Ÿï¼Œæ¯•ç«Ÿæˆ‘åšåˆ°äº†è‡ªå·±èƒ½åšçš„æœ€ä¼˜è§£ã€‚&lt;/p&gt;

&lt;p&gt;æŒç»­ä¸¤ä¸ªå¤šæœˆçš„æ™‹å‡ææ–™å‡†å¤‡ï¼Œç­”è¾©ï¼Œç»“æœç­‰å¾…ï¼Œæœ€ç»ˆæ™‹å‡æˆåŠŸäº†ï¼Œå¹¶ä¸”æ’å Topã€‚&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;å…¶å®ç­”è¾©åˆšç»“æŸçš„æ—¶å€™ï¼ŒLeader åŸºæœ¬å¯ä»¥åˆ¤æ–­å‡ºæˆ‘æ™‹å‡æ²¡é—®é¢˜ï¼Œåªæ˜¯ä¸€ç›´æ²¡è¯´ï¼›åè€Œä»å…¶ä»–å‡ ä¸ª Leader ä¸­å¾—åˆ°ä»¤äººæ»¡æ„çš„åé¦ˆ&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;æ™‹å‡ç»“æœå…¬å¸ƒä¹‹åï¼Œå°±æ˜¯æ™‹å‡è°ƒè–ªäº†ã€‚ä¸å‡ºæ„å¤–ï¼Œåœ¨äº’è”ç½‘æ•´ä½“ä¸æ™¯æ°”çš„æƒ…å†µä¸‹ï¼Œè°ƒè–ªæ¯”ä¾‹ä¸æ˜¯ç‰¹åˆ«é«˜ï¼Œä¸è¿‡è‡ªå·±ä¹Ÿæ‹¿åˆ°äº†åº”è¯¥æ˜¯æœ€é«˜æ¡£çš„æ¯”ä¾‹ï¼Œè¿˜ç®—æ»¡æ„å§ã€‚&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;æ™‹å‡é€šè¿‡åªç»™äº†ç°é‡‘è°ƒæ•´ï¼Œå¹¶æ²¡æœ‰ç»™è‚¡ç¥¨ï¼Œåè€Œåœ¨æ™‹å‡å‰çš„ 4ï¼Œ5 æœˆä»½ç»™äº†èŠèƒœäºæ— çš„è‚¡ç¥¨ï¼Œè®©æˆ‘å¯¹ç¾å›¢çš„æ¿€åŠ±æ”¿ç­–çš„ç†è§£åˆä¸æ¸…æ¥šäº†&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;å›é¡¾æ¥çœ‹ï¼Œç„¦è™‘å¤šåŠæ˜¯ç”±å…¬å¸æ™‹å‡æ”¿ç­–è°ƒæ•´ + ä¸ç¨³é‡çš„å¿ƒæ€å¼•å‘çš„ï¼Œè‡ªå·±æ‰§è¿·äºæ™‹å‡æœ€åˆæ˜¯æƒ³ç»™ä¸¤å¹´å¤šçš„åŠªåŠ›å·¥ä½œä¸€ä¸ªäº¤ä»£ï¼›ä½†æ˜¯ï¼Œè¿™ä¸ªæ‰€è°“çš„äº¤ä»£é‡è¦å—ï¼Œå¦‚æœè‡ªå·±æ™‹å‡å¤±è´¥ï¼Œå¤§ä¸äº†æ˜å¹´å†æ¥æˆ–è€…ç›´æ¥æ¢ä¸€å®¶å…¬å¸ï¼Œè–ªèµ„æ¶¨å¹…è‚¯å®šè¦æ¯”æ™‹å‡å¸¦æ¥çš„å¤šã€‚åœ¨ä¸ Leader  1 on 1 ä¸­ä¹Ÿæåˆ°äº†è‡ªå·±åº”è¯¥æ›´åŠ ç¨³é‡ï¼Œå¯¹äºè¿™ä¸€ç‚¹è¿˜æ˜¯æ¯”è¾ƒè®¤åŒã€‚ä¸ç®¡æ˜¯å·¥ä½œè¿˜æ˜¯ç”Ÿæ´»ï¼Œè‡ªå·±å¾ˆå®¹æ˜“æƒ…ç»ªåŒ–ï¼Œä¸åˆ©äºåç»­çš„å‘å±•æå‡ï¼Œåœ¨æ¥ä¸‹æ¥çš„å·¥ä½œä¸­éœ€è¦åŠªåŠ›æ”¹å˜ã€‚&lt;/p&gt;

&lt;h2 id=&quot;å·¥ä½œ&quot;&gt;å·¥ä½œ&lt;/h2&gt;

&lt;p&gt;ä¸ºäº†åœ¨ 2022H1 æ‹¿åˆ°æ»¡æ„çš„ç»©æ•ˆï¼Œè‡ªå·±æ‰¿æ‹…äº†ä¸€ä¸ªé‡è¦ä»»åŠ¡ï¼Œæ²¡æƒ³åˆ°ç«Ÿç„¶å æ®äº†æˆ‘ä¸€å¹´ 50% ä»¥ä¸Šçš„äººåŠ›æŠ•å…¥ï¼Œå¹¶ä¸”è¿˜å°†è¦åœ¨ 2023 å¹´ç»§ç»­æŠ•å…¥ã€‚&lt;/p&gt;

&lt;p&gt;è¿™ä¸ªå·¥ä½œç®€å•æ¥è¯´å°±æ˜¯å› ä¸ºå„ç§åŸå› éœ€è¦ä¸‹çº¿ä¸€ä¸ªè€ç³»ç»Ÿï¼Œè™½ç„¶ç›®æ ‡æ¯”è¾ƒæ˜ç¡®ï¼Œä½†æ˜¯å…¶ä¸­çš„å„ç§é—®é¢˜æ²¡æœ‰ä¸€ä¸ªæˆç†Ÿçš„ç»éªŒï¼Œåªèƒ½ä¸æ–­æ‘¸ç´¢è°ƒæ•´ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ä¸ŠåŠå¹´çš„æ—¶å€™ï¼Œä¸»è¦ä»¥ A æ–¹å‘å»æ¨åŠ¨ï¼Œéœ€è¦ä¸å…¬å¸å†…éƒ¨å¤§éƒ¨åˆ†ä¸šåŠ¡è¿›è¡Œæ²Ÿé€šã€‚ä¸ºäº†é™ä½ä¸šåŠ¡é£é™©åŠæˆæœ¬ï¼Œéœ€è¦åšå¾ˆå¤šå‰æœŸå‡†å¤‡å·¥ä½œï¼ŒäººåŠ›æŠ•å…¥éå¸¸å¤§ã€‚å¥½åœ¨ä¸­åæœŸä¸ä¸€äº›å¹³å°æ–¹å»ºç«‹äº†åˆä½œå…³ç³»ï¼Œå¤šæ–¹ä¸€èµ·å»æ¨åŠ¨ï¼Œæœ€ç»ˆæ‹¿åˆ°ä¸€ä¸ªæ»¡æ„çš„ç»“æœã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ä¸‹åŠå¹´çš„æ—¶å€™ï¼Œæ„è¯†åˆ° A æ–¹å‘å¯¹æœ€ç»ˆç›®æ ‡è¾¾æˆå½±å“è¾ƒå°ï¼Œç»è¿‡å¤šæ¬¡è®¨è®ºï¼Œæœ€ç»ˆè°ƒæ•´ä¸º B æ–¹å‘ã€‚æ­¤æ—¶æ¶‰åŠçš„ä¸šåŠ¡åŸºæœ¬æ˜¯å…¬å¸æ‰€æœ‰ä¸šåŠ¡äº†ï¼Œå…¶ä¸­çš„ä¸šåŠ¡é£é™©æ›´å¤§ã€‚ä¸ºäº†é™ä½é£é™©ï¼Œåˆ¶å®šäº†å¤šé˜¶æ®µç­–ç•¥ï¼Œå…ˆè§£å†³ä½é£é™©ä¸šåŠ¡ï¼Œå†æ¨åŠ¨é«˜é£é™©ä¸šåŠ¡ã€‚è™½ç„¶æœ€ç»ˆç»“æœä¸æ—¢å®šç›®æ ‡æœ‰æ‰€åå·®ï¼Œä½†æ˜¯æ•´ä½“è¿˜æ˜¯æœ‰äº†é•¿è¶³çš„è¿›æ­¥ï¼Œæ‹¿åˆ°ä¸€å®šçš„æˆæœã€‚&lt;/p&gt;

&lt;p&gt;è¿™ä¸ªè€ç³»ç»Ÿä¸‹çº¿å·¥ä½œä¹‹å‰æŒç»­äº†1ï¼Œ2 å¹´ï¼Œä½†æ˜¯è¿›å±•ç¼“æ…¢ï¼Œå¹¶ä¸”åç»­å¦‚ä½•ä¸‹çº¿ä¸€ç›´æ²¡æœ‰æ˜ç¡®çš„æ–¹æ¡ˆã€‚è‡ªå·±æ¥æ‰‹ä¹‹åï¼Œä¹Ÿæ˜¯æŠ±ç€æ­»é©¬å½“æ´»é©¬åŒ»çš„æ€åº¦ï¼Œåšå¾—äº†å°±åšï¼Œåšä¸äº†å°±ç®—äº†ã€‚ç”±äºä¸‹çº¿é£é™©é«˜ï¼Œå†å²åŒ…è¢±é‡ï¼Œæ¶‰åŠä¸šåŠ¡é¢å¹¿ï¼Œä¸šåŠ¡æƒ…å†µå¤æ‚ç­‰å„ç§åŸå› ï¼Œè‡ªå·±åœ¨æ¨åŠ¨å‰åšäº†å¾ˆå¤šå‡†å¤‡å·¥ä½œï¼Œä½†æ˜¯å¯¹çœŸæ­£çš„å®æ–½æ–¹æ¡ˆå¹¶æ²¡æœ‰æŠŠæ¡ï¼Œåªèƒ½èµ°ä¸€æ­¥çœ‹ä¸€æ­¥ï¼Œéšæ—¶è°ƒæ•´ç­–ç•¥ã€‚åœ¨é‚£æ®µæ—¶é—´é‡Œï¼Œè‡ªå·±ä¹Ÿæ˜¯ç¡çœ ä¸è¶³ï¼Œæ€»æ˜¯æƒ³ç€å¦‚ä½•å°½å¿«æ‹¿åˆ°ç»“æœã€‚å¥½åœ¨æœ€ç»ˆè¿›å±•å¾—åˆ°å¤šæ–¹é¢çš„è®¤å¯ï¼ŒåŠªåŠ›ä»˜å‡ºä¹Ÿå¾—åˆ°äº†å›æŠ¥ã€‚&lt;/p&gt;

&lt;p&gt;å›æƒ³ä¸€ä¸‹ï¼Œè¿™ä¸ªå·¥ä½œå¾ˆéš¾ï¼Œè®©è‡ªå·±èº«å¿ƒç–²æƒ«ï¼Œä½†æ˜¯ä¹Ÿç¡®å®å› æ­¤æ”¶è·é¢‡ä¸°ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ä¸­é•¿æœŸä»»åŠ¡è§„åˆ’èƒ½åŠ›æå‡&lt;/li&gt;
  &lt;li&gt;ä¸šåŠ¡æ²Ÿé€šèƒ½åŠ›æå‡&lt;/li&gt;
  &lt;li&gt;æ»¡æ„çš„ç»©æ•ˆç»“æœ&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;ç”Ÿæ´»&quot;&gt;ç”Ÿæ´»&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;ç–«æƒ…&lt;/p&gt;

    &lt;p&gt;2022 å¹´åˆï¼Œä¸Šæµ·å› ä¸ºç–«æƒ…å°æ§äº† 3 ä¸ªå¤šæœˆï¼Œè‡ªå·±ä¸€ä¸ªäººåœ¨å‡ºç§Ÿå±‹é‡Œå°é—­äº† 3 ä¸ªå¤šæœˆã€‚å›æƒ³è¿™æ®µæ—¶é—´ï¼ŒçœŸæ˜¯ç…ç†¬ï¼Œæ¯å¤©åƒç€ç›¸åŒä¸”å‘³é“å¯¡æ·¡çš„é¥­èœï¼Œè¿˜è¦æ‹…å¿ƒæ˜å¤©èƒ½ä¸èƒ½åƒé¥±ï¼Œè¯¦ç»†è§„åˆ’æ¯å¤©çš„é£Ÿç‰©é‡ï¼Œæ¯å¤©æ—©æ™¨å‡†æ—¶æŠ¢èœï¼Œåˆ‡èº«ä½“ä¼šåˆ°ç²®é£Ÿçš„é‡è¦æ€§ã€‚ä¸€ç²’ç±³çœŸçš„èƒ½é¥¿æ­»ä¸€ä¸ªå›½å®¶ã€‚&lt;/p&gt;

    &lt;p&gt;è§£å°ä¹‹åï¼Œç”±äºå„åœ°æ”¿ç­–é™åˆ¶ï¼Œæ— æ³•è‡ªç”±å‡ºå…¥ï¼Œä¸€äº›äº‹æƒ…å¹¶æ²¡æœ‰æŒ‰ç…§é¢„æœŸåœ¨å‘å±•ã€‚&lt;/p&gt;

    &lt;p&gt;2022 å¹´å°¾ï¼Œå…¨å›½ç–«æƒ…ç®¡æ§æ”¾å¼€ï¼Œä¸å‡ºæ„å¤–åœ°æ„ŸæŸ“äº†ï¼Œå¹¸è¿çš„æ˜¯ç—‡çŠ¶ä¸æ˜¯å¾ˆä¸¥é‡ï¼Œå¤§æ¦‚ä¸‰å¤©å°±æ¢å¤äº†ã€‚&lt;/p&gt;

    &lt;p&gt;å› ä¸ºç–«æƒ…ï¼Œ2022 å¹´å˜å¾—å¾ˆé­”å¹»ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;å¥³æœ‹å‹&lt;/p&gt;

    &lt;p&gt;å¥³æœ‹å‹ä»Šå¹´æ¯•ä¸šï¼Œä¸€ç›´åœ¨å‡†å¤‡è€ƒç¼–ã€‚æœŸé—´æœ‰å¸Œæœ›ï¼Œæœ‰æŒ«è´¥ï¼Œå¥¹è¿™ä¸€å¹´æ¯”æˆ‘æ›´ç„¦è™‘ï¼Œå‹åŠ›ä¹Ÿæ›´å¤§ã€‚å¥½åœ¨æœ€ç»ˆè€ƒä¸Šäº†ç›¸å¯¹æ¯”è¾ƒæ»¡æ„çš„å•ä½ï¼Œä¹Ÿè¦å¼€å§‹ä¸‹ä¸€æ®µäººç”Ÿæ—…ç¨‹ã€‚&lt;/p&gt;

    &lt;p&gt;ä»Šå¹´æˆ‘ä»¬éƒ½å†æ¬¡è§äº†åŒæ–¹çˆ¶æ¯ï¼Œæ„Ÿæƒ…ä¹Ÿæ›´è¿›äº†ä¸€æ­¥ï¼Œä¸€åˆ‡éƒ½åœ¨ç¨³æ­¥å‰è¿›ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;å­¦ä¹ &lt;/p&gt;

    &lt;p&gt;ä»Šå¹´ä¸“ä¸šçŸ¥è¯†å­¦ä¹ ä¸»è¦é›†ä¸­åœ¨ä¸ŠåŠå¹´ï¼Œä¸»è¦é›†ä¸­åœ¨åˆ†å¸ƒå¼ç³»ç»ŸåŠ Linux å†…æ ¸ï¼Œçœ‹çš„è®ºæ–‡æ¯”é¢„æœŸå°‘ã€‚ä¸‹åŠå¹´æ›´ä¸“æ³¨å·¥ä½œä¸ç”Ÿæ´»ï¼ŒåŸºæœ¬æ²¡æœ‰ä¸“ä¸šçŸ¥è¯†çš„å­¦ä¹ ã€‚&lt;/p&gt;

    &lt;blockquote&gt;
      &lt;p&gt;ä¸ŠåŠå¹´ç¿»è¯‘äº†ä¸€ç¯‡è¯¾ç¨‹ï¼Œå¹¶åœ¨å…¬å¸å†…åˆ†äº«äº†&lt;/p&gt;

    &lt;/blockquote&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;é”»ç‚¼&lt;/p&gt;

    &lt;p&gt;åœ¨ 2022 å¹´å°¾æ„ŸæŸ“æ–°å† ä¹‹å‰ï¼Œä¸€ç›´ä¿æŒé”»ç‚¼ï¼Œèº«æä¹Ÿæ¯”è¾ƒç¨³å®šã€‚é˜³åº·ä¹‹åï¼Œå†ä¹Ÿæ²¡æœ‰é‡æ–°é”»ç‚¼äº†ï¼Œé¢„è®¡ç­‰è¿‡å¹´å›æ¥é‡æ–°å¼€å§‹ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;æŠ•èµ„&lt;/p&gt;

    &lt;p&gt;ä»¥åŸºé‡‘ä¸ºä¸»ï¼Œæš‚æ—¶å°‘é‡æŠ•å…¥ï¼Œé•¿æœŸæŒæœ‰ï¼Œæ•´ä½“ä¸äºä¸ç›ˆã€‚&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;</content><author><name>kkzhang</name></author><category term="annual-summary" /><summary type="html">æ¥ä¸Šæµ·ä¸‰å¹´å¤šï¼Œç¬¬ä¸€æ¬¡ï¼ˆ2023-01-15ï¼‰è§åˆ°é‚£ä¹ˆå¤§çš„é›ª</summary></entry><entry><title type="html">ä¾›ç»™ï¼Œéœ€æ±‚ä¸æ”¿åºœæ”¿ç­–</title><link href="http://localhost:4000/principles-of-economics-3.html" rel="alternate" type="text/html" title="ä¾›ç»™ï¼Œéœ€æ±‚ä¸æ”¿åºœæ”¿ç­–" /><published>2022-10-22T00:00:00+08:00</published><updated>2022-10-22T00:00:00+08:00</updated><id>http://localhost:4000/principles-of-economics-3</id><content type="html" xml:base="http://localhost:4000/principles-of-economics-3.html">&lt;h1 id=&quot;ä»·æ ¼æ§åˆ¶&quot;&gt;ä»·æ ¼æ§åˆ¶&lt;/h1&gt;

&lt;p&gt;åœ¨ä¸€ä¸ªæ²¡æœ‰æ”¿åºœç®¡åˆ¶çš„ç«äº‰å¸‚åœºä¸Šï¼Œå†°æ·‡æ·‹çš„ä»·æ ¼å°†è‡ªå‘è°ƒæ•´ï¼Œä½¿å¾—ä¾›æ±‚è¾¾åˆ°å¹³è¡¡ï¼šå‡è¡¡ä»·æ ¼æ—¶ï¼Œä¹°è€…æƒ³ä¹°çš„å†°æ·‡æ·‹æ•°ç›®ç­‰äºå–è€…æƒ³å–çš„å†°æ·‡æ·‹æ•°ç›®ã€‚&lt;/p&gt;

&lt;p&gt;ä¸è¿‡ï¼Œæ”¿åºœå¯ä»¥å¯¹å†°æ·‡æ·‹çš„ä»·æ ¼è¿›è¡Œæ§åˆ¶ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;ä»·æ ¼ä¸Šé™&lt;/strong&gt;ï¼šå‡ºå”®ä¸€ç§ç‰©å“çš„æ³•å®šæœ€é«˜ä»·æ ¼&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;ä»·æ ¼ä¸‹é™&lt;/strong&gt;ï¼šå‡ºå”®ä¸€ç§ç‰©å“çš„æ³•å®šæœ€ä½ä»·æ ¼&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;ä»·æ ¼ä¸Šé™å¯¹å¸‚åœºçš„å½±å“&quot;&gt;ä»·æ ¼ä¸Šé™å¯¹å¸‚åœºçš„å½±å“&lt;/h2&gt;

&lt;p&gt;å‡è®¾åœ¨æ²¡æœ‰æ”¿åºœå¹²é¢„çš„æƒ…å†µä¸‹ï¼Œå†°æ·‡æ·‹çš„å‡è¡¡ä»·æ ¼ä¸º 3 ç¾å…ƒã€‚&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;éé™åˆ¶æ€§ä»·æ ¼ä¸Šé™&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;å‡è®¾ä»·æ ¼ä¸Šé™ä¸º 4 ç¾å…ƒï¼Œæ­¤æ—¶å‡è¡¡ä»·æ ¼ä½äºä»·æ ¼ä¸Šé™ï¼Œé‚£ä¹ˆè¯¥ä»·æ ¼ä¸Šé™æ˜¯éé™åˆ¶æ€§çš„ï¼Œ&lt;strong&gt;ä»·æ ¼ä¸Šé™å¯¹ä»·æ ¼æˆ–è€…é”€å”®é‡æ²¡æœ‰å½±å“&lt;/strong&gt;ã€‚&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/economics/chap6/eco_1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;é™åˆ¶æ€§ä»·æ ¼ä¸Šé™&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;å‡è®¾ä»·æ ¼ä¸Šé™ä¸º 2 ç¾å…ƒï¼Œæ­¤æ—¶å‡è¡¡ä»·æ ¼é«˜äºä»·æ ¼ä¸Šé™ï¼Œé‚£ä¹ˆè¯¥ä»·æ ¼ä¸Šé™æ˜¯é™åˆ¶æ€§çš„ã€‚&lt;/p&gt;

    &lt;p&gt;è¿™ç§æƒ…å†µä¸‹ï¼Œ&lt;strong&gt;ä¾›ç»™å°äºéœ€æ±‚ï¼Œå†°æ·‡æ·‹å‡ºç°çŸ­ç¼º&lt;/strong&gt;ã€‚&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/economics/chap6/eco_2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

    &lt;p&gt;å½“ç”±äºä»·æ ¼ä¸Šé™è€Œå¯¼è‡´çŸ­ç¼ºæ—¶ï¼Œä¸€äº›é…ç»™æœºåˆ¶ä¼šå‡ºç°ï¼š&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;è´­ä¹°è€…æ’é•¿é˜Ÿï¼Œæ„¿æ„æå‰æ¥å¹¶ç­‰å€™çš„äººå¯ä»¥ä¹°åˆ°å†°æ·‡æ·‹&lt;/li&gt;
      &lt;li&gt;å–è€…æ ¹æ®è‡ªå·±çš„åå¥½æ¥é…ç»™å†°æ·‡æ·‹&lt;/li&gt;
    &lt;/ul&gt;

    &lt;blockquote&gt;
      &lt;p&gt;è®¾ç½®ä»·æ ¼ä¸Šé™çš„åŠ¨æœºæ˜¯ä¸ºäº†å¸®åŠ©ä¹°è€…ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯æ‰€æœ‰ä¹°è€…éƒ½èƒ½ä»ä¸­å—ç›Šï¼Œå­˜åœ¨ä¸€äº›ä¹°è€…æ ¹æœ¬ä¹°ä¸åˆ°å†°æ·‡æ·‹&lt;/p&gt;

    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;ç»“è®ºï¼š&lt;strong&gt;å½“æ”¿åºœå¯¹ç«äº‰å¸‚åœºå®è¡Œé™åˆ¶æ€§ä»·æ ¼ä¸Šé™æ—¶ï¼Œå°±äº§ç”Ÿäº†ç‰©å“çŸ­ç¼ºï¼Œè€Œä¸”å–è€…å¿…é¡»åœ¨å¤§é‡æ½œåœ¨ä¹°è€…ä¸­é…ç»™ç¨€ç¼ºå•†å“&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;åœ¨è‡ªç”±å¸‚åœºä¸­ï¼Œä»·æ ¼ç”¨æ¥é…ç»™å•†å“&lt;/p&gt;

&lt;/blockquote&gt;

&lt;h2 id=&quot;ä»·æ ¼ä¸‹é™å¯¹å¸‚åœºçš„å½±å“&quot;&gt;ä»·æ ¼ä¸‹é™å¯¹å¸‚åœºçš„å½±å“&lt;/h2&gt;

&lt;p&gt;å‡è®¾åœ¨æ²¡æœ‰æ”¿åºœå¹²é¢„çš„æƒ…å†µä¸‹ï¼Œå†°æ·‡æ·‹çš„å‡è¡¡ä»·æ ¼ä¸º 3 ç¾å…ƒã€‚&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;éé™åˆ¶æ€§ä»·æ ¼ä¸‹é™&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;å‡è®¾ä»·æ ¼ä¸‹é™ä¸º 2 ç¾å…ƒï¼Œä½äºå‡è¡¡ä»·æ ¼ï¼Œæ­¤æ—¶ä»·æ ¼ä¸‹é™æ²¡æœ‰é™åˆ¶ä½œç”¨ï¼›å¸‚åœºåŠ›é‡è‡ªç„¶åœ°ä½¿ä»·æ ¼å‘å‡è¡¡ä»·æ ¼ç§»åŠ¨ã€‚&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/economics/chap6/eco_3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;é™åˆ¶æ€§ä»·æ ¼ä¸‹é™&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;å‡è®¾ä»·æ ¼ä¸‹é™ä¸º 4 ç¾å…ƒï¼Œé«˜äºå‡è¡¡ä»·æ ¼ï¼Œæ­¤æ—¶ä»·æ ¼ä¸‹é™å­˜åœ¨é™åˆ¶æ€§çº¦æŸã€‚&lt;/p&gt;

    &lt;p&gt;è¿™ç§æƒ…å†µä¸‹ï¼Œ&lt;strong&gt;ä¾›ç»™å¤§äºéœ€æ±‚ï¼Œå†°æ·‡æ·‹å‡ºç°è¿‡å‰©&lt;/strong&gt;ã€‚&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/economics/chap6/eco_4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

    &lt;p&gt;ä»·æ ¼ä¸‹é™å¼•å‘çš„è¿‡å‰©ä¹Ÿä¼šå¯¼è‡´ä¸åˆæ„çš„é…ç»™æœºåˆ¶ï¼š&lt;/p&gt;

    &lt;ul&gt;
      &lt;li&gt;ä¹°è€…ç”±äºä¸ªäººåå¥½å¯ä»¥é€‰æ‹©äº§å“&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;å¯¹ä»·æ ¼æ§åˆ¶çš„è¯„ä»·&quot;&gt;å¯¹ä»·æ ¼æ§åˆ¶çš„è¯„ä»·&lt;/h2&gt;

&lt;p&gt;åœ¨ç»æµå­¦ä¸­ï¼Œä»·æ ¼æ—¶éšè—åœ¨ä¾›ç»™æ›²çº¿å’Œéœ€æ±‚æ›²çº¿èƒŒåçš„åƒç™¾ä¸‡ä¼ä¸šå’Œæ¶ˆè´¹è€…å†³ç­–çš„ç»“æœï¼Œä»·æ ¼æœ‰å¹³è¡¡ä¾›æ±‚ä»è€Œåè°ƒç»æµæ´»åŠ¨çš„å…³é”®ä½œç”¨ã€‚&lt;em&gt;å½“å†³ç­–è€…é€šè¿‡æ³•ä»¤ç¡®å®šä»·æ ¼æ—¶ï¼Œå°±æ¨¡ç³Šäº†æ­£å¸¸æƒ…å†µä¸‹æŒ‡å¼•ç¤¾ä¼šèµ„æºé…ç½®çš„ä¿¡å·&lt;/em&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ä»·æ ¼æ§åˆ¶çš„ç›®æ ‡å¾€å¾€æ˜¯å¸®åŠ©ç©·äººï¼Œä½†æ˜¯&lt;strong&gt;å¾€å¾€ä¼šæŸå®³å“ªäº›å®ƒæœ¬æƒ³å¸®åŠ©çš„äºº&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ç§Ÿé‡‘æ§åˆ¶å¯ä»¥ä¿æŒä½ç§Ÿé‡‘ï¼Œä½†æ˜¯æ— æ³•é¼“åŠ±æˆ¿ä¸œä¿®ç¼®ä½æˆ¿ï¼Œå¹¶ä½¿æ‰¾æˆ¿å˜å¾—å›°éš¾&lt;/li&gt;
  &lt;li&gt;æœ€ä½å·¥èµ„å¯ä»¥å¢åŠ ä¸€äº›å·¥äººçš„æ”¶å…¥ï¼Œä½†æ˜¯ä¹Ÿä¼šä½¿å…¶ä»–å·¥äººæˆä¸ºå¤±ä¸šè€…&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;ç¨æ”¶&quot;&gt;ç¨æ”¶&lt;/h1&gt;

&lt;p&gt;å½“æ”¿åºœå¯¹ä¸€ç§ç‰©å“å¾ç¨æ—¶ï¼Œè°å®é™…ä¸Šæ‰¿æ‹…äº†ç¨æ”¶è´Ÿæ‹…ï¼Ÿä¹°è€…ï¼Ÿå–è€…ï¼Ÿè¿˜æ˜¯ä¸¤è€…å…±åŒæ‰¿æ‹…ï¼Ÿ&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ç¨æ”¶å½’å®¿&lt;/strong&gt;ï¼ˆtax incidenceï¼‰æ˜¯æŒ‡ç¨æ”¶è´Ÿæ‹…å¦‚ä½•åœ¨ç»„æˆå¸‚åœºçš„ä¸åŒäººä¹‹é—´åˆ†é…ã€‚&lt;/p&gt;

&lt;h2 id=&quot;å‘å–è€…å¾ç¨å¯¹å¸‚åœºçš„å½±å“&quot;&gt;å‘å–è€…å¾ç¨å¯¹å¸‚åœºçš„å½±å“&lt;/h2&gt;

&lt;p&gt;å‡è®¾æ”¿åºœè§„å®šï¼Œå‘å†°æ·‡æ·‹å–è€…å–å‡ºçš„æ¯ä¸ªå†°æ·‡æ·‹å¾æ”¶ 0.5 ç¾å…ƒçš„ç¨æ”¶ã€‚é‚£ä¹ˆå°†å¦‚ä½•å½±å“å–è€…å’Œä¹°è€…ï¼Ÿ&lt;/p&gt;

&lt;p&gt;å¯ä»¥æŒ‰ç…§åˆ†æä¾›æ±‚çš„ä¸‰ä¸ªæ­¥éª¤ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;ç¡®å®šè¯¥æ³•å¾‹å½±å“çš„æ˜¯ä¾›ç»™æ›²çº¿è¿˜æ˜¯éœ€æ±‚æ›²çº¿&lt;/li&gt;
  &lt;li&gt;ç¡®å®šæ›²çº¿ç§»åŠ¨çš„æ–¹å‘&lt;/li&gt;
  &lt;li&gt;è€ƒå¯Ÿè¿™ç§ç§»åŠ¨å¦‚ä½•å½±å“å‡è¡¡ä»·æ ¼å’Œæ•°é‡&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;img src=&quot;/images/economics/chap6/eco_5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç¬¬ä¸€æ­¥ï¼šç¨æ”¶å¯¹å–è€…äº§ç”Ÿç›´æ¥å½±å“ï¼Œå› æ­¤ä½¿&lt;strong&gt;ä¾›ç»™æ›²çº¿ç§»åŠ¨&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ç¬¬äºŒæ­¥ï¼šå¯¹å–è€…å¾ç¨æé«˜äº†ç”Ÿäº§å’Œé”€å”®å†°æ·‡æ·‹çš„æˆæœ¬ï¼Œå› æ­¤å¾ç¨å‡å°‘äº†æ¯ä¸€ç§ä»·æ ¼ä¸‹çš„ä¾›ç»™é‡ï¼Œä½¿&lt;strong&gt;ä¾›ç»™æ›²çº¿å·¦ç§»ï¼ˆæˆ–è€…è¯´ä¸Šç§»ï¼‰&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ä¾›ç»™æ›²çº¿ç§»åŠ¨å¹…åº¦ï¼šåœ¨æ¯ä¸€ç§ä¾›ç»™é‡ä¸‹ï¼Œå–è€…å¿…é¡»å°†ä»·æ ¼æé«˜ 0.5 ç¾å…ƒï¼Œä»¥ä¾¿å¼¥è¡¥ç¨æ”¶çš„å½±å“ã€‚å› æ­¤ï¼Œä¾›ç»™æ›²çº¿ä» S1 å‘ä¸Šç§»åŠ¨åˆ° S2ï¼Œ&lt;strong&gt;ç§»åŠ¨å¹…åº¦æ­£å¥½æ˜¯ç¨æ”¶é‡&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ç¬¬ä¸‰æ­¥ï¼šåœ¨æ–°å¹³è¡¡ä¸‹ï¼Œå†°æ·‡æ·‹ä»·æ ¼ç”± 3 ç¾å…ƒä¸Šå‡ä¸º 3.3 ç¾å…ƒï¼›å‡è¡¡æ•°é‡ç”± 100 ä¸ªå‡å°‘åˆ° 90 ä¸ªã€‚å–è€…çš„é”€å”®é‡å‡å°‘äº†ï¼Œä¹°è€…çš„è´­ä¹°é‡ä¹Ÿå‡å°‘äº†ï¼Œå› æ­¤&lt;strong&gt;ç¨æ”¶ç¼©å°äº†å†°æ·‡æ·‹å¸‚åœºçš„è§„æ¨¡&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;å›åˆ°ç¨æ”¶å½’å®¿é—®é¢˜ï¼Œè°æ”¯ä»˜äº†ç¨æ”¶ï¼Ÿ&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ä¹°è€…ï¼šè´­ä¹°ä»·æ ¼å¢åŠ äº† 0.3 ç¾å…ƒ&lt;/li&gt;
  &lt;li&gt;å–è€…ï¼šé”€å”®ä»·æ ¼è™½ç„¶ä¸º 3.3 ç¾å…ƒï¼Œä½†æ˜¯äº¤ç¨åçš„æœ‰æ•ˆä»·æ ¼ä¸º 3.3 - 0.5 = 2.8 ç¾å…ƒï¼Œæ¯”ä¹‹å‰çš„ 3 ç¾å…ƒå°‘äº† 0.2 ç¾å…ƒ&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºä¸¤ä¸ªç»“è®ºï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;ç¨æ”¶æŠ‘åˆ¶äº†å¸‚åœºæ´»åŠ¨&lt;/strong&gt;ï¼šç‰©å“åœ¨æ–°å‡è¡¡çš„é”€å”®é‡å‡å°‘äº†&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;ä¹°è€…ä¸å–è€…åˆ†æ‘Šäº†ç¨æ”¶è´Ÿæ‹…&lt;/strong&gt;ï¼šåœ¨æ–°å‡è¡¡æ—¶ï¼Œä¹°è€…æ”¯ä»˜æ›´å¤šï¼Œå–è€…å¾—åˆ°æ›´å°‘&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;å‘ä¹°è€…å¾ç¨å¯¹å¸‚åœºçš„å½±å“&quot;&gt;å‘ä¹°è€…å¾ç¨å¯¹å¸‚åœºçš„å½±å“&lt;/h2&gt;

&lt;p&gt;å‡è®¾æ”¿åºœè§„å®šï¼Œå‘å†°æ·‡æ·‹ä¹°è€…è´­ä¹°çš„æ¯ä¸ªå†°æ·‡æ·‹å¾æ”¶ 0.5 ç¾å…ƒçš„ç¨æ”¶ã€‚é‚£ä¹ˆå°†å¦‚ä½•å½±å“å–è€…å’Œä¹°è€…ï¼Ÿ&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/economics/chap6/eco_6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä»ç„¶æŒ‰ç…§ä¸‰ä¸ªæ­¥éª¤åˆ†æï¼š&lt;/p&gt;

&lt;p&gt;ç¬¬ä¸€æ­¥ï¼šå‘ä¹°è€…å¾ç¨ï¼Œç›´æ¥å½±å“éœ€æ±‚ï¼Œä½¿å¾—&lt;strong&gt;éœ€æ±‚æ›²çº¿ç§»åŠ¨&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ç¬¬äºŒæ­¥ï¼šå¾ç¨ä½¿ä¹°è€…åœ¨æ¯ä¸€ä»·æ ¼ä¸‹çš„å†°æ·‡æ·‹çš„éœ€æ±‚é‡å‡å°‘ï¼Œä½¿å¾—éœ€&lt;strong&gt;æ±‚æ›²çº¿å‘å·¦ç§»åŠ¨ï¼ˆæˆ–è€…è¯´å‘ä¸‹ç§»åŠ¨ï¼‰&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;éœ€æ±‚æ›²çº¿ç§»åŠ¨å¹…åº¦ï¼šä¹°è€…å…³æ³¨çš„æ˜¯åŒ…æ‹¬ç¨æ”¶åœ¨å†…çš„æ€»æˆæœ¬ï¼Œå› æ­¤åœ¨æ¯ä¸€ç§éœ€æ±‚é‡ä¸‹ï¼Œå¸‚åœºä»·æ ¼å¿…é¡»é™ä½ 0.5 ç¾å…ƒï¼Œä»¥å¼¥è¡¥ç¨æ”¶çš„å½±å“ã€‚å› æ­¤ï¼Œç¨æ”¶ä½¿éœ€æ±‚æ›²çº¿ä» D1 å‘ä¸‹ç§»åŠ¨åˆ° D2ï¼Œç§»åŠ¨å¹…åº¦æ­£å¥½æ˜¯ç¨æ”¶é‡ï¼ˆ0.5 ç¾å…ƒï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;ç¬¬ä¸‰æ­¥ï¼šåœ¨æ–°å¹³è¡¡ä¸‹ï¼Œå‡è¡¡ä»·æ ¼ç”± 3 ç¾å…ƒä¸‹é™åˆ° 2.8 ç¾å…ƒï¼›å‡è¡¡æ•°é‡ç”± 100 ä¸‹é™åˆ° 90ï¼Œå†°æ·‡æ·‹å¸‚åœºè§„æ¨¡ç¼©å°ã€‚åŒæ—¶ï¼Œä¹°è€…ä¸å–è€…åˆ†æ‘Šäº†ç¨æ”¶è´Ÿæ‹…ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ä¹°è€…ï¼šè´­ä¹°æˆæœ¬ 2.8 + 0.5 = 3.3 ç¾å…ƒ&lt;/li&gt;
  &lt;li&gt;å–è€…ï¼šé”€å”®ä»·æ ¼ç”± 3 ç¾å…ƒé™ä½åˆ° 2.8 ç¾å…ƒ&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ç»“è®ºï¼š&lt;strong&gt;å¯¹å–è€…å¾ç¨å’Œå¯¹ä¹°è€…å¾ç¨ä½¿ç›¸åŒçš„ï¼šåœ¨æ–°å‡è¡¡ä¸‹ï¼Œä¹°è€…å’Œå–è€…å…±åŒæ‰¿æ‹…äº†ç¨æ”¶è´Ÿæ‹…&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;h2 id=&quot;å¼¹æ€§ä¸ç¨æ”¶å½’å®¿&quot;&gt;å¼¹æ€§ä¸ç¨æ”¶å½’å®¿&lt;/h2&gt;

&lt;p&gt;å¯¹ç‰©å“å¾ç¨æ—¶ï¼Œç”±å–è€…ä¸ä¹°è€…å…±åŒåˆ†æ‘Šç¨æ”¶è´Ÿæ‹…ï¼Œä½†æ˜¯å¦‚ä½•å‡†ç¡®åˆ’åˆ†ï¼Ÿ&lt;/p&gt;

&lt;p&gt;ç¨æ”¶è´Ÿæ‹…æ›´å¤šåœ°è½åœ¨ç¼ºä¹å¼¹æ€§çš„å¸‚åœºä¸€æ–¹èº«ä¸Šï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;å½“ä¾›ç»™æ¯”éœ€æ±‚æ›´å¯Œæœ‰å¼¹æ€§æ—¶ï¼Œç¨æ”¶æ›´å¤šåœ°ç”±æ¶ˆè´¹è€…æ‰¿æ‹…&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/economics/chap6/eco_7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;å½“éœ€æ±‚æ¯”ä¾›ç»™æ›´å¯Œæœ‰å¼¹æ€§æ—¶ï¼Œç¨æ”¶æ›´å¤šåœ°ç”±ç”Ÿäº§è€…æ‰¿æ‹…&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/economics/chap6/eco_8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;æ€»ç»“&quot;&gt;æ€»ç»“&lt;/h1&gt;

&lt;ol&gt;
  &lt;li&gt;ä»·æ ¼ä¸Šé™æ˜¯æŸç§ç‰©å“ä¸æœåŠ¡çš„æ³•å®šæœ€é«˜ä»·æ ¼ï¼›ä»·æ ¼ä¸‹é™æ˜¯æŸç§ç‰©å“ä¸æœåŠ¡çš„æ³•å®šæœ€ä½ä»·æ ¼&lt;/li&gt;
  &lt;li&gt;å½“æ”¿åºœå¯¹ä¸€ç§ç‰©å“å¾æ”¶ç¨æ”¶æ—¶ï¼Œè¯¥ç‰©å“çš„å‡è¡¡æ•°é‡å‡å°‘ï¼Œå¸‚åœºè§„æ¨¡ç¼©å°&lt;/li&gt;
  &lt;li&gt;ç¨æ”¶å½’å®¿å¹¶ä¸å–å†³äºå‘å–è€…å¾ç¨è¿˜æ˜¯å‘ä¹°è€…å¾ç¨ï¼›ç¨æ”¶å½’å®¿å–å†³äºä¾›ç»™å’Œéœ€æ±‚çš„ä»·æ ¼å¼¹æ€§ï¼Œç¨æ”¶è´Ÿæ‹…æ›´å¤šåœ°è½åœ¨ç¼ºä¹å¼¹æ€§çš„å¸‚åœºä¸€æ–¹&lt;/li&gt;
&lt;/ol&gt;</content><author><name>kkzhang</name></author><category term="economics" /><summary type="html">ä»·æ ¼æ§åˆ¶</summary></entry><entry><title type="html">ä¾›ç»™ä¸éœ€æ±‚çš„å¸‚åœºåŠ›é‡</title><link href="http://localhost:4000/principles-of-economics-2.html" rel="alternate" type="text/html" title="ä¾›ç»™ä¸éœ€æ±‚çš„å¸‚åœºåŠ›é‡" /><published>2022-07-21T00:00:00+08:00</published><updated>2022-07-21T00:00:00+08:00</updated><id>http://localhost:4000/principles-of-economics-2</id><content type="html" xml:base="http://localhost:4000/principles-of-economics-2.html">&lt;p&gt;&lt;strong&gt;ä¾›ç»™&lt;/strong&gt;ä¸&lt;strong&gt;éœ€æ±‚&lt;/strong&gt;æ˜¯ä½¿å¸‚åœºç»æµè¿è¡Œçš„åŠ›é‡ï¼Œå®ƒä»¬å†³å®šäº†æ¯ç§ç‰©å“çš„äº§é‡åŠå‡ºå”®ä»·æ ¼ã€‚&lt;/p&gt;

&lt;h1 id=&quot;å¸‚åœºä¸ç«äº‰&quot;&gt;å¸‚åœºä¸ç«äº‰&lt;/h1&gt;

&lt;p&gt;ä¾›ç»™ä¸éœ€æ±‚è¿™ä¸¤ä¸ªæœ¯è¯­æ˜¯æŒ‡äººä»¬åœ¨&lt;strong&gt;ç«äº‰å¸‚åœº&lt;/strong&gt;ä¸Šç›¸äº’äº¤æ˜“æ—¶çš„è¡Œä¸ºã€‚&lt;/p&gt;

&lt;h2 id=&quot;ä»€ä¹ˆæ˜¯å¸‚åœº&quot;&gt;ä»€ä¹ˆæ˜¯å¸‚åœº&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;å¸‚åœº&lt;/strong&gt;ï¼ˆmarketï¼‰æ˜¯&lt;em&gt;ç”±æŸç§ç‰©å“æˆ–è€…æœåŠ¡çš„ä¹°è€…ä¸å–è€…ç»„æˆçš„ä¸€ä¸ªç¾¤ä½“&lt;/em&gt;ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ä¹°è€…å†³å®šäº†äº§å“çš„éœ€æ±‚&lt;/li&gt;
  &lt;li&gt;å–è€…å†³å®šäº†äº§å“çš„ä¾›ç»™&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å¸‚åœºæœ‰å¤šç§å½¢å¼ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;ç»„ç»‡å¥å…¨çš„å¸‚åœº&lt;/strong&gt;ï¼šå¦‚å†œäº§å“å¸‚åœºä¸Šï¼Œä¹°è€…ä¸å–è€…åœ¨ç‰¹å®šçš„æ—¶é—´ä¸åœ°ç‚¹èšé›†åœ¨ä¸€èµ·ï¼ŒåŒæ—¶å¸‚åœºä¸Šè¿˜æœ‰ä¸€äº›æ‹å–è€…ååŠ©ç¡®å®šä»·æ ¼å¹¶å®‰æ’é”€å”®&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;æ²¡æœ‰ç»„ç»‡çš„å¸‚åœº&lt;/strong&gt;ï¼šå¦‚æŸä¸ªå°é•‡çš„å†°æ·‡æ·‹å¸‚åœºï¼Œä¹°è€…ä¸å–è€…å¹¶æ²¡æœ‰åœ¨ç‰¹å®šæ—¶é—´èšé›†åœ¨ä¸€èµ·ï¼Œå†°æ·‡æ·‹å–è€…åˆ†æ•£åœ¨å„ä¸ªåœ°æ–¹å¹¶æä¾›ç•¥æœ‰å·®å¼‚çš„äº§å“ï¼Œå„ä¸ªå–è€…æ ‡å‡ºå†°æ·‡æ·‹ä»·æ ¼ï¼Œè€Œå„ä¸ªä¹°è€…å†³å®šåœ¨æ¯ä¸ªåº—ä¸­ä¹°å¤šå°‘å†°æ·‡æ·‹&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;ä»€ä¹ˆæ˜¯ç«äº‰&quot;&gt;ä»€ä¹ˆæ˜¯ç«äº‰&lt;/h2&gt;

&lt;p&gt;å¤§å¤šæ•°å¸‚åœºæ˜¯é«˜åº¦ç«äº‰çš„ã€‚ä»¥å†°æ·‡æ·‹å¸‚åœºä¸ºä¾‹ï¼Œæ¯ä¸ªä¹°è€…éƒ½çŸ¥é“æœ‰ä¸€äº›å–è€…å¯ä¾›é€‰æ‹©ï¼Œå¹¶ä¸”æ¯ä¸ªå–è€…ä¹Ÿè®¤è¯†åˆ°å…¶æä¾›çš„äº§å“ä¸å…¶ä»–å–è€…æä¾›çš„äº§å“æ˜¯ç›¸ä¼¼çš„ã€‚å› æ­¤ï¼Œå†°æ·‡æ·‹ä»·æ ¼å¹¶ä¸æ˜¯ç”±ä»»ä½•ä¸€ä¸ªä¹°è€…æˆ–è€…å–è€…å†³å®šçš„ã€‚ç¡®åˆ‡åœ°è¯´ï¼Œ&lt;strong&gt;&lt;em&gt;å†°æ·‡æ·‹çš„ä»·æ ¼å’Œé”€å”®é‡æ˜¯ç”±æ‰€æœ‰ä¹°è€…å’Œå–è€…é€šè¿‡åœ¨å¸‚åœºä¸Šç›¸äº’äº¤æ˜“è€Œå…±åŒå†³å®šçš„&lt;/em&gt;&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ç«äº‰å¸‚åœº&lt;/strong&gt;ï¼ˆcompetitive marketï¼‰ï¼š&lt;em&gt;æœ‰è®¸å¤šä¹°è€…å’Œå–è€…ï¼Œä»¥è‡³äºæ¯ä¸ªäººå¯¹å¸‚åœºä»·æ ¼çš„å½±å“éƒ½å¾®ä¹å…¶å¾®çš„å¸‚åœº&lt;/em&gt;ã€‚&lt;/p&gt;

&lt;p&gt;å®Œå…¨ç«äº‰å¸‚åœºæ˜¯ç«äº‰å¸‚åœºçš„æœ€é«˜å½¢å¼ï¼Œè¯¥å¸‚åœºå¿…é¡»å…·å¤‡ä¸¤ä¸ªç‰¹å¾ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;å¯ä¾›é”€å”®çš„ç‰©å“æ˜¯å®Œå…¨ç›¸åŒçš„&lt;/li&gt;
  &lt;li&gt;ä¹°è€…ä¸å–è€…äººæ•°ä¼—å¤šï¼Œä»¥è‡³äºæ²¡æœ‰ä»»ä½•ä¸€ä¸ªä¹°è€…å’Œå–è€…å¯ä»¥å½±å“å¸‚åœºä»·æ ¼&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;åœ¨å®Œå…¨ç«äº‰å¸‚åœºä¸­ï¼Œä¹°è€…å’Œå–è€…å¿…é¡»æ¥å—å¸‚åœºå†³å®šçš„ä»·æ ¼ï¼Œè¢«ç§°ä¸ºä»·æ ¼æ¥å—è€…ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å„æ–­å¸‚åœº&lt;/strong&gt;ï¼šä¸€äº›å¸‚åœºåªæœ‰ä¸€ä¸ªå–è€…ï¼Œè€Œè¿™ä¸ªå–è€…å†³å®šå¸‚åœºä»·æ ¼ã€‚&lt;/p&gt;

&lt;h1 id=&quot;éœ€æ±‚&quot;&gt;éœ€æ±‚&lt;/h1&gt;

&lt;h2 id=&quot;éœ€æ±‚æ›²çº¿ä»·æ ¼ä¸éœ€æ±‚é‡ä¹‹é—´çš„å…³ç³»&quot;&gt;éœ€æ±‚æ›²çº¿ï¼šä»·æ ¼ä¸éœ€æ±‚é‡ä¹‹é—´çš„å…³ç³»&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;éœ€æ±‚é‡&lt;/strong&gt;ï¼ˆquantity demandedï¼‰ï¼šä¹°è€…æ„¿æ„å¹¶ä¸”èƒ½å¤Ÿè´­ä¹°çš„ä¸€ç§ç‰©å“çš„æ•°é‡ã€‚&lt;/p&gt;

&lt;p&gt;éœ€æ±‚é‡ç”±å¾ˆå¤šå› ç´ å†³å®šï¼Œå…¶ä¸­æœ€ä¸»è¦çš„å› ç´ æ˜¯ç‰©å“çš„&lt;strong&gt;ä»·æ ¼&lt;/strong&gt;ã€‚&lt;em&gt;åœ¨å…¶ä»–æ¡ä»¶ä¸å˜æ—¶ï¼Œä¸€ç§ç‰©å“çš„ä»·æ ¼ä¸Šå‡ï¼Œåˆ™å¯¹è¯¥ç‰©å“çš„éœ€æ±‚é‡å‡å°‘ï¼›ä¸€ç§ç‰©å“çš„ä»·æ ¼ä¸‹é™ï¼Œåˆ™å¯¹è¯¥ç‰©å“çš„éœ€æ±‚é‡é™ä½&lt;/em&gt;ï¼Œè¢«ç§°ä¸º&lt;strong&gt;éœ€æ±‚å®šç†&lt;/strong&gt;ï¼ˆlaw of demandï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;æŠŠä»·æ ¼ä¸éœ€æ±‚è”ç³»åœ¨ä¸€èµ·çš„æ›²çº¿è¢«ç§°ä¸º&lt;strong&gt;éœ€æ±‚æ›²çº¿&lt;/strong&gt;ï¼ˆdemand curveï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/economics/chap4/eco_1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;å¸‚åœºéœ€æ±‚ä¸ä¸ªäººéœ€æ±‚&quot;&gt;å¸‚åœºéœ€æ±‚ä¸ä¸ªäººéœ€æ±‚&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;å¸‚åœºéœ€&lt;/strong&gt;æ±‚æ˜¯&lt;em&gt;æ‰€æœ‰äººå¯¹æŸä¸ªç‰¹å®šç‰©å“æˆ–æœåŠ¡çš„éœ€æ±‚æ€»å’Œ&lt;/em&gt;ã€‚åŒæ ·ï¼Œå¸‚åœºéœ€æ±‚æ›²çº¿è¡¨ç¤ºåœ¨æ‰€æœ‰å½±å“æ¶ˆè´¹è€…è´­ä¹°æ•°é‡çš„å…¶ä»–å› ç´ ä¸å˜æ—¶ï¼Œä¸€ç§ç‰©å“çš„éœ€æ±‚æ€»é‡ä¸è¯¥ç‰©å“ä»·æ ¼çš„å…³ç³»ã€‚&lt;/p&gt;

&lt;h2 id=&quot;éœ€æ±‚æ›²çº¿çš„ç§»åŠ¨&quot;&gt;éœ€æ±‚æ›²çº¿çš„ç§»åŠ¨&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;å¦‚æœæŸç§å› ç´ æ”¹å˜äº†æ—¢å®šä»·æ ¼ä¸‹çš„éœ€æ±‚é‡ï¼Œéœ€æ±‚æ›²çº¿å°±ä¼šç§»åŠ¨&lt;/em&gt;&lt;/strong&gt;ï¼ˆä¹‹å‰æˆ‘ä»¬å‡è®¾å…¶ä»–å› ç´ ä¿æŒä¸å˜ï¼‰ã€‚ä¾‹å¦‚ï¼šå‡å¦‚ç ”ç©¶å‘ç°ç»å¸¸åƒå†°æ·‡æ·‹æœ‰åŠ©äºèº«ä½“å¥åº·ï¼Œé‚£ä¹ˆè¿™ä¸ªå‘ç°ä¼šå¢åŠ å¯¹å†°æ·‡æ·‹çš„éœ€æ±‚ã€‚åœ¨ç°æœ‰ä»·æ ¼ä¸‹ï¼Œä¹°è€…ä¼šè´­ä¹°æ›´å¤šçš„å†°æ·‡æ·‹ï¼Œå› æ­¤éœ€æ±‚æ›²çº¿å°±ä¼šç§»åŠ¨ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ä½¿æ¯ä¸€ç§ä»·æ ¼æ°´å¹³ä¸‹çš„éœ€æ±‚é‡å¢åŠ çš„ä»»ä½•å˜åŠ¨ï¼Œéƒ½ä¼šä½¿éœ€æ±‚æ›²çº¿å‘å³ç§»åŠ¨ï¼Œç§°ä¹‹ä¸º&lt;strong&gt;éœ€æ±‚å¢åŠ &lt;/strong&gt;ã€‚&lt;/li&gt;
  &lt;li&gt;ä½¿æ¯ä¸€ç§ä»·æ ¼æ°´å¹³ä¸‹çš„éœ€æ±‚é‡å‡å°‘çš„ä»»ä½•å˜åŠ¨ï¼Œéƒ½ä¼šä½¿éœ€æ±‚æ›²çº¿å‘å·¦ç§»åŠ¨ï¼Œç§°ä¹‹ä¸º&lt;strong&gt;éœ€æ±‚å‡å°‘&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/images/economics/chap4/eco_2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æœ‰è®¸å¤šå› ç´ ä¼šå¯¼è‡´éœ€æ±‚æ›²çº¿ç§»åŠ¨ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;æ”¶å…¥&lt;/li&gt;
  &lt;li&gt;ç›¸å…³ç‰©å“ä»·æ ¼&lt;/li&gt;
  &lt;li&gt;çˆ±å¥½&lt;/li&gt;
  &lt;li&gt;é¢„æœŸ&lt;/li&gt;
  &lt;li&gt;è´­ä¹°è€…æ•°é‡&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;æ€»ç»“&quot;&gt;æ€»ç»“&lt;/h2&gt;

&lt;p&gt;éœ€æ±‚æ›²çº¿è¡¨ç¤ºåœ¨&lt;strong&gt;å…¶ä»–&lt;/strong&gt;æ‰€æœ‰å½±å“ä¹°è€…çš„&lt;strong&gt;å˜é‡ä¿æŒä¸å˜&lt;/strong&gt;çš„æƒ…å†µä¸‹ï¼Œä¸€ç§&lt;strong&gt;ç‰©å“çš„ä»·æ ¼å˜åŠ¨æ—¶ï¼Œè¯¥ç‰©å“çš„éœ€æ±‚é‡ä¼šå‘ç”Ÿä»€ä¹ˆå˜åŠ¨&lt;/strong&gt;ã€‚å½“è¿™äº›&lt;strong&gt;å˜é‡&lt;/strong&gt;ä¸­çš„ä¸€ä¸ª&lt;strong&gt;å˜åŠ¨&lt;/strong&gt;æ—¶ï¼Œ&lt;strong&gt;éœ€æ±‚æ›²çº¿ä¼šå‘ç”Ÿç§»åŠ¨&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;å˜é‡&lt;/th&gt;
      &lt;th&gt;å˜é‡çš„å˜åŠ¨å°†å¯¼è‡´&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;ä»·æ ¼&lt;/td&gt;
      &lt;td&gt;æ²¿ç€éœ€æ±‚æ›²çº¿å˜åŠ¨&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;æ”¶å…¥ï¼Œç›¸å…³ç‰©å“ä»·æ ¼ï¼Œçˆ±å¥½ï¼Œé¢„æœŸï¼Œä¹°è€…æ•°é‡&lt;/td&gt;
      &lt;td&gt;ä½¿éœ€æ±‚æ›²çº¿ç§»åŠ¨&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h1 id=&quot;ä¾›ç»™&quot;&gt;ä¾›ç»™&lt;/h1&gt;

&lt;h2 id=&quot;ä¾›ç»™æ›²çº¿ä»·æ ¼ä¸ä¾›ç»™é‡ä¹‹é—´çš„å…³ç³»&quot;&gt;ä¾›ç»™æ›²çº¿ï¼šä»·æ ¼ä¸ä¾›ç»™é‡ä¹‹é—´çš„å…³ç³»&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;ä¾›ç»™é‡&lt;/strong&gt;ï¼ˆquantity suppliedï¼‰ï¼šå–è€…æ„¿æ„å¹¶ä¸”èƒ½å¤Ÿå‡ºå”®çš„è¯¥ç§ç‰©å“çš„æ•°é‡ã€‚&lt;/p&gt;

&lt;p&gt;å†³å®šä¾›ç»™é‡çš„å› ç´ æœ‰å¾ˆå¤šï¼Œä»·æ ¼ä»ç„¶èµ·ç€ä¸»è¦ä½œç”¨ã€‚ä»·æ ¼ä¸ä¾›ç»™é‡ä¹‹é—´çš„å…³ç³»è¢«ç§°ä¸º&lt;strong&gt;ä¾›ç»™å®šç†&lt;/strong&gt;ï¼ˆlaw of supplyï¼‰ï¼š&lt;em&gt;åœ¨å…¶ä»–æ¡ä»¶ä¸å˜æ—¶ï¼Œä¸€ç§ç‰©å“ä»·æ ¼ä¸Šå‡ï¼Œè¯¥ç‰©å“ä¾›ç»™é‡å¢åŠ ï¼›ä¸€ç§ç‰©å“ä»·æ ¼ä¸‹é™ï¼Œè¯¥ç‰©å“ä¾›ç»™é‡å‡å°‘&lt;/em&gt;ã€‚&lt;/p&gt;

&lt;p&gt;æŠŠä»·æ ¼ä¸ä¾›ç»™é‡è”ç³»åœ¨ä¸€èµ·çš„æ›²çº¿è¢«ç§°ä¸º&lt;strong&gt;ä¾›ç»™æ›²çº¿&lt;/strong&gt;ï¼ˆsupply curveï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/economics/chap4/eco_3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;å¸‚åœºä¾›ç»™ä¸ä¸ªäººä¾›ç»™&quot;&gt;å¸‚åœºä¾›ç»™ä¸ä¸ªäººä¾›ç»™&lt;/h2&gt;

&lt;p&gt;ä¸å¸‚åœºéœ€æ±‚ä¸€æ ·ï¼Œå¸‚åœºä¾›ç»™æ˜¯æ‰€æœ‰å–è€…ä¾›ç»™çš„æ€»å’Œã€‚&lt;/p&gt;

&lt;h2 id=&quot;ä¾›ç»™æ›²çº¿ç§»åŠ¨&quot;&gt;ä¾›ç»™æ›²çº¿ç§»åŠ¨&lt;/h2&gt;

&lt;p&gt;ä¾›ç»™æ›²çº¿æ˜¯å‡è®¾å…¶ä»–æ¡ä»¶ä¸å˜æ—¶ï¼Œä»·æ ¼ä¸ä¾›ç»™é‡ä¹‹é—´çš„å…³ç³»ï¼›ä½†æ˜¯å½“å…¶ä»–å› ç´ å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¾›ç»™æ›²çº¿å°†å‘ç”Ÿç§»åŠ¨ã€‚ä¾‹å¦‚ï¼Œç³–çš„ä»·æ ¼ä¸‹é™äº†ï¼Œä¼šå¢åŠ å†°æ·‡æ·‹çš„ä¾›ç»™ï¼šåœ¨ä»»ä½•ä¸€ç§æ—¢å®šä»·æ ¼æ°´å¹³ä¸‹ï¼Œå–è€…æ„¿æ„ç”Ÿäº§æ›´å¤šçš„å†°æ·‡æ·‹ï¼Œå†°æ·‡æ·‹çš„ä¾›ç»™æ›²çº¿å‘å³ç§»åŠ¨ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;åœ¨æ—¢å®šä»·æ ¼æ°´å¹³ä¸‹ï¼Œä½¿ä¾›ç»™é‡å¢åŠ çš„ä»»ä½•ä¸€ç§å˜åŠ¨ï¼ˆå¦‚ï¼Œç³–ä»·æ ¼ä¸‹é™ï¼‰ï¼Œéƒ½ä¼šä½¿ä¾›ç»™æ›²çº¿å‘å³ç§»åŠ¨ï¼Œç§°ä¹‹ä¸º&lt;strong&gt;ä¾›ç»™å¢åŠ &lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;åœ¨æ—¢å®šä»·æ ¼æ°´å¹³ä¸‹ï¼Œä½¿ä¾›ç»™é‡å‡å°‘çš„ä»»ä½•ä¸€ç§å˜åŠ¨ï¼Œéƒ½ä¼šä½¿ä¾›ç»™æ›²çº¿å·¦ç§»ï¼Œç§°ä¹‹ä¸º&lt;strong&gt;ä¾›ç»™å‡å°‘&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/images/economics/chap4/eco_4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æœ‰è®¸å¤šå˜é‡ä¼šä½¿ä¾›ç»™æ›²çº¿å‘ç”Ÿç§»åŠ¨ï¼ŒåŒ…æ‹¬ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;æŠ•å…¥å“ä»·æ ¼&lt;/li&gt;
  &lt;li&gt;æŠ€æœ¯&lt;/li&gt;
  &lt;li&gt;é¢„æœŸ&lt;/li&gt;
  &lt;li&gt;å–è€…æ•°é‡&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;æ€»ç»“-1&quot;&gt;æ€»ç»“&lt;/h2&gt;

&lt;p&gt;ä¾›ç»™æ›²çº¿è¡¨ç¤ºåœ¨&lt;strong&gt;å…¶ä»–&lt;/strong&gt;æ‰€æœ‰å½±å“å–è€…çš„&lt;strong&gt;å˜é‡ä¿æŒä¸å˜&lt;/strong&gt;çš„æƒ…å†µä¸‹ï¼Œä¸€ç§ç‰©å“&lt;strong&gt;ä»·æ ¼å˜åŠ¨&lt;/strong&gt;æ—¶ï¼Œè¯¥ç‰©å“çš„ä¾›ç»™é‡ä¼šå‘ç”Ÿä»€ä¹ˆå˜åŠ¨ã€‚å½“è¿™äº›&lt;strong&gt;å˜é‡&lt;/strong&gt;ä¸­çš„ä¸€ä¸ª&lt;strong&gt;å˜åŠ¨&lt;/strong&gt;æ—¶ï¼Œ&lt;strong&gt;ä¾›ç»™æ›²çº¿å°±ä¼šå‘ç”Ÿç§»åŠ¨&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;å˜é‡&lt;/th&gt;
      &lt;th&gt;å˜é‡çš„å˜åŠ¨å°†å¯¼è‡´&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;ä»·æ ¼&lt;/td&gt;
      &lt;td&gt;æ²¿ç€ä¾›ç»™æ›²çº¿çš„å˜åŠ¨&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;æŠ€æœ¯ï¼ŒæŠ•å…¥å“ä»·æ ¼ï¼Œé¢„æœŸï¼Œå–è€…æ•°é‡&lt;/td&gt;
      &lt;td&gt;ä½¿ä¾›ç»™æ›²çº¿ç§»åŠ¨&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h1 id=&quot;ä¾›ç»™ä¸éœ€æ±‚çš„ç»“åˆ&quot;&gt;ä¾›ç»™ä¸éœ€æ±‚çš„ç»“åˆ&lt;/h1&gt;

&lt;h2 id=&quot;å‡è¡¡&quot;&gt;å‡è¡¡&lt;/h2&gt;

&lt;p&gt;å¸‚åœºä»·æ ¼è¾¾åˆ°ä½¿ä¾›ç»™é‡ä¸éœ€æ±‚é‡ç›¸ç­‰çš„æ°´å¹³æ—¶çš„çŠ¶æ€è¢«ç§°ä¸º&lt;strong&gt;å‡è¡¡çŠ¶æ€&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;å‡è¡¡ä»·æ ¼&lt;/strong&gt;ï¼šä½¿ä¾›ç»™ä¸éœ€æ±‚å¹³è¡¡çš„ä»·æ ¼ï¼›&lt;strong&gt;å‡è¡¡æ•°é‡&lt;/strong&gt;ï¼šå‡è¡¡ä»·æ ¼ä¸‹çš„ä¾›ç»™é‡ä¸éœ€æ±‚é‡ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/economics/chap4/eco_5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä¾›ç»™æ›²çº¿ä¸éœ€æ±‚æ›²çº¿ç›¸äº¤äºä¸€ç‚¹ï¼Œè¯¥ç‚¹è¢«ç§°ä¸ºå¸‚åœºçš„å‡è¡¡ã€‚&lt;/p&gt;

&lt;p&gt;&lt;em&gt;åœ¨å‡è¡¡ä»·æ ¼æ—¶ï¼Œä¹°è€…æ„¿æ„å¹¶ä¸”èƒ½å¤Ÿè´­ä¹°çš„ç‰©å“æ•°é‡æ­£å¥½ä¸å–è€…æ„¿æ„å¹¶ä¸”èƒ½å¤Ÿå–å‡ºçš„æ•°é‡ç›¸ç­‰&lt;/em&gt;ã€‚å‡è¡¡ä»·æ ¼æœ‰æ—¶å€™ä¹Ÿä¼šè¢«ç§°ä¸º&lt;strong&gt;å¸‚åœºå‡ºæ¸…ä»·æ ¼&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;ä¹°è€…ä¸å–è€…çš„è¡Œä¸ºè‡ªç„¶è€Œç„¶åœ°ä½¿å¸‚åœºå‘ä¾›ç»™ä¸éœ€æ±‚çš„å‡è¡¡å˜åŠ¨ã€‚å½“å¸‚åœºä»·æ ¼ä¸ç­‰äºå‡è¡¡ä»·æ ¼æ—¶ï¼Œç‰©å“ä¼šè¡¨ç°ä¸ºè¿‡å‰©æˆ–è€…çŸ­ç¼ºï¼Œå¹¶ä½¿å¸‚åœºè¾¾åˆ°å‡è¡¡ä¸ºæ­¢ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;è¿‡å‰©&lt;/strong&gt;ï¼š&lt;em&gt;ä¾›ç»™é‡å¤§äºéœ€æ±‚é‡&lt;/em&gt;&lt;/p&gt;

    &lt;p&gt;å½“å¸‚åœºä»·æ ¼é«˜äºå‡è¡¡ä»·æ ¼æ—¶ï¼Œä¼šä½¿å¾—ä¾›ç»™é‡å¤§äºéœ€æ±‚é‡ï¼Œæ­¤æ—¶ç‰©å“å°±ä¼šå‡ºç°è¿‡å‰©ã€‚&lt;/p&gt;

    &lt;p&gt;å–è€…å¯¹è¿‡å‰©çš„ååº”æ—¶é™ä½å…¶ä»·æ ¼ã€‚å½“ä»·æ ¼ä¸‹é™æ—¶ï¼Œä¼šä½¿éœ€æ±‚é‡å¢åŠ ï¼Œä¾›ç»™å‡å°‘ã€‚&lt;/p&gt;

    &lt;p&gt;è¿™ç§å˜åŒ–è¡¨ç°ä¸ºæ²¿ç€ä¾›ç»™ä¸éœ€æ±‚æ›²çº¿çš„å˜åŠ¨ï¼Œè€Œä¸æ˜¯æ›²çº¿çš„ç§»åŠ¨ã€‚ä»·æ ¼ä¼šæŒç»­ä¸‹é™ï¼Œæœ€ç»ˆå¸‚åœºè¾¾åˆ°å‡è¡¡ã€‚&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/economics/chap4/eco_6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;çŸ­ç¼º&lt;/strong&gt;ï¼š&lt;em&gt;éœ€æ±‚é‡å¤§äºä¾›ç»™é‡&lt;/em&gt;&lt;/p&gt;

    &lt;p&gt;å½“å¸‚åœºä»·æ ¼ä½äºå‡è¡¡ä»·æ ¼æ—¶ï¼Œä¼šä½¿å¾—éœ€æ±‚é‡å¤§äºä¾›ç»™é‡ï¼Œæ­¤æ—¶ç‰©å“å°±ä¼šå‡ºç°çŸ­ç¼ºã€‚&lt;/p&gt;

    &lt;p&gt;ç”±äºå¤ªå¤šçš„ä¹°è€…æŠ¢è´­å¤ªå°‘çš„ç‰©å“ï¼Œå–è€…å¯ä»¥æé«˜ç‰©å“ä»·æ ¼ã€‚å½“ä»·æ ¼æé«˜æ—¶ï¼Œå¼•èµ·éœ€æ±‚å‡å°‘ï¼Œä¾›ç»™å¢åŠ ã€‚&lt;/p&gt;

    &lt;p&gt;è¿™ç§å˜åŒ–è¡¨ç°ä¸ºæ²¿ç€ä¾›ç»™å’Œéœ€æ±‚æ›²çº¿ç§»åŠ¨ï¼Œå¹¶æ¨åŠ¨å¸‚åœºèµ°å‘å‡è¡¡ã€‚&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/economics/chap4/eco_7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

    &lt;p&gt;åœ¨å¤§å¤šæ•°è‡ªç”±å¸‚åœºä¸Šï¼Œä»·æ ¼æœ€ç»ˆéƒ½è¦å˜åŠ¨åˆ°å…¶å‡è¡¡æ°´å¹³ï¼Œè¿‡å‰©ä¸çŸ­ç¼ºéƒ½åªæ˜¯æš‚æ—¶çš„ã€‚&lt;em&gt;ä»»ä½•ç‰©å“çš„ä»·æ ¼éƒ½ä¼šè‡ªå‘è°ƒæ•´ï¼Œä½¿è¯¥ç‰©å“çš„ä¾›ç»™ä¸éœ€æ±‚è¾¾åˆ°å¹³è¡¡&lt;/em&gt;ï¼Œè¢«ç§°ä¸º&lt;strong&gt;ä¾›æ±‚å®šç†&lt;/strong&gt;ï¼ˆlaw of supply and demandï¼‰ã€‚&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;åˆ†æå‡è¡¡å˜åŠ¨çš„æ­¥éª¤&quot;&gt;åˆ†æå‡è¡¡å˜åŠ¨çš„æ­¥éª¤&lt;/h2&gt;

&lt;p&gt;å½“åˆ†ææŸä¸ªäº‹ä»¶å¦‚ä½•å½±å“ä¸€ä¸ªå¸‚åœºä¸Šçš„å‡è¡¡æ—¶ï¼ŒæŒ‰ç…§ä¸‰ä¸ªæ­¥éª¤è¿›è¡Œï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;ç¡®å®šè¯¥äº‹ä»¶æ˜¯ä½¿ä¾›ç»™æ›²çº¿ç§»åŠ¨è¿˜æ˜¯æ—¶éœ€æ±‚æ›²çº¿ç§»åŠ¨&lt;/strong&gt;ï¼ˆæˆ–è€…ä¸¤è€…å‡ç§»åŠ¨ï¼‰&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;ç¡®å®šæ›²çº¿ç§»åŠ¨çš„æ–¹å‘&lt;/strong&gt;ï¼ˆå·¦è¿˜æ˜¯å³ï¼‰&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;ç”¨ä¾›æ±‚å›¾æ¥è¯´æ˜è¿™ç§ç§»åŠ¨å¦‚ä½•æ”¹å˜å‡è¡¡ä»·æ ¼ä¸å‡è¡¡æ•°é‡&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;ä¾‹ç”±éœ€æ±‚ç§»åŠ¨å¼•èµ·çš„å¸‚åœºå‡è¡¡å˜åŠ¨&quot;&gt;ä¾‹ï¼šç”±éœ€æ±‚ç§»åŠ¨å¼•èµ·çš„å¸‚åœºå‡è¡¡å˜åŠ¨&lt;/h3&gt;

&lt;p&gt;å‡è®¾æŸå¹´å¤å­£å¤©æ°”ç‰¹åˆ«ç‚çƒ­ï¼Œè¿™ç§æƒ…å†µå¦‚ä½•å½±å“å†°æ·‡æ·‹å¸‚åœºï¼Ÿ&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;å¤©æ°”ç‚çƒ­æ”¹å˜äº†éœ€æ±‚æ›²çº¿ï¼Œäººä»¬åœ¨æ—¢å®šä»·æ ¼ä¸‹æƒ³è¦è´­ä¹°æ›´å¤šçš„å†°æ·‡æ·‹ã€‚ä¾›ç»™æ›²çº¿ä¸ä¼šå˜ï¼Œå› ä¸ºå¤©æ°”å¹¶ä¸ç›´æ¥å½±å“é”€å”®ä¼ä¸š&lt;/li&gt;
  &lt;li&gt;ç”±äºæ—¢å®šä»·æ ¼ä¸‹éœ€æ±‚å¢å¤šï¼Œæ‰€ä»¥éœ€æ±‚æ›²çº¿å‘å³ç§»åŠ¨&lt;/li&gt;
  &lt;li&gt;åœ¨åŸæœ‰ä»·æ ¼ä¸‹ï¼Œéœ€æ±‚ &amp;gt; ä¾›ç»™ï¼ˆå› ä¸ºéœ€æ±‚å¢å¤šï¼Œè€Œä¸æ˜¯ä¾›ç»™å‡å°‘ï¼‰ï¼Œå¼•èµ·çŸ­ç¼ºï¼Œå› æ­¤å–å®¶æé«˜å†°æ·‡æ·‹ä»·æ ¼ï¼Œè¾¾åˆ°æ–°çš„å‡è¡¡ã€‚&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;æ•´ä½“æ¥çœ‹ï¼Œ&lt;strong&gt;&lt;em&gt;å¤©æ°”ç‚çƒ­æé«˜äº†å†°æ·‡æ·‹ä»·æ ¼ï¼Œå¢åŠ äº†å†°æ·‡æ·‹çš„é”€å”®é‡&lt;/em&gt;&lt;/strong&gt;ã€‚&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/economics/chap4/eco_8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;æ›²çº¿çš„ç§»åŠ¨ä¸æ²¿ç€æ›²çº¿çš„ç§»åŠ¨&quot;&gt;æ›²çº¿çš„ç§»åŠ¨ä¸æ²¿ç€æ›²çº¿çš„ç§»åŠ¨&lt;/h3&gt;

&lt;p&gt;æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œå½“å¤©æ°”ç‚çƒ­æ—¶ï¼Œå†°æ·‡æ·‹éœ€æ±‚å¢åŠ ï¼Œå¹¶ä½¿å…¶ä»·æ ¼ä¸Šå‡ï¼›å°½ç®¡ä¾›ç»™æ›²çº¿ä¸å˜ï¼Œä½†æ˜¯ä¾›ç»™æ•°é‡å¢åŠ äº†ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç§°ä¸ºï¼Œ&lt;strong&gt;â€œä¾›ç»™é‡â€å¢åŠ ï¼Œä½†æ˜¯â€œä¾›ç»™ä¸å˜â€&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;ä¾›ç»™æ˜¯æŒ‡ä¾›ç»™æ›²çº¿çš„ä½ç½®ï¼Œä¾›ç»™é‡æ˜¯æŒ‡ä¾›ç»™è€…å¸Œæœ›å‡ºå”®çš„æ•°é‡&lt;/p&gt;

&lt;/blockquote&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;ä¾›ç»™æ›²çº¿çš„ç§»åŠ¨&lt;/strong&gt;è¢«ç§°ä¸ºâ€œ&lt;strong&gt;ä¾›ç»™å˜åŠ¨&lt;/strong&gt;â€ï¼Œ&lt;strong&gt;éœ€æ±‚æ›²çº¿çš„ç§»åŠ¨&lt;/strong&gt;è¢«ç§°ä¸ºâ€œ&lt;strong&gt;éœ€æ±‚å˜åŠ¨&lt;/strong&gt;â€&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;æ²¿ç€å›ºå®šçš„ä¾›ç»™æ›²çº¿å˜åŠ¨&lt;/strong&gt;è¢«ç§°ä¸ºâ€œ&lt;strong&gt;ä¾›ç»™é‡çš„å˜åŠ¨&lt;/strong&gt;â€ï¼Œ&lt;strong&gt;æ²¿ç€å›ºå®šéœ€æ±‚æ›²çº¿çš„å˜åŠ¨&lt;/strong&gt;è¢«ç§°ä¸ºâ€œ&lt;strong&gt;éœ€æ±‚é‡çš„å˜åŠ¨&lt;/strong&gt;â€&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;ä¾‹ç”±ä¾›ç»™ç§»åŠ¨å¼•èµ·çš„å¸‚åœºå‡è¡¡å˜åŠ¨&quot;&gt;ä¾‹ï¼šç”±ä¾›ç»™ç§»åŠ¨å¼•èµ·çš„å¸‚åœºå‡è¡¡å˜åŠ¨&lt;/h3&gt;

&lt;p&gt;å‡è®¾åœ¨å¦ä¸€ä¸ªå¤å­£ï¼Œå°é£æ‘§æ¯äº†éƒ¨åˆ†ç”˜è”—ç”°ï¼Œä½¿å¾—ç³–çš„ä»·æ ¼ä¸Šå‡ï¼Œè¿™ä¸ªäº‹ä»¶å¦‚ä½•å½±å“å†°æ·‡æ·‹å¸‚åœºï¼Ÿ&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;ç³–ä½œä¸ºå†°æ·‡æ·‹çš„æŠ•å…¥å“ï¼Œå…¶ä»·æ ¼ä¸Šå‡å½±å“äº†ä¾›ç»™æ›²çº¿ï¼Œä¼ä¸šåœ¨æ—¢å®šä»·æ ¼ä¸‹å‡å°‘å†°æ·‡æ·‹çš„ä¾›ç»™ã€‚éœ€æ±‚æ›²çº¿æ²¡å˜ã€‚&lt;/li&gt;
  &lt;li&gt;ä¾›ç»™æ›²çº¿å‘å·¦ç§»åŠ¨&lt;/li&gt;
  &lt;li&gt;åœ¨åŸæœ‰ä»·æ ¼ä¸‹ï¼Œä¾›ç»™ &amp;lt; éœ€æ±‚ï¼ˆå› ä¸ºä¾›ç»™å‡å°‘ï¼Œè€Œä¸æ˜¯éœ€æ±‚å¢å¤šï¼‰ï¼Œå¼•èµ·çŸ­ç¼ºï¼Œå› æ­¤å–å®¶æé«˜å†°æ·‡æ·‹ä»·æ ¼ï¼Œè¾¾åˆ°æ–°çš„å‡è¡¡ã€‚&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;æ•´ä½“æ¥çœ‹ï¼Œç³–çš„ä»·æ ¼ä¸Šå‡ï¼Œå¯¼è‡´å†°æ·‡æ·‹çš„ä»·æ ¼ä¸Šå‡ï¼Œä½†æ˜¯é”€å”®é‡å‡å°‘äº†&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/economics/chap4/eco_9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;å½“ä¾›ç»™æˆ–éœ€æ±‚ç§»åŠ¨æ—¶ä»·æ ¼å’Œæ•°é‡å°†å¦‚ä½•å˜åŒ–&quot;&gt;å½“ä¾›ç»™æˆ–éœ€æ±‚ç§»åŠ¨æ—¶ï¼Œä»·æ ¼å’Œæ•°é‡å°†å¦‚ä½•å˜åŒ–ï¼Ÿ&lt;/h2&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Â &lt;/th&gt;
      &lt;th&gt;ä¾›ç»™æœªå˜&lt;/th&gt;
      &lt;th&gt;ä¾›ç»™å¢åŠ &lt;/th&gt;
      &lt;th&gt;ä¾›ç»™å‡å°‘&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;éœ€æ±‚æœªå˜&lt;/td&gt;
      &lt;td&gt;ä»·æ ¼ç›¸åŒ æ•°é‡ç›¸åŒ&lt;/td&gt;
      &lt;td&gt;ä»·æ ¼ä¸‹é™ æ•°é‡å¢åŠ &lt;/td&gt;
      &lt;td&gt;ä»·æ ¼ä¸Šå‡ æ•°é‡å‡å°‘&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;éœ€æ±‚å¢åŠ &lt;/td&gt;
      &lt;td&gt;ä»·æ ¼ä¸Šå‡ æ•°é‡å¢åŠ &lt;/td&gt;
      &lt;td&gt;æ•°é‡å¢åŠ  ä»·æ ¼ä¸å®š&lt;/td&gt;
      &lt;td&gt;ä»·æ ¼ä¸Šå‡ æ•°é‡ä¸å®š&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;éœ€æ±‚å‡å°‘&lt;/td&gt;
      &lt;td&gt;ä»·æ ¼ä¸‹é™ æ•°é‡å‡å°‘&lt;/td&gt;
      &lt;td&gt;ä»·æ ¼ä¸‹é™ æ•°é‡ä¸å®š&lt;/td&gt;
      &lt;td&gt;ä»·æ ¼ä¸å®š æ•°é‡å‡å°‘&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h1 id=&quot;ç»“è®ºä»·æ ¼å¦‚ä½•é…ç½®èµ„æº&quot;&gt;ç»“è®ºï¼šä»·æ ¼å¦‚ä½•é…ç½®èµ„æº&lt;/h1&gt;

&lt;p&gt;åœ¨å¸‚åœºç»æµä¸­ï¼Œä»·æ ¼æ˜¯é…ç½®ç¨€ç¼ºèµ„æºçš„æœºåˆ¶ã€‚å¯¹äºç»æµä¸­çš„æ¯ç§ç‰©å“æ¥è¯´ï¼Œä»·æ ¼ç¡®ä¿ä¾›ç»™ä¸éœ€æ±‚è¾¾åˆ°å¹³è¡¡ã€‚å‡è¡¡ä»·æ ¼å†³å®šäº†ä¹°è€…é€‰æ‹©è´­ä¹°å¤šå°‘è¿™ç§ç‰©å“ï¼Œä»¥åŠå–è€…é€‰æ‹©ç”Ÿäº§å¤šå°‘è¿™ç§ç‰©å“ã€‚&lt;/p&gt;</content><author><name>kkzhang</name></author><category term="economics" /><summary type="html">ä¾›ç»™ä¸éœ€æ±‚æ˜¯ä½¿å¸‚åœºç»æµè¿è¡Œçš„åŠ›é‡ï¼Œå®ƒä»¬å†³å®šäº†æ¯ç§ç‰©å“çš„äº§é‡åŠå‡ºå”®ä»·æ ¼ã€‚</summary></entry><entry><title type="html">ç¼–ç¨‹ç ç‘: ç®—æ³•è®¾è®¡æŠ€æœ¯</title><link href="http://localhost:4000/programming-pearls-8.html" rel="alternate" type="text/html" title="ç¼–ç¨‹ç ç‘: ç®—æ³•è®¾è®¡æŠ€æœ¯" /><published>2022-06-19T00:00:00+08:00</published><updated>2022-06-19T00:00:00+08:00</updated><id>http://localhost:4000/programming-pearls-8</id><content type="html" xml:base="http://localhost:4000/programming-pearls-8.html">&lt;h2 id=&quot;é—®é¢˜æè¿°&quot;&gt;é—®é¢˜æè¿°&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;è¾“å…¥&lt;/strong&gt;ï¼šå…·æœ‰ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;n&lt;/code&gt; ä¸ªæµ®ç‚¹æ•°çš„å‘é‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;x&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;è¾“å‡º&lt;/strong&gt;ï¼šè¾“å…¥å‘é‡çš„ä»»æ„è¿ç»­å­å‘é‡çš„æœ€å¤§å’Œã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼šè¾“å…¥å‘é‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;x&lt;/code&gt; ä¸º [31, -41, 59, 26, -53, 58, 97, -93, -23, 84]ï¼Œé‚£ä¹ˆè¯¥ç¨‹åºè¾“å‡ºä¸º x[2â€¦6] çš„æ€»å’Œã€‚&lt;/p&gt;

&lt;h2 id=&quot;åˆ†æ&quot;&gt;åˆ†æ&lt;/h2&gt;

&lt;p&gt;å½“æ‰€æœ‰æ•°éƒ½æ˜¯æ­£æ•°æ—¶ï¼Œé—®é¢˜æ¯”è¾ƒç®€å•ï¼Œæ­¤æ—¶æœ€å¤§å­å‘é‡å°±æ˜¯æ•´ä¸ªè¾“å…¥å‘é‡ã€‚&lt;/p&gt;

&lt;p&gt;å½“è¾“å…¥å‘é‡ä¸­å«æœ‰è´Ÿæ•°æ—¶ï¼Œæ˜¯å¦åº”è¯¥åŒ…å«æŸä¸ªè´Ÿæ•°å¹¶æœŸæœ›æ—è¾¹çš„æ­£æ•°ä¼šå¼¥è¡¥å®ƒå‘¢ï¼Ÿ&lt;/p&gt;

&lt;p&gt;ä¸ºäº†ä½¿é—®é¢˜å®šä¹‰æ›´åŠ å®Œæ•´ï¼Œå‡è®¾æ‰€æœ‰çš„è¾“å…¥éƒ½æ˜¯è´Ÿæ•°æ—¶ï¼Œæœ€å¤§å­å‘é‡ä¸ºç©ºå‘é‡ï¼Œæ€»å’Œä¸º 0.&lt;/p&gt;

&lt;h2 id=&quot;on3-ç®—æ³•&quot;&gt;O(n^3) ç®—æ³•&lt;/h2&gt;

&lt;p&gt;è¯¥é—®é¢˜æœ€ç›´æ¥çš„è§£æ³•æ˜¯å¯¹æ‰€æœ‰æ»¡è¶³ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0 â‰¤ i â‰¤ j &amp;lt; n&lt;/code&gt; çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;(i, j)&lt;/code&gt; æ•´æ•°å¯¹è¿›è¡Œè¿­ä»£ã€‚å¯¹æ¯ä¸ªæ•´æ•°å¯¹ï¼Œéƒ½éœ€è¦è®¡ç®— &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;x[i, j]&lt;/code&gt; çš„æ€»å’Œï¼Œå¹¶åˆ¤æ–­æ­¤æ—¶è¯¥å’Œæ˜¯å¦æ˜¯è¿„ä»Šä¸ºæ­¢æœ€å¤§çš„å’Œã€‚&lt;/p&gt;

&lt;p&gt;ä»£ç æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯è¿è¡Œé€Ÿåº¦å¾ˆæ…¢ã€‚&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;maxsofar&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;sum&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// sum is sum of x[i...j]&lt;/span&gt;
		&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;k&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
			&lt;span class=&quot;n&quot;&gt;sum&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;maxsofar&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;maxsofar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;on2-ç®—æ³•&quot;&gt;O(n^2) ç®—æ³•&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;x[i...j]&lt;/code&gt; çš„æ€»å’Œä¸å‰é¢å·²ç»è®¡ç®—å‡ºçš„æ€»å’Œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;x[i...j-1]&lt;/code&gt; ç›¸å…³ï¼Œåˆ©ç”¨è¯¥å…³ç³»å¯ä»¥å¾—åˆ°ç¬¬ä¸€ä¸ªå¹³æ–¹ç®—æ³•ã€‚&lt;/p&gt;

    &lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; &lt;span class=&quot;n&quot;&gt;maxsofar&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
 &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
 	&lt;span class=&quot;n&quot;&gt;sum&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// sum is sum of x[i...j]&lt;/span&gt;
 	&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
 		&lt;span class=&quot;n&quot;&gt;sum&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
 		&lt;span class=&quot;n&quot;&gt;maxsofar&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxsofar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;å¦ä¸€ç§å¹³æ–¹ç®—æ³•æ˜¯æå‰è®¡ç®— &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;x[0...i]&lt;/code&gt; å„ä¸ªæ•°ç´¯åŠ çš„å’Œã€‚&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cumarr[i]&lt;/code&gt; è¡¨ç¤º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;x[0...i]&lt;/code&gt; ä¸­å„ä¸ªæ•°çš„ç´¯åŠ å’Œï¼Œåˆ™ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;x[i..j]&lt;/code&gt; çš„ç´¯åŠ å’Œå¯ä»¥é€šè¿‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cumarr[j] - cumarr[i-1]&lt;/code&gt; å¾—åˆ°ã€‚&lt;/p&gt;

    &lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; &lt;span class=&quot;n&quot;&gt;cumarr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
 &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
 	&lt;span class=&quot;n&quot;&gt;cumarr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cumarr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
 &lt;span class=&quot;n&quot;&gt;maxsofar&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
 &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
 	&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
 		&lt;span class=&quot;n&quot;&gt;sum&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cumarr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;cumarr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// sum is sum of x[i...j]&lt;/span&gt;
 		&lt;span class=&quot;n&quot;&gt;maxsofar&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxsofar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;åˆ†æ²»ç®—æ³•onlogn&quot;&gt;åˆ†æ²»ç®—æ³•ï¼šO(nlogn)&lt;/h2&gt;

&lt;p&gt;å‰é¢è®¨è®ºçš„ç®—æ³•è€ƒè™‘äº†æ‰€æœ‰çš„å­å‘é‡ï¼Œå¹¶è®¡ç®—æ¯ä¸ªå­å‘é‡ä¸­çš„æ‰€æœ‰æ•°çš„å’Œã€‚ç”±äºå­˜åœ¨ O(n^2) ä¸ªå­å‘é‡ï¼Œå› æ­¤è‡³å°‘éœ€è¦ O(n^2) çš„è¿è¡Œæ—¶é—´ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;åˆ†æ²»æ³•åŸç†&lt;/strong&gt;ï¼š&lt;em&gt;è¦è§£å†³è§„æ¨¡ä¸º n çš„é—®é¢˜ï¼Œå¯ä»¥é€’å½’åœ°è§£å†³ä¸¤ä¸ªè§„æ¨¡è¿‘ä¼¼ä¸º n/2 çš„å­é—®é¢˜ï¼Œç„¶åå¯¹å®ƒä»¬çš„ç­”æ¡ˆè¿›è¡Œåˆå¹¶å¯ä»¥å¾—åˆ°æ•´ä¸ªé—®é¢˜çš„ç­”æ¡ˆ&lt;/em&gt;ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨æœ¬é—®é¢˜ä¸­ï¼Œæˆ‘ä»¬å°†å¤§å°ä¸º n çš„å‘é‡åˆ†è§£ä¸ºä¸¤ä¸ªå¤§å°è¿‘ä¼¼çš„å­å‘é‡ a, bï¼Œä¹‹åé€’å½’åœ°æ‰¾å‡º a, b ä¸­çš„æœ€å¤§å­å‘é‡ ma, mbã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;æ•´ä¸ªå‘é‡çš„æœ€å¤§å­å‘é‡ä¸º maï¼šå­å‘é‡åœ¨ a ä¸­&lt;/li&gt;
  &lt;li&gt;æ•´ä¸ªå‘é‡çš„æœ€å¤§å­å‘é‡ä¸º mbï¼šå­å‘é‡åœ¨ b ä¸­&lt;/li&gt;
  &lt;li&gt;æ•´ä¸ªå‘é‡çš„æœ€å¤§å­å‘é‡ä¸º mcï¼šå­å‘é‡è·¨è¶Š a, b ä¹‹é—´çš„è¾¹ç•Œ&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxsum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;l&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;l&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// zero elements&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;l&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;l&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// one element&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;l&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;
	&lt;span class=&quot;c1&quot;&gt;// find max crossing to left&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;lmax&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sum&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;sum&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;lmax&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lmax&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;c1&quot;&gt;// find max crossing to right&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;rmax&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sum&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;sum&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;rmax&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rmax&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lmax&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rmax&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxsum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;l&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxsum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;æ‰«æç®—æ³•on&quot;&gt;æ‰«æç®—æ³•ï¼šO(n)&lt;/h2&gt;

&lt;p&gt;æ‰«æç®—æ³•æ˜¯ä»æ•°ç»„çš„æœ€å·¦ç«¯ï¼ˆx[0]ï¼‰å¼€å§‹æ‰«æï¼Œä¸€ç›´åˆ°æœ€å³ç«¯ï¼ˆx[n-1]ï¼‰ï¼Œå¹¶è®°ä¸‹æ‰€é‡åˆ°çš„æ€»å’Œæœ€å¤§çš„å­å‘é‡ã€‚&lt;/p&gt;

&lt;p&gt;å‡è®¾å·²ç»è§£å†³äº† x[0â€¦i-1] çš„é—®é¢˜ï¼Œå¦‚ä½•å°†å…¶æ‰©å±•ä¸ºåŒ…å« x[i] çš„é—®é¢˜ï¼Ÿ&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;ç±»ä¼¼åˆ†æ²»ç®—æ³•åŸç†ï¼šå‰ i ä¸ªå…ƒç´ ä¸­ï¼Œæœ€å¤§æ€»å’Œçš„å­å‘é‡è¦ä¹ˆåœ¨å‰ i-1 ä¸ªå…ƒç´ ä¸­ï¼ˆmaxsofarï¼‰ï¼Œè¦ä¹ˆå…¶ç»“æŸä½ç½®ä¸º iï¼ˆmaxendinghereï¼‰&lt;/p&gt;

    &lt;table&gt;
      &lt;thead&gt;
        &lt;tr&gt;
          &lt;th&gt;Â &lt;/th&gt;
          &lt;th&gt;maxsofar&lt;/th&gt;
          &lt;th&gt;Â &lt;/th&gt;
          &lt;th&gt;maxendinghere&lt;/th&gt;
        &lt;/tr&gt;
      &lt;/thead&gt;
      &lt;tbody&gt;
        &lt;tr&gt;
          &lt;td&gt;Â &lt;/td&gt;
          &lt;td&gt;Â &lt;/td&gt;
          &lt;td&gt;Â &lt;/td&gt;
          &lt;td&gt;i&lt;/td&gt;
        &lt;/tr&gt;
      &lt;/tbody&gt;
    &lt;/table&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;maxsofar&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;maxendinghere&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;c1&quot;&gt;// maxendinghere ä¸€å¼€å§‹ä¸ºç»“æŸä½ç½®ä¸º x-1 çš„æœ€å¤§å­å‘é‡çš„å’Œï¼Œæ­¤å¤„å°†å…¶æ›´æ–°ä¸ºç»“æŸä½ç½®ä¸º i çš„æœ€å¤§å­å‘é‡çš„å’Œ&lt;/span&gt;
	&lt;span class=&quot;c1&quot;&gt;// å¦‚æœåŠ ä¸Š x[i] ä¹‹åä»ç„¶ä¸ºæ­£å€¼ï¼Œé‚£ä¹ˆ maxendinghere åˆ™åŠ ä¸Š x[i]ï¼›å¦åˆ™å°† maxendinghere è®¾ç½®ä¸º 0ï¼ˆç©ºå‘é‡ï¼‰&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;maxendinghere&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;maxendinghere&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;maxsofar&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;maxsofar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maxendinghere&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;åŸç†&quot;&gt;åŸç†&lt;/h2&gt;

&lt;p&gt;ä¸Šè¿°å‡ ä¸ªç®—æ³•ç»™å‡ºäº†å‡ ä¸ªé‡è¦çš„ç®—æ³•è®¾è®¡æŠ€æœ¯ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ä¿å­˜çŠ¶æ€ï¼Œé¿å…é‡å¤è®¡ç®—ï¼šåŠ¨æ€è§„åˆ’&lt;/li&gt;
  &lt;li&gt;åˆ†æ²»ç®—æ³•&lt;/li&gt;
  &lt;li&gt;æ‰«æç®—æ³•&lt;/li&gt;
  &lt;li&gt;å°†ä¿¡æ¯é¢„å¤„ç†è‡³æ•°æ®ç»“æ„ä¸­&lt;/li&gt;
&lt;/ul&gt;</content><author><name>kkzhang</name></author><category term="algrithom" /><summary type="html">é—®é¢˜æè¿°</summary></entry><entry><title type="html">ç¼–ç¨‹ç ç‘: ç¼–ç¨‹å°äº‹</title><link href="http://localhost:4000/programming-pearls-5.html" rel="alternate" type="text/html" title="ç¼–ç¨‹ç ç‘: ç¼–ç¨‹å°äº‹" /><published>2022-06-11T00:00:00+08:00</published><updated>2022-06-11T00:00:00+08:00</updated><id>http://localhost:4000/programming-pearls-5</id><content type="html" xml:base="http://localhost:4000/programming-pearls-5.html">&lt;h3 id=&quot;è„šæ‰‹æ¶&quot;&gt;è„šæ‰‹æ¶&lt;/h3&gt;

&lt;p&gt;ä½¿ç”¨è„šæ‰‹æ¶æ›´æ–¹ä¾¿åœ°è®¿é—®å‡½æ•°ï¼›æœ€ç®€å•çš„è„šæ‰‹æ¶æ˜¯å‘½ä»¤è¡ŒæŠ€æœ¯&lt;/p&gt;

&lt;h3 id=&quot;ç¼–ç &quot;&gt;ç¼–ç &lt;/h3&gt;

&lt;p&gt;é¦–å…ˆä½¿ç”¨ä¼ªä»£ç æ„å»ºç¨‹åºæ¡†æ¶ï¼Œç„¶åå°†ä¼ªä»£ç ç¿»è¯‘æˆè¦å®ç°çš„è¯­è¨€&lt;/p&gt;

&lt;h3 id=&quot;æµ‹è¯•&quot;&gt;æµ‹è¯•&lt;/h3&gt;

&lt;p&gt;åœ¨è„šæ‰‹æ¶ä¸­å¯¹ç»„ä»¶è¿›è¡Œæµ‹è¯•ï¼›é€šè¿‡è„šæ‰‹æ¶å¯¹ç¨‹åºè¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•&lt;/p&gt;

&lt;h3 id=&quot;è°ƒè¯•&quot;&gt;è°ƒè¯•&lt;/h3&gt;

&lt;p&gt;ä¸ç®¡æ˜¯è„šæ‰‹æ¶è¿˜æ˜¯çœŸå®è¿è¡Œç¯å¢ƒï¼Œè°ƒè¯•å·¥ä½œæ€»æ˜¯å¾ˆå›°éš¾çš„&lt;/p&gt;

&lt;h3 id=&quot;è®¡æ—¶&quot;&gt;è®¡æ—¶&lt;/h3&gt;

&lt;p&gt;å¯¹ç¨‹åºæ‰§è¡Œæ—¶é—´è¿›è¡Œè®¡æ—¶ï¼Œç¡®ä¿ç¨‹åºèƒ½å¤Ÿè¾¾åˆ°æˆ‘ä»¬é¢„æœŸçš„æ€§èƒ½&lt;/p&gt;

&lt;h3 id=&quot;æ–­è¨€çš„è‰ºæœ¯&quot;&gt;æ–­è¨€çš„è‰ºæœ¯&lt;/h3&gt;

&lt;p&gt;æ–­è¨€æ—¢å¯ä»¥çŸ¥é“ç¨‹åºçš„ä»£ç å¼€å‘ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥åˆ¤æ–­ç¨‹åºçš„æ­£ç¡®æ€§ã€‚æˆ‘ä»¬å¯ä»¥å°†æ–­è¨€æ’å…¥ä»£ç ä¸­ï¼Œä»¥ç¡®ä¿ç¨‹åºè¿è¡Œæ—¶çš„è¡Œä¸ºä¸æˆ‘ä»¬çš„ç†è§£ä¸€è‡´&lt;/p&gt;</content><author><name>kkzhang</name></author><category term="algrithom" /><summary type="html">è„šæ‰‹æ¶</summary></entry><entry><title type="html">ç¼–ç¨‹ç ç‘: ç¨‹åºæ€§èƒ½åˆ†æ</title><link href="http://localhost:4000/programming-pearls-6-copy.html" rel="alternate" type="text/html" title="ç¼–ç¨‹ç ç‘: ç¨‹åºæ€§èƒ½åˆ†æ" /><published>2022-06-11T00:00:00+08:00</published><updated>2022-06-11T00:00:00+08:00</updated><id>http://localhost:4000/programming-pearls-6%20copy</id><content type="html" xml:base="http://localhost:4000/programming-pearls-6-copy.html">&lt;h2 id=&quot;è®¾è®¡å±‚é¢&quot;&gt;è®¾è®¡å±‚é¢&lt;/h2&gt;

&lt;p&gt;ä¸ºäº†æé«˜ç³»ç»Ÿæ€§èƒ½ï¼Œå¯ä»¥åœ¨å¤šä¸ªå±‚é¢è¿›è¡Œè®¾è®¡ã€‚&lt;/p&gt;

&lt;h3 id=&quot;é—®é¢˜å®šä¹‰&quot;&gt;é—®é¢˜å®šä¹‰&lt;/h3&gt;

&lt;p&gt;è‰¯å¥½çš„é—®é¢˜å®šä¹‰å¯ä»¥é¿å…å¯¹é—®é¢˜éœ€æ±‚çš„è¿‡é«˜ä¼°è®¡ã€‚é—®é¢˜å®šä¹‰ä¸ç¨‹åºæ•ˆç‡ä¹‹é—´å…·æœ‰å¤æ‚çš„ç›¸äº’å½±å“ã€‚&lt;/p&gt;

&lt;h3 id=&quot;ç³»ç»Ÿç»“æ„&quot;&gt;ç³»ç»Ÿç»“æ„&lt;/h3&gt;

&lt;p&gt;å°†å¤§å‹ç³»ç»Ÿåˆ†è§£æˆå¤šä¸ªæ¨¡å—&lt;/p&gt;

&lt;h3 id=&quot;ç®—æ³•å’Œæ•°æ®ç»“æ„&quot;&gt;ç®—æ³•å’Œæ•°æ®ç»“æ„&lt;/h3&gt;

&lt;p&gt;å¯¹äºæ¨¡å—æ€§èƒ½æå‡çš„å…³é”®æ˜¯è¡¨ç¤ºæ•°æ®çš„ç»“æ„å’Œæ“ä½œè¿™äº›æ•°æ®çš„ç®—æ³•&lt;/p&gt;

&lt;h3 id=&quot;ä»£ç è°ƒä¼˜&quot;&gt;ä»£ç è°ƒä¼˜&lt;/h3&gt;

&lt;p&gt;ä¸ç³»ç»Ÿæ— å…³çš„ä»£ç è°ƒä¼˜&lt;/p&gt;

&lt;h3 id=&quot;ç³»ç»Ÿè½¯ä»¶&quot;&gt;ç³»ç»Ÿè½¯ä»¶&lt;/h3&gt;

&lt;p&gt;æ”¹å˜ç³»ç»Ÿæ‰€åŸºäºçš„è½¯ä»¶ï¼›åŒæ—¶è€ƒè™‘ä¸ç³»ç»Ÿç›¸å…³çš„ä»£ç è°ƒä¼˜&lt;/p&gt;

&lt;h3 id=&quot;ç¡¬ä»¶&quot;&gt;ç¡¬ä»¶&lt;/h3&gt;

&lt;p&gt;æ›´å¿«çš„ç¡¬ä»¶å¯ä»¥æé«˜ç³»ç»Ÿçš„æ€§èƒ½&lt;/p&gt;

&lt;h2 id=&quot;åŸç†&quot;&gt;åŸç†&lt;/h2&gt;

&lt;p&gt;å½“æ€§èƒ½é—®é¢˜æ— æ³•å›é¿æ—¶ï¼Œå¯¹äºä¸åŒçš„æ€§èƒ½ç›®æ ‡å¯ä»¥ä»ä¸åŒçš„è®¾è®¡å±‚é¢è¿›è¡Œè€ƒè™‘ã€‚&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;&lt;em&gt;å¦‚æœä»…éœ€è¦è¾ƒå°çš„æ€§èƒ½æå‡ï¼Œå°±å¯¹æ•ˆæœæœ€ä½³çš„å±‚é¢è¿›è¡Œæ”¹è¿›&lt;/em&gt;&lt;/strong&gt;ã€‚&lt;/p&gt;

    &lt;p&gt;é¦–å…ˆè€ƒè™‘æ‰€æœ‰å¯èƒ½çš„è®¾è®¡å±‚é¢ï¼Œç„¶åé€‰æ‹©â€œæ€§ä»·æ¯”â€æœ€é«˜çš„é‚£ä¸ªï¼šè¾ƒå°æŠ•å…¥å¯ä»¥è·å¾—è¾ƒå¤§çš„åŠ é€Ÿç³»æ•°ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;&lt;em&gt;å¦‚æœéœ€è¦è¾ƒå¤§çš„æ€§èƒ½æå‡ï¼Œéœ€è¦å¯¹å¤šä¸ªå±‚é¢è¿›è¡Œæ”¹è¿›&lt;/em&gt;&lt;/strong&gt;ã€‚&lt;/p&gt;

    &lt;p&gt;éœ€è¦ä»å„ä¸ªä¸åŒæ–¹å‘å¯¹é—®é¢˜è¿›è¡Œæ·±å…¥ç ”ç©¶ã€‚&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;</content><author><name>kkzhang</name></author><category term="algrithom" /><summary type="html">è®¾è®¡å±‚é¢</summary></entry><entry><title type="html">Lion è®¾è®¡ä¸å®ç°</title><link href="http://localhost:4000/lion-design-and-implements.html" rel="alternate" type="text/html" title="Lion è®¾è®¡ä¸å®ç°" /><published>2022-05-28T00:00:00+08:00</published><updated>2022-05-28T00:00:00+08:00</updated><id>http://localhost:4000/lion-design-and-implements</id><content type="html" xml:base="http://localhost:4000/lion-design-and-implements.html">&lt;blockquote&gt;
  &lt;p&gt;æœ¬æ–‡æ˜¯åœ¨ç¾å›¢å†…éƒ¨é¢å‘å…¶ä»–å›¢é˜Ÿçš„åˆ†äº«&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h1 id=&quot;1-ä»‹ç»&quot;&gt;1-ä»‹ç»&lt;/h1&gt;

&lt;h2 id=&quot;1-1-åŠŸèƒ½ä»‹ç»&quot;&gt;1-1 åŠŸèƒ½ä»‹ç»&lt;/h2&gt;

&lt;p&gt;Lion æ˜¯ä¸€ä¸ªé¢å‘åˆ†å¸ƒå¼ç³»ç»Ÿçš„é…ç½®ä¸­å¿ƒï¼Œé‡‡ç”¨ä¸­å¿ƒåŒ–æ•°æ®ç®¡ç†ï¼Œé€šè¿‡ C/S æ¶æ„å®ç°é…ç½®çš„ç»Ÿä¸€ç®¡ç†å’Œå®æ—¶æ¨é€ã€‚&lt;/p&gt;

&lt;p&gt;åº”ç”¨ç¨‹åºä½¿ç”¨ Lion å¯å®ç°é…ç½®ä¸ä»£ç åˆ†ç¦»ã€é…ç½®å˜æ›´æ¨é€ã€å†å²ç‰ˆæœ¬ç®¡ç†ã€ç°åº¦å‘å¸ƒç­‰åŠŸèƒ½ã€‚é€šè¿‡é›†ä¸­åŒ–çš„åœ¨çº¿é…ç½®ç®¡ç†ï¼Œåº”ç”¨å¯ä»¥å®ç°ç§’çº§é…ç½®å˜æ›´ï¼Œå¹¶ä¸”ä¿è¯æ‰€æœ‰èŠ‚ç‚¹é…ç½®çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒLion è¿˜æä¾›æ“ä½œæ—¥å¿—æŸ¥çœ‹ã€ç°åº¦å‘å¸ƒã€é…ç½®å®¡æ ¸ç­‰é«˜çº§åŠŸèƒ½ã€‚&lt;/p&gt;

&lt;h2 id=&quot;1-2-sla-æŒ‡æ ‡&quot;&gt;1-2 SLA æŒ‡æ ‡&lt;/h2&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;æŒ‡æ ‡&lt;/th&gt;
      &lt;th&gt;ç›®æ ‡&lt;/th&gt;
      &lt;th&gt;è¯´æ˜&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;æ¨é€æˆåŠŸç‡&lt;/td&gt;
      &lt;td&gt;99.9%&lt;/td&gt;
      &lt;td&gt;é…ç½®ä¿®æ”¹æˆåŠŸåï¼ˆ5så†…ï¼‰æ‰€æœ‰å®¢æˆ·ç«¯æˆåŠŸè·å–åˆ°æœ€æ–°é…ç½®çš„æ¯”ä¾‹&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;æ¨é€æ—¶æ•ˆæ€§&lt;/td&gt;
      &lt;td&gt;&amp;lt;5s&lt;/td&gt;
      &lt;td&gt;é…ç½®ä»ä¿®æ”¹æˆåŠŸåˆ°å®¢æˆ·ç«¯è·å–åˆ°æ–°é…ç½®çš„æ—¶é—´&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;å½“é…ç½®è¿›è¡Œä¸€æ¬¡æˆåŠŸå˜æ›´ä¹‹åï¼Œ&lt;strong&gt;Lion åªèƒ½ä¿è¯æœ€ç»ˆä¸€è‡´æ€§&lt;/strong&gt;ï¼Œå³æ‰€æœ‰ Client æœ€ç»ˆéƒ½èƒ½è·å–åˆ°æœ€æ–°é…ç½®ï¼Œ&lt;strong&gt;ä¸èƒ½ä¿è¯å¼ºä¸€è‡´æ€§&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;h2 id=&quot;1-2-æœåŠ¡ç«¯æ€§èƒ½æŒ‡æ ‡&quot;&gt;1-2 æœåŠ¡ç«¯æ€§èƒ½æŒ‡æ ‡&lt;/h2&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;æŒ‡æ ‡&lt;/th&gt;
      &lt;th&gt;æ•°æ®&lt;/th&gt;
      &lt;th&gt;è¯´æ˜&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;å•æœº/é›†ç¾¤å†™æ€§èƒ½(8C8G)&lt;/td&gt;
      &lt;td&gt;700QPS/2500QPS&lt;/td&gt;
      &lt;td&gt;HTTP Open API&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;å•æœºè¯»æ€§èƒ½(8C8G, RT &amp;lt; 100ms)&lt;/td&gt;
      &lt;td&gt;7000QPS&lt;/td&gt;
      &lt;td&gt;HTTP Open API&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;å•æœºæœ€ä¼˜è¿æ¥æ•°(8C/16G)&lt;/td&gt;
      &lt;td&gt;8000&lt;/td&gt;
      &lt;td&gt;æœåŠ¡ç«¯é•¿è½®è¯¢è¿æ¥&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;åŒ—ä¸ŠåŒæ­¥å»¶è¿Ÿï¼ˆ1700QPSï¼‰&lt;/td&gt;
      &lt;td&gt;TP999&amp;lt;500ms&lt;/td&gt;
      &lt;td&gt;æ•°æ®åœ¨ä¸€ä¾§æ•°æ®ä¸­å¿ƒå‘ç”Ÿå˜æ›´åï¼ŒåŒæ­¥åˆ°å¦ä¸€ä¾§çš„å»¶è¿Ÿ&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h1 id=&quot;2-ç³»ç»Ÿè®¾è®¡&quot;&gt;2-ç³»ç»Ÿè®¾è®¡&lt;/h1&gt;

&lt;h2 id=&quot;2-1-æ•´ä½“æ¶æ„&quot;&gt;2-1 æ•´ä½“æ¶æ„&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;/images/lion/lion_1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Lion ç³»ç»Ÿé‡‡ç”¨å¼‚åœ°å¤šæ´»æ¶æ„ï¼šåŒ—äº¬ &amp;amp; ä¸Šæµ·å„éƒ¨ç½²ä¸€å¥—æ•°æ®ä¸­å¿ƒï¼Œæ”¯æŒåŒå†™ï¼Œé€šè¿‡è‡ªç ”åŒæ­¥ç»„ä»¶ï¼ˆConsistencyï¼‰ä¿è¯ä¸¤ä¸ªæ•°æ®ä¸­å¿ƒé—´æ•°æ®ä¸€è‡´æ€§ã€‚ä¸šåŠ¡é…ç½®å­˜å‚¨ä¸»è¦ä½¿ç”¨ MySQL, Redis ä½œä¸ºå­˜å‚¨ä»‹è´¨ï¼ˆZK å³å°†ä¸‹çº¿ï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;ç”¨æˆ·å¯ä»¥é€šè¿‡ç®¡ç†ç«¯ï¼ˆConsoleï¼‰ä¸ HTTP æ¥å£ï¼ˆAPIï¼‰è¿›è¡Œé…ç½®å˜æ›´ä¸æŸ¥è¯¢æ“ä½œï¼ŒåŒæ—¶ Lion ä¹Ÿæ”¯æŒå¤šè¯­è¨€çš„ SDKï¼ˆJavaï¼ŒNodeï¼ŒC++ï¼ŒGolangï¼‰ï¼Œä¾¿äºä¸šåŠ¡æœåŠ¡è¿›è¡Œé…ç½®è·å–ä¸å˜æ›´ç›‘å¬æ“ä½œã€‚&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;æ¨¡å—åç§°&lt;/th&gt;
      &lt;th&gt;ä¸»è¦åŠŸèƒ½&lt;/th&gt;
      &lt;th&gt;å¤‡æ³¨&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;lion-config&lt;/td&gt;
      &lt;td&gt;ç”¨äº client è·å–é…ç½®ä¸ç›‘å¬é…ç½®å˜æ›´&lt;/td&gt;
      &lt;td&gt;client ä¸ config ä½¿ç”¨é•¿è½®è¯¢é€šä¿¡; config é›†ç¾¤åŒ—ä¸Šå¤šæœºæˆ¿éƒ¨ç½²ï¼Œæ”¯æŒå¤šé›†ç¾¤&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;lion-consistency&lt;/td&gt;
      &lt;td&gt;ä¸åŒæ•°æ®ä¸­å¿ƒé—´æ•°æ®åŒæ­¥; åŒä¸€æ•°æ®ä¸­å¿ƒï¼Œä¸åŒå­˜å‚¨ä»‹è´¨æ•°æ®åŒæ­¥&lt;/td&gt;
      &lt;td&gt;åŒ—ä¸ŠåŒé›†ç¾¤éƒ¨ç½²&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;lion-meta&lt;/td&gt;
      &lt;td&gt;å®ç° config, consistency æœåŠ¡å‘ç°åŠŸèƒ½ consistency åŒæ­¥æ•°æ®åˆ†åŒºç­–ç•¥æ§åˆ¶; ç”¨äº client è·å–ç›¸å…³å…ƒæ•°æ®ï¼šconfig èŠ‚ç‚¹åˆ—è¡¨ï¼Œé»‘ç™½åå•é¡¹ç›®ç­‰&lt;/td&gt;
      &lt;td&gt;å¼±ä¾èµ– mns å®ç°èŠ‚ç‚¹æ³¨å†Œå‘ç°åŠŸèƒ½ï¼Œåœ¨ mns ä¸å¯ç”¨æ—¶é™çº§åˆ°è‡ªç ”å¥åº·æ£€æµ‹ç­–ç•¥&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;lion-client&lt;/td&gt;
      &lt;td&gt;ä¸ config æœåŠ¡äº¤äº’å®ç°é…ç½®è·å–/ç›‘å¬åŠŸèƒ½&lt;/td&gt;
      &lt;td&gt;å®šæ—¶ä» meta è·å–å¯ç”¨ config èŠ‚ç‚¹åˆ—è¡¨ï¼Œå¹¶é€šè¿‡é•¿è½®è¯¢è®¿é—® config æœåŠ¡ç«¯; config æœåŠ¡ä¸å¯ç”¨æ—¶ï¼Œä»æœ¬åœ°æ–‡ä»¶è·å–é…ç½®ï¼ˆå¯èƒ½æ˜¯è¿‡æœŸæ•°æ®ï¼‰; æ”¯æŒå¤šè¯­è¨€ sdk: java, node, go, c++&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;lion-api&lt;/td&gt;
      &lt;td&gt;æä¾› http open apiï¼šç”¨äºä¸šåŠ¡æ–¹é€šè¿‡ http å®ç°é…ç½®çš„å˜æ›´ä¸æŸ¥è¯¢&lt;/td&gt;
      &lt;td&gt;Â &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;lion-console&lt;/td&gt;
      &lt;td&gt;ç®¡ç†ç«¯äº¤äº’ï¼Œæä¾›é…ç½®å¢åˆ æ”¹æŸ¥åŠŸèƒ½&lt;/td&gt;
      &lt;td&gt;Â &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;2-1-é…ç½®è·å–ä¸æ¨é€&quot;&gt;2-1 é…ç½®è·å–ä¸æ¨é€&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;/images/lion/lion_2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Client åœ¨è·å–é…ç½®æ—¶ï¼ŒåŠ è½½ç­–ç•¥ä¾æ¬¡ä¸ºï¼š&lt;strong&gt;1. å†…å­˜ç¼“å­˜ï¼Œ2. Lion è¿œç¨‹æœåŠ¡ç«¯ï¼Œ3. æœ¬åœ°æŒä¹…åŒ–æ–‡ä»¶&lt;/strong&gt;ã€‚åœ¨ä»æœåŠ¡ç«¯æŸä¸ªèŠ‚ç‚¹åŠ è½½å¤±è´¥æ—¶ï¼Œä¼šåŠæ—¶åˆ‡æ¢åˆ°å…¶ä»–å¯ç”¨èŠ‚ç‚¹ï¼Œç›´åˆ°è¶…æ—¶ï¼›ä¹‹åä¼šé™çº§åˆ°æœ¬åœ°æ–‡ä»¶ï¼ˆå¯èƒ½ä»æ˜¯ä¸Šæ¬¡è·å–åˆ°çš„æ—§å€¼ï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;Config æœåŠ¡ç«¯åœ¨æ”¶åˆ° Client è·å–é…ç½®çš„è¯·æ±‚åï¼Œä¾æ¬¡ä»ï¼š&lt;strong&gt;1. å†…å­˜ç¼“å­˜ï¼Œ2. Redisï¼Œ3. DB&lt;/strong&gt; ä¸­åŠ è½½é…ç½®ã€‚é…ç½®åŠ è½½æˆåŠŸä¹‹åï¼Œéœ€è¦æ¯”è¾ƒ Client æºå¸¦çš„é…ç½®ç‰ˆæœ¬å·ï¼ˆc_versionï¼‰ä¸æœåŠ¡ç«¯åŠ è½½åˆ°çš„é…ç½®ç‰ˆæœ¬å·ï¼ˆs_versionï¼‰ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å¦‚æœ c_verison == 0ï¼Œåˆ™è¯´æ˜ Client é¦–æ¬¡è·å–è¯¥é…ç½®ï¼Œæ­¤æ—¶ç›´æ¥è¿”å›æœåŠ¡ç«¯é…ç½®&lt;/li&gt;
  &lt;li&gt;å¦‚æœ c_version != 0 ä¸” c_version &amp;lt; s_versionï¼Œåˆ™è¯´æ˜è¯¥é…ç½®åœ¨ Client ä¸Šæ¬¡åŠ è½½ä¹‹ååˆæ›´æ–°è¿‡ï¼Œæ­¤æ—¶éœ€è¦å°†æœ€æ–°é…ç½®è¿”å›&lt;/li&gt;
  &lt;li&gt;å¦‚æœ c_version != 0 ä¸” c_version &amp;gt;= s_versionï¼Œåˆ™è¯´æ˜ Client æœ¬åœ°é…ç½®å·²ç»æ˜¯æœ€æ–°å€¼ï¼Œæ­¤æ—¶è¯·æ±‚è¢« hang ä½ï¼Œç›´åˆ°è¯¥é…ç½®è¢«æ›´æ–°æˆ–è€…è¯·æ±‚è¶…æ—¶ï¼ˆ100sï¼‰&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;2-2-ä¸€è‡´æ€§ä¿éšœ&quot;&gt;2-2 ä¸€è‡´æ€§ä¿éšœ&lt;/h2&gt;

&lt;p&gt;Lion é…ç½®å­˜å‚¨åˆ†ä¸ºåŒ—äº¬/ä¸Šæµ·ä¸¤ä¸ªæ•°æ®ä¸­å¿ƒï¼Œæ¯ä¸ªæ•°æ®ä¸­å¿ƒåˆ†åˆ«æœ‰ DB, Redis, ZK(å³å°†ä¸‹çº¿) ã€‚ä¸ºäº†å®ç°å¼‚åœ°å¤šæ´»ï¼Œéœ€è¦ä¿è¯åŒ—ä¸Šæ•°æ®çš„ä¸€è‡´æ€§ã€‚&lt;/p&gt;

&lt;p&gt;Lion é‡‡å–çš„æ˜¯æœ€ç»ˆä¸€è‡´æ€§ï¼Œä¸€è‡´æ€§ä¿éšœç”± Consistency æ¨¡å—ç»´æŠ¤ï¼Œæ•´ä½“å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªæ–¹é¢ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;ä¸åŒæ•°æ®ä¸­å¿ƒé—´çš„ä¸€è‡´æ€§&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;åŒä¸€æ•°æ®ä¸­å¿ƒå†…ä¸åŒå­˜å‚¨ä»‹è´¨çš„ä¸€è‡´æ€§&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;2-2-1-åŒæ­¥æ¨¡å‹&quot;&gt;2-2-1 åŒæ­¥æ¨¡å‹&lt;/h3&gt;

&lt;p&gt;ä¸ºäº†å®ç°æ•°æ®æœ€ç»ˆä¸€è‡´æ€§ï¼Œlion å¯¹æ¯æ¬¡é…ç½®å˜æ›´éƒ½ä¼šè®°å½•ä¸€æ¡ logï¼Œè¢«ç§°ä¸ºåŒæ­¥æ—¥å¿—ï¼ˆsync logï¼‰ã€‚è¯¥ log æ¨¡å‹åŸºæœ¬å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;key&lt;/th&gt;
      &lt;th&gt;release_key&lt;/th&gt;
      &lt;th&gt;local_db_status&lt;/th&gt;
      &lt;th&gt;remote_db_status&lt;/th&gt;
      &lt;th&gt;zk_status&lt;/th&gt;
      &lt;th&gt;redis_status&lt;/th&gt;
      &lt;th&gt;status&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;é…ç½®å”¯ä¸€æ ‡è¯†&lt;/td&gt;
      &lt;td&gt;é…ç½®å˜æ›´å”¯ä¸€æ ‡è¯†&lt;/td&gt;
      &lt;td&gt;åŒä¾§ db çŠ¶æ€ï¼š0 æœªåŒæ­¥ï¼Œ1 åŒæ­¥æˆåŠŸ&lt;/td&gt;
      &lt;td&gt;å¼‚åœ° db çŠ¶æ€:0 æœªåŒæ­¥ï¼Œ1 åŒæ­¥æˆåŠŸ&lt;/td&gt;
      &lt;td&gt;åŒä¾§ zk çŠ¶æ€ï¼š0 æœªåŒæ­¥ï¼Œ1 åŒæ­¥æˆåŠŸ&lt;/td&gt;
      &lt;td&gt;åŒä¾§ redis çŠ¶æ€:0 æœªåŒæ­¥ï¼Œ1 åŒæ­¥æˆåŠŸ&lt;/td&gt;
      &lt;td&gt;æœ¬æ¬¡å˜æ›´åŒæ­¥çŠ¶æ€: 0 æœªåŠ è½½ï¼Œ1 å·²åŠ è½½æœªåŒæ­¥ï¼Œ2 åŒæ­¥æˆåŠŸ&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;blockquote&gt;
  &lt;p&gt;status å­—æ®µç”¨äºæ ‡è¯†åŒæ­¥æµç¨‹æ˜¯å¦å…¨éƒ¨æˆåŠŸï¼Œå¦‚æœåŒæ­¥å¤±è´¥ï¼Œåˆ™ä¼šé‡è¯•ç›´åˆ°åŒæ­¥æˆåŠŸã€‚&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;ä¸ç®¡æ˜¯é€šè¿‡ http api æ¥å£è¿˜æ˜¯ç®¡ç†ç«¯å˜æ›´é…ç½®ï¼Œåªä¼šæ›´æ–°åŒä¾§çš„ dbï¼Œå¹¶ä¸ä¼šåŒæ­¥æ›´æ–°åŒä¾§æ•°æ®ä¸­å¿ƒå†…çš„ zk, redisï¼ˆæé«˜æ¥å£æ€§èƒ½ï¼‰ã€‚æ¯æ¬¡é…ç½®å˜æ›´äº§ç”Ÿçš„ log ä¸ºï¼š&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;local_db&lt;/th&gt;
      &lt;th&gt;remote_db&lt;/th&gt;
      &lt;th&gt;zk&lt;/th&gt;
      &lt;th&gt;redis&lt;/th&gt;
      &lt;th&gt;status&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;0&lt;/td&gt;
      &lt;td&gt;0&lt;/td&gt;
      &lt;td&gt;0&lt;/td&gt;
      &lt;td&gt;0&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;2-2-2-åŒæ­¥æµç¨‹&quot;&gt;2-2-2 åŒæ­¥æµç¨‹&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;/images/lion/lion_3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;åŒæ­¥æµç¨‹æ­¥éª¤åˆ†ä¸ºï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;log åŠ è½½&lt;/strong&gt;ï¼šå°†æœªåŒæ­¥å®Œæˆçš„æ—¥å¿—ä» db ä¸­åŠ è½½åˆ°å†…å­˜é˜Ÿåˆ—ä¸­&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;å¼‚åœ°åŒæ­¥&lt;/strong&gt;ï¼šä¼˜å…ˆå°† log æ‰¹é‡åŒæ­¥åˆ°å¼‚åœ°ï¼›å¼‚åœ°åŒæ­¥æˆåŠŸåå°† log hash åˆ°å†…å­˜é˜Ÿåˆ—ä¸­&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;æœ¬åœ°åŒæ­¥&lt;/strong&gt;ï¼šå°† log é¡ºåºåŒæ­¥åˆ°æœ¬åœ° db, redis, zk ä¸­&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/images/lion/lion_4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç»“åˆ log ä¸­å„ä¸ªåŒæ­¥çŠ¶æ€è¿›ä¸€æ­¥åˆ†æï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;æœ¬åœ° db åŒæ­¥&lt;/strong&gt;ï¼šå¦‚æœæœ¬åœ° db æœªåŒæ­¥ï¼Œåˆ™é¦–å…ˆåŒæ­¥ dbã€‚å¦‚æœåŒæ­¥æˆåŠŸï¼Œåˆ™ log.local_db = 1ã€‚ï¼ˆå¯¹ log äº§ç”Ÿä¾§æ¥è¯´ï¼Œlocal_db é»˜è®¤ 1ï¼Œå³é»˜è®¤ä¸åŒæ­¥ï¼‰&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;å¼‚åœ°åŒæ­¥&lt;/strong&gt;ï¼šè¯¥æµç¨‹ä¸ºå¼‚æ­¥æ“ä½œï¼Œä»…ä»…æ˜¯&lt;em&gt;å°† log å‘é€åˆ°å¼‚åœ°å¹¶è¢«æ¥æ”¶ï¼Œå¹¶åœ¨ç¨åå°†é…ç½®å›å†™åˆ° db, redis, zk&lt;/em&gt;ã€‚å¦‚æœåŒæ­¥æˆåŠŸï¼Œåˆ™ log.remote_db = 1.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;æœ¬åœ° redis åŒæ­¥&lt;/strong&gt;ï¼šå¦‚æœåŒæ­¥æˆåŠŸï¼Œåˆ™ log.local_redis = 1.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;æœ¬åœ° zk åŒæ­¥&lt;/strong&gt;ï¼šå¦‚æœåŒæ­¥æˆåŠŸï¼Œåˆ™ log.local_zk = 1.&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;3-å¯ç”¨æ€§&quot;&gt;3-å¯ç”¨æ€§&lt;/h2&gt;

&lt;p&gt;æ‰¿è¯º Lion æœåŠ¡çš„å¯ç”¨æ€§ä¸ä½äº 99.99%ã€‚&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;æ¨¡å—åç§°&lt;/th&gt;
      &lt;th&gt;é›†ç¾¤åˆ†å¸ƒ&lt;/th&gt;
      &lt;th&gt;å¤–éƒ¨ä¾èµ–&lt;/th&gt;
      &lt;th&gt;å†…éƒ¨ä¾èµ–&lt;/th&gt;
      &lt;th&gt;RTO&lt;/th&gt;
      &lt;th&gt;æ•…éšœæ—¶ä¸»åŠ¨åˆ‡æ¢ SLA&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;lion-consistency&lt;/td&gt;
      &lt;td&gt;ä¸¤åœ°å¤šæœºæˆ¿&lt;/td&gt;
      &lt;td&gt;MySQLã€S3ã€ä¸“çº¿ï¼ˆå¼±ï¼‰ã€DNSï¼ˆå¼±ï¼‰&lt;/td&gt;
      &lt;td&gt;lion-meta&lt;/td&gt;
      &lt;td&gt;120s&lt;/td&gt;
      &lt;td&gt;0s&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;lion-api&lt;/td&gt;
      &lt;td&gt;ä¸¤åœ°å¤šæœºæˆ¿&lt;/td&gt;
      &lt;td&gt;MySQLã€S3ã€Redisï¼ˆå¼±ï¼‰&lt;/td&gt;
      &lt;td&gt;Â &lt;/td&gt;
      &lt;td&gt;120s&lt;/td&gt;
      &lt;td&gt;0s&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;lion-config&lt;/td&gt;
      &lt;td&gt;ä¸¤åœ°å¤šæœºæˆ¿&lt;/td&gt;
      &lt;td&gt;MySQLã€S3ã€Redisï¼ˆå¼±ï¼‰&lt;/td&gt;
      &lt;td&gt;lion-meta&lt;/td&gt;
      &lt;td&gt;120s&lt;/td&gt;
      &lt;td&gt;0s&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;lion-console&lt;/td&gt;
      &lt;td&gt;ä¸¤åœ°å¤šæœºæˆ¿&lt;/td&gt;
      &lt;td&gt;MySQL&lt;/td&gt;
      &lt;td&gt;lion-api&lt;/td&gt;
      &lt;td&gt;60s&lt;/td&gt;
      &lt;td&gt;0s&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;lion-meta&lt;/td&gt;
      &lt;td&gt;ä¸¤åœ°å¤šæœºæˆ¿&lt;/td&gt;
      &lt;td&gt;MySQLã€MNSï¼ˆå¼±ï¼‰&lt;/td&gt;
      &lt;td&gt;Â &lt;/td&gt;
      &lt;td&gt;60s&lt;/td&gt;
      &lt;td&gt;0s&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;lion-client&lt;/td&gt;
      &lt;td&gt;-&lt;/td&gt;
      &lt;td&gt;DNS&lt;/td&gt;
      &lt;td&gt;lion-configã€lion-metaï¼ˆå¼±ï¼‰&lt;/td&gt;
      &lt;td&gt;T_{æ–­è¿æ„ŸçŸ¥}=120s&lt;/td&gt;
      &lt;td&gt;3s (timeout)+3s * (0~N) (N:å¼‚å¸¸ Config æ•°ç›®)&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;img src=&quot;/images/lion/lion_5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;config æœåŠ¡åŒ—ä¸Šä¸¤åœ°å¤šæœºæˆ¿éƒ¨ç½²ï¼Œæ”¯æŒå¼¹æ€§ä¼¸ç¼©ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å¯¹äºå¼‚å¸¸ config èŠ‚ç‚¹ï¼Œmeta ä¼šåŠæ—¶å‰”é™¤ï¼Œä¿è¯ä¸‹å‘ç»™ client èŠ‚ç‚¹åˆ—è¡¨çš„å¯ç”¨æ€§&lt;/li&gt;
  &lt;li&gt;client åœ¨è¯·æ±‚ config æœåŠ¡ç«¯è·å–é…ç½®æ—¶ï¼Œä¼˜å…ˆè®¿é—®åŒåœ°åŸŸèŠ‚ç‚¹ï¼›åŒåœ°åŸŸæ— å¯ç”¨èŠ‚ç‚¹æ—¶ï¼Œè®¿é—®å¼‚åœ°èŠ‚ç‚¹&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;å¦‚æœæ‰€æœ‰ config èŠ‚ç‚¹å‡ä¸å¯ç”¨ï¼Œåˆ™é™çº§åˆ°æœ¬åœ°æŒä¹…åŒ–æ–‡ä»¶&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;config æœåŠ¡åŠ è½½é…ç½®æ—¶ï¼Œå¼ºä¾èµ– dbï¼Œs3(æ–‡ä»¶é…ç½®)ï¼Œå¼±ä¾èµ– redisï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;redis ä¸å¯ç”¨æ—¶ï¼Œå¯¹é…ç½®è·å– &amp;amp; æ¨é€æ²¡æœ‰å½±å“&lt;/li&gt;
  &lt;li&gt;dbï¼Œs3 ä¸å¯ç”¨æ—¶ï¼Œclient æ— æ³•è·å–åˆ°æœ€æ–°é…ç½®ï¼ˆé€šè¿‡ config å†…å­˜ç¼“å­˜å¯ä»¥è·å–åˆ°æ—§é…ç½®ï¼‰&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/images/lion/lion_6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;consistency æœåŠ¡åŒ—ä¸Šä¸¤åœ°å¤šæœºæˆ¿éƒ¨ç½²ï¼Œæ”¯æŒå¼¹æ€§ä¼¸ç¼©ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;åŒæ­¥ log åŠ è½½å¼ºä¾èµ– dbï¼Œdb ä¸å¯ç”¨æ—¶ï¼ŒåŒæ­¥ä»»åŠ¡æ— æ³•æ‰§è¡Œ&lt;/li&gt;
  &lt;li&gt;consistency èŠ‚ç‚¹å¼‚å¸¸æ—¶ï¼Œmeta ä¼šåŠæ—¶å‰”é™¤ï¼Œå¹¶æ›´æ–°åŒæ­¥ç­–ç•¥ï¼ˆå°½å¯èƒ½é™ä½èŠ‚ç‚¹å˜æ›´å¯¹åŒæ­¥å»¶è¿Ÿçš„å½±å“ï¼‰&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;4-éš”ç¦»æ€§&quot;&gt;4-éš”ç¦»æ€§&lt;/h2&gt;

&lt;p&gt;é…ç½®éš”ç¦»å¯ä»¥ä»ä¸¤ä¸ªæ–¹é¢æ¥çœ‹ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;é…ç½®è·å–&lt;/strong&gt;ï¼šå®¢æˆ·ç«¯é€šè¿‡é•¿è½®è¯¢è®¿é—® lion-config è·å–ç›®æ ‡é…ç½®&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;é…ç½®åŒæ­¥&lt;/strong&gt;ï¼šé…ç½®å˜æ›´åœ¨åŒ—ä¸Šä¸¤åœ°/åŒä¸€æ•°æ®ä¸­å¿ƒå†…ä¿æŒä¸€è‡´&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;4-1-é…ç½®è·å–&quot;&gt;4-1 é…ç½®è·å–&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;/images/lion/lion_7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;config æœåŠ¡æ”¯æŒå¤šé›†ç¾¤ï¼Œä¸åŒé›†ç¾¤ç®¡ç†ç‰¹å®šä¸šåŠ¡é…ç½®ã€‚å¯¹äºä¸€äº›é…ç½®å®¹é‡å¤§/ç¨³å®šæ€§è¦æ±‚é«˜çš„ä¸šåŠ¡ï¼Œä¼šæ‹†åˆ†å‡ºç‹¬ç«‹é›†ç¾¤ï¼Œå…¶ä»–ä¸šåŠ¡å…±äº«é»˜è®¤é›†ç¾¤ã€‚&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;config é›†ç¾¤&lt;/th&gt;
      &lt;th&gt;é›†ç¾¤æ‰€å±é¡¹ç›®&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;zebra&lt;/td&gt;
      &lt;td&gt;{ds, group-ds}&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;buffalo&lt;/td&gt;
      &lt;td&gt;{buffalo-reader-taskï¼Œbuffalo-clientï¼Œbuffalo-writer-task}&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;waf&lt;/td&gt;
      &lt;td&gt;{com.sankuai.sec.waf.manage}&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;default&lt;/td&gt;
      &lt;td&gt;{others}&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;å„ä¸ªé›†ç¾¤&lt;strong&gt;é…ç½®ç®¡ç†ç›¸äº’ç‹¬ç«‹ï¼Œä¸šåŠ¡æµé‡éš”ç¦»&lt;/strong&gt;ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;buffalo é…ç½®è·å–åªä¼šè®¿é—® buffalo é›†ç¾¤ï¼ŒåŒæ—¶ buffalo é›†ç¾¤åªç®¡ç† buffalo ç›¸å…³çš„é…ç½®&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;ä¸è¿‡ï¼Œå„ä¸ª config é›†ç¾¤ä¾èµ–çš„åº•å±‚å­˜å‚¨ï¼ˆredis, dbï¼‰ä»å…±ç”¨ä¸€ä¸ªé›†ç¾¤&lt;/p&gt;

&lt;/blockquote&gt;

&lt;h3 id=&quot;4-2-é…ç½®åŒæ­¥&quot;&gt;4-2 é…ç½®åŒæ­¥&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;/images/lion/lion_8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ç”±äºä¸åŒä¸šåŠ¡å¯¹æ¨é€å»¶è¿Ÿçš„æ•æ„Ÿç¨‹åº¦ä¸åŒï¼Œå› æ­¤æˆ‘ä»¬å°†é…ç½®åŒæ­¥åˆ†ä¸ºä¸¤ç§ï¼š1. æ™®é€šé…ç½®ï¼Œ2. é«˜ä¼˜å…ˆçº§é…ç½®ï¼›è¿™ä¸¤ç§é…ç½®åŒæ­¥æµç¨‹ç›¸äº’éš”ç¦»ã€‚&lt;/p&gt;

&lt;p&gt;é€šè¿‡å°†ä¸åŒé…ç½®çš„åŒæ­¥æµç¨‹éš”ç¦»ï¼Œä½¿å¾—æ™®é€šé…ç½®çš„å †ç§¯å¹¶ä¸ä¼šå¯¹é«˜ä¼˜å…ˆçº§é…ç½®çš„åŒæ­¥æµç¨‹äº§ç”Ÿå½±å“ã€‚&lt;/p&gt;

&lt;h3 id=&quot;4-2-1-å±€é™&quot;&gt;4-2-1 å±€é™&lt;/h3&gt;

&lt;p&gt;ä¸ç®¡æ˜¯é…ç½®åŒæ­¥è¿˜æ˜¯é…ç½®æ¨é€ï¼Œç›®å‰éƒ½æ˜¯åœ¨ä¸šåŠ¡é€»è¾‘å±‚è¿›è¡Œéš”ç¦»ï¼Œåœ¨åº•å±‚å­˜å‚¨æ–¹é¢ï¼Œæ‰€æœ‰ä¸šåŠ¡å…±äº«ä¸€å¥—å­˜å‚¨ã€‚å› æ­¤ï¼Œç›®å‰é’ˆå¯¹ä¸šåŠ¡éš”ç¦»ä»å­˜åœ¨ä¸€å®šçš„å±€é™æ€§ï¼Œå¦‚ db é›†ç¾¤å¼‚å¸¸æ—¶ï¼Œæ‰€æœ‰ä¸šåŠ¡æ–¹éƒ½ä¼šå—åˆ°å½±å“ã€‚&lt;/p&gt;

&lt;p&gt;ä¸è¿‡ï¼Œé‰´äºå½“å‰å•é›†ç¾¤å­˜å‚¨å®¹é‡åœ¨ä¸­çŸ­æœŸå†…ä»èƒ½æ”¯æ’‘ä¸šåŠ¡å¢é•¿ï¼Œå¹¶ä¸”å­˜å‚¨å±‚çš„å¯ç”¨æ€§ä¹Ÿèƒ½æ»¡è¶³ Lion çš„éœ€æ±‚ï¼Œå› æ­¤çŸ­æœŸå†…ä»ä¼šä¿æŒç°æœ‰éš”ç¦»æ–¹æ¡ˆã€‚&lt;/p&gt;

&lt;h2 id=&quot;5-å¯è§‚æµ‹æ€§&quot;&gt;5-å¯è§‚æµ‹æ€§&lt;/h2&gt;

&lt;h3 id=&quot;5-1-æ¨é€é“¾è·¯&quot;&gt;5-1 æ¨é€é“¾è·¯&lt;/h3&gt;

&lt;p&gt;å¯¹äºæ¯æ¬¡é…ç½®å˜æ›´çš„æ¨é€æƒ…å†µï¼ŒLion æä¾›äº†æ¨é€é“¾è·¯çš„åŠŸèƒ½å¸®åŠ©ç”¨æˆ·æ’æŸ¥é…ç½®çš„æ¨é€æƒ…å†µï¼ŒåŒ…æ‹¬ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;æ¨åŠ¨æˆåŠŸç‡ï¼Œæ¨é€å»¶è¿Ÿï¼Œæ¯å°æœºå™¨çš„æ¨é€è¯¦æƒ…ç­‰&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¸è¿‡ï¼Œè¯¥åŠŸèƒ½å¯¹ lion-client ç‰ˆæœ¬æœ‰æ‰€è¦æ±‚ï¼ˆ&amp;gt;=0.8.15.4ï¼‰ï¼Œç›®å‰è¦†ç›–ç‡ &amp;gt;80%ï¼ˆå„ç‰ˆæœ¬åˆ†å¸ƒæƒ…å†µï¼‰.&lt;/p&gt;

&lt;h3 id=&quot;5-2-æ•°æ®åŒæ­¥&quot;&gt;5-2 æ•°æ®åŒæ­¥&lt;/h3&gt;

&lt;p&gt;å¯¹äºé…ç½®åŒæ­¥ï¼Œæœ‰ä¸¤ä¸ªå…³é”®æŒ‡æ ‡ï¼š1. åŒæ­¥å»¶è¿Ÿï¼Œ2. åŒæ­¥æˆåŠŸç‡ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;åŒæ­¥å»¶è¿Ÿçš„å¤§å°ä¸é…ç½®å¤§å°ï¼Œé…ç½®çš„å˜æ›´é¢‘ç‡ï¼ŒåŒæ­¥æ‰¹æ¬¡å¤§å°ï¼ŒåŒæ­¥ä»»åŠ¡é—´éš”ç­‰æœ‰å…³ã€‚ç»è¿‡æµ‹è¯•ï¼Œå¯¹äºå°é…ç½®ï¼ˆ&amp;lt;1KBï¼‰ï¼Œåœ¨ 1700 QPS ä¸‹å»¶è¿Ÿ TP999&amp;lt;500msï¼Œæœ€å¤§å»¶è¿Ÿ 1.8sã€‚&lt;/li&gt;
  &lt;li&gt;é€šè¿‡ä¸€è‡´æ€§å¤§ç›˜å¯ä»¥çœ‹åˆ°ï¼Œæ•°æ®ä¸€è‡´æ€§ &amp;gt;99.99%&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;6-faq&quot;&gt;6-FAQ&lt;/h1&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;ä¸šåŠ¡åœ¨æ¥å…¥ lion æ—¶ï¼Œä¼šæŒ‰ç…§ key çš„ç²’åº¦ç¼–ç è·å–é…ç½®ï¼Œå¦‚æœä¸šåŠ¡æ–¹ä»£ç ä¸­è·å–å¼•ç”¨äº†å¤§é‡ keyï¼Œæ˜¯å¦ä¼šå¯¼è‡´ä¸åŒ key æ¯æ¬¡éƒ½é€šè¿‡ http è®¿é—® config æœåŠ¡ç«¯æ˜¯å¦å¯¼è‡´è€—æ—¶å¢å¤§ï¼Ÿ&lt;/strong&gt;
    &lt;ul&gt;
      &lt;li&gt;å¦‚æœåŒä¸€ä¸ªé¡¹ç›®è°ƒç”¨äº†å¤šä¸ª keyï¼ˆ&amp;gt;5ï¼‰ï¼Œé‚£ä¹ˆé…ç½®è·å–ç²’åº¦ä¼šç”± key å‡çº§ä¸ºé¡¹ç›®/åˆ†ç»„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¼šä» config æœåŠ¡ç«¯ä¸€æ¬¡è·å–æ•´ä¸ªé¡¹ç›®/åˆ†ç»„çš„é…ç½®ï¼›è¿™æ ·å½“è®¿é—®å…¶ä»– key æ—¶ï¼Œåªéœ€è¦ä»æœ¬åœ°å†…å­˜ç¼“å­˜å³å¯è·å–ï¼Œå‡å°äº†é…ç½®è·å–è€—æ—¶ã€‚&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;å¦‚æœ lion æœåŠ¡ç«¯å‡ä¸å¯ç”¨ï¼Œå¯¹ä¸šåŠ¡æ–¹æœ‰ä½•å½±å“ï¼Ÿ&lt;/strong&gt;
    &lt;ul&gt;
      &lt;li&gt;ä»é…ç½®è·å–æ¥è¯´ï¼Œåœ¨æœåŠ¡ç«¯å®Œå…¨ä¸å¯ç”¨æ—¶ä¼šé™çº§åˆ°æœ¬åœ°æŒä¹…åŒ–æ–‡ä»¶ï¼Œå¯èƒ½ä¼šè·å–åˆ°å·²ç»å¤±æ•ˆçš„é…ç½®ï¼Œå¹¶ä¸”ä¸ä¼šæ„ŸçŸ¥åˆ°æœ€æ–°çš„é…ç½®å˜æ›´&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;é™¤äº†æœåŠ¡ç«¯å†…éƒ¨ä¸€è‡´æ€§ï¼Œå¦‚ä½•ä¿è¯å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯é—´çš„æ•°æ®ä¸€è‡´æ€§ï¼Ÿ&lt;/strong&gt;
    &lt;ul&gt;
      &lt;li&gt;å¢é‡åŒæ­¥ï¼šå®¢æˆ·ç«¯é€šè¿‡é•¿è½®è¯¢å‘¨æœŸæ€§åœ°ä¸æœåŠ¡ç«¯é€šä¿¡ï¼Œè¯·æ±‚ä¿¡æ¯æºå¸¦äº†å½“å‰å®¢æˆ·ç«¯é…ç½®çš„æœ€æ–°ç‰ˆæœ¬å·ï¼ŒæœåŠ¡ç«¯é€šè¿‡æ¯”è¾ƒç‰ˆæœ¬å·æ¥åˆ¤æ–­å®¢æˆ·ç«¯çš„é…ç½®æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸåˆ™æ›´æ–°å®¢æˆ·ç«¯&lt;/li&gt;
      &lt;li&gt;å…¨é‡åŒæ­¥ï¼šå®¢æˆ·ç«¯å®šæ—¶å…¨é‡åŒæ­¥æœ¬åœ°é…ç½®ï¼Œæ­¤æ—¶ç›´æ¥ä»æœåŠ¡ç«¯è·å–å…¨é‡é…ç½®å¹¶æ›´æ–°æœ¬åœ°è¿‡æœŸé…ç½®&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;åŒ—ä¸Šæ•°æ®åŒæ­¥æ—¶ï¼Œå¦‚ä½•ä¿è¯åŒä¸€æ¡ log ä¸ä¼šè¢«é‡å¤åŒæ­¥?&lt;/strong&gt;
    &lt;ul&gt;
      &lt;li&gt;log é€šè¿‡ status åŒºåˆ†åŒæ­¥çŠ¶æ€ï¼›åŒæ­¥ä»»åŠ¡åªä¼šåŠ è½½ status = 0 çš„è®°å½•ï¼Œç¡®ä¿åŒä¸€æ¡ log ä¸ä¼šè¢«é‡å¤åŠ è½½&lt;/li&gt;
      &lt;li&gt;log è¢«åŠ è½½åä¼šè¿›è¡Œåˆ†åŒºï¼Œä¿è¯ä¸åŒ consistency èŠ‚ç‚¹ä¸ä¼šåŒæ­¥ç›¸åŒçš„ log&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;å¦‚ä½•ä¿è¯é…ç½®å˜æ›´ä¸€å®šä¼šè¢«åŒæ­¥æˆåŠŸï¼Ÿ&lt;/strong&gt;
    &lt;ul&gt;
      &lt;li&gt;æœ‰ä¸‰ç§åŒæ­¥æœºåˆ¶ï¼š1. log åˆ›å»ºåè¢«ç«‹å³åŒæ­¥ï¼›2. åŒæ­¥å¤±è´¥åä¼šè¿›è¡Œæœ‰è¡¥æ‰«ä»»åŠ¡è¿›è¡Œå†æ¬¡åŒæ­¥ï¼ˆ50æ¬¡ï¼‰ï¼›3. åŒ—ä¸Šå®šæ—¶æ£€æµ‹æœºåˆ¶ï¼Œå¯¹äºä¸ä¸€è‡´çš„æ•°æ®ä¼šé‡æ–°è§¦å‘åŒæ­¥æµç¨‹ã€‚&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;åŒ—ä¸ŠåŒæ­¥æ—¶ï¼Œå¦‚ä½•è§£å†³æ•°æ®å†²çªï¼Ÿ&lt;/strong&gt;
    &lt;ul&gt;
      &lt;li&gt;å†²çªè§£å†³æ–¹å¼ä¸ºï¼šæœ€åå†™èƒœå‡ºï¼ˆlrwï¼‰ï¼Œä»¥æœ€æ–°ç‰ˆæœ¬ä¸ºä¸»ã€‚ä¸è¿‡ï¼Œä¸¤åœ°åŒæ—¶å†™å…¥çš„æ¦‚ç‡è¾ƒä½ã€‚&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;åœ¨ä¸Šæµ·ä¾§çš„ä¸€æ¬¡å˜æ›´ï¼Œéœ€è¦å¤šé•¿æ—¶é—´æ‰èƒ½æ¨é€åˆ°åŒ—äº¬ä¾§ä¸šåŠ¡æœºå™¨?&lt;/strong&gt;
    &lt;ul&gt;
      &lt;li&gt;åŒ—ä¸ŠåŒæ­¥å»¶è¿Ÿ TP999 &amp;lt; 500msï¼Œæˆ‘ä»¬æ‰¿è¯º 99.9% çš„é…ç½®ä¼šåœ¨ 5s å†…ä¼šå…¨é‡æ¨é€åˆ°æ‰€æœ‰æœºå™¨ï¼ˆå…·ä½“æ¯æ¬¡é…ç½®å˜æ›´æ¨é€å»¶è¿Ÿå¯ä»¥æŸ¥çœ‹ï¼šLion æ¨é€é“¾è·¯ï¼‰&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h1 id=&quot;7-æœªæ¥è§„åˆ’&quot;&gt;7-æœªæ¥è§„åˆ’&lt;/h1&gt;

&lt;p&gt;ä¸­çŸ­æœŸæ¥çœ‹ï¼ŒLion è§„åˆ’ä¸»è¦æœ‰ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;æå‡ç”¨æˆ·ä½“éªŒï¼šä¸°å¯Œå¤šè¯­è¨€å®¢æˆ·ç«¯åŠŸèƒ½ï¼Œæå‡MWSæ˜“ç”¨æ€§&lt;/li&gt;
  &lt;li&gt;æå‡ç³»ç»Ÿå¯è§‚æµ‹æ€§ï¼šå¢å¼ºé…ç½®é“¾è·¯è·Ÿè¸ªèƒ½åŠ›ï¼Œæå‡ç›‘æ§èƒ½åŠ›ï¼Œ&lt;/li&gt;
  &lt;li&gt;æå‡å®¹ç¾èƒ½åŠ›&lt;/li&gt;
  &lt;li&gt;æå‡ç³»ç»Ÿæ•ˆç‡ï¼šå¯¹é½ä¸šç•ŒåŒç±»ç³»ç»Ÿï¼Œæé«˜ç³»ç»Ÿæ”¯æ’‘èƒ½åŠ›ã€æå‡ç³»ç»Ÿæ•ˆç‡&lt;/li&gt;
  &lt;li&gt;æå‡å¹³å°åŒ–èƒ½åŠ›ï¼šå¢å¼ºå­˜å‚¨åŠæµé‡éš”ç¦»ï¼Œå¢å¼ºé›†ç¾¤ç›‘æ§ã€è¿è¥ç»Ÿè®¡ï¼Œå¼€æ”¾é›†ç¾¤æ‹†åˆ†&lt;/li&gt;
&lt;/ul&gt;</content><author><name>kkzhang</name></author><category term="system-design" /><summary type="html">æœ¬æ–‡æ˜¯åœ¨ç¾å›¢å†…éƒ¨é¢å‘å…¶ä»–å›¢é˜Ÿçš„åˆ†äº«</summary></entry><entry><title type="html">Linux Kernel: The Virtual Filesystem</title><link href="http://localhost:4000/linux-kernel-virtual-filesystem.html" rel="alternate" type="text/html" title="Linux Kernel: The Virtual Filesystem" /><published>2022-05-21T00:00:00+08:00</published><updated>2022-05-21T00:00:00+08:00</updated><id>http://localhost:4000/linux-kernel-virtual-filesystem</id><content type="html" xml:base="http://localhost:4000/linux-kernel-virtual-filesystem.html">&lt;p&gt;é€šè¿‡æ‰€è°“çš„&lt;strong&gt;è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ&lt;/strong&gt;çš„æ¦‚å¿µï¼ŒLinux ç³»ç»Ÿèƒ½å¤Ÿæ”¯æŒå¤šç§æ–‡ä»¶ç³»ç»Ÿç±»å‹ã€‚è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿæ‰€éšå«çš„æ€æƒ³æ˜¯æŠŠè¡¨ç¤ºå¤šç§ä¸åŒç±»å‹çš„æ–‡ä»¶ç³»ç»Ÿçš„å…±åŒä¿¡æ¯å­˜æ”¾åœ¨å†…æ ¸ä¸­ï¼Œå¯¹æ–‡ä»¶ç³»ç»Ÿçš„è¯»å†™è°ƒç”¨ï¼Œå†…æ ¸éƒ½èƒ½å°†å…¶æ›¿æ¢æˆæ”¯æŒæœ¬åœ° Linux æ–‡ä»¶ç³»ç»Ÿæˆ–è€…å…¶ä»–æ–‡ä»¶ç³»ç»Ÿçš„å®é™…å‡½æ•°ã€‚&lt;/p&gt;

&lt;h1 id=&quot;1-è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿçš„ä½œç”¨&quot;&gt;1-è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿçš„ä½œç”¨&lt;/h1&gt;

&lt;p&gt;&lt;strong&gt;è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ&lt;/strong&gt;ï¼ˆVirtual FileSystemï¼‰ä¹Ÿè¢«ç§°ä¸º&lt;strong&gt;&lt;em&gt;è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿè½¬æ¢&lt;/em&gt;&lt;/strong&gt;ï¼ˆVirtual FileSystem Switchï¼‰ï¼Œæ˜¯ä¸€ä¸ª&lt;strong&gt;&lt;em&gt;å†…æ ¸è½¯ä»¶å±‚&lt;/em&gt;&lt;/strong&gt;ï¼Œ&lt;strong&gt;&lt;em&gt;ç”¨æ¥å¤„ç†ä¸ Unix æ ‡å‡†æ–‡ä»¶ç³»ç»Ÿç›¸å…³çš„æ‰€æœ‰ç³»ç»Ÿè°ƒç”¨&lt;/em&gt;&lt;/strong&gt;ï¼›èƒ½å¤Ÿä¸ºå„ä¸ªæ–‡ä»¶ç³»ç»Ÿæä¾›ä¸€ä¸ªé€šç”¨çš„æ¥å£ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;VFS æ˜¯ç”¨æˆ·ç¨‹åºä¸æ–‡ä»¶ç³»ç»Ÿå®ç°ä¹‹é—´çš„æŠ½è±¡å±‚&lt;/strong&gt;ã€‚ä¾‹å¦‚ç”¨æˆ·è¾“å…¥ä»¥ä¸‹ shell å‘½ä»¤&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# /floppy æ˜¯ ms-dos æ–‡ä»¶ç³»ç»Ÿï¼Œè€Œ /tmp æ˜¯ ext2 æ–‡ä»¶ç³»ç»Ÿ&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;cp&lt;/span&gt; /floppy/test /tmp/test
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cp&lt;/code&gt; ç¨‹åºå¹¶ä¸éœ€è¦æ“ä½œç›®å½•çš„å…·ä½“æ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼Œç›¸åï¼Œcp ç¨‹åºä¸ VFS äº¤äº’ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/linux_kernel/chapter_12/lk_1.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;a æè¿°äº† VFS çš„å±‚æ¬¡ï¼Œb è¡¨ç¤º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cp&lt;/code&gt; åº”ç”¨ç¨‹åºçš„å®ç°&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;VFS æ”¯æŒçš„æ–‡ä»¶ç³»ç»Ÿå¯ä»¥åˆ’åˆ†ä¸ºä¸‰ç§ç±»å‹ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;ç£ç›˜æ–‡ä»¶ç³»ç»Ÿ&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;ç”¨äºç®¡ç†æœ¬åœ°ç£ç›˜åˆ†åŒºã€‚æ¯”è¾ƒçŸ¥åçš„åŸºäºç£ç›˜çš„æ–‡ä»¶ç³»ç»Ÿæœ‰ï¼šLinux ä½¿ç”¨çš„æ–‡ä»¶ç³»ç»Ÿï¼ŒUnix å®¶æ—æ–‡ä»¶ç³»ç»Ÿï¼Œå¾®è½¯å…¬å¸æ–‡ä»¶ç³»ç»Ÿç­‰&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿ&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;è¿™äº›æ–‡ä»¶ç³»ç»Ÿå…è®¸è®¿é—®å±äºå…¶ä»–ç½‘ç»œè®¡ç®—æœºçš„æ–‡ä»¶ç³»ç»Ÿæ‰€åŒ…å«çš„æ–‡ä»¶ï¼Œå¸¸è§çš„æœ‰ NFSï¼ŒCodaï¼ŒAFS ç­‰&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;ç‰¹æ®Šæ–‡ä»¶ç³»ç»Ÿ&lt;/strong&gt;&lt;/p&gt;

    &lt;p&gt;è¿™äº›æ–‡ä»¶ç³»ç»Ÿä¸ç®¡ç†æœ¬åœ°æˆ–è€…è¿œç¨‹ç£ç›˜ç©ºé—´ã€‚å¦‚ /proc æ–‡ä»¶ç³»ç»Ÿå°±æ˜¯ä¸€ç§å…¸å‹çš„ç‰¹æ®Šæ–‡ä»¶ç³»ç»Ÿ&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Unix ç›®å½•ç®€æ˜“äº†ä¸€æ£µæ ¹ç›®å½•ä¸º â€™/â€™ çš„æ ‘ï¼Œæ ¹ç›®å½•åŒ…å«åœ¨&lt;em&gt;æ ¹æ–‡ä»¶ç³»ç»Ÿ&lt;/em&gt;ï¼ˆroot filesystemï¼‰ä¸­ã€‚åœ¨ Linux ä¸­ï¼Œ&lt;em&gt;æ ¹æ–‡ä»¶ç³»ç»Ÿé€šå¸¸ä¸º Ext2 or Ext3 ç±»å‹ï¼Œå…¶ä»–æ‰€æœ‰çš„æ–‡ä»¶ç³»ç»Ÿéƒ½å¯ä»¥è¢«â€œå®‰è£…â€åœ¨è·Ÿæ–‡ä»¶ç³»ç»Ÿçš„å­ç›®å½•ä¸­&lt;/em&gt;ã€‚&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;å½“ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿè¢«å®‰è£…åœ¨æŸä¸ªç›®å½•ä¸Šæ—¶ï¼Œåœ¨çˆ¶æ–‡ä»¶ç³»ç»Ÿä¸­çš„ç›®å½•å†…å®¹ä¸å†æ˜¯å¯è®¿é—®çš„&lt;/p&gt;

&lt;/blockquote&gt;

&lt;h2 id=&quot;1-1-é€šç”¨æ–‡ä»¶æ¨¡å‹&quot;&gt;1-1 é€šç”¨æ–‡ä»¶æ¨¡å‹&lt;/h2&gt;

&lt;p&gt;VFS çš„ä¸»è¦æ€æƒ³åœ¨äºå¼•å…¥äº†ä¸€ä¸ª&lt;strong&gt;é€šç”¨çš„æ–‡ä»¶æ¨¡å‹&lt;/strong&gt;ï¼ˆcommon file modelï¼‰ï¼Œè¯¥æ¨¡å‹èƒ½å¤Ÿè¡¨ç¤ºæ‰€æœ‰æ”¯æŒçš„æ–‡ä»¶ç³»ç»Ÿã€‚&lt;/p&gt;

&lt;p&gt;å¯¹äºæ¯ä¸ªå…·ä½“çš„æ–‡ä»¶ç³»ç»Ÿï¼Œéœ€è¦å°†å…¶ç‰©ç†ç»„ç»‡ç»“æ„è½¬æ¢ä¸ºè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿçš„é€šç”¨æ–‡ä»¶æ¨¡å‹ã€‚Linux å†…æ ¸å¯¹äºæ¯ä¸ªæ–‡ä»¶æ“ä½œå¿…é¡»ä½¿ç”¨ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘è¦è®¿é—®çš„å…·ä½“æ–‡ä»¶ç³»ç»Ÿçš„é€‚å½“å‡½æ•°ã€‚&lt;/p&gt;

&lt;p&gt;é€šç”¨æ–‡ä»¶æ¨¡å‹ç”±ä»¥ä¸‹å¯¹è±¡ç±»å‹ç»„æˆï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;è¶…çº§å—å¯¹è±¡&lt;/strong&gt;ï¼ˆsuperblock objectï¼‰&lt;/p&gt;

    &lt;p&gt;&lt;em&gt;ç”¨äºå­˜æ”¾å·²å®‰è£…æ–‡ä»¶ç³»ç»Ÿçš„æœ‰å…³ä¿¡æ¯&lt;/em&gt;ã€‚å¯¹äºåŸºäºç£ç›˜çš„æ–‡ä»¶ç³»ç»Ÿï¼Œè¯¥ç±»å¯¹è±¡é€šå¸¸å¯¹åº”äºå­˜æ”¾åœ¨ç£ç›˜ä¸Šçš„æ–‡ä»¶ç³»ç»Ÿæ§åˆ¶å—ï¼ˆfilesystem control blockï¼‰&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;ç´¢å¼•èŠ‚ç‚¹å¯¹è±¡&lt;/strong&gt;ï¼ˆinode objectï¼‰&lt;/p&gt;

    &lt;p&gt;&lt;em&gt;ç”¨äºå­˜æ”¾å…·ä½“æ–‡ä»¶çš„ä¸€èˆ¬ä¿¡æ¯&lt;/em&gt;ã€‚å¯¹äºåŸºäºç£ç›˜çš„æ–‡ä»¶ç³»ç»Ÿï¼Œè¯¥ç±»å¯¹è±¡é€šå¸¸å¯¹åº”äºå­˜æ”¾åœ¨ç£ç›˜ä¸Šçš„æ–‡ä»¶æ§åˆ¶å—ï¼ˆfile control blockï¼‰ã€‚&lt;em&gt;æ¯ä¸ªç´¢å¼•èŠ‚ç‚¹å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªç´¢å¼•èŠ‚ç‚¹å·ï¼Œè¯¥ç´¢å¼•èŠ‚ç‚¹å·å”¯ä¸€æ ‡è¯†æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶&lt;/em&gt;ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;æ–‡ä»¶å¯¹è±¡&lt;/strong&gt;ï¼ˆfile objectï¼‰&lt;/p&gt;

    &lt;p&gt;&lt;em&gt;ç”¨äºå­˜æ”¾æ‰“å¼€çš„æ–‡ä»¶ä¸è¿›ç¨‹ä¹‹é—´è¿›è¡Œäº¤äº’çš„æœ‰å…³ä¿¡æ¯&lt;/em&gt;ã€‚è¿™ç±»ä¿¡æ¯ä»…å½“è¿›ç¨‹è®¿é—®æ–‡ä»¶æœŸé—´å­˜åœ¨äºå†…æ ¸å†…å­˜ä¸­ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;ç›®å½•é¡¹å¯¹è±¡&lt;/strong&gt;ï¼ˆdentry objectï¼‰&lt;/p&gt;

    &lt;p&gt;&lt;em&gt;ç”¨äºå­˜æ”¾ç›®å½•é¡¹ï¼ˆä¹Ÿå°±æ˜¯æ–‡ä»¶çš„ç‰¹åœ°åç§°ï¼‰ä¸å¯¹åº”æ–‡ä»¶è¿›è¡Œé“¾æ¥çš„æœ‰å…³ä¿¡æ¯&lt;/em&gt;ã€‚æ¯ä¸ªç£ç›˜æ–‡ä»¶ç³»ç»Ÿéƒ½ä»¥è‡ªå·±çš„æ–¹å¼å°†è¯¥ç±»ä¿¡æ¯å­˜æ”¾åœ¨ç£ç›˜ä¸Šã€‚&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;ä¸‹å›¾ç®€å•è¯´æ˜è¿›ç¨‹æ€æ ·ä¸æ–‡ä»¶è¿›è¡Œäº¤äº’ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/linux_kernel/chapter_12/lk_2.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ä¸‰ä¸ªä¸åŒçš„è¿›ç¨‹æ‰“å¼€åŒä¸€ä¸ªæ–‡ä»¶ï¼Œå…¶ä¸­ä¸¤ä¸ªè¿›ç¨‹ä½¿ç”¨ç¡¬é“¾æ¥&lt;/li&gt;
  &lt;li&gt;&lt;em&gt;æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„æ–‡ä»¶å¯¹è±¡ï¼Œä½†æ˜¯åªéœ€è¦ä¸¤ä¸ªç›®å½•é¡¹å¯¹è±¡ï¼ˆæ¯ä¸ªç¡¬é“¾æ¥å¯¹åº”ä¸€ä¸ªç›®å½•é¡¹å¯¹è±¡ï¼‰&lt;/em&gt;&lt;/li&gt;
  &lt;li&gt;&lt;em&gt;è¿™ä¸¤ä¸ªç›®å½•é¡¹å¯¹è±¡æŒ‡å‘åŒä¸€ä¸ªç´¢å¼•èŠ‚ç‚¹å¯¹è±¡&lt;/em&gt;&lt;/li&gt;
  &lt;li&gt;è¯¥ç´¢å¼•èŠ‚ç‚¹å¯¹è±¡æ ‡è¯†è¶…çº§å—å¯¹è±¡ä»¥åŠæ™®é€šçš„ç£ç›˜æ–‡ä»¶&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¸ºäº†æé«˜ç³»ç»Ÿæ€§èƒ½ï¼Œæœ€è¿‘æœ€å¸¸ç”¨çš„ç›®å½•é¡¹å¯¹è±¡è¢«å­˜æ”¾åœ¨&lt;strong&gt;&lt;em&gt;ç›®å½•é¡¹é«˜é€Ÿç¼“å­˜&lt;/em&gt;&lt;/strong&gt;ï¼ˆdentry cacheï¼‰çš„ç£ç›˜é«˜é€Ÿç¼“å­˜ï¼ˆdisk cacheï¼‰ä¸­ï¼Œä»¥æé«˜ä»æ–‡ä»¶è·¯å¾„ååˆ°æœ€åä¸€ä¸ªè·¯å¾„åˆ†é‡çš„ç´¢å¼•èŠ‚ç‚¹çš„è½¬æ¢æ•ˆç‡ã€‚&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;ä¸€èˆ¬æ¥è¯´ï¼Œç£ç›˜é«˜é€Ÿç¼“å­˜å±äºè½¯æœºåˆ¶ï¼Œå…è®¸å†…æ ¸å°†åŸæœ¬å­˜æ”¾åœ¨ç£ç›˜ä¸Šçš„æŸäº›ä¿¡æ¯ä¿å­˜åœ¨ RAM ä¸­ï¼Œä»¥åŠ é€Ÿå¯¹è¿™äº›æ•°æ®çš„è®¿é—®&lt;/p&gt;

&lt;/blockquote&gt;

&lt;h2 id=&quot;1-2-vfs-æ‰€å¤„ç†çš„ç³»ç»Ÿè°ƒç”¨&quot;&gt;1-2 VFS æ‰€å¤„ç†çš„ç³»ç»Ÿè°ƒç”¨&lt;/h2&gt;

&lt;p&gt;ä¸‹å›¾åˆ—å‡ºäº† VFS å¤„ç†çš„ç³»ç»Ÿè°ƒç”¨ï¼Œæ¶‰åŠæ–‡ä»¶ç³»ç»Ÿï¼Œæ™®é€šæ–‡ä»¶ï¼Œç›®å½•æ–‡ä»¶ï¼Œç¬¦å·é“¾æ¥æ–‡ä»¶ç­‰ã€‚&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;VFS å±äºå†…æ ¸å±‚ï¼Œå¤„ç†åº”ç”¨ç¨‹åºçš„ç³»ç»Ÿè°ƒç”¨&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&quot;/images/linux_kernel/chapter_12/lk_3.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/linux_kernel/chapter_12/lk_4.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;select() poll()&lt;/code&gt;ï¼šç­‰å¾…ä¸€ç»„æ–‡ä»¶æè¿°ç¬¦ä¸Šå‘ç”Ÿçš„äº‹æƒ…&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;read() write() readv() writev() sendfile()&lt;/code&gt;ï¼šè¿›è¡Œæ–‡ä»¶ IO æ“ä½œ&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mmap() mmap2()&lt;/code&gt;ï¼šå¤„ç†æ–‡ä»¶å†…å­˜æ˜ å°„&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;VFS æ˜¯åº”ç”¨ç¨‹åºä¸å…·ä½“æ–‡ä»¶ç³»ç»Ÿä¹‹é—´çš„ä¸€å±‚ã€‚ä¸è¿‡ï¼Œ&lt;strong&gt;&lt;em&gt;åœ¨æŸäº›æƒ…å†µä¸‹ä¸€ä¸ªæ–‡ä»¶æ“ä½œå¯èƒ½ç”± VFS æœ¬èº«æ‰§è¡Œï¼Œä¸éœ€è¦è°ƒç”¨åº•å±‚å‡½æ•°&lt;/em&gt;&lt;/strong&gt;ã€‚ä¾‹å¦‚ï¼Œå½“è¿›ç¨‹å…³é—­æ‰“å¼€çš„æ–‡ä»¶æ—¶ï¼Œå¹¶ä¸éœ€è¦æ¶‰åŠç£ç›˜ä¸Šç›¸åº”æ–‡ä»¶ï¼Œå› æ­¤ VFS åªéœ€è¦é‡Šæ”¾å¯¹åº”çš„æ–‡ä»¶å¯¹è±¡å³å¯ã€‚&lt;/p&gt;

&lt;p&gt;ä»æŸç§æ„ä¹‰ä¸Šæ¥è¯´ï¼ŒVFS å¯ä»¥è¢«çœ‹ä½œæ™®é€šçš„æ–‡ä»¶ç³»ç»Ÿï¼Œåœ¨å¿…è¦æ—¶ä¾èµ–æŸç§å…·ä½“çš„æ–‡ä»¶ç³»ç»Ÿã€‚&lt;/p&gt;

&lt;h1 id=&quot;2-vfs-çš„æ•°æ®ç»“æ„&quot;&gt;2-VFS çš„æ•°æ®ç»“æ„&lt;/h1&gt;

&lt;p&gt;æ¯ä¸ª VFS å¯¹è±¡éƒ½å­˜æ”¾åœ¨ä¸€ä¸ªé€‚å½“çš„æ•°æ®ç»“æ„ä¸­ï¼ŒåŒ…æ‹¬å¯¹è±¡çš„å±æ€§å’Œ&lt;em&gt;æŒ‡å‘å¯¹è±¡æ–¹æ³•è¡¨&lt;/em&gt;çš„æŒ‡é’ˆã€‚&lt;/p&gt;

&lt;h2 id=&quot;2-1-è¶…çº§å—å¯¹è±¡&quot;&gt;2-1 è¶…çº§å—å¯¹è±¡&lt;/h2&gt;

&lt;p&gt;è¶…çº§å—å¯¹è±¡ç”± &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;super_block&lt;/code&gt; ç»“æ„ç»„æˆï¼Œéƒ¨åˆ†å­—æ®µå¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/linux_kernel/chapter_12/lk_5.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/linux_kernel/chapter_12/lk_6.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/linux_kernel/chapter_12/lk_7.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/linux_kernel/chapter_12/lk_8.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;æ‰€æœ‰çš„è¶…çº§å—å¯¹è±¡éƒ½ä»¥åŒå‘å¾ªç¯é“¾è¡¨çš„å½¢å¼é“¾æ¥åœ¨ä¸€èµ·ã€‚é“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;super_blocks&lt;/code&gt; å˜é‡è¡¨ç¤ºï¼Œè¶…çº§å—å¯¹è±¡çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;s_list&lt;/code&gt; å­—æ®µå­˜æ”¾æŒ‡å‘é“¾è¡¨ç›¸é‚»å…ƒç´ çš„æŒ‡é’ˆã€‚&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sb_lock&lt;/code&gt; è‡ªæ—‹é”ç”¨äºé¿å…é“¾è¡¨è¢«å¤šä¸ªå¤„ç†å™¨ç³»ç»ŸåŒæ—¶è®¿é—®ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;s_fs_info&lt;/code&gt; å­—æ®µæŒ‡å‘å±äºå…·ä½“æ–‡ä»¶ç³»ç»Ÿçš„è¶…çº§å—ä¿¡æ¯ã€‚ä»»ä½•åŸºäºç£ç›˜çš„æ–‡ä»¶ç³»ç»Ÿéƒ½éœ€è¦è®¿é—®å’Œæ›´æ–°è‡ªå·±çš„ç£ç›˜åˆ†é…ä½å›¾ï¼Œä»¥ä¾¿åˆ†é…æˆ–é‡Šæ”¾ç£ç›˜å—ã€‚ä¸ºäº†æé«˜æ•ˆç‡ï¼Œç”± &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;s_fs_info&lt;/code&gt; å­—æ®µæ‰€æŒ‡å‘çš„æ•°æ®è¢«å¤åˆ¶åˆ°å†…å­˜ï¼ŒVFS å…è®¸è¿™äº›æ–‡ä»¶ç³»ç»Ÿç›´æ¥å¯¹å†…å­˜è¶…çº§å—çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;s_fs_info&lt;/code&gt; å­—æ®µè¿›è¡Œæ“ä½œï¼Œæ— éœ€è®¿é—®ç£ç›˜ã€‚&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;ä¸è¿‡è¿™ç§æ–¹æ³•å¯èƒ½ä¼šå¯¼è‡´ VFS è¶…çº§å—ä¸ç£ç›˜ä¸Šçš„è¶…çº§å—ä¸åŒæ­¥ï¼Œå› æ­¤é€šè¿‡å¼•å…¥ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;s_dirt&lt;/code&gt; æ ‡å¿—æ¥è¡¨ç¤ºè¯¥è¶…çº§å—æ˜¯å¦æ˜¯è„çš„ï¼Œä»¥ä¾¿åŠæ—¶æ›´æ–°ç£ç›˜ä¸Šçš„æ•°æ®ã€‚&lt;/p&gt;

    &lt;blockquote&gt;
      &lt;p&gt;Linux é€šè¿‡å‘¨æœŸæ€§åœ°å°†æ‰€æœ‰è„çš„è¶…çº§å—å›å†™ç£ç›˜æ¥å‡å°‘ä¸ä¸€è‡´çš„é£é™©&lt;/p&gt;

    &lt;/blockquote&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;è¶…çº§å—çš„æ“ä½œæ–¹æ³•ç”±æ•°æ®ç»“æ„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;super_operations&lt;/code&gt; ç»“æ„è¡¨ç¤ºï¼Œè¯¥ç»“æ„çš„èµ·å§‹åœ°å€å­˜æ”¾åœ¨è¶…çº§å—çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;s_op&lt;/code&gt; å­—æ®µä¸­&lt;/p&gt;

    &lt;p&gt;æ¯ä¸€ä¸ªå…·ä½“çš„æ–‡ä»¶ç³»ç»Ÿå¯ä»¥å®šä¹‰è‡ªå·±çš„è¶…çº§å—æ“ä½œã€‚å½“ VFS éœ€è¦è°ƒç”¨å…¶ä¸­ä¸€ä¸ªæ“ä½œæ—¶ï¼Œå¦‚ read_inode()ï¼Œæ‰§è¡Œæ“ä½œå¦‚ä¸‹ï¼š&lt;/p&gt;

    &lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  &lt;span class=&quot;n&quot;&gt;sb&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s_op&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;read_inode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;inode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; 
  &lt;span class=&quot;c1&quot;&gt;// sb å­˜æ”¾æ¶‰åŠçš„è¶…çº§å—å¯¹è±¡åœ°å€ï¼›super_operation è¡¨çš„ read_inode å­—æ®µå­˜æ”¾å¯¹åº”å‡½æ•°çš„åœ°å€&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;2-1-1-è¶…çº§å—æ“ä½œæ–¹æ³•&quot;&gt;2-1-1 è¶…çº§å—æ“ä½œæ–¹æ³•&lt;/h3&gt;

&lt;p&gt;è¶…çº§å—æ“ä½œè¡¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;super_operation&lt;/code&gt; ä¸­ä¸€äº›æ¯”è¾ƒå¸¸è§çš„æ–¹æ³•ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;alloc_inode(sb)&lt;/code&gt;ï¼šä¸ºç´¢å¼•èŠ‚ç‚¹å¯¹è±¡åˆ†é…ç©ºé—´ï¼ŒåŒ…æ‹¬å…·ä½“æ–‡ä»¶ç³»ç»Ÿçš„æ•°æ®æ‰€éœ€ç©ºé—´&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;destroy_inode(inode)&lt;/code&gt;: æ’¤é”€ç´¢å¼•èŠ‚ç‚¹å¯¹è±¡ï¼ŒåŒ…æ‹¬å…·ä½“æ–‡ä»¶ç³»ç»Ÿçš„æ•°æ®&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;read_inode(inode)&lt;/code&gt;: ç”¨ç£ç›˜ä¸Šçš„æ•°æ®å¡«å……ä»¥å‚æ•°ä¼ é€’è¿‡æ¥çš„ç´¢å¼•èŠ‚ç‚¹å¯¹è±¡çš„å­—æ®µ&lt;/p&gt;

    &lt;blockquote&gt;
      &lt;p&gt;ç´¢å¼•èŠ‚ç‚¹å¯¹è±¡çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;i_ino&lt;/code&gt; å­—æ®µæ ‡è¯†ä»ç£ç›˜ä¸Šè¦è¯»å–çš„å…·ä½“æ–‡ä»¶ç³»ç»Ÿçš„ç´¢å¼•èŠ‚ç‚¹&lt;/p&gt;

    &lt;/blockquote&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dirty_inode(inode)&lt;/code&gt;: å½“ç´¢å¼•èŠ‚ç‚¹è¢«ä¿®æ”¹æ—¶è°ƒç”¨&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;write_inode(inode)&lt;/code&gt;: é€šè¿‡ä¼ é€’å‚æ•°æŒ‡å®šçš„ç´¢å¼•èŠ‚ç‚¹å¯¹è±¡å†…å®¹æ›´æ–°ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„ç´¢å¼•èŠ‚ç‚¹&lt;/p&gt;

    &lt;blockquote&gt;
      &lt;p&gt;ç´¢å¼•èŠ‚ç‚¹å¯¹è±¡çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;i_ino&lt;/code&gt; å­—æ®µæ ‡è¯†æ‰€æ¶‰åŠçš„ç£ç›˜ä¸Šæ–‡ä»¶ç³»ç»Ÿçš„ç´¢å¼•èŠ‚ç‚¹&lt;/p&gt;

    &lt;/blockquote&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;put_inode(inode)&lt;/code&gt;: é‡Šæ”¾ç´¢å¼•èŠ‚ç‚¹æ—¶è°ƒç”¨ï¼ŒåŒæ—¶å‡å°‘è¯¥èŠ‚ç‚¹å¼•ç”¨è®¡æ•°å™¨å€¼&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;drop_inode(inode)&lt;/code&gt;: å½“æœ€åä¸€ä¸ªç”¨æˆ·é‡Šæ”¾è¯¥ç´¢å¼•èŠ‚ç‚¹æ—¶è°ƒç”¨ï¼›è¯¥ç´¢å¼•èŠ‚ç‚¹å°†ä¼šè¢«æ’¤æ¶ˆ&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;delete_inode(inode)&lt;/code&gt;: æ’¤æ¶ˆç´¢å¼•èŠ‚ç‚¹æ—¶è°ƒç”¨ï¼›åˆ é™¤å†…å­˜ä¸­çš„ VFS ç´¢å¼•èŠ‚ç‚¹å’Œç£ç›˜ä¸Šçš„æ–‡ä»¶æ•°æ®åŠå…ƒæ•°æ®&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;2-2-ç´¢å¼•èŠ‚ç‚¹å¯¹è±¡&quot;&gt;2-2 ç´¢å¼•èŠ‚ç‚¹å¯¹è±¡&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;æ–‡ä»¶ç³»ç»Ÿå¤„ç†æ–‡ä»¶æ‰€éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯éƒ½å­˜æ”¾åœ¨ä¸€ä¸ªåä¸ºç´¢å¼•èŠ‚ç‚¹çš„æ•°æ®ç»“æ„ä¸­&lt;/strong&gt;ã€‚å†…å­˜ä¸­çš„ç´¢å¼•èŠ‚ç‚¹å¯¹è±¡ç”±ä¸€ä¸ª inode æ•°æ®ç»“æ„ç»„æˆã€‚&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;æ–‡ä»¶åå¯ä»¥éšæ„æ›´æ”¹ï¼Œä½†æ˜¯&lt;strong&gt;&lt;em&gt;å¯¹æ–‡ä»¶æ¥è¯´ï¼Œç´¢å¼•èŠ‚ç‚¹æ—¶å”¯ä¸€çš„ï¼Œå¹¶ä¸”éšç€æ–‡ä»¶çš„å­˜åœ¨è€Œå­˜åœ¨&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&quot;/images/linux_kernel/chapter_12/lk_9.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/linux_kernel/chapter_12/lk_10.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/linux_kernel/chapter_12/lk_11.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;i_hash&lt;/code&gt;: ç”¨äºæ•£åˆ—è¡¨çš„æŒ‡é’ˆ&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;i_list&lt;/code&gt;: ç”¨äºæè¿°ç´¢å¼•èŠ‚ç‚¹å½“å‰çŠ¶æ€çš„é“¾è¡¨çš„æŒ‡é’ˆ&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;i_sb_list&lt;/code&gt;: ç”¨äºè¶…çº§å—çš„ç´¢å¼•èŠ‚ç‚¹é“¾è¡¨çš„æŒ‡é’ˆ&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;i_dentry&lt;/code&gt;: å¼•ç”¨ç´¢å¼•èŠ‚ç‚¹çš„ç›®å½•é¡¹å¯¹è±¡é“¾è¡¨çš„å¤´&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;i_ino&lt;/code&gt;: ç´¢å¼•èŠ‚ç‚¹å·&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;i_count&lt;/code&gt;: å¼•ç”¨è®¡æ•°å™¨&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;i_nlink&lt;/code&gt;: ç¡¬é“¾æ¥æ•°ç›®&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;i_state&lt;/code&gt;: ç´¢å¼•èŠ‚ç‚¹çš„çŠ¶æ€æ ‡å¿—
    &lt;ul&gt;
      &lt;li&gt;å¦‚æœ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;i_state&lt;/code&gt; çš„å€¼ä¸º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;I_DIRTY_SYNC&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;I_DIRTY_DATASYNC&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;I_DIRTY_PAGES&lt;/code&gt; ï¼Œåˆ™è¡¨æ˜è¯¥ç´¢å¼•èŠ‚ç‚¹æ˜¯è„çš„ï¼Œå¯¹åº”çš„ç£ç›˜ç´¢å¼•èŠ‚ç‚¹å¿…é¡»æ›´æ–°&lt;/li&gt;
      &lt;li&gt;å¦‚æœ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;i_state&lt;/code&gt; å­—æ®µçš„å€¼ä¸º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;I_LOCK&lt;/code&gt;ï¼Œè¡¨æ˜å¯¹åº”çš„ç´¢å¼•èŠ‚ç‚¹å¯¹è±¡å¤„äº IO ä¼ è¾“ä¸­ï¼›&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;I_FREEING&lt;/code&gt; è¡¨ç¤ºç´¢å¼•èŠ‚ç‚¹å¯¹è±¡æ­£åœ¨è¢«é‡Šæ”¾ï¼›&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;I_CLEAR&lt;/code&gt; è¡¨ç¤ºç´¢å¼•èŠ‚ç‚¹å¯¹è±¡çš„å†…å®¹ä¸å†æœ‰æ„ä¹‰ï¼›&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;I_NEW&lt;/code&gt; è¡¨ç¤ºç´¢å¼•èŠ‚ç‚¹å¯¹è±¡å·²ç»åˆ†é…ï¼Œä½†æ˜¯è¿˜æ²¡ç”¨ç£ç›˜ç´¢å¼•èŠ‚ç‚¹è¯»å–æ¥çš„æ•°æ®å¡«å……&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;i_size&lt;/code&gt;: æ–‡ä»¶çš„å­—èŠ‚æ•°&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;i_blocks&lt;/code&gt;: æ–‡ä»¶çš„å—æ•°&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;i_op&lt;/code&gt;: ç´¢å¼•èŠ‚ç‚¹çš„æ“ä½œ&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;i_sb&lt;/code&gt;: æŒ‡å‘è¶…çº§å—å¯¹è±¡çš„æŒ‡é’ˆ&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;æ¯ä¸ªç´¢å¼•èŠ‚ç‚¹å¯¹è±¡éƒ½ä¼šå¤åˆ¶ç£ç›˜ç´¢å¼•èŠ‚ç‚¹åŒ…å«çš„ä¸€äº›æ•°æ®&lt;/em&gt;&lt;/strong&gt;ï¼Œå¦‚åˆ†é…ç»™æ–‡ä»¶çš„ç£ç›˜å—æ•°ã€‚&lt;/p&gt;

&lt;p&gt;æ¯ä¸ªç´¢å¼•èŠ‚ç‚¹å¯¹è±¡æ€»æ˜¯å¤„äºä¸‹åˆ—åŒå‘å¾ªç¯é“¾è¡¨ä¸­çš„æŸä¸ªé“¾è¡¨ä¸­ï¼ˆé“¾è¡¨ç›¸é‚»å…ƒç´ çš„æŒ‡é’ˆå­˜æ”¾åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;i_list&lt;/code&gt; å­—æ®µä¸­ï¼‰ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;æœ‰æ•ˆæœªä½¿ç”¨çš„ç´¢å¼•èŠ‚ç‚¹é“¾è¡¨&lt;/strong&gt;ï¼šè¿™äº›ç´¢å¼•èŠ‚ç‚¹å½“å‰æœªè¢«ä»»ä½•è¿›ç¨‹ä½¿ç”¨ï¼Œä¸”ä¸ä¸ºè„ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;i_count&lt;/code&gt; å­—æ®µä¸º 0ï¼›é“¾è¡¨é¦–å°¾å…ƒç´ ç”±å˜é‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;inode_unused&lt;/code&gt; å¼•ç”¨ã€‚è¯¥é“¾è¡¨ç”¨ä½œç£ç›˜é«˜é€Ÿç¼“å­˜ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;æ­£åœ¨ä½¿ç”¨çš„ç´¢å¼•èŠ‚ç‚¹é“¾è¡¨&lt;/strong&gt;ï¼šè¿™äº›ç´¢å¼•èŠ‚ç‚¹å½“å‰æ­£åœ¨è¢«æŸäº›è¿›ç¨‹ä½¿ç”¨ï¼Œä¸”ä¸ä¸ºè„ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;i_count&lt;/code&gt; å­—æ®µä¸ºæ­£æ•°ï¼›é“¾è¡¨çš„é¦–å°¾å…ƒç´ ç”±å˜é‡ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;inode_in_use&lt;/code&gt; å¼•ç”¨ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;è„ç´¢å¼•èŠ‚ç‚¹çš„é“¾è¡¨&lt;/strong&gt;ï¼šé“¾è¡¨çš„é¦–å°¾å…ƒç´ ç”±ç›¸åº”çš„è¶…çº§å—å¯¹è±¡çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;s_dirty&lt;/code&gt; å­—æ®µå¼•ç”¨ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;blockquote&gt;
  &lt;p&gt;è¿™äº›é“¾è¡¨éƒ½æ˜¯é€šè¿‡é€‚å½“ç´¢å¼•èŠ‚ç‚¹å¯¹è±¡çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;i_list&lt;/code&gt; å­—æ®µé“¾æ¥åœ¨ä¸€èµ·&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;æ¯ä¸ªç´¢å¼•èŠ‚ç‚¹å¯¹è±¡ä¹ŸåŒ…å«åœ¨æ–‡ä»¶ç³»ç»Ÿ(per-filesystem)çš„åŒå‘å¾ªç¯é“¾è¡¨ä¸­ï¼Œé“¾è¡¨çš„å¤´å­˜æ”¾åœ¨è¶…çº§å—å¯¹è±¡çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;s_inodes&lt;/code&gt; å­—æ®µä¸­ï¼›ç´¢å¼•èŠ‚ç‚¹å¯¹è±¡çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;i_sb_list&lt;/code&gt; å­—æ®µå­˜æ”¾äº†æŒ‡å‘é“¾è¡¨ç›¸é‚»å…ƒç´ çš„æŒ‡é’ˆã€‚&lt;/p&gt;

&lt;p&gt;ç´¢å¼•èŠ‚ç‚¹å¯¹è±¡ä¹Ÿå­˜æ”¾åœ¨ä¸€ä¸ªè¢«ç§°ä¸º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;inode_hashtable&lt;/code&gt; çš„æ•£åˆ—è¡¨ä¸­ã€‚æ•£é“¾è¡¨åŠ å¿«äº†å¯¹ç´¢å¼•èŠ‚ç‚¹çš„æœç´¢ã€‚&lt;/p&gt;

&lt;h3 id=&quot;2-2-1-ç´¢å¼•èŠ‚ç‚¹æ“ä½œæ–¹æ³•&quot;&gt;2-2-1 ç´¢å¼•èŠ‚ç‚¹æ“ä½œæ–¹æ³•&lt;/h3&gt;

&lt;p&gt;ä¸ç´¢å¼•èŠ‚ç‚¹å¯¹è±¡å…³è”çš„æ–¹æ³•ä¹Ÿè¢«ç§°ä¸º&lt;strong&gt;ç´¢å¼•èŠ‚ç‚¹æ“ä½œ&lt;/strong&gt;ï¼Œç”± &lt;strong&gt;inode_operation&lt;/strong&gt; ç»“æ„æ¥è¡¨ç¤ºï¼Œå­˜æ”¾åœ¨ç´¢å¼•èŠ‚ç‚¹å¯¹è±¡çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;i_op&lt;/code&gt; å­—æ®µä¸­ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;create(dir, dentry, mode, nameidata)&lt;/code&gt;: åœ¨æŸä¸€ç›®å½•ä¸‹ï¼Œä¸ºç›®å½•é¡¹å¯¹è±¡ç›¸å…³çš„æ™®é€šæ–‡ä»¶åˆ›å»ºä¸€ä¸ªæ–°çš„ç£ç›˜ç´¢å¼•èŠ‚ç‚¹&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lookup(dir, dentry, nameidata)&lt;/code&gt;: ä¸ºåŒ…å«åœ¨ä¸€ä¸ªç›®å½•é¡¹å¯¹è±¡ä¸­çš„æ–‡ä»¶åå¯¹åº”çš„ç´¢å¼•èŠ‚ç‚¹æŸ¥æ‰¾ç›®å½•&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;link(old_dentry, dir, new_dentry)&lt;/code&gt;: åˆ›å»ºä¸€ä¸ªåä¸º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;new_dentry&lt;/code&gt; çš„æ–°çš„ç¡¬é“¾æ¥ï¼ŒæŒ‡å‘ dir ç›®å½•ä¸‹åä¸º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;old_dentry&lt;/code&gt; çš„æ–‡ä»¶&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;unlink(dir, dentry)&lt;/code&gt;: ä»ä¸€ä¸ªç›®å½•ä¸­åˆ é™¤ç›®å½•é¡¹å¯¹è±¡æ‰€æŒ‡å®šæ–‡ä»¶çš„ç¡¬é“¾æ¥&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;symlink(dir, dentry, mode)&lt;/code&gt;: åœ¨æŸä¸ªç›®å½•ä¸‹ï¼Œä¸ºä¸ç›®å½•é¡¹å¯¹è±¡ç›¸å…³çš„ç›®å½•åˆ›å»ºä¸€ä¸ªæ–°çš„ç´¢å¼•èŠ‚ç‚¹&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mkdir(dir, dentry, mode)&lt;/code&gt;: åœ¨æŸä¸ªç›®å½•ä¸‹ï¼Œä¸ºä¸ç›®å½•é¡¹å¯¹è±¡ç›¸å…³çš„ç›®å½•åˆ›å»ºä¸€ä¸ªæ–°çš„ç´¢å¼•èŠ‚ç‚¹&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rmdir(dir, dentry)&lt;/code&gt;: ä»ä¸€ä¸ªç›®å½•åˆ é™¤å­ç›®å½•ï¼Œå­ç›®å½•çš„åç§°åŒ…å«åœ¨ç›®å½•é¡¹å¯¹è±¡ä¸­&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;2-3-æ–‡ä»¶å¯¹è±¡&quot;&gt;2-3 æ–‡ä»¶å¯¹è±¡&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;æ–‡ä»¶å¯¹è±¡æè¿°è¿›ç¨‹å¦‚ä½•ä¸ä¸€ä¸ªæ‰“å¼€çš„æ–‡ä»¶è¿›è¡Œäº¤äº’&lt;/strong&gt;ã€‚æ–‡ä»¶å¯¹è±¡æ˜¯åœ¨æ–‡ä»¶è¢«æ‰“å¼€æ—¶åˆ›å»ºçš„ï¼Œç”±ä¸€ä¸ª &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;file&lt;/code&gt; ç»“æ„è¡¨ç¤ºã€‚&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;em&gt;æ–‡ä»¶å¯¹è±¡åœ¨ç£ç›˜ä¸Šæ²¡æœ‰å¯¹åº”çš„æ˜ åƒ&lt;/em&gt;ï¼Œå› æ­¤ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;file&lt;/code&gt; ç»“æ„ä¸­æ²¡æœ‰è®¾ç½® dirty å­—æ®µæ¥è¡¨ç¤ºæ–‡ä»¶å¯¹è±¡æ˜¯å¦è¢«ä¿®æ”¹&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&quot;/images/linux_kernel/chapter_12/lk_12.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å­˜æ”¾åœ¨æ–‡ä»¶å¯¹è±¡ä¸­çš„ä¸»è¦ä¿¡æ¯æ˜¯&lt;strong&gt;&lt;em&gt;æ–‡ä»¶æŒ‡é’ˆ&lt;/em&gt;&lt;/strong&gt;ï¼Œå³æ–‡ä»¶å½“å‰çš„ä½ç½®ï¼Œä¸‹ä¸ªæ“ä½œå°†åœ¨è¯¥ä½ç½®æ‰§è¡Œã€‚&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;em&gt;ç”±äºå‡ ä¸ªè¿›ç¨‹å¯èƒ½åŒæ—¶è®¿é—®åŒä¸€æ–‡ä»¶ï¼Œå› æ­¤æ–‡ä»¶æŒ‡é’ˆå¿…é¡»å­˜æ”¾åœ¨æ–‡ä»¶å¯¹è±¡è€Œä¸æ˜¯ç´¢å¼•èŠ‚ç‚¹å¯¹è±¡ä¸­&lt;/em&gt;&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;æ–‡ä»¶å¯¹è±¡é€šè¿‡ä¸€ä¸ªåä¸º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;filp&lt;/code&gt; çš„ slab é«˜é€Ÿç¼“å­˜åˆ†é…ï¼Œå¯åˆ†é…çš„æ–‡ä»¶å¯¹è±¡æ•°ç›®å­˜åœ¨ä¸Šé™ï¼Œå› æ­¤&lt;strong&gt;&lt;em&gt;ç³»ç»Ÿå¯åŒæ—¶è®¿é—®çš„æ–‡ä»¶æ•°ç›®ä¹Ÿå­˜åœ¨ä¸Šé™&lt;/em&gt;&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;æ­£åœ¨ä½¿ç”¨ä¸­çš„æ–‡ä»¶å¯¹è±¡åŒ…å«åœ¨å…·ä½“æ–‡ä»¶ç³»ç»Ÿçš„è¶…çº§å—çš„é“¾è¡¨ä¸­ï¼Œæ¯ä¸ªè¶…çº§å—å¯¹è±¡æŠŠæ–‡ä»¶å¯¹è±¡é“¾è¡¨çš„å¤´å­˜æ”¾åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;s_files&lt;/code&gt; å­—æ®µä¸­ã€‚å› æ­¤ï¼Œå±äºä¸åŒæ–‡ä»¶ç³»ç»Ÿçš„æ–‡ä»¶å¯¹è±¡åŒ…å«åœ¨ä¸åŒçš„é“¾è¡¨ä¸­ã€‚æ–‡ä»¶å¯¹è±¡çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;f_list&lt;/code&gt; å­—æ®µç”¨äºæŒ‡å‘é“¾è¡¨çš„å‰åå…ƒç´ ã€‚&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;f_count&lt;/code&gt; å­—æ®µä¸ºå¼•ç”¨è®¡æ•°å™¨ï¼Œç”¨äºè®°å½•ä½¿ç”¨æ–‡ä»¶å¯¹è±¡çš„è¿›ç¨‹æ•°ã€‚&lt;/p&gt;

    &lt;blockquote&gt;
      &lt;p&gt;å½“å†…æ ¸æœ¬èº«ä½¿ç”¨è¯¥æ–‡ä»¶å¯¹è±¡æ—¶ï¼Œä¹Ÿéœ€è¦å¢åŠ è®¡æ•°å™¨çš„å€¼&lt;/p&gt;

    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å½“ VFS ä»£è¡¨è¿›ç¨‹å¿…é¡»æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œè°ƒç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;get_empty_filp()&lt;/code&gt; å‡½æ•°åˆ†é…ä¸€ä¸ªæ–°çš„æ–‡ä»¶å¯¹è±¡ã€‚è¯¥å‡½æ•°è°ƒç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;kmem_cache_alloc()&lt;/code&gt; ä» filp é«˜é€Ÿç¼“å­˜ä¸­è·å¾—ä¸€ä¸ªç©ºé—²çš„æ–‡ä»¶å¯¹è±¡ï¼Œä¹‹ååˆå§‹åŒ–è¯¥å¯¹è±¡çš„å­—æ®µã€‚&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;memset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;INIT_LIST_HEAD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f_ep_links&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;spin_lock_init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f_ep_lock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;atomic_set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f_count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f_uid&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fsuid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f_gid&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fsgid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f_owner&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lock&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;RW_LOCK_UNLOCKED&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;INIT_LIST_HEAD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f_list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f_maxcount&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;INT_MAX&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ä¹‹å‰è¯´è¿‡ï¼Œæ¯ä¸ªæ–‡ä»¶ç³»ç»Ÿéƒ½æœ‰å…¶è‡ªå·±çš„æ–‡ä»¶æ“ä½œé›†åˆï¼Œç”¨äºæ‰§è¡Œæ–‡ä»¶è¯»å†™ç­‰æ“ä½œã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å½“å†…æ ¸å°†ä¸€ä¸ªç´¢å¼•èŠ‚ç‚¹ä»ç£ç›˜è£…å…¥å†…å­˜æ—¶ï¼Œå°±ä¼šæŠŠæŒ‡å‘è¿™äº›æ–‡ä»¶æ“ä½œçš„æŒ‡é’ˆå­˜æ”¾åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;file_operatrions&lt;/code&gt; ç»“æ„ä¸­ï¼Œè€Œè¯¥ç»“æ„çš„åœ°å€å­˜æ”¾åœ¨ç´¢å¼•èŠ‚ç‚¹å¯¹è±¡çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;i_fop&lt;/code&gt; å­—æ®µä¸­ã€‚&lt;/li&gt;
  &lt;li&gt;å½“è¿›ç¨‹æ‰“å¼€æ–‡ä»¶æ—¶ï¼ŒVFS å°±ç”¨å­˜æ”¾åœ¨ç´¢å¼•èŠ‚ç‚¹ä¸­çš„è¿™ä¸ªåœ°å€åˆå§‹åŒ–æ–°æ–‡ä»¶å¯¹è±¡çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;f_op&lt;/code&gt; å­—æ®µï¼Œä½¿å¾—åç»­å¯¹è¯¥æ–‡ä»¶çš„æ“ä½œèƒ½å¤Ÿè°ƒç”¨è¿™äº›å‡½æ•°ã€‚&lt;/li&gt;
  &lt;li&gt;å¦‚æœæœ‰éœ€è¦ï¼ŒVFS éšåå¯ä»¥é€šè¿‡åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;f_op&lt;/code&gt; å­—æ®µå­˜æ”¾ä¸€ä¸ªæ–°å€¼æ¥ä¿®æ”¹æ–‡ä»¶æ“ä½œçš„é›†åˆã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;2-3-1-æ–‡ä»¶å¯¹è±¡æ“ä½œæ–¹æ³•&quot;&gt;2-3-1 æ–‡ä»¶å¯¹è±¡æ“ä½œæ–¹æ³•&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;llseek(file, offset, origin)&lt;/code&gt;: æ›´æ–°æ–‡ä»¶æŒ‡é’ˆ&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;read(file, fuf, count, offset)&lt;/code&gt;: ä»æ–‡ä»¶çš„ offset å¤„å¼€å§‹è¯»å– count ä¸ªå­—èŠ‚ï¼Œç„¶åå¢åŠ  offset çš„å€¼&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aio_read(req, buf, len, pos)&lt;/code&gt;: å¼‚æ­¥ IO è¯»å–æ“ä½œ&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;write(file, buf, count, offset)&lt;/code&gt;: ä»æ–‡ä»¶çš„ offset å¤„å¼€å§‹å†™å…¥ count ä¸ªå­—èŠ‚ï¼Œç„¶åå¢åŠ  offset çš„å€¼&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aio_write(req, buf, len, pos)&lt;/code&gt;: å¼‚æ­¥ IO å†™å…¥æ“ä½œ&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mmap(file, vma)&lt;/code&gt;: æ‰§è¡Œæ–‡ä»¶çš„å†…å­˜æ˜ å°„ï¼Œå¹¶å°†æ˜ å°„æ”¾å…¥è¿›ç¨‹çš„åœ°å€ç©ºé—´&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;open(inode, file)&lt;/code&gt;: é€šè¿‡åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶å¯¹è±¡æ¥æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶å°†å…¶è¿æ¥åˆ°å¯¹åº”çš„ç´¢å¼•èŠ‚ç‚¹å¯¹è±¡&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;flush(file)&lt;/code&gt;: å½“æ‰“å¼€çš„æ–‡ä»¶å¼•ç”¨è¢«å…³é—­æ—¶è°ƒç”¨&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fsync(file, dentry, flag)&lt;/code&gt;: å°†æ–‡ä»¶æ‰€ç¼“å­˜çš„å…¨éƒ¨æ•°æ®å†™å…¥ç£ç›˜&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;aio_fsync(req, flag)&lt;/code&gt;: å¼‚æ­¥ IO åˆ·æ–°æ“ä½œ&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lock(file, cmd, file_lock)&lt;/code&gt;: å¯¹ file æ–‡ä»¶ç”³è¯·ä¸€ä¸ªé”&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;2-4-ç›®å½•é¡¹å¯¹è±¡&quot;&gt;2-4 ç›®å½•é¡¹å¯¹è±¡&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;VFS æŠŠæ¯ä¸ªç›®å½•çœ‹ä½œç”±è‹¥å¹²å­ç›®å½•å’Œæ–‡ä»¶ç»„æˆçš„ä¸€ä¸ªæ™®é€šæ–‡ä»¶&lt;/strong&gt;ã€‚å½“ä¸€ä¸ªç›®å½•é¡¹è¢«è¯»å…¥å†…å­˜ï¼ŒVFS å°±ä¼šå°†å…¶è½¬æ¢æˆåŸºäº dentry ç»“æ„çš„ä¸€ä¸ªç›®å½•é¡¹å¯¹è±¡ã€‚&lt;/p&gt;

&lt;p&gt;å¯¹äºè¿›ç¨‹æŸ¥æ‰¾çš„è·¯å¾„åä¸­çš„æ¯ä¸ªåˆ†é‡ï¼Œå†…æ ¸éƒ½ä¼šä¸ºå…¶åˆ›å»ºä¸€ä¸ªç›®å½•é¡¹å¯¹è±¡ã€‚&lt;strong&gt;&lt;em&gt;ç›®å½•é¡¹å¯¹è±¡å°†æ¯ä¸ªè·¯å¾„åˆ†é‡ä¸å…¶å¯¹åº”çš„ç´¢å¼•èŠ‚ç‚¹è”ç³»èµ·æ¥&lt;/em&gt;&lt;/strong&gt;ã€‚å¦‚åœ¨æŸ¥æ‰¾è·¯å¾„å &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/tmp/test&lt;/code&gt; æ—¶ï¼Œå†…æ ¸ä¸ºæ ¹ç›®å½• &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/&lt;/code&gt; åˆ›å»ºä¸€ä¸ªç›®å½•é¡¹å¯¹è±¡ï¼Œä¸ºæ ¹ç›®å½•ä¸‹çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tmp&lt;/code&gt; é¡¹åˆ›å»ºä¸€ä¸ªç¬¬äºŒçº§ç›®å½•é¡¹å¯¹è±¡ï¼Œä¸º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/tmp&lt;/code&gt; ç›®å½•ä¸‹çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;test&lt;/code&gt; é¡¹åˆ›å»ºä¸€ä¸ªç¬¬ä¸‰çº§ç›®å½•é¡¹å¯¹è±¡ã€‚&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;ä¸æ–‡ä»¶å¯¹è±¡ä¸€æ ·ï¼Œç›®å½•é¡¹å¯¹è±¡åœ¨ç£ç›˜ä¸Šä¹Ÿæ²¡æœ‰å¯¹åº”çš„æ˜ åƒï¼Œå› æ­¤ dentry ç»“æ„ä¸åŒ…å«æŒ‡å‡ºè¯¥å¯¹è±¡å·²è¢«ä¿®æ”¹çš„å­—æ®µ&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;ç›®å½•é¡¹å¯¹è±¡å­˜æ”¾åä¸º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dentry_cache&lt;/code&gt; çš„ slab é«˜é€Ÿç¼“å­˜ä¸­ï¼›ç›®å½•é¡¹å¯¹è±¡çš„åˆ›å»ºå’Œåˆ é™¤æ˜¯é€šè¿‡è°ƒç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;kmem_cache_alloc()&lt;/code&gt; å’Œ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;kmem_cache_free()&lt;/code&gt; å®ç°çš„ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/linux_kernel/chapter_12/lk_13.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/linux_kernel/chapter_12/lk_14.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;d_count&lt;/code&gt;: ç›®å½•é¡¹å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å™¨&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;d_flag&lt;/code&gt;: ç›®å½•é¡¹é«˜é€Ÿç¼“å­˜æ ‡å¿—&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;d_inode&lt;/code&gt;: ä¸æ–‡ä»¶åå…³è”çš„ç´¢å¼•èŠ‚ç‚¹&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;d_parent&lt;/code&gt;: çˆ¶ç›®å½•çš„ç›®å½•é¡¹å¯¹è±¡&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;d_child&lt;/code&gt;: å¯¹ç›®å½•è€Œè¨€ï¼Œç”¨äºåŒä¸€çˆ¶ç›®å½•ä¸­çš„ç›®å½•é¡¹é“¾è¡¨çš„æŒ‡é’ˆ&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;d_subdirs&lt;/code&gt;: å¯¹ç›®å½•è€Œè¨€ï¼Œå­ç›®å½•é¡¹é“¾è¡¨çš„å¤´&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;d_name&lt;/code&gt;: æ–‡ä»¶å&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ¯ä¸ªç›®å½•é¡¹å¯¹è¥¿é‚£ä¸ªå¯ä»¥å¤„äºä»¥ä¸‹å››ç§çŠ¶æ€ä¹‹ä¸€ï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;ç©ºé—²çŠ¶æ€&lt;/strong&gt;ï¼ˆfreeï¼‰&lt;/p&gt;

    &lt;p&gt;&lt;em&gt;è¯¥çŠ¶æ€çš„ç›®å½•é¡¹å¯¹è±¡ä¸åŒ…å«æœ‰æ•ˆä¿¡æ¯ï¼Œä¸”è¿˜æ²¡è¢« VFS ä½¿ç”¨&lt;/em&gt;ã€‚å¯¹åº”çš„å†…å­˜åŒºç”± slab åˆ†é…å™¨è¿›è¡Œåˆ†é…&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;æœªä½¿ç”¨çŠ¶æ€&lt;/strong&gt;ï¼ˆunusedï¼‰&lt;/p&gt;

    &lt;p&gt;&lt;em&gt;è¯¥çŠ¶æ€çš„ç›®å½•é¡¹å¯¹è±¡è¿˜æ²¡è¢«å†…æ ¸ä½¿ç”¨&lt;/em&gt;ã€‚å¼•ç”¨è®¡æ•°å™¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;d_count&lt;/code&gt; å€¼ä¸º 0ï¼Œä½†æ˜¯å…¶ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;d_inode&lt;/code&gt; å­—æ®µæŒ‡å‘å…³è”çš„ç´¢å¼•èŠ‚ç‚¹ã€‚ç›®å½•é¡¹å¯¹è±¡åŒ…å«æœ‰æ•ˆçš„ä¿¡æ¯ï¼Œä½†æ˜¯ä¸ºäº†åœ¨å¿…è¦æ—¶å›æ”¶å†…å­˜ï¼Œå¯¹åº”å†…å®¹å¯èƒ½ä¼šè¢«ä¸¢å¤±ã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;æ­£åœ¨ä½¿ç”¨çŠ¶æ€&lt;/strong&gt;ï¼ˆin useï¼‰&lt;/p&gt;

    &lt;p&gt;&lt;em&gt;è¯¥çŠ¶æ€çš„ç›®å½•é¡¹å¯¹è±¡æ­£åœ¨è¢«å†…æ ¸ä½¿ç”¨&lt;/em&gt;ã€‚å¼•ç”¨è®¡æ•°å™¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;d_count&lt;/code&gt; å€¼ä¸ºæ­£æ•°ï¼Œå…¶ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;d_inode&lt;/code&gt; å­—æ®µæŒ‡å‘å…³è”çš„ç´¢å¼•èŠ‚ç‚¹å¯¹è±¡ã€‚ç›®å½•é¡¹å¯¹è±¡åŒ…å«æœ‰æ•ˆçš„ä¿¡æ¯ï¼Œä¸”ä¸èƒ½è¢«ä¸¢å¼ƒã€‚&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;è´ŸçŠ¶æ€&lt;/strong&gt;ï¼ˆnegativeï¼‰&lt;/p&gt;

    &lt;p&gt;&lt;em&gt;ä¸ç›®å½•é¡¹å…³è”çš„ç´¢å¼•èŠ‚ç‚¹ä¸å­˜åœ¨&lt;/em&gt;ï¼Œå¯èƒ½æ˜¯å› ä¸º&lt;em&gt;ç›¸åº”çš„ç£ç›˜èŠ‚ç‚¹å·²ç»è¢«åˆ é™¤&lt;/em&gt;ï¼Œæˆ–è€…æ˜¯å› ä¸º&lt;em&gt;ç›®å½•é¡¹å¯¹è±¡æ˜¯é€šè¿‡è§£æä¸€ä¸ªä¸å­˜åœ¨æ–‡ä»¶çš„è·¯å¾„ååˆ›å»ºçš„&lt;/em&gt;ã€‚ç›®å½•é¡¹å¯¹è±¡çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;d_inode&lt;/code&gt; å­—æ®µä¸º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;NULL&lt;/code&gt;ï¼Œä½†æ˜¯è¯¥å¯¹è±¡ä»è¢«ä¿å­˜åœ¨ç›®å½•é¡¹é«˜é€Ÿç¼“å­˜ä¸­ï¼Œä»¥ä¾¿åç»­å¯¹åŒä¸€ä¸ªæ–‡ä»¶ç›®å½•åçš„æŸ¥æ‰¾æ“ä½œèƒ½å¿«é€Ÿå®Œæˆã€‚&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;2-4-1-ç›®å½•é¡¹å¯¹è±¡æ“ä½œæ–¹æ³•&quot;&gt;2-4-1 ç›®å½•é¡¹å¯¹è±¡æ“ä½œæ–¹æ³•&lt;/h3&gt;

&lt;p&gt;ä¸ç›®å½•é¡¹å¯¹è±¡å…³è”çš„æ–¹æ³•ç§°ä¸º&lt;strong&gt;ç›®å½•é¡¹æ“ä½œ&lt;/strong&gt;ï¼Œç”± &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dentry_operation&lt;/code&gt; ç»“æ„è¡¨ç¤ºï¼Œè¯¥ç»“æ„çš„åœ°å€å­˜æ”¾åœ¨ç›®å½•é¡¹å¯¹è±¡çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;d_op&lt;/code&gt; å­—æ®µä¸­ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;d_revalidate(dentry, nameidata)&lt;/code&gt;: æŠŠç›®å½•é¡¹å¯¹è±¡è½¬æ¢ä¸ºä¸€ä¸ªæ–‡ä»¶è·¯å¾„åä¹‹å‰ï¼Œåˆ¤æ–­è¯¥ç›®å½•é¡¹å¯¹è±¡æ˜¯å¦ä»ç„¶æœ‰æ•ˆã€‚&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;d_delete(dentry)&lt;/code&gt;: å½“å¯¹ç›®å½•é¡¹å¯¹è±¡çš„æœ€åä¸€ä¸ªå¼•ç”¨è¢«åˆ é™¤æ—¶ï¼Œè°ƒç”¨è¯¥æ–¹æ³•ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;d_release(dentry)&lt;/code&gt;: å½“è¦é‡Šæ”¾ä¸€ä¸ªç›®å½•é¡¹å¯¹è±¡æ—¶ï¼ˆæ”¾å…¥ slab åˆ†é…å™¨ï¼‰ï¼Œè°ƒç”¨è¯¥æ–¹æ³•ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;d_iput(dentry, ino)&lt;/code&gt;: å½“ä¸€ä¸ªç›®å½•é¡¹å¯¹è±¡å˜ä¸ºè´ŸçŠ¶æ€ä½¿è°ƒç”¨ï¼ˆå³ä¸¢å¼ƒå¯¹åº”çš„ç´¢å¼•èŠ‚ç‚¹ï¼‰&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;2-5-ç›®å½•é¡¹é«˜é€Ÿç¼“å­˜&quot;&gt;2-5 ç›®å½•é¡¹é«˜é€Ÿç¼“å­˜&lt;/h2&gt;

&lt;p&gt;ç”±äºä»ç£ç›˜è¯»å…¥ä¸€ä¸ªç›®å½•é¡¹å¹¶æ„é€ ç›¸åº”çš„ç›®å½•é¡¹å¯¹è±¡éœ€è¦èŠ±è´¹ä¸€å®šçš„æ—¶é—´ï¼Œå› æ­¤åœ¨å®Œæˆå¯¹ç›®å½•é¡¹å¯¹è±¡çš„æ“ä½œä¹‹åï¼Œå¹¶ä¸ä¼šç«‹å³ä¸¢å¼ƒï¼Œè€Œæ˜¯å°†å…¶ä¿ç•™åœ¨å†…å­˜ä¸­ã€‚ä¸ºäº†æœ€å¤§é™åº¦åœ°æé«˜å¤„ç†è¿™äº›ç›®å½•é¡¹å¯¹è±¡çš„æ•ˆç‡ï¼ŒLinux ä½¿ç”¨&lt;strong&gt;ç›®å½•é¡¹é«˜é€Ÿç¼“å­˜&lt;/strong&gt;ï¼Œè¯¥ç¼“å­˜ç”±ä¸¤ç§ç±»å‹çš„æ•°æ®ç»“æ„ç»„æˆï¼š&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;ä¸€ä¸ªå¤„äºæ­£åœ¨ä½¿ç”¨ï¼Œæœªä½¿ç”¨æˆ–è´ŸçŠ¶æ€çš„ç›®å½•é¡¹å¯¹è±¡çš„é›†åˆ&lt;/strong&gt;
    &lt;ul&gt;
      &lt;li&gt;æ‰€æœ‰æœªä½¿ç”¨çš„ç›®å½•é¡¹å¯¹è±¡å­˜æ”¾åœ¨ä¸€ä¸ªâ€œæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆLRUï¼‰â€çš„åŒå‘é“¾è¡¨ä¸­&lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;æ­£åœ¨ä½¿ç”¨çš„ç›®å½•é¡¹å¯¹è±¡è¢«ä¿å­˜åœ¨ä¸€ä¸ªåŒå‘é“¾è¡¨ä¸­ï¼Œè¯¥é“¾è¡¨ç”±ç´¢å¼•å¯¹è±¡çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;i_dentry&lt;/code&gt; å­—æ®µå¼•ç”¨ï¼›ç›®å½•é¡¹å¯¹è±¡çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;d_alias&lt;/code&gt; å­—æ®µå­˜æ”¾é“¾è¡¨ä¸­ç›¸é‚»å…ƒç´ çš„åœ°å€&lt;/p&gt;

        &lt;blockquote&gt;
          &lt;p&gt;&lt;em&gt;æ¯ä¸ªç´¢å¼•èŠ‚ç‚¹å¯¹è±¡å¯èƒ½ä¸å¤šä¸ªç¡¬é“¾æ¥å…³è”&lt;/em&gt;ï¼Œå› æ­¤éœ€è¦ä¸€ä¸ªé“¾è¡¨&lt;/p&gt;

        &lt;/blockquote&gt;
      &lt;/li&gt;
      &lt;li&gt;å½“æŒ‡å‘æ–‡ä»¶çš„æœ€åä¸€ä¸ªç¡¬é“¾æ¥è¢«åˆ é™¤ä¹‹åï¼Œä¸€ä¸ªæ­£åœ¨è¢«ä½¿ç”¨çš„ç›®å½•é¡¹å¯¹è±¡å¯èƒ½å˜æˆè´ŸçŠ¶æ€ã€‚æ­¤æ—¶ï¼Œè¯¥ç›®å½•é¡¹å¯¹è±¡è¢«ç§»åŠ¨åˆ°æœªä½¿ç”¨ç›®å½•é¡¹å¯¹è±¡ç»„æˆçš„ LRU é“¾è¡¨ä¸­&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;ä¸€ä¸ªèƒ½å¤Ÿå¿«é€Ÿè·å–ä¸ç»™å®šçš„æ–‡ä»¶åå’Œç›®å½•åå¯¹åº”çš„ç›®å½•é¡¹å¯¹è±¡çš„æ•£åˆ—è¡¨&lt;/strong&gt;&lt;/p&gt;

    &lt;blockquote&gt;
      &lt;p&gt;å¦‚æœç›®æ ‡ç›®å½•é¡¹å¯¹è±¡ä¸å­˜åœ¨ç¼“å­˜ä¸­ï¼Œé‚£ä¹ˆæ•£åˆ—å‡½æ•°èŒƒå›´ç©ºå€¼&lt;/p&gt;

      &lt;ul&gt;
        &lt;li&gt;æ•£åˆ—è¡¨æ˜¯ç”±æ•°ç»„å®ç°ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªæŒ‡å‘é“¾è¡¨çš„æŒ‡é’ˆã€‚ç›®å½•é¡¹å¯¹è±¡çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;d_hash&lt;/code&gt; å­—æ®µåŒ…å«æŒ‡å‘å…·æœ‰ç›¸åŒæ•£åˆ—å€¼çš„é“¾è¡¨ä¸­çš„ç›¸é‚»å…ƒç´ &lt;/li&gt;
      &lt;/ul&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;ç›®å½•é¡¹é«˜é€Ÿç¼“å­˜è¿˜ç›¸å½“äº&lt;strong&gt;ç´¢å¼•èŠ‚ç‚¹é«˜é€Ÿç¼“å­˜&lt;/strong&gt;ï¼ˆinode cacheï¼‰çš„æ§åˆ¶å™¨ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;åœ¨å†…æ ¸å†…å­˜ä¸­ï¼Œä¸ä¼šä¸¢å¼ƒä¸æœªä½¿ç”¨ç›®å½•é¡¹ç›¸å…³çš„ç´¢å¼•èŠ‚ç‚¹ï¼Œå› æ­¤è¿™äº›ç´¢å¼•èŠ‚ç‚¹å¯¹è±¡ä»ä¿å­˜åœ¨ RAM ä¸­ï¼Œå¹¶ä¸”èƒ½å¤Ÿé€šè¿‡ç›¸åº”çš„ç›®å½•é¡¹å¿«é€Ÿå¼•ç”¨&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dcache_lock&lt;/code&gt; è‡ªæ—‹é”ç”¨äºä¿æŠ¤ç›®å½•é¡¹é«˜é€Ÿç¼“å­˜æ•°æ®ç»“æ„é¿å…è¢«å¤šä¸ªå¤„ç†å™¨åŒæ—¶è®¿é—®ã€‚&lt;/p&gt;

&lt;h2 id=&quot;2-6-ä¸è¿›ç¨‹ç›¸å…³çš„æ–‡ä»¶&quot;&gt;2-6 ä¸è¿›ç¨‹ç›¸å…³çš„æ–‡ä»¶&lt;/h2&gt;

&lt;p&gt;ä¹‹å‰æåˆ°ï¼Œ&lt;em&gt;æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±å½“å‰çš„å·¥ä½œç›®å½•ä¸æ ¹ç›®å½•&lt;/em&gt;ï¼Œè¿™ä»…ä»…æ˜¯è¿›ç¨‹ä¸æ–‡ä»¶ç³»ç»Ÿäº¤äº’æ‰€å¿…é¡»ç»´æŠ¤çš„æ•°æ®ä¸­çš„ä¸¤ä¸ªä¾‹å­ã€‚ç±»å‹ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fs_struct&lt;/code&gt; æ•°æ®ç»“æ„ç»´æŠ¤äº†&lt;strong&gt;è¿›ç¨‹ä¸æ–‡ä»¶ç³»ç»Ÿäº¤äº’æ‰€éœ€è¦çš„æ•°æ®&lt;/strong&gt;ï¼›&lt;em&gt;æ¯ä¸ªè¿›ç¨‹æè¿°ç¬¦çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fs&lt;/code&gt; å­—æ®µæŒ‡å‘è¯¥ç»“æ„&lt;/em&gt;ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/linux_kernel/chapter_12/lk_15.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;count&lt;/code&gt;: å…±äº«è¿™ä¸ªè¡¨çš„è¿›ç¨‹ä¸ªæ•°&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;lock&lt;/code&gt;: ç”¨äºè¡¨ä¸­å­—æ®µçš„è¯»å†™è‡ªæ—‹é”&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;root&lt;/code&gt;: æ ¹ç›®å½•çš„ç›®å½•é¡¹&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pwd&lt;/code&gt;: å½“å‰å·¥ä½œç›®å½•çš„ç›®å½•é¡¹&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;é™¤äº† &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fs_struct&lt;/code&gt;ï¼Œè¿˜æœ‰å¦ä¸€ä¸ªç»“æ„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;files_struct&lt;/code&gt;ï¼Œç”¨äºè¡¨ç¤ºè¿›ç¨‹å½“å‰æ‰“å¼€çš„æ–‡ä»¶ã€‚&lt;em&gt;è¿›ç¨‹æè¿°ç¬¦çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;files&lt;/code&gt; å­—æ®µå­˜æ”¾äº†è¯¥è¡¨çš„åœ°å€&lt;/em&gt;ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/linux_kernel/chapter_12/lk_16.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fd&lt;/code&gt;: æŒ‡å‘æ–‡ä»¶å¯¹è±¡çš„æŒ‡é’ˆæ•°ç»„ï¼›&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;max_fds&lt;/code&gt;: æŒ‡å‘è¯¥æ•°ç»„çš„é•¿åº¦&lt;/li&gt;
  &lt;li&gt;é€šå¸¸ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fd&lt;/code&gt; å­—æ®µæŒ‡å‘ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;files_struct&lt;/code&gt; ç»“æ„çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fd_array&lt;/code&gt; å­—æ®µï¼Œè¯¥å­—æ®µåŒ…å« 32 ä¸ªæ–‡ä»¶å¯¹è±¡æŒ‡é’ˆã€‚å¦‚æœè¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶æ•°å¤§äº 32ï¼Œå†…æ ¸å°±åˆ†é…ä¸€ä¸ªæ–°çš„ï¼Œæ›´å¤§çš„æ–‡ä»¶æŒ‡é’ˆæ•°ç»„ï¼Œå¹¶å°†åœ°å€å­˜æ”¾åœ¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fd&lt;/code&gt; å­—æ®µä¸­ï¼Œå†…æ ¸åŒæ—¶æ›´æ–° &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;max_fds&lt;/code&gt; å­—æ®µçš„å€¼&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;å¯¹äº &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fd&lt;/code&gt; æ•°ç»„ä¸­æœ‰å…ƒç´ çš„æ¯ä¸ªæ–‡ä»¶æ¥è¯´ï¼Œ&lt;strong&gt;æ•°ç»„çš„ç´¢å¼•å°±æ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼ˆfile descriptorï¼‰&lt;/strong&gt;ã€‚&lt;/p&gt;

    &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fd&lt;/code&gt; æ•°ç»„çš„&lt;em&gt;ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆindex = 0ï¼‰é€šå¸¸æ˜¯è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥æ–‡ä»¶&lt;/em&gt;ï¼Œ&lt;em&gt;ç¬¬äºŒä¸ªå…ƒç´ ï¼ˆindex = 1ï¼‰æ˜¯è¿›ç¨‹çš„æ ‡å‡†è¾“å‡ºæ–‡ä»¶ï¼Œç¬¬ä¸‰ä¸ªå…ƒç´ ï¼ˆindex = 2ï¼‰æ˜¯è¿›ç¨‹çš„æ ‡å‡†é”™è¯¯æ–‡ä»¶&lt;/em&gt;ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;

    &lt;p&gt;&lt;img src=&quot;/images/linux_kernel/chapter_12/lk_17.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;Unix è¿›ç¨‹å°†æ–‡ä»¶æè¿°ç¬¦ä½œä¸ºä¸»æ–‡ä»¶æ ‡è¯†ç¬¦ã€‚&lt;em&gt;ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦å¯ä»¥æŒ‡å‘åŒä¸€ä¸ªæ‰“å¼€çš„æ–‡ä»¶&lt;/em&gt;ï¼Œå³æ•°ç»„ä¸­çš„ä¸¤ä¸ªå…ƒç´ å¯èƒ½æŒ‡å‘åŒä¸€ä¸ªæ–‡ä»¶å¯¹è±¡ã€‚&lt;/li&gt;
  &lt;li&gt;è¿›ç¨‹ä¸èƒ½ä½¿ç”¨å¤šäº &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;NR_OPEN&lt;/code&gt;ï¼ˆä¸€èˆ¬ä¸º 1048576ï¼‰ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;open_fds&lt;/code&gt;: æŒ‡å‘æ‰“å¼€æ–‡ä»¶æè¿°ç¬¦çš„æŒ‡é’ˆã€‚&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;open_fds_init&lt;/code&gt;: æ–‡ä»¶æè¿°ç¬¦çš„åˆå§‹é›†åˆã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;ä½¿ç”¨æ–‡ä»¶å¯¹è±¡&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å½“å†…æ ¸å¼€å§‹ä½¿ç”¨ä¸€ä¸ªæ–‡ä»¶å¯¹è±¡æ—¶ï¼Œè°ƒç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fget()&lt;/code&gt; å‡½æ•°ï¼šè¿™ä¸ªå‡½æ•°æ¥æ”¶æ–‡ä»¶æè¿°ç¬¦ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fd&lt;/code&gt; ä½œä¸ºå‚æ•°ï¼Œè¿”å› &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;currentâ†’filesâ†’fd[fd]&lt;/code&gt; ä¸­çš„åœ°å€ï¼Œå³å¯¹åº”æ–‡ä»¶å¯¹è±¡çš„åœ°å€ï¼›åŒæ—¶ä½¿æ–‡ä»¶å¯¹è±¡å¼•ç”¨è®¡æ•°å™¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;f_count&lt;/code&gt; å€¼ +1ã€‚å¦‚æœæ²¡æœ‰æ–‡ä»¶ä¸ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fd&lt;/code&gt; å¯¹åº”ï¼Œåˆ™ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fget()&lt;/code&gt; è¿”å› NULLã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;é‡Šæ”¾æ–‡ä»¶å¯¹è±¡&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å½“å†…æ ¸å®Œæˆå¯¹æ–‡ä»¶å¯¹è±¡çš„ä½¿ç”¨åï¼Œè°ƒç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;fput()&lt;/code&gt; å‡½æ•°ï¼šè¯¥å‡½æ•°å°†æ–‡ä»¶å¯¹è±¡çš„åœ°å€ä½œä¸ºå‚æ•°ï¼Œå¹¶å‡å°‘æ–‡ä»¶å¯¹è±¡å¼•ç”¨è®¡æ•°å™¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;f_count&lt;/code&gt; çš„å€¼ã€‚å¦‚æœ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;f_count&lt;/code&gt; çš„å€¼å˜æˆ 0ï¼Œåˆ™è¯¥è¯¥å‡½æ•°è°ƒç”¨æ–‡ä»¶æ“ä½œçš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;release&lt;/code&gt; æ–¹æ³•ï¼Œå‡å°‘ç´¢å¼•èŠ‚ç‚¹å¯¹è±¡çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;i_write count&lt;/code&gt; å­—æ®µçš„å€¼ï¼Œå¹¶å°†æ–‡ä»¶å¯¹è±¡ä»è¶…çº§å—é“¾è¡¨ä¸­ç§»é™¤ï¼Œé‡Šæ”¾æ–‡ä»¶å¯¹è±¡ç»™ slab åˆ†é…å™¨ï¼Œæœ€åå‡å°‘ç›¸å…³çš„æ–‡ä»¶ç³»ç»Ÿæè¿°ç¬¦çš„ç›®å½•é¡¹å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å™¨çš„å€¼ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;3-æ–‡ä»¶ç³»ç»Ÿç±»å‹&quot;&gt;3-æ–‡ä»¶ç³»ç»Ÿç±»å‹&lt;/h1&gt;

&lt;p&gt;Linux å†…æ ¸æ”¯æŒå¤šç§ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿã€‚æœ‰ä¸€äº›ç‰¹æ®Šçš„æ–‡ä»¶ç³»ç»Ÿåœ¨ Linux å†…æ ¸è®¾è®¡ä¸­å…·æœ‰é‡è¦ä½œç”¨ã€‚&lt;/p&gt;

&lt;h2 id=&quot;3-1-ç‰¹æ®Šæ–‡ä»¶ç³»ç»Ÿ&quot;&gt;3-1 ç‰¹æ®Šæ–‡ä»¶ç³»ç»Ÿ&lt;/h2&gt;

&lt;p&gt;å½“ç½‘ç»œå’Œç£ç›˜æ–‡ä»¶ç³»ç»Ÿèƒ½å¤Ÿä½¿ç”¨æˆ·å¤„ç†å­˜æ”¾åœ¨å†…æ ¸ä¹‹å¤–çš„ä¿¡æ¯æ—¶ï¼Œç‰¹æ®Šæ–‡ä»¶ç³»ç»Ÿå¯ä»¥ä¸ºç³»ç»Ÿç®¡ç†å‘˜å’Œç¨‹åºå‘˜æä¾›ä¸€ç§å®¹æ˜“çš„æ–¹å¼æ¥&lt;strong&gt;&lt;em&gt;æ“ä½œå†…æ ¸çš„æ•°æ®ç»“æ„å¹¶å®ç°æ“ä½œç³»ç»Ÿçš„ç‰¹æ®Šç‰¹å¾&lt;/em&gt;&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;ç‰¹æ®Šæ–‡ä»¶ç³»ç»Ÿæä¾›ç»™ç³»ç»Ÿç®¡ç†å‘˜ä½¿ç”¨ï¼Œç½‘ç»œå’Œç£ç›˜æ–‡ä»¶ç³»ç»Ÿæä¾›ç»™æ™®é€šç”¨æˆ·ä½¿ç”¨&lt;/p&gt;

&lt;/blockquote&gt;

&lt;p&gt;å¸¸ç”¨çš„ç‰¹æ®Šæ–‡ä»¶ç³»ç»Ÿå¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/linux_kernel/chapter_12/lk_18.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/linux_kernel/chapter_12/lk_19.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;æ³¨æ„ï¼Œæœ‰å‡ ä¸ªæ–‡ä»¶ç³»ç»Ÿæ²¡æœ‰å›ºå®šçš„å®‰è£…ç‚¹&lt;/p&gt;

  &lt;ul&gt;
    &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;bdedv&lt;/code&gt; å—è®¾å¤‡ï¼›&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;pipefs&lt;/code&gt; ç®¡é“ï¼›&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;shm&lt;/code&gt; IPC å…±äº«çº¿æ€§åŒºï¼›&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sockfs&lt;/code&gt; å¥—æ¥å­—ï¼›&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;usbfs&lt;/code&gt; USB è®¾å¤‡ï¼›&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tmpfs&lt;/code&gt; ä¸´æ—¶æ–‡ä»¶ï¼ˆå¦‚æœä¸è¢«äº¤æ¢å‡ºå»å°±ä¿æŒåœ¨ RAM ä¸­ï¼‰&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;strong&gt;ç‰¹æ®Šæ–‡ä»¶ç³»ç»Ÿä¸å±€é™äºç‰©ç†å—è®¾å¤‡&lt;/strong&gt;ã€‚ä¸è¿‡ï¼Œå†…æ ¸ç»™æ¯ä¸ªå®‰è£…çš„ç‰¹æ®Šæ–‡ä»¶ç³»ç»Ÿåˆ†é…ä¸€ä¸ªè™šæ‹Ÿçš„å—è®¾å¤‡ï¼Œå…¶ä¸»è®¾å¤‡å·ä¸º 0ï¼Œæ¬¡è®¾å¤‡å·å…·æœ‰ä»»æ„å€¼ï¼ˆä¸åŒç‰¹æ®Šæ–‡ä»¶ç³»ç»Ÿçš„å€¼ä¸åŒï¼‰ã€‚&lt;/p&gt;

&lt;h2 id=&quot;3-2-æ–‡ä»¶ç³»ç»Ÿç±»å‹æ³¨å†Œ&quot;&gt;3-2 æ–‡ä»¶ç³»ç»Ÿç±»å‹æ³¨å†Œ&lt;/h2&gt;

&lt;p&gt;VFS éœ€è¦å¯¹ä»£ç å·²ç»åœ¨å†…æ ¸ä¸­çš„æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿçš„ç±»å‹è¿›è¡Œè·Ÿè¸ªï¼Œéœ€è¦è¿›è¡Œæ–‡ä»¶ç³»ç»Ÿç±»å‹æ³¨å†Œæ¥å®ç°ã€‚&lt;/p&gt;

&lt;p&gt;æ¯ä¸ªæ³¨å†Œçš„æ–‡ä»¶ç³»ç»Ÿä½¿ç”¨ç±»å‹ä¸º &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;file_system_type&lt;/code&gt; å¯¹è±¡æ¥è¡¨ç¤ºï¼Œè¯¥å¯¹è±¡ç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/linux_kernel/chapter_12/lk_20.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿç±»å‹çš„å¯¹è±¡éƒ½æ’å…¥åˆ°ä¸€ä¸ªå•å‘é“¾è¡¨ä¸­ï¼Œè¯¥é“¾è¡¨ç”±è‡ªæ—‹é”ä¿æŠ¤é¿å…åŒæ—¶è®¿é—®ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ç³»ç»Ÿåˆå§‹åŒ–æœŸé—´ï¼Œè°ƒç”¨ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;register_filesystem()&lt;/code&gt; å‡½æ•°æ¥æ³¨å†Œç¼–è¯‘æ—¶æŒ‡å®šçš„æ¯ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼›è¯¥å‡½æ•°æŠŠç›¸åº”çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;file_system_type&lt;/code&gt; å¯¹è±¡æ’å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿç±»å‹çš„é“¾è¡¨ä¸­ã€‚&lt;/p&gt;

&lt;h1 id=&quot;4-æ–‡ä»¶ç³»ç»Ÿå¤„ç†&quot;&gt;4-æ–‡ä»¶ç³»ç»Ÿå¤„ç†&lt;/h1&gt;

&lt;p&gt;ä¸å…¶ä»– Unix ç³»ç»Ÿä¸€æ ·ï¼ŒLinux ä¹Ÿä½¿ç”¨ç³»ç»Ÿçš„&lt;strong&gt;æ ¹æ–‡ä»¶ç³»ç»Ÿï¼ˆsystemâ€™s root filesystemï¼‰&lt;/strong&gt;ï¼š&lt;em&gt;ç”±å†…æ ¸åœ¨å¼•å¯¼é˜¶æ®µç›´æ¥å®‰è£…ï¼Œå¹¶æ‹¥æœ‰ç³»ç»Ÿåˆå§‹åŒ–è„šæœ¬åŠæœ€åŸºæœ¬çš„ç³»ç»Ÿç¨‹åº&lt;/em&gt;ã€‚&lt;/p&gt;

&lt;p&gt;å…¶ä»–æ–‡ä»¶ç³»ç»Ÿè¦ä¹ˆç”±åˆå§‹åŒ–è„šæœ¬å®‰è£…ï¼Œè¦ä¹ˆç”±ç”¨æˆ·ç›´æ¥å®‰è£…åœ¨å·²ç»å®‰è£…çš„æ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•ä¸Šã€‚&lt;/p&gt;

&lt;p&gt;ä½œä¸ºä¸€ä¸ªç›®å½•æ ‘ï¼Œæ¯ä¸ªæ–‡ä»¶ç³»ç»Ÿéƒ½æ‹¥æœ‰è‡ªå·±çš„æ ¹ç›®å½•ï¼ˆroot directoryï¼‰ã€‚å®‰è£…æ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•ç§°ä¹‹ä¸º&lt;strong&gt;å®‰è£…ç‚¹ï¼ˆmount pointï¼‰&lt;/strong&gt;ã€‚&lt;strong&gt;&lt;em&gt;å¯¹äºå·²ç»å®‰è£…çš„æ–‡ä»¶ç³»ç»Ÿå±äºå®‰è£…ç‚¹ç›®å½•çš„ä¸€ä¸ªå­æ–‡ä»¶ç³»ç»Ÿ&lt;/em&gt;&lt;/strong&gt;ï¼Œå¦‚ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/proc&lt;/code&gt; è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿæ˜¯ç³»ç»Ÿçš„æ ¹æ–‡ä»¶ç³»ç»Ÿçš„å­æ–‡ä»¶ç³»ç»Ÿã€‚&lt;/p&gt;

&lt;h2 id=&quot;4-1-å‘½åç©ºé—´&quot;&gt;4-1 å‘½åç©ºé—´&lt;/h2&gt;

&lt;p&gt;åœ¨ Linux ä¸­ï¼Œæ¯ä¸ªè¿›ç¨‹å¯ä»¥æ‹¥æœ‰è‡ªå·±çš„å·²å®‰è£…æ–‡ä»¶ç³»ç»Ÿæ ‘ï¼Œè¢«ç§°ä¸ºè¿›ç¨‹çš„&lt;strong&gt;å‘½åç©ºé—´&lt;/strong&gt;ï¼ˆnamespaceï¼‰ã€‚é€šå¸¸å¤§å¤šæ•°è¿›ç¨‹å…±äº«åŒä¸€ä¸ªå‘½åç©ºé—´ï¼Œå³ä½äºç³»ç»Ÿçš„æ ¹æ–‡ä»¶ç³»ç»Ÿä¸”è¢« init è¿›ç¨‹ä½¿ç”¨çš„å·²å®‰è£…çš„æ–‡ä»¶ç³»ç»Ÿæ ‘ã€‚&lt;/p&gt;

&lt;h1 id=&quot;5-è·¯å¾„åæŸ¥æ‰¾&quot;&gt;5-è·¯å¾„åæŸ¥æ‰¾&lt;/h1&gt;

&lt;p&gt;å½“è¿›ç¨‹éœ€è¦è¯†åˆ«ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œå°±å°†æ–‡ä»¶è·¯å¾„åä¼ é€’ç»™æŸä¸ª VFS ç³»ç»Ÿè°ƒç”¨ï¼ˆå¦‚ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;open()&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mkdir()&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rename()&lt;/code&gt; ç­‰ï¼‰ï¼ŒVFS ä¼šå°†è·¯å¾„åå¯¼å‡ºå¯¹åº”çš„ç´¢å¼•èŠ‚ç‚¹ã€‚&lt;/p&gt;

&lt;p&gt;è·¯å¾„åæŸ¥æ‰¾çš„æ ‡å‡†æµç¨‹æ˜¯&lt;strong&gt;åˆ†æè·¯å¾„åå¹¶æŠŠå®ƒæ‹†åˆ†æˆä¸€ä¸ªæ–‡ä»¶ååºåˆ—ï¼Œé™¤äº†æœ€åä¸€ä¸ªæ–‡ä»¶åä»¥å¤–ï¼Œå…¶ä½™æ‰€æœ‰æ–‡ä»¶åè‚¯å®šéƒ½æ˜¯ç›®å½•&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;å¦‚æœè·¯å¾„åçš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ â€œ/â€ï¼Œåˆ™è¯¥è·¯å¾„åæ˜¯ç»å¯¹è·¯å¾„ï¼Œéœ€è¦ä» &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;currentâ†’fsâ†’root&lt;/code&gt;ï¼ˆè¿›ç¨‹æ ¹ç›®å½•ï¼‰æ‰€æ ‡è¯†çš„ç›®å½•å¼€å§‹æœç´¢&lt;/li&gt;
  &lt;li&gt;å¦åˆ™ï¼Œè¯¥è·¯å¾„åæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œéœ€è¦ä» &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;currentâ†’fsâ†’pwd&lt;/code&gt;ï¼ˆè¿›ç¨‹å½“å‰ç›®å½•ï¼‰æ‰€æ ‡è¯†çš„ç›®å½•å¼€å§‹æœç´¢&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;åœ¨å¯¹åˆå§‹ç›®å½•çš„ç´¢å¼•èŠ‚ç‚¹è¿›è¡Œå¤„ç†æ—¶ï¼Œéœ€è¦æ£€æŸ¥ä¸ç¬¬ä¸€ä¸ªåå­—&lt;strong&gt;åŒ¹é…çš„ç›®å½•é¡¹ï¼Œè·å¾—ç›¸åº”çš„ç´¢å¼•èŠ‚ç‚¹&lt;/strong&gt;ï¼›ä¹‹åï¼Œ&lt;strong&gt;ä»ç£ç›˜è¯»å–åŒ…å«é‚£ä¸ªç´¢å¼•èŠ‚ç‚¹çš„ç›®å½•æ–‡ä»¶&lt;/strong&gt;ï¼Œå¹¶æ£€æŸ¥ä¸ç¬¬äºŒä¸ªåå­—åŒ¹é…çš„ç›®å½•é¡¹ï¼Œä»¥è·å¾—ç›¸åº”çš„ç´¢å¼•èŠ‚ç‚¹ã€‚å¯¹åŒ…å«åœ¨è·¯å¾„ä¸­çš„æ¯ä¸ªåå­—ï¼Œè¯¥è¿‡ç¨‹åå¤æ‰§è¡Œã€‚&lt;/p&gt;

&lt;p&gt;ç›®å½•é¡¹é«˜é€Ÿç¼“å­˜èƒ½å¤ŸåŠ é€Ÿä¸Šè¿°è§£ææµç¨‹ï¼Œå› ä¸ºæœ€è¿‘æœ€å¸¸ä½¿ç”¨çš„ç›®å½•é¡¹å¯¹è±¡ä¿è¢«ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œæ¯ä¸ª&lt;strong&gt;ç›®å½•é¡¹å¯¹è±¡ä½¿å¾—ç‰¹å®šç›®å½•ä¸­çš„ä¸€ä¸ªæ–‡ä»¶åä¸å®ƒç›¸åº”çš„ç´¢å¼•èŠ‚ç‚¹è”ç³»èµ·æ¥&lt;/strong&gt;ã€‚å› æ­¤ï¼Œå¯ä»¥é¿å…åœ¨è·¯å¾„åˆ†æè¿‡ç¨‹ä¸­ä»ç£ç›˜è¯»å–ä¸­é—´ç›®å½•ã€‚&lt;/p&gt;

&lt;p&gt;è·¯å¾„åæŸ¥æ‰¾ç”± &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;path_look_up()&lt;/code&gt; å‡½æ•°æ‰§è¡Œï¼Œæ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼š&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;name&lt;/code&gt;: æŒ‡å‘è¦è§£æçš„æ–‡ä»¶è·¯å¾„åçš„æŒ‡é’ˆ&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;flags&lt;/code&gt;: æ ‡å¿—ï¼Œè¡¨ç¤ºå°†ä¼šå¦‚ä½•è®¿é—®æŸ¥æ‰¾åˆ°çš„æ–‡ä»¶&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nd&lt;/code&gt;: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nameidata&lt;/code&gt; æ•°æ®ç»“æ„çš„åœ°å€ï¼Œå­˜æ”¾äº†æŸ¥æ‰¾æ“ä½œçš„ç»“æœ&lt;/p&gt;

    &lt;blockquote&gt;
      &lt;p&gt;å½“ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;path_lookup()&lt;/code&gt; è¿”å›æ—¶ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nd&lt;/code&gt; æŒ‡å‘çš„ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nameidata&lt;/code&gt; ç»“æ„ç”¨ä¸è·¯å¾„åæŸ¥æ‰¾æ“ä½œæœ‰å…³çš„æ•°æ®å¡«å……&lt;/p&gt;

    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nameidata&lt;/code&gt; ç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/linux_kernel/chapter_12/lk_21.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dentry&lt;/code&gt; ä¸ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mnt&lt;/code&gt; åˆ†åˆ«æŒ‡å‘æ‰€è§£æçš„&lt;strong&gt;&lt;em&gt;æœ€åä¸€ä¸ªè·¯å¾„åˆ†é‡çš„ç›®å½•é¡¹å¯¹è±¡å’Œå·²ç»å®‰è£…æ–‡ä»¶ç³»ç»Ÿå¯¹è±¡&lt;/em&gt;&lt;/strong&gt;ã€‚&lt;/p&gt;

    &lt;blockquote&gt;
      &lt;p&gt;è¿™ä¸¤ä¸ªå­—æ®µè¡¨ç¤ºç»™å®šçš„è·¯å¾„æ–‡ä»¶&lt;/p&gt;

    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;flags&lt;/code&gt; å­—æ®µçš„å–å€¼æœ‰ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/linux_kernel/chapter_12/lk_22.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;</content><author><name>kkzhang</name></author><category term="Operating-System" /><summary type="html">é€šè¿‡æ‰€è°“çš„è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿçš„æ¦‚å¿µï¼ŒLinux ç³»ç»Ÿèƒ½å¤Ÿæ”¯æŒå¤šç§æ–‡ä»¶ç³»ç»Ÿç±»å‹ã€‚è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿæ‰€éšå«çš„æ€æƒ³æ˜¯æŠŠè¡¨ç¤ºå¤šç§ä¸åŒç±»å‹çš„æ–‡ä»¶ç³»ç»Ÿçš„å…±åŒä¿¡æ¯å­˜æ”¾åœ¨å†…æ ¸ä¸­ï¼Œå¯¹æ–‡ä»¶ç³»ç»Ÿçš„è¯»å†™è°ƒç”¨ï¼Œå†…æ ¸éƒ½èƒ½å°†å…¶æ›¿æ¢æˆæ”¯æŒæœ¬åœ° Linux æ–‡ä»¶ç³»ç»Ÿæˆ–è€…å…¶ä»–æ–‡ä»¶ç³»ç»Ÿçš„å®é™…å‡½æ•°ã€‚</summary></entry></feed>