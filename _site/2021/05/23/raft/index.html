<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <meta name='viewport' content='width=device-width, initial-scale=1'>

  <title>Raft: An Understandable Consensus Algorithm</title>
  <link rel="icon" href="https://raw.githubusercontent.com/kkzhang-tt/kkzhang-tt.github.io/main/_images/logo.ico" type="image/x-icon">
  <meta name='description' content="æ¦‚è¿°">
  <link rel='canonical' href="kkzhang-tt.github.io/2021/05/23/raft/">
  <link rel='alternate' type='application/rss+xml' title='Find a needle in haystack' href="kkzhang-tt.github.io/feed.xml">
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Volkhov:400,700" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" rel="stylesheet">

  <style>
    
    /*! normalize.css v7.0.0 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,footer,header,nav,section{display:block}h1{font-size:2em;margin:0.67em 0}figcaption,figure,main{display:block}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace, monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace, monospace;font-size:1em}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-0.25em}sup{top:-0.5em}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}button,html [type="button"],[type="reset"],[type="submit"]{-webkit-appearance:button}button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0}button:-moz-focusring,[type="button"]:-moz-focusring,[type="reset"]:-moz-focusring,[type="submit"]:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:0.35em 0.75em 0.625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{display:inline-block;vertical-align:baseline}textarea{overflow:auto}[type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0}[type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{height:auto}[type="search"]{-webkit-appearance:textfield;outline-offset:-2px}[type="search"]::-webkit-search-cancel-button,[type="search"]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details,menu{display:block}summary{display:list-item}canvas{display:inline-block}template{display:none}[hidden]{display:none}body,h1,h2,h3,h4,h5,h6,p,blockquote,pre,dl,dd,ol,ul,fieldset,legend,figure,hr{margin:0;padding:0}li>ul,li>ol{margin-bottom:0}table{border-collapse:collapse;border-spacing:0}@-webkit-keyframes spin{100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spin{100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}.icon{position:relative;display:inline-block;width:25px;height:25px;overflow:hidden;fill:currentColor}.icon__cnt{width:100%;height:100%;background:inherit;fill:inherit;pointer-events:none;transform:translateX(0);-ms-transform:translate(0.5px, -0.3px)}.icon--m{width:50px;height:50px}.icon--l{width:100px;height:100px}.icon--xl{width:150px;height:150px}.icon--xxl{width:200px;height:200px}.icon__spinner{position:absolute;top:0;left:0;width:100%;height:100%}.icon--ei-spinner .icon__spinner,.icon--ei-spinner-2 .icon__spinner{-webkit-animation:spin 1s steps(12) infinite;animation:spin 1s steps(12) infinite}.icon--ei-spinner-3 .icon__spinner{-webkit-animation:spin 1.5s linear infinite;animation:spin 1.5s linear infinite}.icon--ei-sc-facebook{fill:#3b5998}.icon--ei-sc-github{fill:#333}.icon--ei-sc-google-plus{fill:#dd4b39}.icon--ei-sc-instagram{fill:#3f729b}.icon--ei-sc-linkedin{fill:#0976b4}.icon--ei-sc-odnoklassniki{fill:#ed812b}.icon--ei-sc-skype{fill:#00aff0}.icon--ei-sc-soundcloud{fill:#f80}.icon--ei-sc-tumblr{fill:#35465c}.icon--ei-sc-twitter{fill:#55acee}.icon--ei-sc-vimeo{fill:#1ab7ea}.icon--ei-sc-vk{fill:#45668e}.icon--ei-sc-youtube{fill:#e52d27}.icon--ei-sc-pinterest{fill:#bd081c}.icon--ei-sc-telegram{fill:#0088cc}*,*::after,*::before{box-sizing:border-box}h1,h2,h3,h4,h5,h6,ul,ol,dl,blockquote,p,address,hr,table,fieldset,figure,pre{margin-bottom:15px}ul,ol,dd{margin-left:15px}.highlight{background:#f7f7f7}.highlighter-rouge .highlight{background:#eef}.highlight .c{color:#998;font-style:italic}.highlight .err{color:#a61717;background-color:#e3d2d2}.highlight .k{font-weight:bold}.highlight .o{font-weight:bold}.highlight .cm{color:#998;font-style:italic}.highlight .cp{color:#999;font-weight:bold}.highlight .c1{color:#998;font-style:italic}.highlight .cs{color:#999;font-weight:bold;font-style:italic}.highlight .gd{color:#000;background-color:#fdd}.highlight .gd .x{color:#000;background-color:#faa}.highlight .ge{font-style:italic}.highlight .gr{color:#a00}.highlight .gh{color:#999}.highlight .gi{color:#000;background-color:#dfd}.highlight .gi .x{color:#000;background-color:#afa}.highlight .go{color:#888}.highlight .gp{color:#555}.highlight .gs{font-weight:bold}.highlight .gu{color:#aaa}.highlight .gt{color:#a00}.highlight .kc{font-weight:bold}.highlight .kd{font-weight:bold}.highlight .kp{font-weight:bold}.highlight .kr{font-weight:bold}.highlight .kt{color:#458;font-weight:bold}.highlight .m{color:#099}.highlight .s{color:#d14}.highlight .na{color:#008080}.highlight .nb{color:#0086B3}.highlight .nc{color:#458;font-weight:bold}.highlight .no{color:#008080}.highlight .ni{color:#800080}.highlight .ne{color:#900;font-weight:bold}.highlight .nf{color:#900;font-weight:bold}.highlight .nn{color:#555}.highlight .nt{color:#000080}.highlight .nv{color:#008080}.highlight .ow{font-weight:bold}.highlight .w{color:#bbb}.highlight .mf{color:#099}.highlight .mh{color:#099}.highlight .mi{color:#099}.highlight .mo{color:#099}.highlight .sb{color:#d14}.highlight .sc{color:#d14}.highlight .sd{color:#d14}.highlight .s2{color:#d14}.highlight .se{color:#d14}.highlight .sh{color:#d14}.highlight .si{color:#d14}.highlight .sx{color:#d14}.highlight .sr{color:#009926}.highlight .s1{color:#d14}.highlight .ss{color:#990073}.highlight .bp{color:#999}.highlight .vc{color:#008080}.highlight .vg{color:#008080}.highlight .vi{color:#008080}.highlight .il{color:#099}body{font-family:"Open Sans",Helvetica Neue,Helvetica,Arial,sans-serif;font-size:15px;line-height:28px;color:#404040;background-color:#fbfbfb;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}*::selection{color:#fff;background-color:#3af}h1,h2,h3,h4,h5,h6{font-family:"Volkhov","Times New Roman",Times,serif;font-weight:400;line-height:initial}h1{font-size:32px}h2{font-size:28px}h3{font-size:24px}h4{font-size:20px}h5{font-size:18px}h6{font-size:16px}img{max-width:100%;height:auto;vertical-align:middle}a{text-decoration:none;color:#3af;transition:.35s}a:hover{color:#0086e6}blockquote{padding-left:15px;border-left:3px solid #3af;font-family:'Volkhov', 'Times New Roman', Times, serif;font-style:normal;font-size:18px;background-color:rgba(220,235,245,0.2)}blockquote p{padding:10px}hr{height:1px;margin:30px 0;border:0;background-color:#f0f0f0}pre{overflow:auto;padding:25px;font-size:14px;white-space:pre-wrap;word-wrap:break-word;word-break:break-all;font-family:Courier, monospace}code{overflow:auto;white-space:pre-wrap;word-wrap:break-word;word-break:break-all;font-family:Courier, monospace;font-size:14px}p code,li code{padding:3px 5px}.o-wrapper{max-width:1440px;position:relative}.o-opacity{animation-duration:0.7s;animation-delay:0.2s;animation-fill-mode:both;animation-name:opacity}@keyframes opacity{from{opacity:0}to{opacity:1}}.c-btn{display:inline-block;white-space:nowrap;vertical-align:middle;font-family:'Volkhov', serif;font-size:12px;text-align:center;padding:8px 15px;cursor:pointer;transition:.35s}.c-btn--primary{color:#fff;background-color:#3af;background:linear-gradient(135deg, #3af 0%, #62d5ff 100%)}.c-btn--secondary{color:#fff;background-color:#cfcfdd;background:linear-gradient(135deg, #a2a2bd 0%, #cfcfdd 100%)}.c-btn--round{border-radius:30px}.c-btn--shadow{box-shadow:8px 10px 20px 0 rgba(46,61,73,0.15)}.c-btn--shadow:hover{box-shadow:2px 4px 8px 0px rgba(46,61,73,0.2)}.c-btn--middle{display:block;width:300px;max-width:100%}.c-btn--big{display:block;width:100%}.c-btn:hover{color:#fff;transition:.35s}.c-btn:active{transform:translateY(2px)}.c-sidebar{display:flex;flex-direction:column;justify-content:space-between;position:fixed;top:0;left:0;bottom:0;width:360px;padding:40px 20px 20px;text-align:center;box-shadow:1px 1px 0 rgba(31,35,46,0.15);background-color:#fff}.c-sidebar-author .c-author__cover{width:150px;height:200px;margin:0 auto 10px;border-radius:5%;overflow:hidden;background-color:#cfcfdd}.c-sidebar-author .c-author__cover img{width:100%;height:100%;border-radius:5%;transition:.35s}.c-sidebar-author .c-contact-menu .c-btn{min-width:110px}.c-sidebar-author .c-contact-menu .c-btn .icon{width:18px;height:18px;vertical-align:text-bottom;fill:#fff}.c-sidebar-author .c-author__info{font-family:'Volkhov', serif}.c-sidebar-author .c-author__name{font-size:18px;font-weight:700;line-height:21px}.c-sidebar-author .c-author__job{font-size:12px;color:#a0a0a0;margin:5px 0 0}.c-sidebar-author .c-contact-menu{margin:30px 0}.c-sidebar-author .c-contact-menu .c-btn--secondary{margin-right:10px}.c-sidebar-author .c-author__about{max-width:400px;margin:5px 5px 5px 55px;font-size:13px}.c-sidebar-footer .c-social__title{position:relative;font-family:'Volkhov', serif;font-size:15px;font-weight:700;color:#444}.c-sidebar-footer .c-social__title::before{content:"";display:block;height:2px;width:calc(50% - 40px);transform:translateY(-50%);position:absolute;top:50%;left:0;background-color:#444}.c-sidebar-footer .c-social__title::after{content:"";display:block;height:2px;width:calc(50% - 40px);transform:translateY(-50%);position:absolute;top:50%;right:0;background-color:#444}.c-sidebar-footer .c-social__list{list-style-type:none;padding:0;margin:15px 0}.c-sidebar-footer .c-social__list .c-social__item{display:inline-block;width:27px;height:27px}.c-sidebar-footer .c-social__list .icon{width:27px;height:27px;fill:#444;vertical-align:middle;transition:.35s}.c-sidebar-footer .c-social__list .icon:hover{fill:#3af;transform:scale(1.2);transition:.35s}.c-sidebar-footer .c-copyright p{font-size:13px;margin:0}@media only screen and (max-width: 900px){.c-sidebar{position:relative;width:100%;padding:20px}.c-sidebar .c-contact-menu{margin:20px 0}.c-sidebar-footer .c-social .c-social__title{clip:rect(1px, 1px, 1px, 1px);height:1px;overflow:hidden;position:absolute !important;width:1px;word-wrap:normal !important}.c-sidebar-footer .c-social__list{margin:0}.c-sidebar-footer .c-copyright{clip:rect(1px, 1px, 1px, 1px);height:1px;overflow:hidden;position:absolute !important;width:1px;word-wrap:normal !important}}@media only screen and (max-width: 480px){.c-sidebar-author .c-author__cover{width:80px;height:80px}.c-sidebar-author .c-author__cover img{width:100%;height:100%}.c-sidebar-author .c-contact-menu{margin:15px 0}.c-sidebar-author .c-contact-menu .c-btn{min-width:80px;font-size:10px;padding:4px 15px;margin-right:5px}.c-sidebar-author .c-contact-menu .c-btn .icon{width:16px;height:16px}.c-sidebar-footer .c-social .c-social__title{clip:rect(1px, 1px, 1px, 1px);height:1px;overflow:hidden;position:absolute !important;width:1px;word-wrap:normal !important}.c-sidebar-footer .c-social__list{margin:0}.c-sidebar-footer .c-social__list .icon{width:25px;height:25px}.c-sidebar-footer .c-copyright{clip:rect(1px, 1px, 1px, 1px);height:1px;overflow:hidden;position:absolute !important;width:1px;word-wrap:normal !important}}.c-content{position:relative;display:flex;flex-direction:row;flex-wrap:wrap;align-items:stretch;padding:0 20px 0;margin-left:360px}@media only screen and (max-width: 900px){.c-content{position:static;padding:0 15px 0;margin-left:0}}.c-posts{width:100%;display:flex;flex-direction:row;flex-wrap:wrap}.c-post{width:100%;max-width:100%;margin-bottom:20px;display:flex;flex-direction:row;align-items:stretch;min-height:90px;border-radius:10px;overflow:hidden;transition:.35s;background-color:#fff;box-shadow:0 1px 1px 0 rgba(31,35,46,0.15)}.c-post:hover{transform:translate(0px, -2px);box-shadow:0 15px 45px -10px rgba(10,16,34,0.2)}.c-post .c-post-thumbnail{display:block;width:30%;max-width:100%;min-height:180px;border-radius:10px 0 0 10px;background-color:rgba(220,235,245,0.2);background-size:cover;background-position:50% 50%}.c-post .c-post-content{padding:15px;width:70%}.c-post .c-post-content .c-post-title{font-size:30px;font-weight:400;margin:0 0 15px}.c-post .c-post-content .c-post-title a{text-decoration:none;color:#263959}.c-post .c-post-content .c-post-date,.c-post .c-post-content .c-post-words{font-size:12px}.c-load-more{padding:20px;margin:20px auto 40px;font-size:13px;color:#fff;border:none;background-color:#3af;outline:none}.c-load-more:hover{background-color:#0086e6}@media only screen and (max-width: 1200px){.c-post{width:48%;max-width:100%;margin:0 1% 20px;flex-direction:column}.c-post .c-post-thumbnail{width:100%;border-radius:10px 10px 0 0}.c-post .c-post-content{width:100%}.c-post .c-post-content .c-post-title{font-size:21px;margin:15px 0}}@media only screen and (max-width: 480px){.c-post{width:100%;max-width:100%;margin:0 0 20px}.c-post .c-post-content{width:100%}.c-post .c-post-content .c-post-title{font-size:21px;margin:15px 0}}.c-article{width:100%;margin:20px 0}.c-wrap-content{padding:20px;background-color:#fff}.c-article__image{position:relative;background-color:rgba(220,235,245,0.2);background-position:center;background-size:cover;background-repeat:no-repeat}.c-article__image:after{content:"";display:block;padding-top:56%}.c-article__header{margin-bottom:20px;text-align:center}.c-article__header .c-article__title{margin-bottom:10px}.c-article__date span{font-size:13px;text-transform:uppercase;color:#a0a0a0}.c-article__footer{margin:30px 0 0;padding-bottom:30px;text-align:center;border-bottom:1px solid #f0f0f0}.c-article__footer .c-article__share{transition:.35s}.c-article__footer .c-article__share a .icon{vertical-align:middle;transition:.35s}.c-article__footer .c-article__share a .icon:hover{opacity:.7;transition:.35s}.c-article__footer .c-article__tag{margin-bottom:5px}.c-article__footer .c-article__tag a{display:inline-block;vertical-align:middle;padding:5px 10px;font-family:'Volkhov', 'Times New Roman', Times, serif;font-size:10px;line-height:10px;text-transform:uppercase;background-color:rgba(115,138,160,0.6);color:#fff}.c-article__footer .c-article__tag a:hover{background-color:rgba(80,100,118,0.6)}.c-article__footer .c-article__tag a:last-child{margin-right:0}.c-recent-post{padding:30px 0}.c-recent-post .c-recent__title{font-size:14px;text-align:center;text-transform:uppercase;margin-bottom:30px}.c-recent-post .c-recent__box{display:flex;flex-direction:row;flex-wrap:wrap}.c-recent-post .c-recent__item{max-width:23%;flex-basis:23%;margin:0 1% 20px;border-radius:10px;overflow:hidden;text-align:center;background-color:#fff;box-shadow:0 1px 1px 0 rgba(31,35,46,0.15);transition:.35s}.c-recent-post .c-recent__item h4{margin-bottom:5px;font-size:12px;text-transform:uppercase}.c-recent-post .c-recent__item h4 a{color:#444}.c-recent-post .c-recent__item:hover{box-shadow:2px 4px 8px 0px rgba(46,61,73,0.2)}.c-recent-post .c-recent__footer{padding:15px}.c-recent-post .c-recent__image{display:block;width:100%;min-height:180px;background-color:rgba(220,235,245,0.2);background-size:cover;background-position:center;background-repeat:no-repeat}.c-recent-post .c-recent__date{color:#a0a0a0;font-size:12px}@media only screen and (max-width: 1200px){.c-recent-post .c-recent__item{max-width:48%;flex-basis:48%}}@media only screen and (max-width: 900px){.c-article{margin:15px 0}}@media only screen and (max-width: 480px){.c-wrap-content{padding:15px}.c-article__header{margin-bottom:5px}.c-article__header .c-article__title{font-size:24px;margin-bottom:5px}.c-recent-post .c-recent__item{max-width:100%;flex-basis:100%;margin:0 0 20px}}.c-blog-tags{width:100%;padding:20px;margin:20px 0 40px;background-color:#fff}.c-blog-tags h1{text-align:center;margin-bottom:0}.c-blog-tags h2{font-size:18px;text-transform:uppercase;margin:30px 0;color:#757575}.c-tag__list{list-style:none;padding:0 0 40px;margin:40px 0 0;border-bottom:1px solid #f0f0f0}.c-tag__list li{display:inline-block;margin-right:15px}.c-tag__list li a{color:#404040;text-transform:uppercase;font-size:12px}.c-tag__list li a:hover{color:#000}.c-tag__item{margin-bottom:15px}.c-tag__image{width:50px;height:50px;border-radius:50%;margin-right:5px}@media only screen and (max-width: 480px){.c-blog-tags{padding:15px}.c-blog-tags h1{font-size:27px}.c-blog-tags h2{font-size:16px;margin:15px 0}.c-tag__list{padding:0 0 30px;margin:30px 0 0}.c-tag__item{margin-bottom:5px}.c-tag__image{display:none}}.c-header{position:relative;width:100%;margin:20px 0}.c-header__box{position:relative;display:flex;flex-direction:row;justify-content:space-between;align-items:center}.c-header__box .icon--ei-search{position:absolute;top:7px;left:15px;fill:#ccc}.c-search{width:80%}.c-search .c-search__box{display:flex;align-items:center}.c-search .c-search__text{position:relative;width:100%;padding:10px 10px 10px 40px;border:1px solid #dce4ea;border-radius:30px;outline:none;color:#a0a0a0}.c-search .c-search__text::placeholder{color:#ccc}.c-search .c-search__text:hover{box-shadow:0 1px 0px rgba(132,135,138,0.1);transition:.35s}.c-search .c-search-results-list{position:absolute;width:100%;margin:10px 0 0;list-style-type:none;background-color:#fff;z-index:1}.c-search .c-search-results-list li{display:flex;flex-wrap:wrap;align-items:center;margin:0;padding:20px 25px 0;background-color:#fff;line-height:1.4;border-left:solid 1px #edeeee;border-right:solid 1px #edeeee}.c-search .c-search-results-list li:first-child{border-top-left-radius:5px;border-top-right-radius:5px;border-top:solid 1px #edeeee}.c-search .c-search-results-list li:last-child{border-bottom-left-radius:5px;border-bottom-right-radius:5px;padding-bottom:25px;border-bottom:solid 1px #edeeee}.c-search .c-search-results-list li a{font-size:16px}.c-nav{flex-grow:1;padding-left:20px}.c-nav .c-nav__list{display:flex;justify-content:flex-end}.c-nav .c-nav__list .c-nav__item{display:flex;align-items:center;float:left;padding:4px 10px;font-size:10px;text-transform:uppercase;white-space:nowrap;border:1px solid #dce4ea;box-shadow:0 1px 0px rgba(132,135,138,0.4);will-change:transform;transform:translateY(0px);cursor:pointer}.c-nav .c-nav__list .c-nav__item:hover{color:#222;background-color:#fff}.c-nav .c-nav__list .c-nav__item.is-active{box-shadow:0 0 0 rgba(132,135,138,0.5);transform:translateY(1px);color:#cfcfdd}.c-nav .c-nav__list .c-nav__item.is-active:hover{background-color:#fbfbfb}.c-nav .c-nav__list .c-nav__item:first-child{border-radius:10px 0 0 10px}.c-nav .c-nav__list .c-nav__item:last-child{border-radius:0 10px 10px 0}.c-nav .c-nav__list .c-nav__item .icon{width:18px;height:18px;margin-right:3px}@media only screen and (max-width: 900px){.c-header{margin:15px 0}}@media only screen and (max-width: 480px){.c-header .c-header__box{flex-direction:column}.c-header .c-search{width:100%}.c-header .c-search .c-search__text{padding:8px 8px 8px 40px}.c-header .c-nav{margin-top:15px}.c-header .c-nav .c-nav__list{justify-content:center}.c-header .c-nav .c-nav__item{padding:4px 8px}}.c-categories{width:100%}.c-categories__list{width:100%;display:flex;flex-direction:row;flex-wrap:wrap}.c-categories__item{max-width:25%;flex-basis:25%;padding:0 10px 20px}.c-categories__link{height:100%;display:flex;flex-direction:column;align-items:center;padding:20px 10px;border-radius:5px;box-shadow:5px 5px 25px rgba(46,61,73,0.15);background-color:#fff;transition:.35s}.c-categories__link:hover{box-shadow:2px 4px 8px 0px rgba(46,61,73,0.2)}.c-categories__link:hover .c-categories__img .c-categories__more{opacity:1;transition:.35s}.c-categories__link .c-categories__container{width:100%;word-wrap:break-word}.c-categories__link .c-categories__container.c-empty-figure{display:flex;flex-direction:column;justify-content:center;flex-grow:1}.c-categories__img{position:relative;max-width:100%}.c-categories__img figure{position:relative;width:200px;max-width:100%;margin-bottom:20px;overflow:hidden;background-size:cover;background-repeat:no-repeat;background-position:center;border-radius:50%;box-shadow:inset 0 1px 3px rgba(141,165,185,0.3)}.c-categories__img figure:after{content:"";display:block;padding-top:100%}.c-categories__img figure:before{content:"";position:absolute;top:0;bottom:0;left:0;right:0;background-color:rgba(0,0,0,0.15)}.c-categories__img .c-categories__more{display:inline-block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);font-weight:700;color:#fff;text-transform:uppercase;text-shadow:0 1px 0 rgba(104,172,191,0.3);opacity:0;transition:.35s}.c-categories__container{text-align:center}.c-categories__container .c-categories__header{font-size:13px;margin-bottom:10px;font-weight:normal;text-transform:uppercase;color:#404040}.c-categories__container .c-categories__count{font-family:'Volkhov', serif;font-size:12px;color:#404040;margin-bottom:0}.c-categories__container .c-categories__count span{display:inline-block;width:20px;height:20px;line-height:20px;vertical-align:baseline;margin-right:5px;border-radius:50%;color:#fff;background-color:#ee6c6c}@media only screen and (max-width: 1200px){.c-categories .c-categories__item{max-width:33.333%;flex-basis:33.333%}}@media only screen and (max-width: 1050px){.c-categories .c-categories__item{max-width:50%;flex-basis:50%}}@media only screen and (max-width: 480px){.c-categories .c-categories__item{max-width:100%;flex-basis:100%;padding:0 0 20px}}.c-form-box{position:absolute;top:0;width:calc(100% - 40px);min-height:100vh;padding:0 20px;background-color:#fff;z-index:1}.c-form-bnt__close{position:absolute;top:0px;left:0;width:30px;height:30px;cursor:pointer;transition:.35s}.c-form-bnt__close:hover{transform:scale(0.8);opacity:.8}.c-form{position:relative;width:750px;max-width:100%;margin:40px auto}.c-form .c-form__title{margin:0 0 40px;min-width:0;border:0;padding:0;font-family:"Volkhov","Times New Roman",Times,serif;text-transform:uppercase;text-align:center}.c-form a{color:#404040}.c-form__group{margin-bottom:20px}.c-form__group label{display:block;text-transform:uppercase;font-size:10px}.c-form__group input,.c-form__group textarea{width:100%;padding:10px 15px;color:#404040;border:1px solid #dce4ea;outline:none;transition:.35s}.c-form__group input:focus,.c-form__group textarea:focus{box-shadow:0 4px 25px rgba(132,135,138,0.1)}.c-form__group button{padding:20px;text-transform:uppercase;outline:none;border:none}.c-thank-you p{position:relative;padding:20px 40px;width:750px;max-width:100%;text-transform:uppercase;font-size:12px;line-height:18px;font-weight:700;margin:40px auto 0;text-align:center;color:#fff;background:linear-gradient(135deg, #55b5ad 0%, #5ec9c5 100%)}.c-thank-you p .c-form-bnt__close{width:25px;height:25px;background:transparent}.c-thank-you p a{color:#fff}@media only screen and (max-width: 900px){.c-form-box{width:100%;left:0;right:0}}@media only screen and (max-width: 480px){.c-form-bnt__close{width:25px;height:25px}}.c-newsletter{padding:30px 0 60px;margin:0 auto;border-bottom:1px solid #f0f0f0}.c-newsletter__header{text-align:center}.c-newsletter__header .c-newsletter__title{font-size:14px;text-transform:uppercase;text-align:center}.c-newsletter__header .c-newsletter__subtitle{margin-bottom:15px}.c-newsletter-form{width:100%;max-width:750px;margin:0 auto}.c-newsletter-form .c-newsletter-form__group{display:flex}.c-newsletter__email{width:70%;height:40px;padding:10px 15px;border:1px solid #ddd;border-right-color:transparent;outline:none;transition:.35s}.c-newsletter__email:focus{box-shadow:0 4px 25px rgba(132,135,138,0.1)}.c-newsletter__button{width:30%;height:40px;color:#fff;background-color:#3af;transition:.35s;border:none;outline:none;cursor:pointer}.c-newsletter__button:hover{background-color:#0086e6}@media only screen and (max-width: 480px){.c-newsletter__button{font-size:13px}}.c-comments{padding:30px 0;border-top:1px solid #f0f0f0}.c-top{position:fixed;width:40px;height:40px;bottom:20px;color:#757575;cursor:pointer;transition:.35s;right:-100px;z-index:10;opacity:.5}.c-top--active{right:15px}.c-top:hover{color:#757575;opacity:1}.u-text-left{text-align:left}.u-text-right{text-align:right}.u-text-center{text-align:center}.u-text-justify{text-align:justify}.u-block{display:block}.u-inline-block{display:inline-block}.u-inline{display:inline}.u-full-width{display:block;width:100%}.u-vertical-center{display:flex;align-items:center;justify-content:center}.u-responsive-image{max-width:100%;height:auto;vertical-align:middle}.u-show{display:block !important}.u-hide{display:none !important}.u-invisible{visibility:hidden}.u-float-left{float:left}.u-float-right{float:right}.u-no-padding-top{padding-top:0}.u-no-padding-bottom{padding-bottom:0}.u-no-padding-left{padding-left:0}.u-no-padding-right{padding-right:0}.u-no-padding{padding:0}.u-no-margin-top{margin-top:0}.u-no-margin-bottom{margin-bottom:0}.u-no-margin-left{margin-left:0}.u-no-margin-right{margin-right:0}.u-no-margin{margin:0}.u-lists-reset{list-style-type:none;margin:0;padding:0}.u-clearfix::before,.u-clearfix::after{content:"";display:table;clear:both}.u-screen-reader-text{clip:rect(1px, 1px, 1px, 1px);height:1px;overflow:hidden;position:absolute !important;width:1px;word-wrap:normal !important}

  </style>
</head>

<body>
  
  <div class="o-wrapper">
    <aside class="c-sidebar">
  <div class="c-sidebar-author">
    <div class="c-author__cover">
      <a href="/">
        <img src="/images/1.jpg" alt="KKZHANG">
      </a>
    </div>
    <div class="c-author__info">
      <div class="c-author__name">KKZHANG</div>
      <span class="c-author__job">Software Engineer</span>
    </div>
    <div class="c-contact-menu">
      
      <a href="/contact" class="c-contact-btn c-btn c-btn--secondary c-btn--round c-btn--shadow"><span data-icon='ei-envelope' data-size='s'></span> Send me</a>
      
      
      <a href="https://twitter.com/intent/user?screen_name=KZ25674171" class="c-btn c-btn--primary c-btn--round c-btn--shadow"><span data-icon='ei-sc-twitter' data-size='s'></span> Follow me</a>
      
    </div>
    <!-- <p class="c-author__about">ğŸ‘‹ Hi, Iâ€™m @kkzhang. ğŸ‘I am now working at @MeiTuan, engaged in middleware development. âœŒï¸ I used to work at @ByteDance, develop software about Instant Messaging.  â˜ï¸ I am interested in distributed-system & operating-system. ğŸ§­ The main development language is java, and I also know little golang.</p> -->
    <!-- <div class="c-author__about" align="left">ğŸ‘‹ Hi, Iâ€™m @kkzhang.<br> ğŸ‘ I am now working at @MeiTuan, engaged in middleware development.<br> âœŒï¸ I used to work at @ByteDance, develop software about Instant Messaging. <br> â˜ï¸ I am interested in distributed-system & operating-system.<br> ğŸ§­ The main development language is java, and I also know little golang.</div> -->
    <div class="c-author__about" align="left">
      <ul>
        <li>ğŸ‘‹ Hi, Iâ€™m @kkzhang</li>
        <li>âœŒï¸ Email: kkzhang1029@gmail.com</li>
        <li>ğŸ§­ Work experience:</li>
          <ul>
            <li>â˜ï¸ Meituan - Infrastructure</li>
            <li>ğŸ‘ ByteDance - Instant Messaging</li>
          </ul>
      </ul>
    </div>
  </div>

  <div class="c-sidebar-footer">
    <div class="c-social">
      <div class="c-social__title">Social</div>
      <ul class="c-social__list u-lists-reset">
        
          <li class="c-social__item"><a href="https://twitter.com/KZ25674171" target="_blank"><div data-icon='ei-sc-twitter' data-size='s'></div></a></li>
        
        
        
        
          <li class="c-social__item"><a href="https://github.com/kkzhang-tt" target="_blank"><div data-icon='ei-sc-github' data-size='s'></div></a></li>
        
        
        
        
          <li class="c-social__item"><a href="https://instagram.com/kzhang29" target="_blank"><div data-icon='ei-sc-instagram' data-size='s'></div></a></li>
        
        
        
        
        
        
          <li class="c-social__item"><a href="https://in.linkedin.com/in/k-z-23575b202" target="_blank"><div data-icon='ei-sc-linkedin' data-size='s'></div></a></li>
        
      </ul>
    </div>
    <div class="c-copyright">
      <p>2021 &copy; KKZHANG</p>
    </div>
  </div>
</aside> <!-- /.c-sidebar -->

<main class="c-content">
  <article class="c-article">
  <div class="c-article__content">
    <header class="c-header u-hide u-no-margin-top">
      <div class="c-header__box">
        <div class="c-search u-full-width">
          <div class="c-search__box">
            <label for="js-search-input" class="u-screen-reader-text">Search for Blog</label>
            <input type="text" id="js-search-input" class="c-search__text" autocomplete="off" placeholder="Type to search...">
            <div data-icon='ei-search' data-size='s'></div>
          </div>
          <ul id="js-results-container" class="c-search-results-list"></ul>
        </div>
      </div>
    </header>
    
    <div class="c-article__image o-opacity" style="background-image: url( /images/raft.jpg )"></div>
    
    <div class="c-wrap-content">
      <header class="c-article__header">
        <h1 class="c-article__title">Raft: An Understandable Consensus Algorithm</h1>
        <div class="c-article__date">
          <span>2021, May 23</span>
        </div>
      </header>
      <h1 id="æ¦‚è¿°">æ¦‚è¿°</h1>

<p>Raft æ˜¯ä¸€ç§ä¸ºäº†ç®¡ç†å¤åˆ¶æ—¥å¿—çš„ä¸€è‡´æ€§ç®—æ³•ï¼ˆä¸€è‡´æ€§ç®—æ³•å…è®¸ä¸€ç»„æœºå™¨åƒä¸€ä¸ªæ•´ä½“ä¸€æ ·å·¥ä½œï¼Œä»è€Œèƒ½å¤Ÿæä¾›çº¿æ€§ä¸€è‡´æ€§ï¼Œå³ä½¿å…¶ä¸­ä¸€äº›æœºå™¨å‡ºç°æ•…éšœä¹Ÿèƒ½å¤Ÿç»§ç»­å·¥ä½œä¸‹å»ï¼‰ï¼Œèƒ½å¤Ÿå®ç°ä¸ Paxos ç±»ä¼¼çš„åŠŸèƒ½ï¼Œä½†æ˜¯å®ç°ä¸ç†è§£èµ·æ¥æ›´ä¸ºç®€å•ã€‚</p>

<p>ç›¸å¯¹äºå…¶ä»–ä¸€è‡´æ€§ç®—æ³•æ¥è¯´ï¼Œæœ‰ä¸€äº›ç‹¬ç‰¹çš„ç‰¹æ€§ï¼š</p>

<ul>
  <li><strong>å¼ºé¢†å¯¼è€…</strong>ï¼šå’Œå…¶ä»–ä¸€è‡´æ€§ç®—æ³•ç›¸æ¯”ï¼ŒRaft ä½¿ç”¨ä¸€ç§æ›´å¼ºçš„é¢†å¯¼èƒ½åŠ›å½¢å¼ã€‚æ¯”å¦‚ï¼Œæ—¥å¿—æ¡ç›®åªä»é¢†å¯¼è€…å‘é€ç»™å…¶ä»–çš„æœåŠ¡å™¨ã€‚è¿™ç§æ–¹å¼ç®€åŒ–äº†å¯¹å¤åˆ¶æ—¥å¿—çš„ç®¡ç†å¹¶ä¸”ä½¿å¾— Raft ç®—æ³•æ›´åŠ æ˜“äºç†è§£ã€‚</li>
  <li><strong>é¢†å¯¼é€‰ä¸¾</strong>ï¼šRaft ç®—æ³•ä½¿ç”¨ä¸€ä¸ªéšæœºè®¡æ—¶å™¨æ¥é€‰ä¸¾é¢†å¯¼è€…ï¼Œé€šè¿‡éšæœºè®¡æ—¶å™¨èƒ½å¤Ÿæœ‰æ•ˆå‡å°‘é€‰ä¸¾è¿‡ç¨‹ä¸­çš„å†²çªã€‚</li>
  <li><strong>æˆå‘˜å…³ç³»è°ƒæ•´</strong>ï¼šRaft ä½¿ç”¨ä¸€ç§å…±åŒä¸€è‡´çš„æ–¹æ³•æ¥å¤„ç†é›†ç¾¤æˆå‘˜å˜æ¢çš„é—®é¢˜ï¼Œåœ¨è¿™ç§æ–¹æ³•ä¸‹ï¼Œå¤„äºè°ƒæ•´è¿‡ç¨‹ä¸­çš„ä¸¤ç§ä¸åŒçš„é…ç½®é›†ç¾¤ä¸­å¤§å¤šæ•°æœºå™¨ä¼šæœ‰é‡å ï¼Œè¿™å°±ä½¿å¾—é›†ç¾¤åœ¨æˆå‘˜å˜æ¢çš„æ—¶å€™ä¾ç„¶å¯ä»¥ç»§ç»­å·¥ä½œã€‚</li>
</ul>

<h1 id="raft-åŸºç¡€">Raft åŸºç¡€</h1>

<h2 id="èŠ‚ç‚¹çŠ¶æ€">èŠ‚ç‚¹çŠ¶æ€</h2>

<p>Raft çš„èŠ‚ç‚¹æœ‰ä¸‰ç§çŠ¶æ€ï¼šLeader, Follower, Candidateã€‚åœ¨é€šå¸¸æƒ…å†µä¸‹ï¼Œç³»ç»Ÿä¸­åªæœ‰ä¸€ä¸ª Leader å¹¶ä¸”å…¶ä»–çš„èŠ‚ç‚¹å…¨éƒ¨éƒ½æ˜¯ Followerã€‚Follower éƒ½æ˜¯è¢«åŠ¨çš„ï¼šä»–ä»¬ä¸ä¼šå‘é€ä»»ä½•è¯·æ±‚ï¼Œåªæ˜¯ç®€å•çš„å“åº”æ¥è‡ª Leader æˆ–è€… Candidate çš„è¯·æ±‚ã€‚Leader å¤„ç†æ‰€æœ‰çš„å®¢æˆ·ç«¯è¯·æ±‚ï¼ˆå¦‚æœä¸€ä¸ªå®¢æˆ·ç«¯å’Œ Follower è”ç³»ï¼Œé‚£ä¹ˆ Follower ä¼šæŠŠè¯·æ±‚é‡å®šå‘ç»™ Leader ï¼‰ã€‚</p>

<p><img src="https://raw.githubusercontent.com/kkzhang-tt/kkzhang-tt.github.io/main/_images/raft_1.png" /></p>

<p>å„ä¸ªçŠ¶æ€ä¹‹é—´çš„è½¬åŒ–å¦‚å›¾ï¼š</p>

<ul>
  <li>åˆå§‹çŠ¶æ€ä¸‹ï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹éƒ½æ˜¯ Follower çŠ¶æ€ï¼Œå¹¶ä¸”éšæœºé€‰æ‹©ä¸€ä¸ªé€‰ä¸¾è¶…æ—¶æ—¶é—´</li>
  <li>å½“é€‰ä¸¾è¶…æ—¶æ—¶é—´å†…æ²¡æœ‰æ”¶åˆ° Leader çš„å¿ƒè·³æˆ–è€…é™„åŠ æ—¥å¿—çš„è¯·æ±‚ï¼Œåˆ™è®¤ä¸ºå½“å‰é›†ç¾¤ä¸­ä¸å­˜åœ¨ Leaderï¼Œåˆ™å°†è‡ªå·±çš„èº«ä»½ä» Follower è½¬æ¢ä¸º Candidate ï¼Œå¹¶å‘èµ·é€‰ä¸¾ï¼Œé€‰ä¸¾çš„ç»“æœå¯èƒ½æœ‰ä¸‰ç§
    <ol>
      <li>åœ¨é€‰ä¸¾è¶…æ—¶åï¼Œä»ç„¶æ²¡æœ‰ Leader è¢«é€‰å‡ºï¼Œåˆ™å†æ¬¡å¼€å§‹é€‰ä¸¾ï¼ˆè¿™ç§æƒ…å†µä¸€èˆ¬æ˜¯é€‰ç¥¨è¢«ç“œåˆ†äº†ï¼Œä¸è¿‡ç”±äºé‡‡å–çš„æ˜¯éšæœºé€‰ä¸¾è¶…æ—¶ï¼Œé‚£ä¹ˆå‡ºç°é€‰ç¥¨ç“œåˆ†çš„æƒ…å†µæ¯”è¾ƒå°‘ï¼‰</li>
      <li>è‡ªå·±æ”¶åˆ°äº†å¤§å¤šæ•°é€‰ç¥¨ï¼Œèµ¢å¾—äº†é€‰ä¸¾ï¼Œåˆ™åˆ‡æ¢èº«ä»½ä¸º Leader</li>
      <li>å…¶ä»–èŠ‚ç‚¹èµ¢å¾—äº†é€‰ä¸¾æˆ–è€…æ¥æ”¶åˆ°æ¥è‡ªæ–°çš„é¢†å¯¼äººçš„é™„åŠ æ—¥å¿— RPCï¼Œè½¬å˜æˆè·Ÿéšè€…ï¼Œåˆ™åˆ‡æ¢è‡ªå·±çš„èº«ä»½ä¸º Followerï¼Œå¹¶ä» Leader ä¸­å¤åˆ¶æ—¥å¿—</li>
    </ol>
  </li>
  <li>Leader èŠ‚ç‚¹ä¼šä¸€ç›´è®¤ä¸ºè‡ªå·±æ˜¯ Leader ç›´åˆ°è‡ªå·±å®•æœºäº†ï¼Œä¸è¿‡åœ¨é€šä¿¡è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå‘ç°æœ‰æ›´é«˜ä»»æœŸçš„èŠ‚ç‚¹ï¼Œåˆ™ä¼šå°†è‡ªå·±çš„èº«ä»½è½¬æ¢ä¸º Follower</li>
</ul>

<h2 id="ä»»æœŸ">ä»»æœŸ</h2>

<p><img src="https://raw.githubusercontent.com/kkzhang-tt/kkzhang-tt.github.io/main/_images/raft_2.png" /></p>

<p>Raft æŠŠæ—¶é—´åˆ†å‰²æˆä»»æ„é•¿åº¦çš„ä»»æœŸï¼Œä»»æœŸç”¨è¿ç»­çš„æ•´æ•°æ ‡è®°ã€‚ä»»æœŸåœ¨ Raft ç®—æ³•ä¸­å……å½“é€»è¾‘æ—¶é’Ÿçš„ä½œç”¨ï¼Œåœ¨æ•´ä¸ªæ—¶é—´å†…å•è°ƒé€’å¢ï¼Œè¿™ä¼šå…è®¸æœåŠ¡å™¨èŠ‚ç‚¹æŸ¥æ˜ä¸€äº›è¿‡æœŸçš„ä¿¡æ¯æ¯”å¦‚å¤±æ•ˆçš„ Leaderã€‚ä»»æœŸåœ¨ Raft ç®—æ³•ä¸­èµ·ç€é‡è¦çš„ä½œç”¨ï¼›æ¯ä¸€ä¸ªèŠ‚ç‚¹å­˜å‚¨å½“å‰ä»»æœŸå· currentTermï¼Œå½“èŠ‚ç‚¹æ”¶åˆ° RPC é€šä¿¡è¯·æ±‚æ—¶å°±ä¼šè¿›è¡Œæ¯”è¾ƒï¼Œåšå‡ºç›¸å…³åˆ¤æ–­</p>

<ul>
  <li>è¿½åŠ æ—¥å¿—è¯·æ±‚ä¸­ï¼Œå¦‚æœ Leader çš„ä»»æœŸå°äº currentTermï¼Œåˆ™æ‹’ç»æ¥æ”¶è¯¥æ—¥å¿—</li>
  <li>è¯·æ±‚æŠ•ç¥¨è¯·æ±‚ä¸­ï¼Œå¦‚æœ Candidate çš„ä»»æœŸå°äº currentTermï¼Œåˆ™æ‹’ç»ç»™ Candidate æŠ•ç¥¨</li>
  <li>ä¸ç®¡æ˜¯æ¥æ”¶åˆ°çš„è¯·æ±‚è¿˜æ˜¯å“åº”ï¼Œå¦‚æœä»»æœŸå·T &gt; currentTermï¼Œé‚£ä¹ˆå°±ä»¤ currentTerm ç­‰äº Tï¼Œå¹¶åˆ‡æ¢çŠ¶æ€ä¸ºè·Ÿéšè€…</li>
  <li>åœ¨é€‰ä¸¾æŠ•ç¥¨å‰ï¼ŒCandidate ä¼šå¢åŠ è‡ªå·±çš„ currentTerm</li>
  <li>åœ¨æ—¥å¿—æ¯”å¯¹ä¸­ï¼Œterm å·æ›´å¤§çš„æ—¥å¿—æ›´æ–°ï¼ˆç±»ä¼¼äº lamport æ—¶é—´æˆ³ï¼‰</li>
</ul>

<h1 id="è¯¦è§£">è¯¦è§£</h1>

<h2 id="é¢†å¯¼äººé€‰ä¸¾">é¢†å¯¼äººé€‰ä¸¾</h2>

<p>åœ¨ Raft èŠ‚ç‚¹çš„çŠ¶æ€è½¬æ¢ä¸­ï¼Œé€šè¿‡é€‰ä¸¾æ¥ç¡®å®š Leader &amp; Follower çš„èº«ä»½ã€‚</p>

<p>Raft ä½¿ç”¨ä¸€ç§å¿ƒè·³æœºåˆ¶æ¥è§¦å‘é¢†å¯¼äººé€‰ä¸¾ï¼Œå½“é›†ç¾¤åˆšå¯åŠ¨æˆ–è€… Leader å®•æœºä¹‹åï¼ŒFollower åœ¨é€‰ä¸¾è¶…æ—¶æ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°ç›¸å…³å¿ƒè·³ï¼Œå°±ä¼šè®¤ä¸ºæ²¡æœ‰å¯ç”¨çš„ Leaderï¼Œåˆ™è§¦å‘é€‰ä¸¾æµç¨‹ã€‚</p>

<h3 id="å‘èµ·é€‰ä¸¾"><strong>å‘èµ·é€‰ä¸¾</strong></h3>

<p>è¦å¼€å§‹é€‰ä¸¾ï¼ŒFollower éœ€è¦ä½¿è‡ªå·±çš„ term + 1ï¼Œå¹¶åˆ‡æ¢èº«ä»½åˆ° Candidateï¼›ä¹‹åä¼šå¹¶å‘åœ°å‘é›†ç¾¤ä¸­çš„å…¶ä»–èŠ‚ç‚¹å‘é€è¯·æ±‚æŠ•ç¥¨çš„ RPC è¯·æ±‚å¾é›†é€‰ç¥¨ï¼ŒåŒæ—¶ä¼šç»™è‡ªå·±æŠ•ç¥¨ï¼ˆå°† voteFor æ›´æ–°ä¸ºè‡ªå·±çš„ idï¼‰ã€‚è¯¥æ¬¡é€‰ä¸¾ä¼šç»´æŒåˆ°ä»¥ä¸‹äº‹ä»¶å‘ç”Ÿï¼š</p>

<ol>
  <li>è¯¥èŠ‚ç‚¹èµ¢å¾—äº†è¿™æ¬¡é€‰ä¸¾ï¼Œæˆä¸º Leader</li>
  <li>å…¶ä»–èŠ‚ç‚¹èµ¢å¾—äº†è¿™æ¬¡é€‰ä¸¾ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹å°±åˆ‡æ¢æˆ Follower èº«ä»½</li>
  <li>ä¸€æ®µæ—¶é—´åï¼Œæ²¡æœ‰ä»»ä½•èŠ‚ç‚¹èµ¢å¾—é€‰ä¸¾</li>
</ol>

<h4 id="corner-case">Corner Case</h4>

<p>å­˜åœ¨ä¸€äº› corner caseï¼Œå¦‚æœå·²ç»é€‰å‡ºäº† Leaderï¼Œå¹¶ä¸” Leader èƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼Œä½†æ˜¯å¦ä¸€ä¸ª Candidate æœ‰æ›´é«˜çš„ termï¼Œè¿™æ ·å¾ˆæœ‰å¯èƒ½è®© Leader å˜æˆ Followerï¼Œæˆ–è€…è®© Follower ç»™è¿™ä¸ªæ›´é«˜ Term çš„ Candidate é‡æ–°æŠ•ç¥¨ã€‚</p>

<p>ä¸ºäº†è§£å†³è¿™æ ·çš„é—®é¢˜ï¼Œå¯ä»¥è€ƒè™‘ Pre-Voteï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ª Follower å¦‚æœè¦å¼€å§‹æŠ•ç¥¨ï¼Œå®ƒå¹¶ä¸ä¼šç«‹åˆ»å˜æˆ Candidateï¼Œç»™è‡ªå·± term + 1ï¼Œè€Œæ˜¯ä¼šå…ˆå˜æˆ Pre-Candidate çš„çŠ¶æ€ï¼Œç”¨å½“å‰çš„ term å»é—®å…¶ä»–çš„èŠ‚ç‚¹èƒ½å¦ç»™è‡ªå·±æŠ•ç¥¨ï¼Œå¦‚æœæ”¶åˆ°äº†å¤§å¤šæ•°çš„åŒæ„æ¶ˆæ¯ï¼Œé‚£ä¹ˆæ‰ä¼šå˜æˆ Candidate ç»§ç»­åé¢çš„é€‰ä¸¾æµç¨‹ã€‚</p>

<p>å¦å¤–ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ Check Quorumï¼Œå½“ä¸€ä¸ª Follower æ”¶åˆ°äº†æ›´é«˜çš„ Term é€‰ä¸¾æ¶ˆæ¯ï¼Œå¦‚æœå®ƒç¡®ä¿¡å½“å‰é›†ç¾¤è¿˜åœ¨æ­£åœ¨å·¥ä½œï¼Œä¹Ÿå°±æ˜¯åœ¨ election timeout çš„æ—¶é—´é‡Œé¢ä»ç„¶æ”¶åˆ°äº† Leader çš„æ¶ˆæ¯ï¼Œé‚£ä¹ˆè¿™ä¸ª Follower ä¼šç›´æ¥ä¸¢æ‰è¿™ä¸ªæ¶ˆæ¯ã€‚</p>

<h3 id="é€‰ä¸¾æŠ•ç¥¨">é€‰ä¸¾æŠ•ç¥¨</h3>

<p>æŠ•ç¥¨è¯·æ±‚è¯·æ±‚ä¸ç›¸åº”çš„å‚æ•°ï¼š</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">VoteRequest</span> <span class="o">{</span>
	<span class="n">term</span><span class="o">;</span> <span class="c1">// å€™é€‰äººçš„ä»»æœŸå·</span>
	<span class="n">candidateId</span><span class="o">;</span> <span class="c1">// è¯·æ±‚é€‰ç¥¨çš„å€™é€‰äººçš„ Id</span>
	<span class="n">lastLogIndex</span><span class="o">;</span> <span class="c1">// å€™é€‰äººçš„æœ€åæ—¥å¿—æ¡ç›®çš„ç´¢å¼•å€¼</span>
	<span class="n">lastLogTerm</span><span class="o">;</span> <span class="c1">// å€™é€‰äººæœ€åæ—¥å¿—æ¡ç›®çš„ä»»æœŸå·</span>
<span class="o">}</span>

<span class="nc">VoteResponse</span> <span class="o">{</span>
	<span class="n">term</span><span class="o">;</span> <span class="c1">// å½“å‰ä»»æœŸå·ï¼›å¦‚æœæ¯” Candidate å¤§ï¼Œåˆ™ç”¨äºæ›´æ–° Candidate</span>
	<span class="n">voteGranted</span><span class="o">;</span> <span class="c1">// å€™é€‰äººèµ¢å¾—äº†æ­¤å¼ é€‰ç¥¨æ—¶ä¸ºçœŸ</span>
<span class="o">}</span>
</code></pre></div></div>

<p>å¯¹äºæ”¶åˆ°æŠ•ç¥¨è¯·æ±‚çš„èŠ‚ç‚¹æ¥è¯´ï¼Œéœ€è¦åšå‡ºå¦‚ä¸‹å†³å®šï¼š</p>

<ol>
  <li>å¦‚æœè¯·æ±‚ä¸­çš„ term &lt; currentTermï¼Œåˆ™æ‹’ç»ç»™å…¶æŠ•ç¥¨</li>
  <li>å¦‚æœè¯·æ±‚ä¸­çš„ term &gt; currentTermï¼Œåˆ™ä»¤ currentTerm ç­‰äº termï¼Œå¹¶åˆ‡æ¢çŠ¶æ€ä¸º Follower</li>
  <li>å¦‚æœ votedFor ä¸ºç©ºæˆ–è€…ä¸º candidateIdï¼Œå¹¶ä¸”å€™é€‰äººçš„æ—¥å¿—è‡³å°‘å’Œè‡ªå·±ä¸€æ ·æ–°ï¼Œé‚£ä¹ˆå°±æŠ•ç¥¨ç»™å®ƒ</li>
</ol>

<p>é’ˆå¯¹æŠ•ç¥¨ï¼ŒRaft è¿˜æœ‰ä¸€äº›é€‰ä¸¾é™åˆ¶ï¼š<strong>ä¸€ä¸ªå€™é€‰äººèƒ½å¤Ÿèµ¢å¾—é€‰é€‰ç¥¨é™¤éè¿™ä¸ªå€™é€‰äººåŒ…å«äº†æ‰€æœ‰å·²ç»æäº¤çš„æ—¥å¿—æ¡ç›®</strong>ã€‚</p>

<p>ç»“åˆ Raft çš„é™åˆ¶æ¥çœ‹ï¼Œä¸€ä¸ª Candidate å¦‚æœæƒ³è¦èµ¢å¾—é€‰ç¥¨ï¼Œéœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š</p>

<ol>
  <li>Candidate çš„ term å¿…é¡»è¦å¤§äºæŠ•ç¥¨è€…çš„ term</li>
  <li>Candidate lastLogEntry å¿…é¡»ä¸èƒ½è½åäºæŠ•ç¥¨è€…çš„ lastLogEntryï¼šå¦‚æœä¸¤ä»½æ—¥å¿—æœ€åçš„æ¡ç›®çš„ä»»æœŸå·ä¸åŒï¼Œé‚£ä¹ˆä»»æœŸå·å¤§çš„æ—¥å¿—æ›´æ–°ï¼›å¦‚æœä¸¤ä»½æ—¥å¿—æœ€åçš„æ¡ç›®ä»»æœŸå·ç›¸åŒï¼Œé‚£ä¹ˆæ—¥å¿—æ¯”è¾ƒé•¿çš„é‚£ä¸ªå°±æ›´æ–°ã€‚</li>
</ol>

<h4 id="corner-case-1">Corner Case</h4>

<p>å…³äºæœ€æ–°æ—¥å¿—æ¯”è¾ƒï¼Œè€ƒè™‘è¿™æ ·ä¸€ç§æƒ…å†µã€‚Aï¼ŒBï¼ŒC ä¸‰ä¸ªèŠ‚ç‚¹ä¸­ï¼ŒA ä¸º Leaderï¼Œå…¶ä»–ä¸¤ä¸ªèŠ‚ç‚¹ä¸º Followerï¼Œå¹¶ä¸”å½“å‰ term = 10ï¼ŒlogIndex = 19ã€‚</p>

<p>A ä¹‹åè¢«ç½‘ç»œéš”ç¦»ï¼Œä½†æ˜¯å…¶ä»ç„¶è®¤ä¸ºè‡ªå·±æ˜¯ Leaderï¼Œä»åœ¨æ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå‡å¦‚åˆæ”¶åˆ°ä¸€ä¸ªè¯·æ±‚ï¼Œé‚£ä¹ˆ A çš„æœ€æ–°æ—¥å¿—ä¸º term = 10, logIndex = 20ã€‚Bï¼ŒCç”±äºä¸ A è¡Œç¨‹ç½‘ç»œéš”ç¦»ï¼Œä»è€Œå‘èµ·é€‰ä¸¾ï¼ŒB è¢«é€‰ä¸º Leader å¹¶å¤„ç†è¯·æ±‚ï¼Œå¦‚æœ B å¤„ç†äº†ä¸€ä¸ªè¯·æ±‚ï¼Œæ­¤æ—¶å…¶æœ€æ–°æ—¥å¿—ä¸º term = 11, logIndex =20ã€‚</p>

<p>ä¹‹åç½‘ç»œæ¢å¤ï¼ŒA ç»™ Bï¼ŒC æŠ•ç¥¨ï¼Œæ­¤æ—¶ A çš„ term å¯èƒ½å·²ç»å˜æˆ 12 äº†ï¼›ä½†æ˜¯ A çš„æœ€å log ä¸æ­£ç¡®ï¼Œå…¶ term = 10ï¼Œå› æ­¤ Bï¼ŒC éœ€è¦æ‹’ç» Aã€‚</p>

<h3 id="é€‰ä¸¾ç»ˆæ­¢">é€‰ä¸¾ç»ˆæ­¢</h3>

<p>å½“ä¸€ä¸ª Candidate ä»æ•´ä¸ªé›†ç¾¤çš„å¤§å¤šæ•°æœåŠ¡å™¨èŠ‚ç‚¹è·å¾—äº†é’ˆå¯¹åŒä¸€ä¸ªä»»æœŸå·çš„é€‰ç¥¨ï¼Œé‚£ä¹ˆå®ƒå°±èµ¢å¾—äº†è¿™æ¬¡é€‰ä¸¾å¹¶æˆä¸º Leaderã€‚æ¯ä¸€ä¸ªæœåŠ¡å™¨æœ€å¤šä¼šå¯¹ä¸€ä¸ªä»»æœŸå·æŠ•å‡ºä¸€å¼ é€‰ç¥¨ï¼ŒæŒ‰ç…§å…ˆæ¥å…ˆæœåŠ¡çš„åŸåˆ™ã€‚è¦æ±‚å¤§å¤šæ•°é€‰ç¥¨çš„è§„åˆ™ç¡®ä¿äº†æœ€å¤šåªä¼šæœ‰ä¸€ä¸ª Candidate èµ¢å¾—æ­¤æ¬¡é€‰ä¸¾ã€‚ä¸€æ—¦ Candidate èµ¢å¾—é€‰ä¸¾ï¼Œå®ƒå°±ç«‹å³æˆä¸ºé¢†å¯¼äººã€‚ç„¶åä¼šå‘å…¶ä»–çš„æœåŠ¡å™¨å‘é€å¿ƒè·³æ¶ˆæ¯æ¥å»ºç«‹è‡ªå·±çš„æƒå¨å¹¶ä¸”é˜»æ­¢æ–°çš„ Leader çš„äº§ç”Ÿã€‚</p>

<p>é€‰ä¸¾è¿‡ç¨‹ä¸­å¯èƒ½ä¼šé‡åˆ°é€‰ç¥¨è¢«ç“œåˆ†çš„æƒ…å†µï¼Œå¯¼è‡´æ²¡æœ‰ Leader è¢«é€‰å‡ºï¼Œä»è€Œè¢«è¿«è¿›å…¥ä¸‹ä¸€æ¬¡é€‰ä¸¾ã€‚ä¸ºäº†å‡å°‘è¿™ç§æƒ…å†µï¼ŒRaft é‡‡ç”¨äº†éšæœºé€‰ä¸¾è¶…æ—¶çš„æ–¹æ¡ˆï¼šæ¯ä¸ªèŠ‚ç‚¹çš„é€‰ä¸¾è¶…æ—¶æ—¶é—´éƒ½ä¸åŒï¼Œä»è€Œå¤§å¤šæ•°æ—¶å€™åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹è¶…æ—¶ï¼Œç„¶åè¯¥è¶…æ—¶çš„èŠ‚ç‚¹èµ¢å¾—é€‰ä¸¾ï¼ˆå…¶ term æ¯”å…¶ä»–èŠ‚ç‚¹éƒ½å¤§ï¼Œå¹¶ä¸”æ—¥å¿—ä¸è½åï¼‰ã€‚</p>

<h2 id="æ—¥å¿—å¤åˆ¶">æ—¥å¿—å¤åˆ¶</h2>

<h3 id="ç›¸å…³å‚æ•°">ç›¸å…³å‚æ•°</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">LogAppendRequest</span><span class="o">{</span>
	<span class="n">term</span><span class="o">;</span> <span class="c1">// é¢†å¯¼è€…çš„ä»»æœŸ</span>
  <span class="n">leaderId</span><span class="o">;</span> <span class="c1">// é¢†å¯¼è€…ID å› æ­¤è·Ÿéšè€…å¯ä»¥å¯¹å®¢æˆ·ç«¯è¿›è¡Œé‡å®šå‘</span>
  <span class="n">prevLogIndex</span><span class="o">;</span> <span class="c1">// ç´§é‚»æ–°æ—¥å¿—æ¡ç›®ä¹‹å‰çš„é‚£ä¸ªæ—¥å¿—æ¡ç›®çš„ç´¢å¼•</span>
  <span class="n">preLogTerm</span><span class="o">;</span> <span class="c1">// ç´§é‚»æ–°æ—¥å¿—æ¡ç›®ä¹‹å‰çš„é‚£ä¸ªæ—¥å¿—æ¡ç›®çš„ä»»æœŸ</span>
  <span class="n">entries</span><span class="o">[];</span> <span class="c1">// éœ€è¦è¢«ä¿å­˜çš„æ—¥å¿—æ¡ç›®ï¼ˆè¢«å½“åšå¿ƒè·³ä½¿ç”¨æ˜¯ åˆ™æ—¥å¿—æ¡ç›®å†…å®¹ä¸ºç©ºï¼›ä¸ºäº†æé«˜æ•ˆç‡å¯èƒ½ä¸€æ¬¡æ€§å‘é€å¤šä¸ªï¼‰</span>
  <span class="n">leaderCommit</span><span class="o">;</span> <span class="c1">// é¢†å¯¼è€…çš„å·²çŸ¥å·²æäº¤çš„æœ€é«˜çš„æ—¥å¿—æ¡ç›®çš„ç´¢å¼•</span>
<span class="o">}</span>

<span class="nc">LogAppendResponse</span><span class="o">{</span>
  <span class="n">term</span><span class="o">;</span> <span class="c1">// å½“å‰ä»»æœŸ,å¯¹äºé¢†å¯¼è€…è€Œè¨€ å®ƒä¼šæ›´æ–°è‡ªå·±çš„ä»»æœŸ</span>
  <span class="n">success</span><span class="o">;</span> <span class="c1">// ç»“æœä¸ºçœŸ:å¦‚æœè·Ÿéšè€…æ‰€å«æœ‰çš„æ¡ç›®å’ŒprevLogIndexä»¥åŠprevLogTermåŒ¹é…ä¸Šäº†</span>
<span class="o">}</span>
</code></pre></div></div>

<blockquote>
  <p>å¦‚æœ leaderCommit å¤§äº Follower commitIndexï¼Œåˆ™æŠŠ Follower çš„ commitIndex ç½®ä¸º leaderCommitï¼›åŒæ—¶å¯¹äºä¹‹å‰çš„æ—¥å¿—ä¾æ¬¡æäº¤åˆ°çŠ¶æ€æœºä¸­</p>
</blockquote>

<h3 id="å¤åˆ¶æµç¨‹">å¤åˆ¶æµç¨‹</h3>

<p><img src="https://raw.githubusercontent.com/kkzhang-tt/kkzhang-tt.github.io/main/_images/raft_3.png" /></p>

<p>Leader é€‰ä¸¾å‡ºæ¥ä¹‹åå°±ä¼šä¸ºå®¢æˆ·ç«¯æä¾›æœåŠ¡ï¼š</p>

<ol>
  <li>å®¢æˆ·ç«¯çš„æ¯ä¸€ä¸ªè¯·æ±‚éƒ½åŒ…å«ä¸€æ¡è¢«å¤åˆ¶çŠ¶æ€æœºæ‰§è¡Œçš„æŒ‡ä»¤ã€‚</li>
  <li>Leader æŠŠè¿™æ¡æŒ‡ä»¤ä½œä¸ºä¸€æ¡æ–°çš„æ—¥å¿—æ¡ç›®é™„åŠ åˆ°æ—¥å¿—ä¸­å»ï¼Œç„¶åå¹¶è¡Œçš„å‘èµ·é™„åŠ æ¡ç›® RPCs ç»™å…¶ä»–çš„æœåŠ¡å™¨ï¼Œè®©ä»–ä»¬å¤åˆ¶è¿™æ¡æ—¥å¿—æ¡ç›®ã€‚</li>
  <li>å½“è¿™æ¡æ—¥å¿—æ¡ç›®è¢«å®‰å…¨çš„å¤åˆ¶ï¼ŒLeader ä¼šåº”ç”¨è¿™æ¡æ—¥å¿—æ¡ç›®åˆ°å®ƒçš„çŠ¶æ€æœºä¸­ç„¶åæŠŠæ‰§è¡Œçš„ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li>
  <li>å¦‚æœ Follower å´©æºƒæˆ–è€…è¿è¡Œç¼“æ…¢ï¼Œå†æˆ–è€…ç½‘ç»œä¸¢åŒ…ï¼Œé¢†å¯¼äººä¼šä¸æ–­çš„é‡å¤å°è¯•é™„åŠ æ—¥å¿—æ¡ç›® RPCs ï¼ˆå°½ç®¡å·²ç»å›å¤äº†å®¢æˆ·ç«¯ï¼‰ç›´åˆ°æ‰€æœ‰çš„ Follower éƒ½æœ€ç»ˆå­˜å‚¨äº†æ‰€æœ‰çš„æ—¥å¿—æ¡ç›®ã€‚</li>
</ol>

<p>åœ¨ä¸€ä¸ªé›†ç¾¤ä¸­ï¼Œå„ä¸ªèŠ‚ç‚¹çš„æ—¥å¿—æƒ…å†µå¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<p><img src="https://raw.githubusercontent.com/kkzhang-tt/kkzhang-tt.github.io/main/_images/raft_4.png" /></p>

<blockquote>
  <p>æ¯ä¸€ä¸ªæ—¥å¿—æ¡ç›®å­˜å‚¨ä¸€æ¡çŠ¶æ€æœºæŒ‡ä»¤å’Œä»é¢†å¯¼äººæ”¶åˆ°è¿™æ¡æŒ‡ä»¤æ—¶çš„ä»»æœŸå·ï¼Œæ—¥å¿—ä¸­çš„ä»»æœŸå·ç”¨æ¥æ£€æŸ¥æ˜¯å¦å‡ºç°ä¸ä¸€è‡´çš„æƒ…å†µã€‚</p>
</blockquote>

<p>åœ¨ Leader å°†åˆ›å»ºçš„æ—¥å¿—æ¡ç›®å¤åˆ¶åˆ°å¤§å¤šæ•°çš„æœåŠ¡å™¨ä¸Šçš„æ—¶å€™ï¼Œæ—¥å¿—æ¡ç›®å°±ä¼šè¢«æäº¤ï¼›è€Œå·²æäº¤çš„çŠ¶æ€æ˜¯å®‰å…¨çš„ï¼ŒRaft ç®—æ³•ä¿è¯æ‰€æœ‰å·²æäº¤çš„æ—¥å¿—æ¡ç›®éƒ½æ˜¯æŒä¹…åŒ–çš„å¹¶ä¸”æœ€ç»ˆä¼šè¢«æ‰€æœ‰å¯ç”¨çš„çŠ¶æ€æœºæ‰§è¡Œã€‚</p>

<p>Raft ä¸­è¿˜æœ‰ä¸€ä¸ªå®‰å…¨æ€§é™åˆ¶ï¼Œä»è€Œä½¿å¾—ä¹‹å‰é¢†å¯¼äººåˆ›å»ºçš„æ—¥å¿—ä¹Ÿä¼šè¢«åº”ç”¨åˆ°çŠ¶æ€æœºï¼ˆä¹‹å‰çš„æ—¥å¿—å¯èƒ½æ˜¯å·²æäº¤ï¼Œä¹Ÿå¯èƒ½åªæ˜¯å¤åˆ¶åˆ°å…¶ä»–èŠ‚ç‚¹ä½†æ˜¯æœªå®Œæˆæäº¤ï¼‰ã€‚</p>

<p>åŒæ—¶ï¼ŒLeader è·Ÿè¸ªäº†æœ€å¤§çš„å°†ä¼šè¢«æäº¤çš„æ—¥å¿—é¡¹çš„ç´¢å¼•ï¼Œå¹¶ä¸”ç´¢å¼•å€¼ä¼šè¢«åŒ…å«åœ¨æœªæ¥çš„æ‰€æœ‰é™„åŠ æ—¥å¿— RPCs ï¼ˆåŒ…æ‹¬å¿ƒè·³åŒ…ï¼‰ï¼Œè¿™æ ·å…¶ä»–çš„æœåŠ¡å™¨æ‰èƒ½æœ€ç»ˆçŸ¥é“é¢†å¯¼äººçš„æäº¤ä½ç½®ã€‚ä¸€æ—¦è·Ÿéšè€…çŸ¥é“ä¸€æ¡æ—¥å¿—æ¡ç›®å·²ç»è¢«æäº¤ï¼Œé‚£ä¹ˆä»–ä¹Ÿä¼šå°†è¿™ä¸ªæ—¥å¿—æ¡ç›®åº”ç”¨åˆ°æœ¬åœ°çš„çŠ¶æ€æœºä¸­ï¼ˆæŒ‰ç…§æ—¥å¿—çš„é¡ºåºï¼‰ã€‚</p>

<h3 id="æ—¥å¿—åŒ¹é…--å†²çªè§£å†³">æ—¥å¿—åŒ¹é… &amp; å†²çªè§£å†³</h3>

<p>Raft çš„æ—¥å¿—åŒ¹é…ç‰¹æ€§ï¼š</p>

<ul>
  <li>å¦‚æœåœ¨ä¸åŒçš„æ—¥å¿—ä¸­çš„ä¸¤ä¸ªæ¡ç›®æ‹¥æœ‰ç›¸åŒçš„ç´¢å¼•å’Œä»»æœŸå·ï¼Œé‚£ä¹ˆä»–ä»¬å­˜å‚¨äº†ç›¸åŒçš„æŒ‡ä»¤ã€‚</li>
  <li>å¦‚æœåœ¨ä¸åŒçš„æ—¥å¿—ä¸­çš„ä¸¤ä¸ªæ¡ç›®æ‹¥æœ‰ç›¸åŒçš„ç´¢å¼•å’Œä»»æœŸå·ï¼Œé‚£ä¹ˆä»–ä»¬ä¹‹å‰çš„æ‰€æœ‰æ—¥å¿—æ¡ç›®ä¹Ÿå…¨éƒ¨ç›¸åŒã€‚</li>
</ul>

<p>å…³äºç¬¬äºŒæ¡ç‰¹æ€§æ˜¯ç”±é™„åŠ æ—¥å¿— RPC è¿›è¡Œä¸€è‡´æ€§æ£€æŸ¥å®ç°çš„ï¼šåœ¨å‘é€é™„åŠ æ—¥å¿— RPC çš„æ—¶å€™ï¼Œä¼šæŠŠæ–°çš„æ—¥å¿—æ¡ç›®ç´§æ¥ç€ä¹‹å‰çš„æ¡ç›®çš„ç´¢å¼•ä½ç½®å’Œä»»æœŸå·åŒ…å«åœ¨é‡Œé¢ã€‚å¦‚æœåŒ¹é…æˆåŠŸï¼Œåˆ™ä¸€è‡´æ€§æ£€æŸ¥é€šè¿‡ï¼›å¦‚æœ Follower åœ¨å®ƒçš„æ—¥å¿—ä¸­æ‰¾ä¸åˆ°åŒ…å«ç›¸åŒç´¢å¼•ä½ç½®å’Œä»»æœŸå·çš„æ¡ç›®ï¼Œé‚£ä¹ˆ Follower å°±ä¼šæ‹’ç»æ¥æ”¶æ–°çš„æ—¥å¿—æ¡ç›®ï¼Œæ­¤æ—¶ Leader ä¸ Follower çš„æ—¥å¿—å°±ä¼šäº§ç”Ÿå†²çªã€‚</p>

<p>é€ æˆè¿™ç§å†²çªçš„åŸå› æ˜¯ä¹‹å‰çš„ Leader å´©æºƒï¼Œä½†æ˜¯æ²¡æœ‰å®Œå…¨å¤åˆ¶æ—¥å¿—ï¼Œä½¿å¾—éƒ¨åˆ† Follower å¯èƒ½æ‹¥æœ‰ä¸æ–°çš„ Leader ä¸åŒçš„æ—¥å¿—ï¼›å¯èƒ½çš„æƒ…å†µå¦‚ä¸‹ï¼š</p>

<p><img src="https://raw.githubusercontent.com/kkzhang-tt/kkzhang-tt.github.io/main/_images/raft_5.png" /></p>

<p>åœ¨ Raft ç®—æ³•ä¸­ï¼ŒLeader å¤„ç†ä¸ä¸€è‡´æ˜¯é€šè¿‡å¼ºåˆ¶è·Ÿéšè€…ç›´æ¥å¤åˆ¶è‡ªå·±çš„æ—¥å¿—æ¥è§£å†³äº†ï¼Œè¿™æ„å‘³ç€åœ¨è·Ÿéšè€…ä¸­çš„å†²çªçš„æ—¥å¿—æ¡ç›®ä¼šè¢«é¢†å¯¼äººçš„æ—¥å¿—è¦†ç›–ã€‚è¦ä½¿å¾— Follower çš„æ—¥å¿—é‡æ–°ä¸ Leader ä¿æŒä¸€è‡´çš„çŠ¶æ€ï¼ŒLeader å¿…é¡»æ‰¾åˆ°æœ€åä¸¤è€…è¾¾æˆä¸€è‡´çš„åœ°æ–¹ï¼Œç„¶ååˆ é™¤ä»é‚£ä¸ªç‚¹ä¹‹åçš„æ‰€æœ‰æ—¥å¿—æ¡ç›®ï¼Œå‘é€è‡ªå·±çš„æ—¥å¿—ç»™ Followerã€‚</p>

<ol>
  <li>Leader åˆšè¢«é€‰ä¸¾æˆåŠŸåï¼Œä¼šåˆå§‹åŒ–æ‰€æœ‰çš„ nextIndex ä¸ºè‡ªå·± lastLogEntryIndex + 1ï¼ˆLeader ç»´æŠ¤äº† nextIndexï¼šè¡¨ç¤ºä¸‹ä¸€ä¸ªéœ€è¦å‘é€ç»™ Follower çš„æ—¥å¿—æ¡ç›®çš„ç´¢å¼•åœ°å€ï¼‰</li>
  <li>Leader å‘é€é™„åŠ æ—¥å¿—è¿›è¡Œä¸€è‡´æ€§æ£€æŸ¥</li>
  <li>Follower ä¸€è‡´æ€§æ£€æŸ¥å¤±è´¥å¹¶æ‹’ç»é™„åŠ æ—¥å¿—è¯·æ±‚</li>
  <li>Leader æ”¶åˆ°æ‹’ç»ä¹‹åï¼Œå‡å°è¯¥ Follower çš„ nextIndex è¿›è¡Œé‡è¯•ï¼Œç›´åˆ°æ‰¾åˆ°ä¸å…¶æ—¥å¿—ä¿æŒä¸€è‡´çš„ä½ç½®</li>
  <li>å¤šæ¬¡é‡è¯•ä¹‹åï¼Œé™„åŠ æ—¥å¿—è¿”å›æˆåŠŸï¼Œæ­¤æ—¶ä¼šæŠŠ Follower çš„æ—¥å¿—åˆ é™¤å¹¶é‡æ–°åŠ ä¸Š Leader çš„æ—¥å¿—ï¼ˆ<strong>Leader çš„æ—¥å¿—åªèƒ½é™„åŠ ä¸èƒ½åˆ é™¤ï¼Œä½†æ˜¯ Follower çš„æ—¥å¿—å¯ä»¥åˆ é™¤</strong>ï¼‰</li>
</ol>

<h2 id="å®‰å…¨æ€§">å®‰å…¨æ€§</h2>

<p>Raft ä¿è¯äº†ä»¥ä¸‹å‡ æ¡å®‰å…¨æ€§ï¼š</p>

<ol>
  <li>é€‰ä¸¾å®‰å…¨ç‰¹æ€§ï¼šå¯¹äºä¸€ä¸ªç»™å®šçš„ä»»æœŸå·ï¼Œæœ€å¤šåªä¼šæœ‰ä¸€ä¸ªé¢†å¯¼äººè¢«é€‰ä¸¾å‡ºæ¥</li>
  <li>é¢†å¯¼äººåªé™„åŠ åŸåˆ™ï¼šé¢†å¯¼äººç»å¯¹ä¸ä¼šåˆ é™¤æˆ–è€…è¦†ç›–è‡ªå·±çš„æ—¥å¿—ï¼Œåªä¼šå¢åŠ </li>
  <li>æ—¥å¿—åŒ¹é…åŸåˆ™ï¼šå¦‚æœä¸¤ä¸ªæ—¥å¿—åœ¨ç›¸åŒçš„ç´¢å¼•ä½ç½®çš„æ—¥å¿—æ¡ç›®çš„ä»»æœŸå·ç›¸åŒï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è®¤ä¸ºè¿™ä¸ªæ—¥å¿—ä»å¤´åˆ°è¿™ä¸ªç´¢å¼•ä½ç½®ä¹‹é—´å…¨éƒ¨å®Œå…¨ç›¸åŒ</li>
  <li>é¢†å¯¼äººå®Œå…¨ç‰¹æ€§ï¼šå¦‚æœæŸä¸ªæ—¥å¿—æ¡ç›®åœ¨æŸä¸ªä»»æœŸå·ä¸­å·²ç»è¢«æäº¤ï¼Œé‚£ä¹ˆè¿™ä¸ªæ¡ç›®å¿…ç„¶å‡ºç°åœ¨æ›´å¤§ä»»æœŸå·çš„æ‰€æœ‰é¢†å¯¼äººä¸­</li>
  <li>çŠ¶æ€æœºå®‰å…¨ç‰¹æ€§ï¼šå¦‚æœä¸€ä¸ªé¢†å¯¼äººå·²ç»å°†ç»™å®šçš„ç´¢å¼•å€¼ä½ç½®çš„æ—¥å¿—æ¡ç›®åº”ç”¨åˆ°çŠ¶æ€æœºä¸­ï¼Œé‚£ä¹ˆå…¶ä»–ä»»ä½•çš„æœåŠ¡å™¨åœ¨è¿™ä¸ªç´¢å¼•ä½ç½®ä¸ä¼šåº”ç”¨ä¸€ä¸ªä¸åŒçš„æ—¥å¿—</li>
</ol>

<p>ä¸ºäº†ä¿è¯ä»¥ä¸Šå®‰å…¨æ€§ï¼ŒRaft å­˜åœ¨ä¸€äº›é™åˆ¶ï¼š</p>

<h3 id="é€‰ä¸¾é™åˆ¶">é€‰ä¸¾é™åˆ¶</h3>

<p><strong>Candidate å¿…é¡»åŒ…å«äº†æ‰€æœ‰å·²ç»æäº¤çš„ logEntries æ‰èƒ½èµ¢å¾—é€‰ä¸¾ã€‚</strong></p>

<p>è¿™ä¸€ç‚¹åˆ†ä¸ºä¸¤ä¸ªè§’åº¦çœ‹ï¼š</p>

<ul>
  <li>Candidate æƒ³è¦èµ¢å¾—é€‰ä¸¾ï¼Œéœ€è¦èµ¢å¾—å¤§å¤šæ•°çš„é€‰ç¥¨ï¼›è€Œè¦æƒ³èµ¢å¾—é€‰ç¥¨ï¼Œéœ€è¦å…¶æ—¥å¿—æ¯”æŠ•ç¥¨äººæ–°</li>
  <li>å‰ä»» Leader çš„å·²æäº¤æ—¥å¿—éœ€è¦å¤åˆ¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹ä¸Š</li>
</ul>

<p>æ‰€ä»¥ï¼Œèƒ½å¤Ÿèµ¢å¾—é€‰ä¸¾çš„ Candidate ä¸€å®šåŒ…å«äº†æ‰€æœ‰å·²ç»æäº¤çš„æ—¥å¿—ï¼›ä¸<strong>è¿‡å…¶åœ¨æœ€åå·²æäº¤çš„æ—¥å¿—åå¯èƒ½åŒ…å«è¿˜æœªæäº¤çš„æ—¥å¿—ï¼ˆå‰ä»» Leader å¤åˆ¶åˆ°è¯¥èŠ‚ç‚¹ä½†æ˜¯æœªæäº¤</strong>ï¼‰ã€‚</p>

<p>æ‰€ä»¥åœ¨ Leader é€‰ä¸¾ä¸­ï¼Œä¸ä»…ä»…è¦çœ‹ termï¼Œè¿˜éœ€è¦çœ‹æ—¥å¿—ä¿¡æ¯ï¼š</p>

<p><strong>æŠ•ç¥¨äººä¼šæ‹’ç»æ‰é‚£äº›æ—¥å¿—æ²¡æœ‰è‡ªå·±æ–°çš„æŠ•ç¥¨è¯·æ±‚ã€‚</strong></p>

<blockquote>
  <p>Raft é€šè¿‡æ¯”è¾ƒä¸¤ä»½æ—¥å¿—ä¸­æœ€åä¸€æ¡æ—¥å¿—æ¡ç›®çš„ç´¢å¼•å€¼å’Œä»»æœŸå·å®šä¹‰è°çš„æ—¥å¿—æ¯”è¾ƒæ–°ã€‚å¦‚æœä¸¤ä»½æ—¥å¿—æœ€åçš„æ¡ç›®çš„ä»»æœŸå·ä¸åŒï¼Œé‚£ä¹ˆä»»æœŸå·å¤§çš„æ—¥å¿—æ›´æ–°ï¼›å¦‚æœä¸¤ä»½æ—¥å¿—æœ€åçš„æ¡ç›®ä»»æœŸå·ç›¸åŒï¼Œé‚£ä¹ˆæ—¥å¿—æ¯”è¾ƒé•¿çš„é‚£ä¸ªå°±æ›´æ–°ã€‚</p>
</blockquote>

<h3 id="æäº¤ä¹‹å‰ä»»æœŸå†…çš„æ—¥å¿—æ¡ç›®">æäº¤ä¹‹å‰ä»»æœŸå†…çš„æ—¥å¿—æ¡ç›®</h3>

<p><strong>Raft ä¸ä¼šé€šè¿‡è®¡ç®—å‰¯æœ¬æ•°ç›®çš„æ–¹å¼å»æäº¤ä¸€ä¸ªä¹‹å‰ä»»æœŸå†…çš„æ—¥å¿—æ¡ç›®</strong>ã€‚</p>

<p>å½“å‰ä»»æœŸå†…ï¼Œå¦‚æœ Leader å°†æ—¥å¿—å¤åˆ¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹ä¸Šï¼Œé‚£ä¹ˆ Leader å°±çŸ¥é“è¯¥æ—¥å¿—å¯ä»¥è¢«æäº¤äº†ï¼›ä½†æ˜¯å½“å‰ä»»æœŸå†…çš„ Leader ä¸èƒ½æ–­å®šå‰ä»» Leader å¤åˆ¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹çš„æ—¥å¿—å°±ä¸€å®šå·²ç»æäº¤äº†ã€‚</p>

<p><img src="https://raw.githubusercontent.com/kkzhang-tt/kkzhang-tt.github.io/main/_images/raft_6.png" /></p>

<ul>
  <li>åœ¨ (a) ä¸­ï¼ŒS1 æ˜¯ Leaderï¼Œéƒ¨åˆ†çš„å¤åˆ¶äº†ç´¢å¼•ä½ç½® 2 çš„æ—¥å¿—æ¡ç›®ã€‚</li>
  <li>åœ¨ (b) ä¸­ï¼ŒS1 å´©æºƒäº†ï¼Œç„¶å S5 åœ¨ä»»æœŸ 3 é‡Œé€šè¿‡ S3ã€S4 å’Œè‡ªå·±çš„é€‰ç¥¨èµ¢å¾—é€‰ä¸¾ï¼Œç„¶åä»å®¢æˆ·ç«¯æ¥æ”¶äº†ä¸€æ¡ä¸ä¸€æ ·çš„æ—¥å¿—æ¡ç›®æ”¾åœ¨äº†ç´¢å¼• 2 å¤„ã€‚</li>
  <li>åˆ°äº† (c)ï¼ŒS5 åˆå´©æºƒäº†ï¼›S1 é‡æ–°å¯åŠ¨ï¼Œé€‰ä¸¾æˆåŠŸï¼Œå¼€å§‹å¤åˆ¶æ—¥å¿—ã€‚åœ¨è¿™æ—¶ï¼Œæ¥è‡ªä»»æœŸ 2 çš„é‚£æ¡æ—¥å¿—å·²ç»è¢«å¤åˆ¶åˆ°äº†é›†ç¾¤ä¸­çš„å¤§å¤šæ•°æœºå™¨ä¸Šï¼Œä½†æ˜¯è¿˜æ²¡æœ‰è¢«æäº¤ã€‚</li>
  <li>å¦‚æœ S1 åœ¨ (d) ä¸­åˆå´©æºƒäº†ï¼ŒS5 å¯ä»¥é‡æ–°è¢«é€‰ä¸¾æˆåŠŸï¼ˆé€šè¿‡æ¥è‡ª S2ï¼ŒS3 å’Œ S4 çš„é€‰ç¥¨ï¼šterm = 5, å¹¶ä¸”æœ€åä¸€æ¡æ—¥å¿—å¤Ÿæ–°ï¼‰ï¼Œç„¶åè¦†ç›–äº†ä»–ä»¬åœ¨ç´¢å¼• 2 å¤„çš„æ—¥å¿—ã€‚</li>
  <li>åä¹‹ï¼Œå¦‚æœåœ¨å´©æºƒä¹‹å‰ï¼ŒS1 æŠŠè‡ªå·±ä¸»å¯¼çš„æ–°ä»»æœŸé‡Œäº§ç”Ÿçš„æ—¥å¿—æ¡ç›®å¤åˆ¶åˆ°äº†å¤§å¤šæ•°æœºå™¨ä¸Šï¼Œå°±å¦‚ (e) ä¸­é‚£æ ·ï¼Œé‚£ä¹ˆåœ¨åé¢ä»»æœŸé‡Œé¢è¿™äº›æ–°çš„æ—¥å¿—æ¡ç›®å°±ä¼šè¢«æäº¤ï¼ˆå› ä¸º S5 å°±ä¸å¯èƒ½é€‰ä¸¾æˆåŠŸï¼šæœ€åä¸€æ¡æ—¥å¿—ä¸å¤Ÿæ–°ï¼‰ã€‚ è¿™æ ·åœ¨åŒä¸€æ—¶åˆ»å°±åŒæ—¶ä¿è¯äº†ï¼Œä¹‹å‰çš„æ‰€æœ‰è€çš„æ—¥å¿—æ¡ç›®å°±ä¼šè¢«æäº¤ã€‚</li>
</ul>

<p>å¦‚æœé€šè¿‡è®¡ç®—å‰¯æœ¬æ•°ç›®çš„æ–¹å¼å»æäº¤ä¸€ä¸ªä¹‹å‰ä»»æœŸå†…çš„æ—¥å¿—æ¡ç›®ï¼Œé‚£ä¹ˆå°±å¾ˆå¯èƒ½ä¼šå‡ºç°å·²ç»æäº¤çš„æ—¥å¿—è¢«è¦†ç›–çš„æƒ…å†µï¼ˆindex = 2 çš„æ—¥å¿—è¢«é‡æ–°è¦†ç›–äº†ï¼‰ã€‚<strong>åªæœ‰ Leader å½“å‰ä»»æœŸé‡Œçš„æ—¥å¿—æ¡ç›®é€šè¿‡è®¡ç®—å‰¯æœ¬æ•°ç›®å¯ä»¥è¢«æäº¤ï¼›ä¸€æ—¦å½“å‰ä»»æœŸçš„æ—¥å¿—æ¡ç›®ä»¥è¿™ç§æ–¹å¼è¢«æäº¤ï¼Œé‚£ä¹ˆç”±äºæ—¥å¿—åŒ¹é…ç‰¹æ€§ï¼Œä¹‹å‰çš„æ—¥å¿—æ¡ç›®ä¹Ÿéƒ½ä¼šè¢«é—´æ¥çš„æäº¤ï¼ˆ</strong>æŒ‰ç…§ e çš„æƒ…å†µï¼Œå‡å¦‚ s3 è¢«é€‰ä¸º Leaderï¼Œé‚£ä¹ˆ 2ï¼Œ4 ä½ç½®çš„æ—¥å¿—éƒ½ä¼šè¢«é‡æ–°æäº¤ï¼‰ã€‚</p>

<blockquote>
  <p>å¯¹å½“å‰ Leaderæ¥è¯´ï¼ŒcommitIndex å¢åŠ ï¼Œä½¿å¾—å‰ä»»çš„æ—¥å¿—éƒ½åº”ç”¨åˆ°çŠ¶æ€æœºä¸­ï¼›åŒæ—¶æ—¥å¿—ä¸€è‡´æ€§æ£€æŸ¥ä¼šä¿ƒè¿› Follower å°†æ—¥å¿—ä¿æŒåŒæ­¥å¹¶åº”ç”¨åˆ°è‡ªå·±çš„çŠ¶æ€æœºä¸­ã€‚</p>
</blockquote>

<h2 id="é›†ç¾¤æˆå‘˜å˜åŒ–">é›†ç¾¤æˆå‘˜å˜åŒ–</h2>

<p>å½“é›†ç¾¤ä¸­éœ€è¦æ–°å¢èŠ‚ç‚¹æˆ–è€…åˆ é™¤èŠ‚ç‚¹ï¼Œæ„å‘³ç€é›†ç¾¤é…ç½®å‘ç”Ÿäº†å˜æ›´ã€‚å¦‚æœç›´æ¥å°†å„ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤é…ç½®ä»æ—§é…ç½®åˆ‡æ¢åˆ°æ–°é…ç½®æ˜¯ä¸å®‰å…¨çš„ï¼Œå› ä¸ºæ¯ä¸ªèŠ‚ç‚¹çš„é…ç½®åˆ‡æ¢å¯èƒ½å‘ç”Ÿåœ¨ä»»ä½•æ—¶å€™ï¼Œé‚£ä¹ˆå°±å¯èƒ½å­˜åœ¨ä¸€ä¸ªæ—¶é—´ç‚¹ä½¿å¾—ä¸¤ä¸ªä¸åŒçš„é¢†å¯¼äººåœ¨åŒä¸€ä¸ªä»»æœŸå†…é€‰ä¸¾æˆåŠŸï¼›å…¶ä¸­ä¸€ä¸ªæ˜¯é€šè¿‡æ—§çš„é›†ç¾¤é…ç½®ï¼Œå¦ä¸€ä¸ªæ˜¯é€šè¿‡æ–°çš„é›†ç¾¤é…ç½®ã€‚</p>

<p><img src="https://raw.githubusercontent.com/kkzhang-tt/kkzhang-tt.github.io/main/_images/raft_7.png" /></p>

<p>ä¸ºäº†ä¿è¯å®‰å…¨æ€§ï¼ŒRaft é‡‡ç”¨çš„æ˜¯ä¸¤é˜¶æ®µæ–¹æ³•ï¼šé›†ç¾¤å…ˆåˆ‡æ¢åˆ°ä¸€ä¸ªè¿‡æ¸¡çš„é…ç½®ï¼Œç§°ä¸ºå…±åŒä¸€è‡´ï¼›ä¸€æ—¦å…±åŒä¸€è‡´å·²ç»è¢«æäº¤äº†ï¼Œé‚£ä¹ˆç³»ç»Ÿå°±åˆ‡æ¢åˆ°æ–°çš„é…ç½®ä¸Šã€‚å…±åŒä¸€è‡´æ˜¯è€é…ç½®å’Œæ–°é…ç½®çš„ç»“åˆï¼š</p>

<ul>
  <li>æ—¥å¿—æ¡ç›®è¢«å¤åˆ¶ç»™é›†ç¾¤ä¸­æ–°ã€è€é…ç½®çš„æ‰€æœ‰æœåŠ¡å™¨ã€‚</li>
  <li>æ–°ã€æ—§é…ç½®çš„æœåŠ¡å™¨éƒ½å¯ä»¥æˆä¸ºé¢†å¯¼äººã€‚</li>
  <li>è¾¾æˆä¸€è‡´ï¼ˆé’ˆå¯¹é€‰ä¸¾å’Œæäº¤ï¼‰éœ€è¦åˆ†åˆ«åœ¨ä¸¤ç§é…ç½®ä¸Šè·å¾—å¤§å¤šæ•°çš„æ”¯æŒã€‚</li>
</ul>

<p>å…±åŒä¸€è‡´å…è®¸ç‹¬ç«‹çš„æœåŠ¡å™¨åœ¨ä¸å½±å“å®‰å…¨æ€§çš„å‰æä¸‹ï¼Œåœ¨ä¸åŒçš„æ—¶é—´è¿›è¡Œé…ç½®è½¬æ¢è¿‡ç¨‹ã€‚æ­¤å¤–ï¼Œå…±åŒä¸€è‡´å¯ä»¥è®©é›†ç¾¤åœ¨é…ç½®è½¬æ¢çš„è¿‡ç¨‹ä¸­ä¾ç„¶å“åº”å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚</p>

<p>å…³äºé›†ç¾¤é…ç½®ï¼Œå­˜åœ¨ä¸€æ¡è§„åˆ™ï¼š<strong>ä¸€æ—¦ä¸€ä¸ªæœåŠ¡å™¨å°†æ–°çš„é…ç½®æ—¥å¿—æ¡ç›®å¢åŠ åˆ°å®ƒçš„æ—¥å¿—ä¸­ï¼Œå®ƒå°±ä¼šç”¨è¿™ä¸ªé…ç½®æ¥åšå‡ºæœªæ¥æ‰€æœ‰çš„å†³å®šï¼ˆæœåŠ¡å™¨æ€»æ˜¯ä½¿ç”¨æœ€æ–°çš„é…ç½®ï¼Œæ— è®ºä»–æ˜¯å¦å·²ç»è¢«æäº¤ï¼‰</strong>ã€‚</p>

<p>é‚£ä¹ˆæˆå‘˜å˜åŒ–æ—¶ï¼Œæ•´ä¸ªåˆ‡æ¢æµç¨‹å¦‚ä¸‹ï¼š</p>

<ol>
  <li>
    <p>Leader æ”¶åˆ°æ–°çš„é›†ç¾¤é…ç½®è¯·æ±‚ C-new</p>
  </li>
  <li>
    <p>Leader ä¸ºäº†å…±åŒä¸€è‡´å­˜å‚¨é…ç½® C-old,newï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°æœ¬åœ°æ—¥å¿—ä¸­ï¼ŒåŒæ—¶å¤åˆ¶ç»™é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ï¼ˆæ­¤æ—¶éœ€è¦æˆåŠŸ</p>

    <p>å¤åˆ¶åˆ° C-old,new ä¸­å¤§å¤šæ•°èŠ‚ç‚¹ï¼Œæ‰èƒ½æäº¤</p>

    <p>ï¼‰ã€‚åœ¨æ­¤æœŸé—´ï¼Œå¦‚æœ Leader æ”¶åˆ°äº†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œé‚£ä¹ˆä¹Ÿéœ€è¦å°†æ—¥å¿—å¤åˆ¶åˆ° C-old,new ä¸­çš„å¤§éƒ¨åˆ†èŠ‚ç‚¹æ‰èƒ½æäº¤</p>

    <ul>
      <li>å¦‚æœ C-old,new è¿˜æ²¡æäº¤ï¼Œä½†æ˜¯æ­¤æ—¶ Leader å´©æºƒäº†ï¼Œè¢«é€‰å‡ºæ¥çš„æ–° Leader å¯èƒ½æ˜¯ä½¿ç”¨ C-old é…ç½®ä¹Ÿå¯èƒ½æ˜¯ C-old,new é…ç½®ï¼Œè¿™å–å†³äºèµ¢å¾—é€‰ä¸¾çš„å€™é€‰äººæ˜¯å¦å·²ç»æ¥æ”¶åˆ°äº† C-old,new é…ç½®ã€‚åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œ C-new é…ç½®åœ¨è¿™ä¸€æ—¶æœŸéƒ½ä¸ä¼šå•æ–¹é¢çš„åšå‡ºå†³å®šã€‚</li>
      <li>å¦‚æœ C-old,new è¢«æˆåŠŸæäº¤äº†ï¼Œé‚£ä¹ˆå³ä½¿ Leader å´©æºƒäº†ï¼Œåªæœ‰æ‹¥æœ‰ C-old,new çš„èŠ‚ç‚¹æ‰èƒ½æˆä¸ºæ–°çš„ Leaderï¼ˆLeader å®Œå…¨ç‰¹æ€§ï¼‰</li>
    </ul>
  </li>
  <li>
    <p>Leader åˆ›å»ºæ–°çš„é›†ç¾¤é…ç½® C-newï¼Œå¹¶æ·»åŠ åˆ°è‡ªå·±çš„æœ¬åœ°æ—¥å¿—ä¸­ï¼ŒåŒæ—¶å°†æ—¥å¿—å¤åˆ¶ç»™ Followerï¼ˆæ­¤æ—¶</p>

    <p>åªéœ€è¦ C-new ä¸­å¤§å¤šæ•°èŠ‚ç‚¹åŒæ„å³å¯</p>

    <p>ï¼Œåç»­éƒ½é‡‡ç”¨æ–°çš„é…ç½®ï¼‰ã€‚åœ¨æ­¤æœŸé—´ï¼Œå¦‚æœ Leader æ”¶åˆ°äº†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œåªéœ€è¦å°†æ—¥å¿—å¤åˆ¶åˆ° C-new çš„å¤§å¤šæ•°èŠ‚ç‚¹å³å¯æäº¤</p>

    <ul>
      <li>å¦‚æœ C-new è¿˜æ²¡æäº¤ä½†æ˜¯ Leader å´©æºƒäº†ï¼Œé‚£ä¹ˆæ–° Leader å¯èƒ½ä½¿ç”¨ C-newï¼Œä¹Ÿå¯èƒ½ä½¿ç”¨ C-old,new ä½œä¸ºé…ç½®</li>
      <li>å¦‚æœ C-new æäº¤å Leader å´©æºƒäº†ï¼Œé‚£ä¹ˆæ–° Leader åªèƒ½ä½¿ç”¨ C-old,new ä½œä¸ºæ–°é…ç½®</li>
    </ul>
  </li>
  <li>
    <p>å¦‚æœ Follower å‘ç°è‡ªå·±ä¸åœ¨ C-new ä¸­ï¼Œåˆ™ä¼šä¸»åŠ¨é€€å‡º</p>

    <ul>
      <li>å¦‚æœå½“å‰ Leader ä¸æ˜¯ C-new ä¸­çš„ä¸€å‘˜ï¼Œåˆ™åœ¨ C-new é…ç½®æäº¤åé€€å‡º</li>
    </ul>
  </li>
</ol>

<p>ä½¿ç”¨ä¸¤é˜¶æ®µè¿‡æ¸¡çš„æ–¹å¼ï¼ŒC-old ä¸ C-new ä¸ä¼šåŒæ—¶åšå‡ºå•æ–¹é¢çš„å†³å®šï¼Œä¿è¯äº†å®‰å…¨æ€§ã€‚</p>

<p><img src="https://raw.githubusercontent.com/kkzhang-tt/kkzhang-tt.github.io/main/_images/raft_8.png" /></p>

<h2 id="çº¿æ€§åŒ–è¯­ä¹‰æ”¯æŒ">çº¿æ€§åŒ–è¯­ä¹‰æ”¯æŒ</h2>

<h2 id="çº¿æ€§åŒ–è¯­ä¹‰æ”¯æŒ-1">çº¿æ€§åŒ–è¯­ä¹‰æ”¯æŒ</h2>

<h3 id="å®¢æˆ·ç«¯äº¤äº’">å®¢æˆ·ç«¯äº¤äº’</h3>

<p>Raft ä¸­çš„å®¢æˆ·ç«¯å‘é€æ‰€æœ‰è¯·æ±‚ç»™ Leaderã€‚</p>

<p>å½“å®¢æˆ·ç«¯å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šéšæœºæŒ‘é€‰ä¸€ä¸ªæœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚å¦‚æœå®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡æŒ‘é€‰çš„æœåŠ¡å™¨ä¸æ˜¯Leaderï¼Œé‚£ä¹ˆé‚£ä¸ªæœåŠ¡å™¨ä¼šæ‹’ç»å®¢æˆ·ç«¯çš„è¯·æ±‚å¹¶ä¸”æä¾›ä»–æœ€è¿‘æ¥æ”¶åˆ°çš„ Leader çš„ä¿¡æ¯ï¼ˆé™„åŠ æ¡ç›®è¯·æ±‚åŒ…å«äº†é¢†å¯¼äººçš„ç½‘ç»œåœ°å€ï¼‰ã€‚å¦‚æœ Leader å·²ç»å´©æºƒäº†ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯çš„è¯·æ±‚å°±ä¼šè¶…æ—¶ï¼›å®¢æˆ·ç«¯ä¹‹åä¼šå†æ¬¡é‡è¯•éšæœºæŒ‘é€‰æœåŠ¡å™¨çš„è¿‡ç¨‹ã€‚</p>

<h3 id="å†™çº¿æ€§åŒ–">å†™çº¿æ€§åŒ–</h3>

<p>Raft æ˜¯å¯ä»¥æ‰§è¡ŒåŒä¸€æ¡å‘½ä»¤å¤šæ¬¡çš„ï¼šä¾‹å¦‚ï¼ŒLeader åœ¨æäº¤äº†è¿™æ¡æ—¥å¿—ä¹‹åï¼Œä½†æ˜¯åœ¨å“åº”å®¢æˆ·ç«¯ä¹‹å‰å´©æºƒäº†ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯ä¼šå’Œæ–°çš„é¢†å¯¼äººé‡è¯•è¿™æ¡æŒ‡ä»¤ï¼Œå¯¼è‡´è¿™æ¡å‘½ä»¤å°±è¢«å†æ¬¡æ‰§è¡Œäº†ã€‚è§£å†³æ–¹æ¡ˆå°±æ˜¯å®¢æˆ·ç«¯å¯¹äºæ¯ä¸€æ¡æŒ‡ä»¤éƒ½èµ‹äºˆä¸€ä¸ªå”¯ä¸€çš„åºåˆ—å·ã€‚ç„¶åï¼ŒçŠ¶æ€æœºè·Ÿè¸ªæ¯æ¡æŒ‡ä»¤æœ€æ–°çš„åºåˆ—å·å’Œç›¸åº”çš„å“åº”ã€‚å¦‚æœæ¥æ”¶åˆ°ä¸€æ¡æŒ‡ä»¤ï¼Œå®ƒçš„åºåˆ—å·å·²ç»è¢«æ‰§è¡Œäº†ï¼Œé‚£ä¹ˆå°±ç«‹å³è¿”å›ç»“æœï¼Œè€Œä¸é‡æ–°æ‰§è¡ŒæŒ‡ä»¤ã€‚</p>

<h3 id="è¯»çº¿æ€§åŒ–">è¯»çº¿æ€§åŒ–</h3>

<p>ä¸ºäº†é˜²æ­¢å‰ä»» Leader å´©æºƒå¯¼è‡´è¯»å–äº†è„æ•°æ®ï¼Œéœ€è¦ä¸€äº›é¢å¤–çš„æªæ–½ã€‚</p>

<ol>
  <li>
    <p>Leader å¿…é¡»æœ‰å…³äºè¢«æäº¤æ—¥å¿—çš„æœ€æ–°ä¿¡æ¯</p>

    <p>Leader å®Œå…¨ç‰¹æ€§ä¿è¯äº† Leader ä¸€å®šæ‹¥æœ‰æ‰€æœ‰å·²ç»è¢«æäº¤çš„æ—¥å¿—æ¡ç›®ï¼Œä½†æ˜¯åœ¨å…¶ä»»æœŸå¼€å§‹çš„æ—¶å€™ï¼Œå¯èƒ½ä¸çŸ¥é“å“ªäº›æ˜¯å·²ç»è¢«æäº¤çš„ã€‚ä¸ºäº†çŸ¥é“è¿™äº›ä¿¡æ¯ï¼ŒLeader éœ€è¦åœ¨ä»»æœŸé‡Œæäº¤ä¸€æ¡æ—¥å¿—æ¡ç›®ã€‚</p>

    <p>Raft ä¸­é€šè¿‡é¢†å¯¼äººåœ¨ä»»æœŸå¼€å§‹çš„æ—¶å€™æäº¤ä¸€ä¸ªç©ºç™½çš„æ²¡æœ‰ä»»ä½•æ“ä½œçš„æ—¥å¿—æ¡ç›®åˆ°æ—¥å¿—ä¸­å»æ¥å®ç°ã€‚è¯¥åŠ¨ä½œä¼šä½¿å¾—å‰ä»» Leader çš„ log å…¨éƒ¨è¢«æäº¤ï¼ŒåŒæ—¶ä¼šé—´æ¥ä¿ƒè¿› Follower æäº¤ä¹‹å‰çš„æ—¥å¿—å¹¶ä¸ Leader ä¿æŒä¸€è‡´ã€‚</p>
  </li>
  <li>
    <p>é¢†å¯¼äººåœ¨å¤„ç†åªè¯»çš„è¯·æ±‚ä¹‹å‰å¿…é¡»æ£€æŸ¥è‡ªå·±æ˜¯å¦å·²ç»è¢«åºŸé»œäº†</p>

    <p>Raft ä¸­é€šè¿‡è®© Leader åœ¨å“åº”åªè¯»è¯·æ±‚ä¹‹å‰ï¼Œå…ˆå’Œé›†ç¾¤ä¸­çš„å¤§å¤šæ•°èŠ‚ç‚¹äº¤æ¢ä¸€æ¬¡å¿ƒè·³ä¿¡æ¯æ¥å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚</p>
  </li>
</ol>

      <div class="c-article__footer u-clearfix">
        <div class="c-article__tag">
          
        </div>
        <div class="c-article__share">
          <a href="https://twitter.com/intent/tweet?text=Raft:%20An%20Understandable%20Consensus%20Algorithm&url=kkzhang-tt.github.io/2021/05/23/raft/" title="Share
          on Twitter" rel="nofollow" target="_blank"><div data-icon='ei-sc-twitter' data-size='s'></div></a>
          <a href="https://facebook.com/sharer.php?u=kkzhang-tt.github.io/2021/05/23/raft/" title="Share on Facebook" rel="nofollow" target="_blank"><div data-icon='ei-sc-facebook' data-size='s'></div></a>
        </div>
      </div>
      <div class="c-newsletter">
  <div class="c-newsletter__header">
    <h4 class="c-newsletter__title">Newsletter</h4>
    <div class="c-newsletter__subtitle">Subscribe to this blog and receive notifications of new posts by email.</div>
  </div>
  <form class="c-newsletter-form validate" action="#" method="POST" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" target="_blank" novalidate>
    <div class="c-newsletter-form__group">
      <label class="u-screen-reader-text" for="mce-EMAIL">Email address</label>
      <input class="c-newsletter__email required email" id="mce-EMAIL" type="email" name="EMAIL" placeholder="Your email address" autocomplete="on">
      <input class="c-newsletter__button" id="mc-embedded-subscribe" type="submit" name="subscribe" value="Subscribe">
    </div>
  </form>
</div> <!-- /.c-newsletter -->
      <div class="c-recent-post">
        <h4 class="c-recent__title">You might also enjoy</h4>
        <div class="c-recent__box">
        
        
          <div class="c-recent__item">
            <a class="c-recent__image" href="/2021/06/26/nce2_lesson_7/" style="background-image: url( /images/nce_l7.jpg)"></a>
            <div class="c-recent__footer">
              <h4><a href="/2021/06/26/nce2_lesson_7/">New Concept English (Lesson 7)</a></h4>
              <div class="c-recent__date">
                <time datetime="2021-06-26T00:00:00+08:00">June 26, 2021</time>
              </div>
            </div>
          </div>
        
        
        
          <div class="c-recent__item">
            <a class="c-recent__image" href="/2021/06/22/summary_h1_2021/" style="background-image: url( /images/2021_summary_h1.jpg)"></a>
            <div class="c-recent__footer">
              <h4><a href="/2021/06/22/summary_h1_2021/">2021 H1 Summary</a></h4>
              <div class="c-recent__date">
                <time datetime="2021-06-22T00:00:00+08:00">June 22, 2021</time>
              </div>
            </div>
          </div>
        
        
        
          <div class="c-recent__item">
            <a class="c-recent__image" href="/2021/06/19/nce2_lesson_6/" style="background-image: url( /images/nce_l6.jpg)"></a>
            <div class="c-recent__footer">
              <h4><a href="/2021/06/19/nce2_lesson_6/">New Concept English (Lesson 6)</a></h4>
              <div class="c-recent__date">
                <time datetime="2021-06-19T00:00:00+08:00">June 19, 2021</time>
              </div>
            </div>
          </div>
        
        
        
          <div class="c-recent__item">
            <a class="c-recent__image" href="/2021/06/19/ddia-3/" style="background-image: url( /images/ddia_3.jpg)"></a>
            <div class="c-recent__footer">
              <h4><a href="/2021/06/19/ddia-3/">DDIA: ä¸€è‡´æ€§ä¸å…±è¯†ï¼ˆä¸‰ï¼‰</a></h4>
              <div class="c-recent__date">
                <time datetime="2021-06-19T00:00:00+08:00">June 19, 2021</time>
              </div>
            </div>
          </div>
        
        
        </div>
      </div> <!-- /.c-recent-post -->
      
    </div> <!-- /.c-wrap-content -->
  </div> <!-- /.c-article__content -->
</article> <!-- /.c-article-page -->

</main> <!-- /.c-content -->
  </div> <!-- /.o-wrapper -->
  <div class="c-top" data-icon='ei-chevron-up' data-size='s' title="Scroll To Top"></div> <!-- /.c-top -->
  <script src="/js/jquery-3.3.1.min.js"></script>
<script src="/js/evil-icons.min.js"></script>
<script src="/js/jquery.fitvids.js"></script>
<script src="/js/simple-jekyll-search.min.js"></script>
<script src="/js/main.js"></script>
<!-- /javascripts -->
</body>
</html>